{"version":3,"sources":["../../../src/core/template-system/schemas.ts","../../../src/core/template-system/registry.ts","../../../src/core/template-system/processor.ts","../../../src/core/commands/shared/json-output.ts","../../../src/services/progress-reporter.ts","../../../src/core/commands/new-server.ts","../../../src/core/commands/template.ts","../../../src/core/commands/shared/backup-restore.ts","../../../src/core/commands/shared/orchestration/scaffold-orchestrator.ts","../../../src/core/commands/shared/registration-service.ts","../../../src/core/commands/shared/validation-service.ts","../../../src/core/commands/shared/template-service.ts","../../../src/core/commands/shared/config/wrangler-utils.ts","../../../src/core/commands/shared/utils.ts","../../../src/core/commands/shared/binding-detection-service.ts","../../../src/core/commands/shared/metadata.ts","../../../src/core/commands/shared/schemas.ts","../../../src/core/commands/shared/strategies/entity-scaffold-strategy.ts","../../../src/core/commands/shared/entity-scaffolder.ts","../../../src/core/commands/add-prompt.ts","../../../src/core/commands/add-resource.ts","../../../src/core/commands/shared/platform-detection.ts","../../../src/core/commands/shared/auth-templates.ts","../../../src/core/commands/shared/dependency-manager.ts","../../../src/core/commands/shared/anchor-service.ts","../../../src/core/commands/shared/entry-point-transformer.ts","../../../src/core/commands/shared/toml-merger.ts","../../../src/core/commands/shared/config/auth-config-updater.ts","../../../src/core/commands/shared/validation-gate.ts","../../../src/core/commands/shared/strategies/auth-scaffold-strategy.ts","../../../src/core/commands/shared/auth-scaffolder.ts","../../../src/core/commands/add-auth.ts","../../../src/types/binding-types.ts","../../../src/core/commands/shared/binding-validator.ts","../../../src/core/commands/shared/binding-template-service.ts","../../../src/core/commands/shared/config/binding-config-updater.ts","../../../src/core/commands/shared/strategies/binding-scaffold-strategy.ts","../../../src/core/commands/shared/binding-scaffolder.ts","../../../src/core/commands/add-binding.ts","../../../src/core/commands/add-tool.ts","../../../src/core/commands/validate.ts","../../../src/core/commands/shared/entity-lister.ts","../../../src/core/commands/list-tools.ts","../../../src/core/commands/list-prompts.ts","../../../src/core/commands/list-resources.ts","../../../src/core/commands/list.ts"],"names":["__filename","__dirname","readdir","join","dirname","readFile","resolve","fileURLToPath","path","Command","stat","existsSync","writeFile","insertPos","comment","Handlebars","access","z","TemplateConfigSchema","mkdir","modified","statSync","readFileSync","execAsync","promisify","exec","toKebabCase","toPascalCase","printHumanReadableResult","createValidateCommand","fileExists","fs","createListCommand"],"mappings":";;;;;;;;;;;;;;;AAWO,IAAM,sBAAA,GAAyB,EAAE,MAAA,CAAO;AAAA,EAC9C,IAAA,EAAM,EACJ,MAAA,EAAO,CACP,IAAI,CAAC,CAAA,CACL,KAAA,CAAM,mBAAA,EAAqB,kDAAkD,CAAA;AAAA,EAC/E,QAAA,EAAU,EAAE,OAAA,EAAQ;AAAA,EACpB,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC7B,MAAA,EAAQ,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC5B,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AACrB,CAAC,CAAA;AAKM,IAAM,wBAAA,GAA2B,EAAE,MAAA,CAAO;AAAA,EAChD,OAAA,EAAS,EAAE,OAAA,EAAQ;AAAA,EACnB,cAAA,EAAgB,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EACpC,aAAa,CAAA,CAAE,KAAA,CAAM,EAAE,MAAA,EAAQ,EAAE,QAAA,EAAS;AAAA,EAC1C,SAAA,EAAW,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AACvB,CAAC,CAAA;AAKM,IAAM,0BAAA,GAA6B,EAAE,MAAA,CAAO;AAAA,EAClD,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,IAAI,CAAC,CAAA;AAAA,EACzB,SAAA,EAAW,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,CAAI,CAAC,CAAC,CAAA,CAAE,GAAA,CAAI,CAAC,CAAA;AAAA,EAC3C,YAAY,CAAA,CAAE,IAAA,CAAK,CAAC,QAAA,EAAU,OAAO,CAAC,CAAA;AAAA,EACtC,UAAU,CAAA,CAAE,IAAA,CAAK,CAAC,YAAA,EAAc,YAAY,CAAC;AAC9C,CAAC,CAAA;AAKM,IAAM,0BAAA,GAA6B,EAAE,MAAA,CAAO;AAAA,EAClD,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC7B,MAAA,EAAQ,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC5B,kBAAkB,CAAA,CAAE,MAAA,CAAO,EAAE,MAAA,EAAQ,EAAE,QAAA;AACxC,CAAC,CAAA;AAKM,IAAM,yBAAA,GAA4B,EAAE,MAAA,CAAO;AAAA,EACjD,GAAA,EAAK,CAAA,CAAE,MAAA,EAAO,CAAE,IAAI,CAAC,CAAA;AAAA,EACrB,IAAA,EAAM,CAAA,CAAE,MAAA,EAAO,CAAE,IAAI,CAAC,CAAA;AAAA,EACtB,MAAA,EAAQ,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC5B,SAAA,EAAW,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AACvB,CAAC,CAAA;AAKM,IAAM,sBAAA,GAAyB,EAAE,MAAA,CAAO;AAAA,EAC9C,WAAA,EAAa,EAAE,OAAA,EAAQ;AAAA,EACvB,kBAAA,EAAoB,EAAE,OAAA,EAAQ;AAAA,EAC9B,YAAA,EAAc,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,QAAQ,CAAA;AAAA,EAChC,aAAA,EAAe,EAAE,OAAA;AAClB,CAAC,CAAA;AAKM,IAAM,2BAAA,GAA8B,EAAE,MAAA,CAAO;AAAA,EACnD,IAAA,EAAM,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC1B,GAAA,EAAK,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EACzB,IAAA,EAAM,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC1B,IAAA,EAAM,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAClB,CAAC,CAAA;AAKM,IAAM,oBAAA,GAAuB,EAAE,MAAA,CAAO;AAAA,EAC5C,EAAA,EAAI,EACF,MAAA,EAAO,CACP,IAAI,CAAC,CAAA,CACL,KAAA,CAAM,cAAA,EAAgB,4CAA4C,CAAA;AAAA,EACpE,SAAS,CAAA,CAAE,MAAA,EAAO,CAAE,KAAA,CAAM,mBAAmB,sCAAsC,CAAA;AAAA,EACnF,IAAA,EAAM,CAAA,CAAE,MAAA,EAAO,CAAE,IAAI,CAAC,CAAA;AAAA,EACtB,WAAA,EAAa,CAAA,CAAE,MAAA,EAAO,CAAE,IAAI,CAAC,CAAA;AAAA,EAC7B,YAAA,EAAc,0BAAA;AAAA,EACd,YAAA,EAAc,0BAAA;AAAA,EACd,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACrB,SAAA,EAAW,CAAA,CAAE,KAAA,CAAM,sBAAsB,CAAA;AAAA,IACzC,YAAA,EAAc,yBAAyB,QAAA;AAAS,GAChD,CAAA;AAAA,EACD,GAAA,EAAK,yBAAA;AAAA,EACL,QAAA,EAAU,sBAAA;AAAA,EACV,aAAA,EAAe;AAChB,CAAC,CAAA;AAKqC,EAAE,MAAA,CAAO;AAAA,EAC9C,EAAA,EAAI,EAAE,MAAA,EAAO;AAAA,EACb,OAAA,EAAS,EAAE,MAAA,EAAO;AAAA,EAClB,IAAA,EAAM,EAAE,MAAA,EAAO;AAAA,EACf,eAAA,EAAiB,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EACrC,cAAA,EAAgB,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EACpC,aAAA,EAAe,EAAE,MAAA,EAAO;AAAA,EACxB,SAAA,EAAW,CAAA,CAAE,MAAA,CAAO,CAAA,CAAE,QAAQ;AAC/B,CAAC;AAKoC,EAAE,MAAA,CAAO;AAAA,EAC7C,QAAA,EAAU,CAAA,CAAE,MAAA,EAAO,CAAE,IAAI,CAAC,CAAA;AAAA,EAC1B,SAAA,EAAW,CAAA,CAAE,MAAA,EAAO,CAAE,IAAI,CAAC,CAAA;AAAA,EAC3B,SAAA,EAAW,CAAA,CAAE,MAAA,CAAO,CAAA,CAAE,QAAQ,CAAA;AAAA,EAC9B,SAAA,EAAW,CAAA,CAAE,OAAA,EAAQ,CAAE,QAAA,EAAS;AAAA,EAChC,cAAA,EAAgB,CAAA,CAAE,IAAA,CAAK,CAAC,KAAA,EAAO,QAAQ,MAAA,EAAQ,KAAK,CAAC,CAAA,CAAE,QAAA,EAAS;AAAA,EAChE,SAAA,EAAW,CAAA,CAAE,OAAA,EAAQ,CAAE,QAAA;AACxB,CAAC;AAKmC,EAAE,MAAA,CAAO;AAAA,EAC5C,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC7B,SAAA,EAAW,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC/B,UAAA,EAAY,EAAE,IAAA,CAAK,CAAC,UAAU,OAAO,CAAC,EAAE,QAAA,EAAS;AAAA,EACjD,QAAA,EAAU,EAAE,IAAA,CAAK,CAAC,cAAc,YAAY,CAAC,EAAE,QAAA;AAChD,CAAC;AAKM,SAAS,uBAAuB,MAAA,EAIrC;AACD,EAAA,MAAM,MAAA,GAAS,oBAAA,CAAqB,SAAA,CAAU,MAAM,CAAA;AAEpD,EAAA,IAAI,OAAO,OAAA,EAAS;AACnB,IAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,IAAA,EAAM,OAAO,IAAA,EAAK;AAAA,EAC3C;AAEA,EAAA,OAAO,EAAE,OAAA,EAAS,KAAA,EAAO,MAAA,EAAQ,OAAO,KAAA,EAAM;AAC/C;;;ACpIA,SAAS,eAAA,GAA0B;AAClC,EAAA,MAAMA,WAAAA,GAAa,aAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAChD,EAAA,MAAMC,UAAAA,GAAY,QAAQD,WAAU,CAAA;AAGpC,EAAA,IAAIC,UAAAA,CAAU,QAAA,CAAS,OAAO,CAAA,EAAG;AAEhC,IAAA,OAAO,IAAA,CAAKA,YAAW,oBAAoB,CAAA;AAAA,EAC5C,CAAA,MAAO;AAEN,IAAA,OAAO,IAAA,CAAKA,YAAW,cAAc,CAAA;AAAA,EACtC;AACD;AAKO,IAAM,mBAAN,MAAuB;AAAA,EACrB,YAAA;AAAA,EACA,cAAA,uBAA4C,GAAA,EAAI;AAAA,EAExD,YAAY,YAAA,EAAuB;AAElC,IAAA,IAAA,CAAK,YAAA,GAAe,gBAAgB,eAAA,EAAgB;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBAAA,GAA+C;AACpD,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAM,OAAA,CAAQ,IAAA,CAAK,cAAc,EAAE,aAAA,EAAe,MAAM,CAAA;AAExE,MAAA,MAAM,YAA8B,EAAC;AAErC,MAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC5B,QAAA,IAAI,CAAC,KAAA,CAAM,WAAA,EAAY,EAAG;AAE1B,QAAA,MAAM,YAAA,GAAe,IAAA,CAAK,IAAA,CAAK,YAAA,EAAc,MAAM,IAAI,CAAA;AACvD,QAAA,MAAM,UAAA,GAAa,IAAA,CAAK,YAAA,EAAc,sBAAsB,CAAA;AAE5D,QAAA,IAAI;AAEH,UAAA,MAAM,OAAO,UAAU,CAAA;AAAA,QACxB,CAAA,CAAA,MAAQ;AAGP,UAAA;AAAA,QACD;AAEA,QAAA,IAAI;AAEH,UAAA,MAAM,aAAA,GAAgB,MAAM,QAAA,CAAS,UAAA,EAAY,OAAO,CAAA;AACxD,UAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,aAAa,CAAA;AAGvC,UAAA,MAAM,UAAA,GAAa,uBAAuB,MAAM,CAAA;AAEhD,UAAA,IAAI,UAAA,CAAW,OAAA,IAAW,UAAA,CAAW,IAAA,EAAM;AAC1C,YAAA,SAAA,CAAU,IAAA,CAAK,WAAW,IAAI,CAAA;AAG9B,YAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,UAAA,CAAW,IAAA,CAAK,EAAA,EAAI;AAAA,cAC3C,QAAQ,UAAA,CAAW,IAAA;AAAA,cACnB,IAAA,EAAM,YAAA;AAAA,cACN,SAAA,EAAW,IAAA,CAAK,YAAA,EAAc,OAAO,CAAA;AAAA,cACrC,SAAA,EAAW,IAAA,CAAK,YAAA,EAAc,OAAO;AAAA,aACrC,CAAA;AAAA,UACF,CAAA,MAAO;AAEN,YAAA,OAAA,CAAQ,IAAA;AAAA,cACP,CAAA,kBAAA,EAAqB,MAAM,IAAI,CAAA,uBAAA;AAAA,aAChC;AAAA,UACD;AAAA,QACD,SAAS,KAAA,EAAO;AAEf,UAAA,OAAA,CAAQ,IAAA;AAAA,YACP,CAAA,kBAAA,EAAqB,KAAA,CAAM,IAAI,CAAA,EAAA,EAAK,KAAA,YAAiB,QAAQ,KAAA,CAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,WAC3F;AACA,UAAA;AAAA,QACD;AAAA,MACD;AAEA,MAAA,OAAO,SAAA;AAAA,IACR,SAAS,KAAA,EAAO;AACf,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,8BAAA,EAAiC,KAAK,CAAA,CAAE,CAAA;AAAA,IACzD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,EAAA,EAA+B;AAEhD,IAAA,IAAI,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,EAAE,CAAA,EAAG;AAChC,MAAA,OAAO,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,EAAE,CAAA;AAAA,IAClC;AAGA,IAAA,MAAM,KAAK,iBAAA,EAAkB;AAG7B,IAAA,IAAI,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,EAAE,CAAA,EAAG;AAChC,MAAA,OAAO,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,EAAE,CAAA;AAAA,IAClC;AAEA,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,oBAAA,EAAuB,EAAE,CAAA,CAAE,CAAA;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBAAiB,EAAA,EAA+C;AACrE,IAAA,MAAM,SAAmB,EAAC;AAC1B,IAAA,MAAM,WAAqB,EAAC;AAE5B,IAAA,IAAI;AACH,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,WAAA,CAAY,EAAE,CAAA;AAM1C,MAAA,IAAI;AACH,QAAA,MAAM,MAAA,CAAO,SAAS,SAAS,CAAA;AAAA,MAChC,CAAA,CAAA,MAAQ;AACP,QAAA,MAAA,CAAO,IAAA,CAAK,CAAA,2BAAA,EAA8B,QAAA,CAAS,SAAS,CAAA,CAAE,CAAA;AAAA,MAC/D;AAGA,MAAA,MAAM,aAAA,GAAgB,CAAC,kBAAA,EAAoB,eAAA,EAAiB,eAAe,CAAA;AAE3E,MAAA,KAAA,MAAW,QAAQ,aAAA,EAAe;AACjC,QAAA,IAAI;AACH,UAAA,MAAM,MAAA,CAAO,IAAA,CAAK,QAAA,CAAS,SAAA,EAAW,IAAI,CAAC,CAAA;AAAA,QAC5C,CAAA,CAAA,MAAQ;AACP,UAAA,QAAA,CAAS,IAAA,CAAK,CAAA,0BAAA,EAA6B,IAAI,CAAA,CAAE,CAAA;AAAA,QAClD;AAAA,MACD;AAGA,MAAA,KAAA,MAAW,QAAA,IAAY,QAAA,CAAS,MAAA,CAAO,WAAA,CAAY,SAAA,EAAW;AAC7D,QAAA,IAAI,QAAA,CAAS,QAAA,IAAY,QAAA,CAAS,OAAA,EAAS;AAC1C,UAAA,QAAA,CAAS,IAAA,CAAK,CAAA,SAAA,EAAY,QAAA,CAAS,IAAI,CAAA,oCAAA,CAAsC,CAAA;AAAA,QAC9E;AAAA,MACD;AAGA,MAAA,IAAI,QAAA,CAAS,MAAA,CAAO,YAAA,CAAa,SAAA,CAAU,WAAW,CAAA,EAAG;AACxD,QAAA,MAAA,CAAO,KAAK,8CAA8C,CAAA;AAAA,MAC3D;AAEA,MAAA,OAAO;AAAA,QACN,KAAA,EAAO,OAAO,MAAA,KAAW,CAAA;AAAA,QACzB,MAAA;AAAA,QACA;AAAA,OACD;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,OAAO;AAAA,QACN,KAAA,EAAO,KAAA;AAAA,QACP,MAAA,EAAQ,CAAC,CAAA,6BAAA,EAAgC,KAAK,CAAA,CAAE,CAAA;AAAA,QAChD,UAAU;AAAC,OACZ;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,MAAA,EAAoD;AACvE,IAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,iBAAA,EAAkB;AAE/C,IAAA,IAAI,CAAC,MAAA,EAAQ;AACZ,MAAA,OAAO,SAAA;AAAA,IACR;AAEA,IAAA,OAAO,SAAA,CAAU,MAAA,CAAO,CAAC,QAAA,KAAa;AAErC,MAAA,IAAI,OAAO,OAAA,IAAW,QAAA,CAAS,YAAA,CAAa,OAAA,KAAY,OAAO,OAAA,EAAS;AACvE,QAAA,OAAO,KAAA;AAAA,MACR;AAGA,MAAA,IAAI,MAAA,CAAO,aAAa,CAAC,QAAA,CAAS,aAAa,SAAA,CAAU,QAAA,CAAS,MAAA,CAAO,SAAS,CAAA,EAAG;AACpF,QAAA,OAAO,KAAA;AAAA,MACR;AAGA,MAAA,IAAI,OAAO,UAAA,IAAc,QAAA,CAAS,YAAA,CAAa,UAAA,KAAe,OAAO,UAAA,EAAY;AAChF,QAAA,OAAO,KAAA;AAAA,MACR;AAGA,MAAA,IAAI,OAAO,QAAA,IAAY,QAAA,CAAS,YAAA,CAAa,QAAA,KAAa,OAAO,QAAA,EAAU;AAC1E,QAAA,OAAO,KAAA;AAAA,MACR;AAEA,MAAA,OAAO,IAAA;AAAA,IACR,CAAC,CAAA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAe,EAAA,EAA8B;AAClD,IAAA,IAAI;AACH,MAAA,MAAM,IAAA,CAAK,YAAY,EAAE,CAAA;AACzB,MAAA,OAAO,IAAA;AAAA,IACR,CAAA,CAAA,MAAQ;AACP,MAAA,OAAO,KAAA;AAAA,IACR;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAA,GAKH;AACF,IAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,iBAAA,EAAkB;AAE/C,IAAA,MAAM,QAAA,uBAAe,GAAA,EAAY;AACjC,IAAA,MAAM,UAAA,uBAAiB,GAAA,EAAY;AACnC,IAAA,MAAM,WAAA,uBAAkB,GAAA,EAAY;AACpC,IAAA,MAAM,SAAA,uBAAgB,GAAA,EAAY;AAElC,IAAA,KAAA,MAAW,YAAY,SAAA,EAAW;AACjC,MAAA,QAAA,CAAS,GAAA,CAAI,QAAA,CAAS,YAAA,CAAa,OAAO,CAAA;AAC1C,MAAA,KAAA,MAAW,SAAA,IAAa,QAAA,CAAS,YAAA,CAAa,SAAA,EAAW;AACxD,QAAA,UAAA,CAAW,IAAI,SAAS,CAAA;AAAA,MACzB;AACA,MAAA,WAAA,CAAY,GAAA,CAAI,QAAA,CAAS,YAAA,CAAa,UAAU,CAAA;AAChD,MAAA,SAAA,CAAU,GAAA,CAAI,QAAA,CAAS,YAAA,CAAa,QAAQ,CAAA;AAAA,IAC7C;AAEA,IAAA,OAAO,EAAE,QAAA,EAAU,UAAA,EAAY,WAAA,EAAa,SAAA,EAAU;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAmB;AAClB,IAAA,IAAA,CAAK,eAAe,KAAA,EAAM;AAAA,EAC3B;AACD,CAAA;AClPO,IAAM,oBAAN,MAAwB;AAAA,EACtB,QAAA;AAAA,EAER,YAAY,QAAA,EAA4B;AACvC,IAAA,IAAA,CAAK,QAAA,GAAW,QAAA;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,OAAA,EAAmD;AACjE,IAAA,IAAI;AAEH,MAAA,MAAM,WAAW,MAAM,IAAA,CAAK,QAAA,CAAS,WAAA,CAAY,QAAQ,QAAQ,CAAA;AAGjE,MAAA,MAAM,YAAY,IAAA,CAAK,iBAAA;AAAA,QACtB,OAAA,CAAQ,SAAA;AAAA,QACR,QAAA,CAAS,OAAO,WAAA,CAAY;AAAA,OAC7B;AAGA,MAAA,MAAM,MAAM,OAAA,CAAQ,SAAA,EAAW,EAAE,SAAA,EAAW,MAAM,CAAA;AAGlD,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,QAAA,EAAU,cAAA,EAAgB;AAAA,QAC5C,UAAU,QAAA,CAAS,MAAA;AAAA,QACnB,WAAW,OAAA,CAAQ,SAAA;AAAA,QACnB,SAAA;AAAA,QACA,gBAAgB,OAAA,CAAQ;AAAA,OACxB,CAAA;AAGD,MAAA,MAAM,IAAA,CAAK,iBAAA,CAAkB,QAAA,EAAU,OAAA,CAAQ,WAAW,SAAS,CAAA;AAGnE,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,QAAA,EAAU,eAAA,EAAiB;AAAA,QAC7C,UAAU,QAAA,CAAS,MAAA;AAAA,QACnB,WAAW,OAAA,CAAQ,SAAA;AAAA,QACnB,SAAA;AAAA,QACA,gBAAgB,OAAA,CAAQ;AAAA,OACxB,CAAA;AAGD,MAAA,IAAI,CAAC,OAAA,CAAQ,SAAA,IAAa,SAAS,MAAA,CAAO,WAAA,CAAY,cAAc,OAAA,EAAS;AAC5E,QAAA,MAAM,IAAA,CAAK,mBAAA;AAAA,UACV,OAAA,CAAQ,SAAA;AAAA,UACR,OAAA,CAAQ,cAAA;AAAA,UACR,QAAA,CAAS,MAAA,CAAO,WAAA,CAAY,YAAA,CAAa;AAAA,SAC1C;AAGA,QAAA,IAAI,QAAA,CAAS,MAAA,CAAO,WAAA,CAAY,YAAA,EAAc,WAAA,EAAa;AAC1D,UAAA,MAAM,IAAA,CAAK,sBAAA;AAAA,YACV,OAAA,CAAQ,SAAA;AAAA,YACR,QAAA,CAAS,MAAA,CAAO,WAAA,CAAY,YAAA,CAAa;AAAA,WAC1C;AAAA,QACD;AAAA,MACD;AAGA,MAAA,IAAI,QAAQ,SAAA,IAAa,QAAA,CAAS,MAAA,CAAO,WAAA,CAAY,cAAc,SAAA,EAAW;AAC7E,QAAA,MAAM,IAAA,CAAK,YAAA;AAAA,UACV,OAAA,CAAQ,SAAA;AAAA,UACR,QAAA,CAAS,MAAA,CAAO,WAAA,CAAY,YAAA,CAAa;AAAA,SAC1C;AAAA,MACD;AAGA,MAAA,MAAM,IAAA,CAAK,aAAA,CAAc,OAAA,CAAQ,SAAA,EAAW,UAAU,SAAS,CAAA;AAE/D,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,IAAA;AAAA,QACT,QAAA,EAAU,SAAS,MAAA,CAAO,EAAA;AAAA,QAC1B,MAAM,OAAA,CAAQ;AAAA,OACf;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,MAAM,OAAA,CAAQ,SAAA;AAAA,QACd,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,OAC7D;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAA,CACP,UACA,WAAA,EACyB;AACzB,IAAA,MAAM,YAAoC,EAAC;AAE3C,IAAA,KAAA,MAAW,OAAO,WAAA,EAAa;AAE9B,MAAA,IAAI,IAAI,QAAA,IAAY,CAAC,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA,EAAG;AACxC,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,2BAAA,EAA8B,GAAA,CAAI,IAAI,CAAA,CAAE,CAAA;AAAA,MACzD;AAGA,MAAA,MAAM,QAAQ,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA,IAAK,IAAI,OAAA,IAAW,EAAA;AAGnD,MAAA,IAAI,GAAA,CAAI,WAAW,KAAA,EAAO;AACzB,QAAA,MAAM,KAAA,GAAQ,IAAI,MAAA,CAAO,GAAA,CAAI,OAAO,CAAA;AACpC,QAAA,IAAI,CAAC,KAAA,CAAM,IAAA,CAAK,KAAK,CAAA,EAAG;AACvB,UAAA,MAAM,IAAI,MAAM,CAAA,SAAA,EAAY,GAAA,CAAI,IAAI,CAAA,yBAAA,EAA4B,GAAA,CAAI,OAAO,CAAA,CAAE,CAAA;AAAA,QAC9E;AAAA,MACD;AAEA,MAAA,SAAA,CAAU,GAAA,CAAI,IAAI,CAAA,GAAI,KAAA;AAAA,IACvB;AAGA,IAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,KAAK,MAAA,CAAO,OAAA,CAAQ,QAAQ,CAAA,EAAG;AACpD,MAAA,IAAI,CAAC,SAAA,CAAU,GAAG,CAAA,EAAG;AACpB,QAAA,SAAA,CAAU,GAAG,CAAA,GAAI,KAAA;AAAA,MAClB;AAAA,IACD;AAEA,IAAA,OAAO,SAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAA,CACb,QAAA,EACA,SAAA,EACA,SAAA,EACgB;AAChB,IAAA,MAAM,IAAA,CAAK,sBAAA,CAAuB,QAAA,CAAS,SAAA,EAAW,WAAW,SAAS,CAAA;AAAA,EAC3E;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAA,CACb,SAAA,EACA,SAAA,EACA,SAAA,EACgB;AAChB,IAAA,MAAM,UAAU,MAAMC,OAAAA,CAAQ,WAAW,EAAE,aAAA,EAAe,MAAM,CAAA;AAEhE,IAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC5B,MAAA,MAAM,UAAA,GAAaC,IAAAA,CAAK,SAAA,EAAW,KAAA,CAAM,IAAI,CAAA;AAC7C,MAAA,IAAI,UAAA,GAAaA,IAAAA,CAAK,SAAA,EAAW,KAAA,CAAM,IAAI,CAAA;AAG3C,MAAA,IAAI,KAAA,CAAM,IAAA,CAAK,QAAA,CAAS,MAAM,CAAA,EAAG;AAChC,QAAA,UAAA,GAAaA,KAAK,SAAA,EAAW,KAAA,CAAM,KAAK,KAAA,CAAM,CAAA,EAAG,EAAE,CAAC,CAAA;AAAA,MACrD;AAEA,MAAA,IAAI,KAAA,CAAM,aAAY,EAAG;AAExB,QAAA,MAAM,KAAA,CAAM,UAAA,EAAY,EAAE,SAAA,EAAW,MAAM,CAAA;AAC3C,QAAA,MAAM,IAAA,CAAK,sBAAA,CAAuB,UAAA,EAAY,UAAA,EAAY,SAAS,CAAA;AAAA,MACpE,CAAA,MAAO;AAEN,QAAA,MAAM,IAAA,CAAK,WAAA,CAAY,UAAA,EAAY,UAAA,EAAY,SAAS,CAAA;AAAA,MACzD;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,WAAA,CACb,UAAA,EACA,UAAA,EACA,SAAA,EACgB;AAEhB,IAAA,MAAM,MAAMC,OAAAA,CAAQ,UAAU,GAAG,EAAE,SAAA,EAAW,MAAM,CAAA;AAGpD,IAAA,IAAI,UAAA,CAAW,QAAA,CAAS,MAAM,CAAA,EAAG;AAEhC,MAAA,MAAM,eAAA,GAAkB,MAAMC,QAAAA,CAAS,UAAA,EAAY,OAAO,CAAA;AAG1D,MAAA,MAAM,QAAA,GAAW,UAAA,CAAW,OAAA,CAAQ,eAAe,CAAA;AACnD,MAAA,MAAM,gBAAA,GAAmB,SAAS,SAAS,CAAA;AAG3C,MAAA,MAAM,SAAA,CAAU,UAAA,EAAY,gBAAA,EAAkB,OAAO,CAAA;AAAA,IACtD,CAAA,MAAO;AAEN,MAAA,MAAM,QAAA,CAAS,YAAY,UAAU,CAAA;AAAA,IACtC;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,OAAA,CACb,QAAA,EACA,QAAA,EACA,OAAA,EACgB;AAChB,IAAA,IAAI,CAAC,SAAS,SAAA,EAAW;AAEzB,IAAA,MAAM,WAAWF,IAAAA,CAAK,QAAA,CAAS,SAAA,EAAW,CAAA,EAAG,QAAQ,CAAA,GAAA,CAAK,CAAA;AAE1D,IAAA,IAAI;AAEH,MAAA,MAAM,KAAK,QAAQ,CAAA;AAGnB,MAAA,MAAM,IAAA,GAAO,MAAM,OAAO,QAAA,CAAA;AAE1B,MAAA,IAAI,OAAO,IAAA,CAAK,OAAA,KAAY,UAAA,EAAY;AACvC,QAAA,MAAM,IAAA,CAAK,QAAQ,OAAO,CAAA;AAAA,MAC3B;AAAA,IACD,SAAS,KAAA,EAAO;AAGf,MAAA,MAAM,aAAa,KAAA,YAAiB,KAAA,IACnC,MAAA,IAAU,KAAA,IACT,MAAgC,IAAA,KAAS,QAAA;AAE3C,MAAA,IAAI,CAAC,UAAA,EAAY;AAChB,QAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,mBAAA,EAAY,QAAQ,CAAA,SAAA,EAAY,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAAA,MACtG;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAA,CACb,SAAA,EACA,cAAA,EACA,aAAA,EACgB;AAChB,IAAA,MAAM,EAAE,KAAA,EAAM,GAAI,MAAM,OAAO,eAAoB,CAAA;AAGnD,IAAA,MAAM,OAAA,GAAU,aAAA,IAAiB,IAAA,CAAK,iBAAA,CAAkB,cAAc,CAAA;AAEtE,IAAA,OAAO,IAAI,OAAA,CAAQ,CAACG,QAAAA,EAAS,MAAA,KAAW;AACvC,MAAA,MAAM,CAAC,GAAA,EAAK,GAAG,IAAI,CAAA,GAAI,OAAA,CAAQ,MAAM,GAAG,CAAA;AAExC,MAAA,MAAM,IAAA,GAAO,KAAA,CAAM,GAAA,EAAK,IAAA,EAAM;AAAA,QAC7B,GAAA,EAAK,SAAA;AAAA,QACL,KAAA,EAAO,SAAA;AAAA,QACP,KAAA,EAAO;AAAA,OACP,CAAA;AAED,MAAA,IAAA,CAAK,EAAA,CAAG,OAAA,EAAS,CAAC,IAAA,KAAS;AAC1B,QAAA,IAAI,SAAS,CAAA,EAAG;AACf,UAAAA,QAAAA,EAAQ;AAAA,QACT,CAAA,MAAO;AACN,UAAA,MAAA,CAAO,IAAI,KAAA,CAAM,CAAA,iCAAA,EAAoC,IAAI,EAAE,CAAC,CAAA;AAAA,QAC7D;AAAA,MACD,CAAC,CAAA;AAED,MAAA,IAAA,CAAK,EAAA,CAAG,OAAA,EAAS,CAAC,KAAA,KAAU;AAC3B,QAAA,MAAA,CAAO,KAAK,CAAA;AAAA,MACb,CAAC,CAAA;AAAA,IACF,CAAC,CAAA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAA,CACb,SAAA,EACA,QAAA,EACgB;AAChB,IAAA,MAAM,EAAE,KAAA,EAAM,GAAI,MAAM,OAAO,eAAoB,CAAA;AAEnD,IAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,kBAAA,EAAgB,SAAS,MAAM,CAAA;AAAA,CAA+B,CAAA;AAE1E,IAAA,KAAA,MAAW,WAAW,QAAA,EAAU;AAC/B,MAAA,MAAM,IAAI,OAAA,CAAc,CAACA,QAAAA,EAAS,MAAA,KAAW;AAC5C,QAAA,MAAM,CAAC,GAAA,EAAK,GAAG,IAAI,CAAA,GAAI,OAAA,CAAQ,MAAM,GAAG,CAAA;AAExC,QAAA,MAAM,IAAA,GAAO,KAAA,CAAM,GAAA,EAAK,IAAA,EAAM;AAAA,UAC7B,GAAA,EAAK,SAAA;AAAA,UACL,KAAA,EAAO,SAAA;AAAA,UACP,KAAA,EAAO;AAAA,SACP,CAAA;AAED,QAAA,IAAA,CAAK,EAAA,CAAG,OAAA,EAAS,CAAC,IAAA,KAAS;AAC1B,UAAA,IAAI,SAAS,CAAA,EAAG;AACf,YAAAA,QAAAA,EAAQ;AAAA,UACT,CAAA,MAAO;AACN,YAAA,MAAA,CAAO,IAAI,KAAA,CAAM,CAAA,sBAAA,EAAyB,OAAO,CAAA,mBAAA,EAAsB,IAAI,EAAE,CAAC,CAAA;AAAA,UAC/E;AAAA,QACD,CAAC,CAAA;AAED,QAAA,IAAA,CAAK,EAAA,CAAG,OAAA,EAAS,CAAC,KAAA,KAAU;AAC3B,UAAA,MAAA,CAAO,KAAK,CAAA;AAAA,QACb,CAAC,CAAA;AAAA,MACF,CAAC,CAAA;AAAA,IACF;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,cAAA,EAAiC;AAC1D,IAAA,QAAQ,cAAA;AAAgB,MACvB,KAAK,MAAA;AACJ,QAAA,OAAO,cAAA;AAAA,MACR,KAAK,MAAA;AACJ,QAAA,OAAO,cAAA;AAAA,MACR,KAAK,KAAA;AACJ,QAAA,OAAO,aAAA;AAAA,MACR,KAAK,KAAA;AAAA,MACL;AACC,QAAA,OAAO,aAAA;AAAA;AACT,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YAAA,CAAa,SAAA,EAAmB,gBAAA,EAAyC;AACtF,IAAA,MAAM,EAAE,KAAA,EAAM,GAAI,MAAM,OAAO,eAAoB,CAAA;AAEnD,IAAA,OAAO,IAAI,OAAA,CAAQ,CAACA,QAAAA,EAAS,MAAA,KAAW;AACvC,MAAA,MAAM,CAAC,GAAA,EAAK,GAAG,IAAI,CAAA,GAAI,gBAAA,CAAiB,MAAM,GAAG,CAAA;AAEjD,MAAA,MAAM,IAAA,GAAO,KAAA,CAAM,GAAA,EAAK,IAAA,EAAM;AAAA,QAC7B,GAAA,EAAK,SAAA;AAAA,QACL,KAAA,EAAO,SAAA;AAAA,QACP,KAAA,EAAO;AAAA,OACP,CAAA;AAED,MAAA,IAAA,CAAK,EAAA,CAAG,OAAA,EAAS,CAAC,IAAA,KAAS;AAC1B,QAAA,IAAI,SAAS,CAAA,EAAG;AACf,UAAAA,QAAAA,EAAQ;AAAA,QACT,CAAA,MAAO;AACN,UAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,4BAAA,EAA+B,IAAI,CAAA,oBAAA,CAAsB,CAAA;AACtE,UAAAA,QAAAA,EAAQ;AAAA,QACT;AAAA,MACD,CAAC,CAAA;AAED,MAAA,IAAA,CAAK,EAAA,CAAG,OAAA,EAAS,CAAC,KAAA,KAAU;AAC3B,QAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,kBAAA,EAAqB,KAAK,CAAA,oBAAA,CAAsB,CAAA;AAC7D,QAAAA,QAAAA,EAAQ;AAAA,MACT,CAAC,CAAA;AAAA,IACF,CAAC,CAAA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,aAAA,CACb,SAAA,EACA,QAAA,EACA,SAAA,EACgB;AAChB,IAAA,MAAM,QAAA,GAA6B;AAAA,MAClC,EAAA,EAAI,SAAS,MAAA,CAAO,EAAA;AAAA,MACpB,OAAA,EAAS,SAAS,MAAA,CAAO,OAAA;AAAA,MACzB,IAAA,EAAM,SAAS,MAAA,CAAO,IAAA;AAAA,MACtB,eAAA,EAAiB,QAAA,CAAS,MAAA,CAAO,YAAA,CAAa,OAAA;AAAA,MAC9C,cAAA,EAAgB,QAAA,CAAS,MAAA,CAAO,YAAA,CAAa,MAAA;AAAA,MAC7C,aAAA,EAAA,iBAAe,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,MACtC;AAAA,KACD;AAEA,IAAA,MAAM,YAAA,GAAeH,IAAAA,CAAK,SAAA,EAAW,oBAAoB,CAAA;AACzD,IAAA,MAAM,SAAA,CAAU,cAAc,IAAA,CAAK,SAAA,CAAU,UAAU,IAAA,EAAM,GAAI,GAAG,OAAO,CAAA;AAAA,EAC5E;AACD,CAAA;;;AC/XO,SAAS,YAAA,CACf,MAAA,EACA,QAAA,EACA,iBAAA,EACO;AACP,EAAA,IAAI,QAAA,EAAU;AACb,IAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,EAC5C,WAAW,iBAAA,EAAmB;AAC7B,IAAA,iBAAA,CAAkB,MAAM,CAAA;AAAA,EACzB;AACD;;;ACKO,IAAM,mBAAN,MAAuB;AAAA,EAI7B,WAAA,CAAoB,WAAoB,KAAA,EAAO;AAA3B,IAAA,IAAA,CAAA,QAAA,GAAA,QAAA;AAAA,EAA4B;AAAA,EAHxC,KAAA,uBAAuC,GAAA,EAAI;AAAA,EAC3C,SAAA,GAAoB,CAAA;AAAA;AAAA;AAAA;AAAA,EAO5B,MAAM,gBAAA,EAAkC;AACvC,IAAA,IAAA,CAAK,SAAA,GAAY,KAAK,GAAA,EAAI;AAC1B,IAAA,IAAA,CAAK,MAAM,KAAA,EAAM;AAGjB,IAAA,gBAAA,CAAiB,OAAA,CAAQ,CAAC,WAAA,EAAa,KAAA,KAAU;AAChD,MAAA,MAAM,EAAA,GAAK,CAAA,KAAA,EAAQ,KAAA,GAAQ,CAAC,CAAA,CAAA;AAC5B,MAAA,IAAA,CAAK,KAAA,CAAM,IAAI,EAAA,EAAI;AAAA,QAClB,EAAA;AAAA,QACA,WAAA;AAAA,QACA,MAAA,EAAQ;AAAA,OACR,CAAA;AAAA,IACF,CAAC,CAAA;AAED,IAAA,IAAA,CAAK,SAAA,CAAU;AAAA,MACd,IAAA,EAAM,OAAA;AAAA,MACN,SAAA,EAAA,iBAAW,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,MAClC,UAAA,EAAY,KAAK,KAAA,CAAM,IAAA;AAAA,MACvB,cAAA,EAAgB;AAAA,KAChB,CAAA;AAED,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AACnB,MAAA,OAAA,CAAQ,IAAI,qCAA8B,CAAA;AAAA,IAC3C;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,CACC,MAAA,EACA,MAAA,EACA,KAAA,EACO;AACP,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,MAAM,CAAA;AAClC,IAAA,IAAI,CAAC,IAAA,EAAM;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,cAAA,EAAiB,MAAM,CAAA,CAAE,CAAA;AAAA,IAC1C;AAEA,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AACd,IAAA,IAAI,KAAA,EAAO;AACV,MAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AAAA,IACd;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU;AAAA,MACd,IAAA,EAAM,aAAA;AAAA,MACN,SAAA,EAAA,iBAAW,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,MAClC,IAAA,EAAM,EAAE,GAAG,IAAA,EAAK;AAAA,MAChB,UAAA,EAAY,KAAK,KAAA,CAAM,IAAA;AAAA,MACvB,cAAA,EAAgB,KAAK,iBAAA;AAAkB,KACvC,CAAA;AAED,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AACnB,MAAA,IAAA,CAAK,eAAe,IAAI,CAAA;AAAA,IACzB;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAAiB;AAChB,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,IAAA,CAAK,SAAA;AAEnC,IAAA,IAAA,CAAK,SAAA,CAAU;AAAA,MACd,IAAA,EAAM,UAAA;AAAA,MACN,SAAA,EAAA,iBAAW,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,MAClC,UAAA,EAAY,KAAK,KAAA,CAAM,IAAA;AAAA,MACvB,cAAA,EAAgB,KAAK,iBAAA;AAAkB,KACvC,CAAA;AAED,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AACnB,MAAA,MAAM,SAAS,KAAA,CAAM,IAAA,CAAK,KAAK,KAAA,CAAM,MAAA,EAAQ,CAAA,CAAE,MAAA;AAAA,QAC9C,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW;AAAA,OACrB;AACA,MAAA,IAAI,MAAA,CAAO,WAAW,CAAA,EAAG;AACxB,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,8BAAA,EAA8B,QAAQ,CAAA;AAAA,CAAM,CAAA;AAAA,MACzD,CAAA,MAAO;AACN,QAAA,OAAA,CAAQ,GAAA;AAAA,UACP;AAAA,uCAAA,EAAkC,MAAA,CAAO,MAAM,CAAA,mBAAA,EAAsB,QAAQ,CAAA;AAAA;AAAA,SAC9E;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAKE;AACD,IAAA,MAAM,QAAQ,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,QAAQ,CAAA;AAC5C,IAAA,OAAO;AAAA,MACN,OAAO,KAAA,CAAM,MAAA;AAAA,MACb,SAAA,EAAW,MAAM,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,MAAA,KAAW,WAAW,CAAA,CAAE,MAAA;AAAA,MACzD,MAAA,EAAQ,MAAM,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,MAAA,KAAW,QAAQ,CAAA,CAAE,MAAA;AAAA,MACnD,UAAA,EAAY,MAAM,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,MAAA,KAAW,aAAa,CAAA,CAAE;AAAA,KAC7D;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAA2B;AAC1B,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,QAAQ,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAU,KAAA,EAA4B;AAC7C,IAAA,IAAI,KAAK,QAAA,EAAU;AAClB,MAAA,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,SAAA,CAAU,KAAK,CAAC,CAAA;AAAA,IAClC;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,IAAA,EAA0B;AAChD,IAAA,IAAI,IAAA;AACJ,IAAA,IAAI,KAAA;AAEJ,IAAA,QAAQ,KAAK,MAAA;AAAQ,MACpB,KAAK,SAAA;AACJ,QAAA,IAAA,GAAO,cAAA;AACP,QAAA,KAAA,GAAQ,UAAA;AACR,QAAA;AAAA,MACD,KAAK,aAAA;AACJ,QAAA,IAAA,GAAO,QAAA;AACP,QAAA,KAAA,GAAQ,UAAA;AACR,QAAA;AAAA,MACD,KAAK,WAAA;AACJ,QAAA,IAAA,GAAO,QAAA;AACP,QAAA,KAAA,GAAQ,UAAA;AACR,QAAA;AAAA,MACD,KAAK,QAAA;AACJ,QAAA,IAAA,GAAO,QAAA;AACP,QAAA,KAAA,GAAQ,UAAA;AACR,QAAA;AAAA;AAGF,IAAA,MAAM,KAAA,GAAQ,SAAA;AACd,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAG,KAAK,CAAA,EAAG,IAAI,IAAI,IAAA,CAAK,WAAW,CAAA,EAAG,KAAK,CAAA,CAAE,CAAA;AAEzD,IAAA,IAAI,KAAK,KAAA,EAAO;AACf,MAAA,OAAA,CAAQ,GAAA,CAAI,MAAM,KAAK,CAAA,OAAA,EAAK,KAAK,KAAK,CAAA,EAAG,KAAK,CAAA,CAAE,CAAA;AAAA,IACjD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAA,GAA4B;AACnC,IAAA,OAAO,MAAM,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,MAAA,EAAQ,CAAA,CAAE,MAAA;AAAA,MACtC,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW;AAAA,KACrB,CAAE,MAAA;AAAA,EACH;AACD,CAAA;AClLO,SAAS,sBAAA,GAAkC;AACjD,EAAA,MAAM,OAAA,GAAU,IAAI,OAAA,CAAQ,QAAQ,CAAA,CAClC,YAAY,mCAAmC,CAAA,CAC/C,kBAAA,CAAmB,+DAAwD,CAAA,CAC3E,cAAA,CAAe,iBAAiB,uCAAuC,CAAA,CACvE,MAAA,CAAO,iBAAA,EAAmB,oBAAA,EAAsB,mBAAmB,EACnE,MAAA,CAAO,sBAAA,EAAwB,qBAAqB,CAAA,CACpD,MAAA,CAAO,eAAA,EAAiB,2BAA2B,MAAM,CAAA,CACzD,MAAA,CAAO,iBAAA,EAAmB,0GAA0G,CAAA,CACpI,OAAO,cAAA,EAAgB,8BAA8B,CAAA,CACrD,MAAA,CAAO,gBAAA,EAAkB,wCAAA,EAA0C,KAAK,CAAA,CACxE,MAAA,CAAO,OAAA,EAAS,+EAA+E,CAAA,CAC/F,MAAA,CAAO,UAAU,uBAAuB,CAAA,CACxC,MAAA,CAAO,OAAO,OAAA,KAAY;AAE1B,IAAA,IAAI,QAAA;AAEJ,IAAA,IAAI;AACH,MAAA,QAAA,GAAW,IAAI,gBAAA,CAAiB,CAAC,CAAC,QAAQ,IAAI,CAAA;AAG9C,MAAA,MAAM,KAAA,GAAQ;AAAA,QACb,0BAAA;AAAA,QACA,kBAAA;AAAA,QACA;AAAA,OACD;AAGA,MAAA,IAAI,QAAQ,OAAA,EAAS;AACpB,QAAA,KAAA,CAAM,KAAK,yBAAyB,CAAA;AACpC,QAAA,KAAA,CAAM,KAAK,+BAA+B,CAAA;AAAA,MAC3C;AAEA,MAAA,KAAA,CAAM,KAAK,oBAAoB,CAAA;AAE/B,MAAA,QAAA,CAAS,MAAM,KAAK,CAAA;AAGpB,MAAA,QAAA,CAAS,UAAA,CAAW,UAAU,aAAa,CAAA;AAG3C,MAAA,MAAM,QAAA,GAAW,CAAC,KAAA,EAAO,MAAA,EAAQ,QAAQ,KAAK,CAAA;AAC9C,MAAA,IAAI,CAAC,QAAA,CAAS,QAAA,CAAS,OAAA,CAAQ,EAAE,CAAA,EAAG;AACnC,QAAA,MAAM,YAAA,GAAe,4BAA4B,OAAA,CAAQ,EAAE,qBAAqB,QAAA,CAAS,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA;AACnG,QAAA,QAAA,CAAS,UAAA,CAAW,QAAA,EAAU,QAAA,EAAU,YAAY,CAAA;AACpD,QAAA,QAAA,CAAS,QAAA,EAAS;AAElB,QAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,UAAA,MAAM,MAAA,GAA0B;AAAA,YAC/B,OAAA,EAAS,KAAA;AAAA,YACT,aAAa,OAAA,CAAQ,IAAA;AAAA,YACrB,YAAY,OAAA,CAAQ,QAAA;AAAA,YACpB,IAAA,EAAM,EAAA;AAAA,YACN,WAAW,EAAC;AAAA,YACZ,KAAA,EAAO;AAAA,WACR;AACA,UAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,QAC5C,CAAA,MAAO;AACN,UAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,cAAA,EAAY,YAAY,CAAA,CAAE,CAAA;AAAA,QACzC;AACA,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MACf;AAGA,MAAA,MAAM,QAAA,GAAW,IAAI,gBAAA,EAAiB;AACtC,MAAA,MAAM,SAAA,GAAY,IAAI,iBAAA,CAAkB,QAAQ,CAAA;AAEhD,MAAA,QAAA,CAAS,UAAA,CAAW,UAAU,WAAW,CAAA;AAGzC,MAAA,QAAA,CAAS,UAAA,CAAW,UAAU,aAAa,CAAA;AAG3C,MAAA,MAAM,cAAA,GAAiB,MAAM,QAAA,CAAS,cAAA,CAAe,QAAQ,QAAQ,CAAA;AACrE,MAAA,IAAI,CAAC,cAAA,EAAgB;AACpB,QAAA,MAAM,SAAA,GAAY,MAAM,QAAA,CAAS,aAAA,EAAc;AAC/C,QAAA,MAAM,kBAAA,GAAqB,SAAA,CAAU,GAAA,CAAI,CAAC,MAAM,CAAA,EAAG,CAAA,CAAE,EAAE,CAAA,EAAA,EAAK,CAAA,CAAE,IAAI,CAAA,CAAE,CAAA,CAAE,KAAK,IAAI,CAAA;AAC/E,QAAA,MAAM,YAAA,GAAe,CAAA,UAAA,EAAa,OAAA,CAAQ,QAAQ,2BAA2B,kBAAkB,CAAA,CAAA;AAE/F,QAAA,QAAA,CAAS,UAAA,CAAW,QAAA,EAAU,QAAA,EAAU,YAAY,CAAA;AACpD,QAAA,QAAA,CAAS,QAAA,EAAS;AAElB,QAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,UAAA,MAAM,MAAA,GAA0B;AAAA,YAC/B,OAAA,EAAS,KAAA;AAAA,YACT,aAAa,OAAA,CAAQ,IAAA;AAAA,YACrB,YAAY,OAAA,CAAQ,QAAA;AAAA,YACpB,IAAA,EAAM,EAAA;AAAA,YACN,WAAW,EAAC;AAAA,YACZ,KAAA,EAAO;AAAA,WACR;AACA,UAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,QAC5C,CAAA,MAAO;AACN,UAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,wBAAA,EAAsB,OAAA,CAAQ,QAAQ,CAAA,WAAA,CAAa,CAAA;AACjE,UAAA,OAAA,CAAQ,MAAM,wBAAwB,CAAA;AACtC,UAAA,KAAA,MAAW,KAAK,SAAA,EAAW;AAC1B,YAAA,OAAA,CAAQ,MAAM,CAAA,IAAA,EAAO,CAAA,CAAE,EAAE,CAAA,EAAA,EAAK,CAAA,CAAE,IAAI,CAAA,CAAE,CAAA;AAAA,UACvC;AAAA,QACD;AACA,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MACf;AAGA,MAAA,MAAM,SAAA,GAAoC;AAAA,QACzC,cAAc,OAAA,CAAQ,IAAA;AAAA,QACtB,eAAA,EAAiB,OAAA,CAAQ,WAAA,IAAe,OAAA,CAAQ,IAAA;AAAA,QAChD,MAAM,OAAA,CAAQ;AAAA,OACf;AAEA,MAAA,IAAI,QAAQ,WAAA,EAAa;AACxB,QAAA,SAAA,CAAU,cAAc,OAAA,CAAQ,WAAA;AAAA,MACjC;AAGA,MAAA,IAAI,QAAQ,GAAA,EAAK;AAChB,QAAA,MAAMH,WAAAA,GAAaO,aAAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAChD,QAAA,MAAMN,UAAAA,GAAiBO,cAAQR,WAAU,CAAA;AACzC,QAAA,MAAM,UAAA,GAAkBQ,KAAA,CAAA,OAAA,CAAQP,UAAAA,EAAW,KAAK,CAAA;AAChD,QAAA,SAAA,CAAU,QAAA,GAAW,MAAA;AACrB,QAAA,SAAA,CAAU,YAAA,GAAe,UAAA;AACzB,QAAA,IAAI,CAAC,QAAQ,IAAA,EAAM;AAClB,UAAA,OAAA,CAAQ,GAAA;AAAA,YACP,6DAAsD,UAAU;AAAA;AAAA,WACjE;AAAA,QACD;AAAA,MACD;AAGA,MAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,MAAA,GAClBO,KAAA,CAAA,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,OAAA,CAAQ,IAAI,CAAA,GACtC,CAAA,EAAA,EAAK,OAAA,CAAQ,IAAI,CAAA,CAAA;AAEpB,MAAA,QAAA,CAAS,UAAA,CAAW,UAAU,WAAW,CAAA;AAGzC,MAAA,QAAA,CAAS,UAAA,CAAW,UAAU,aAAa,CAAA;AAG3C,MAAA,MAAM,cAAA,GAAiB,MAAM,SAAA,CAAU,QAAA,CAAS;AAAA,QAC/C,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,SAAA;AAAA,QACA,SAAA;AAAA,QACA,SAAA,EAAW,CAAC,OAAA,CAAQ,OAAA;AAAA,QACpB,gBAAgB,OAAA,CAAQ;AAAA,OACxB,CAAA;AAQD,MAAA,QAAA,CAAS,UAAA,CAAW,UAAU,WAAW,CAAA;AAEzC,MAAA,IAAI,QAAQ,OAAA,EAAS;AACpB,QAAA,QAAA,CAAS,UAAA,CAAW,UAAU,WAAW,CAAA;AACzC,QAAA,QAAA,CAAS,UAAA,CAAW,UAAU,WAAW,CAAA;AACzC,QAAA,QAAA,CAAS,UAAA,CAAW,UAAU,aAAa,CAAA;AAAA,MAC5C,CAAA,MAAO;AACN,QAAA,QAAA,CAAS,UAAA,CAAW,UAAU,aAAa,CAAA;AAAA,MAC5C;AAGA,MAAA,IAAI,eAAe,OAAA,EAAS;AAE3B,QAAA,MAAM,WAAA,GAAc,OAAA,CAAQ,OAAA,GAAU,QAAA,GAAW,QAAA;AACjD,QAAA,QAAA,CAAS,UAAA,CAAW,aAAa,WAAW,CAAA;AAC5C,QAAA,QAAA,CAAS,QAAA,EAAS;AAElB,QAAA,MAAM,YAAY,EAAC;AACnB,QAAA,SAAA,CAAU,IAAA,CAAK,CAAA,GAAA,EAAM,SAAS,CAAA,CAAE,CAAA;AAChC,QAAA,IAAI,CAAC,QAAQ,OAAA,EAAS;AACrB,UAAA,SAAA,CAAU,IAAA,CAAK,CAAA,EAAG,OAAA,CAAQ,EAAE,CAAA,QAAA,CAAU,CAAA;AAAA,QACvC;AACA,QAAA,SAAA,CAAU,IAAA,CAAK,CAAA,EAAG,OAAA,CAAQ,EAAE,CAAA,QAAA,CAAU,CAAA;AAEtC,QAAA,MAAM,MAAA,GAA0B;AAAA,UAC/B,OAAA,EAAS,IAAA;AAAA,UACT,aAAa,OAAA,CAAQ,IAAA;AAAA,UACrB,YAAY,OAAA,CAAQ,QAAA;AAAA,UACpB,IAAA,EAAWA,cAAQ,SAAS,CAAA;AAAA,UAC5B,SAAA;AAAA,UACA,SAAS,OAAA,CAAQ;AAAA,SAClB;AAEA,QAAA,YAAA,CAAa,QAAQ,CAAC,CAAC,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAA,KAAM;AAC3C,UAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,+BAAA,EAA6B,QAAQ,IAAI;AAAA,CAAI,CAAA;AACzD,UAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,4BAAA,EAA4B,QAAQ,IAAI,CAAA;AAAA,CAAK,CAAA;AACzD,UAAA,IAAI,QAAQ,GAAA,EAAK;AAChB,YAAA,OAAA,CAAQ,GAAA;AAAA,cACP;AAAA,aACD;AAAA,UACD;AACA,UAAA,OAAA,CAAQ,IAAI,aAAa,CAAA;AACzB,UAAA,KAAA,MAAW,IAAA,IAAQ,EAAE,SAAA,EAAW;AAC/B,YAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAA,EAAK,IAAI,CAAA,CAAE,CAAA;AAAA,UACxB;AACA,UAAA,OAAA,CAAQ,IAAI,6BAAsB,CAAA;AAAA,QACnC,CAAC,CAAA;AAAA,MACF,CAAA,MAAO;AAEN,QAAA,MAAM,aAAA,GAAgB,QAAA;AACtB,QAAA,QAAA,CAAS,UAAA,CAAW,aAAA,EAAe,QAAA,EAAU,cAAA,CAAe,KAAK,CAAA;AACjE,QAAA,QAAA,CAAS,QAAA,EAAS;AAElB,QAAA,MAAM,MAAA,GAA0B;AAAA,UAC/B,OAAA,EAAS,KAAA;AAAA,UACT,aAAa,OAAA,CAAQ,IAAA;AAAA,UACrB,YAAY,OAAA,CAAQ,QAAA;AAAA,UACpB,IAAA,EAAM,SAAA;AAAA,UACN,WAAW,EAAC;AAAA,UACZ,OAAO,cAAA,CAAe;AAAA,SACvB;AAEA,QAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,UAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,QAC5C,CAAA,MAAO;AACN,UAAA,OAAA,CAAQ,KAAA,CAAM;AAAA,cAAA,EAAc,eAAe,KAAK;AAAA,CAAI,CAAA;AAAA,QACrD;AACA,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MACf;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAE1E,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,MAAM,MAAA,GAA0B;AAAA,UAC/B,OAAA,EAAS,KAAA;AAAA,UACT,aAAa,OAAA,CAAQ,IAAA;AAAA,UACrB,YAAY,OAAA,CAAQ,QAAA;AAAA,UACpB,IAAA,EAAM,EAAA;AAAA,UACN,WAAW,EAAC;AAAA,UACZ,KAAA,EAAO;AAAA,SACR;AACA,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAA,MAAO;AACN,QAAA,OAAA,CAAQ,KAAA,CAAM;AAAA,cAAA,EAAc,YAAY;AAAA,CAAI,CAAA;AAAA,MAC7C;AACA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AAEF,EAAA,OAAO,OAAA;AACR;AAKO,SAAS,gBAAA,GAA4B;AAC3C,EAAA,MAAM,SAAS,IAAI,OAAA,CAAQ,KAAK,CAAA,CAAE,YAAY,sCAAsC,CAAA;AAEpF,EAAA,MAAA,CAAO,UAAA,CAAW,wBAAwB,CAAA;AAE1C,EAAA,OAAO,MAAA;AACR;ACnQA,SAAS,iBAAA,GAA6B;AACrC,EAAA,OAAO,IAAIC,OAAAA,CAAQ,MAAM,CAAA,CACvB,WAAA,CAAY,0BAA0B,CAAA,CACtC,MAAA,CAAO,QAAA,EAAU,gBAAgB,CAAA,CACjC,MAAA,CAAO,qBAAA,EAAuB,mBAAmB,CAAA,CACjD,MAAA,CAAO,yBAAA,EAA2B,qBAAqB,CAAA,CACvD,MAAA,CAAO,2BAAA,EAA6B,qCAAqC,CAAA,CACzE,MAAA,CAAO,uBAAA,EAAyB,4CAA4C,CAAA,CAC5E,MAAA,CAAO,OAAO,OAAA,KAAY;AAC1B,IAAA,IAAI;AACH,MAAA,MAAM,QAAA,GAAW,IAAI,gBAAA,EAAiB;AAGtC,MAAA,MAAM,SAAyB,EAAC;AAChC,MAAA,IAAI,OAAA,CAAQ,OAAA,EAAS,MAAA,CAAO,OAAA,GAAU,OAAA,CAAQ,OAAA;AAC9C,MAAA,IAAI,OAAA,CAAQ,SAAA,EAAW,MAAA,CAAO,SAAA,GAAY,OAAA,CAAQ,SAAA;AAClD,MAAA,IAAI,OAAA,CAAQ,UAAA,EAAY,MAAA,CAAO,UAAA,GAAa,OAAA,CAAQ,UAAA;AACpD,MAAA,IAAI,OAAA,CAAQ,QAAA,EAAU,MAAA,CAAO,QAAA,GAAW,OAAA,CAAQ,QAAA;AAGhD,MAAA,MAAM,SAAA,GAAY,MAAM,QAAA,CAAS,aAAA,CAAc,MAAM,CAAA;AAErD,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,SAAA,EAAW,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MAC/C,CAAA,MAAO;AACN,QAAA,IAAI,SAAA,CAAU,WAAW,CAAA,EAAG;AAC3B,UAAA,OAAA,CAAQ,IAAI,oDAAoD,CAAA;AAChE,UAAA;AAAA,QACD;AAEA,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,qBAAA,EAA0B,UAAU,MAAM,CAAA;AAAA,CAAM,CAAA;AAC5D,QAAA,KAAA,MAAW,YAAY,SAAA,EAAW;AACjC,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAA,EAAK,QAAA,CAAS,EAAE,CAAA,CAAE,CAAA;AAC9B,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,UAAA,EAAa,QAAA,CAAS,IAAI,CAAA,CAAE,CAAA;AACxC,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,iBAAA,EAAoB,QAAA,CAAS,WAAW,CAAA,CAAE,CAAA;AACtD,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,aAAA,EAAgB,QAAA,CAAS,YAAA,CAAa,OAAO,CAAA,CAAE,CAAA;AAC3D,UAAA,OAAA,CAAQ,GAAA,CAAI,kBAAkB,QAAA,CAAS,YAAA,CAAa,UAAU,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAC1E,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,gBAAA,EAAmB,QAAA,CAAS,YAAA,CAAa,UAAU,CAAA,CAAE,CAAA;AACjE,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,cAAA,EAAiB,QAAA,CAAS,YAAA,CAAa,QAAQ,CAAA,CAAE,CAAA;AAC7D,UAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,QACb;AAAA,MACD;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,OAAA,CAAQ,KAAA,CAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAChF,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AACH;AAKA,SAAS,iBAAA,GAA6B;AACrC,EAAA,OAAO,IAAIA,OAAAA,CAAQ,MAAM,EACvB,WAAA,CAAY,4CAA4C,EACxD,QAAA,CAAS,eAAA,EAAiB,aAAa,CAAA,CACvC,OAAO,QAAA,EAAU,gBAAgB,EACjC,MAAA,CAAO,OAAO,YAAY,OAAA,KAAY;AACtC,IAAA,IAAI;AACH,MAAA,MAAM,QAAA,GAAW,IAAI,gBAAA,EAAiB;AACtC,MAAA,MAAM,QAAA,GAAW,MAAM,QAAA,CAAS,WAAA,CAAY,UAAU,CAAA;AAEtD,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,SAAS,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MACrD,CAAA,MAAO;AACN,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,UAAA,EAAe,QAAA,CAAS,OAAO,IAAI;AAAA,CAAI,CAAA;AACnD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,QAAA,CAAS,MAAA,CAAO,EAAE,CAAA,CAAE,CAAA;AACvC,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,SAAA,EAAY,QAAA,CAAS,MAAA,CAAO,OAAO,CAAA,CAAE,CAAA;AACjD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,aAAA,EAAgB,QAAA,CAAS,MAAA,CAAO,WAAW,CAAA,CAAE,CAAA;AACzD,QAAA,OAAA,CAAQ,GAAA,EAAI;AAEZ,QAAA,OAAA,CAAQ,IAAI,eAAe,CAAA;AAC3B,QAAA,OAAA,CAAQ,IAAI,CAAA,WAAA,EAAc,QAAA,CAAS,MAAA,CAAO,YAAA,CAAa,OAAO,CAAA,CAAE,CAAA;AAChE,QAAA,OAAA,CAAQ,GAAA,CAAI,gBAAgB,QAAA,CAAS,MAAA,CAAO,aAAa,SAAA,CAAU,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAC/E,QAAA,OAAA,CAAQ,IAAI,CAAA,cAAA,EAAiB,QAAA,CAAS,MAAA,CAAO,YAAA,CAAa,UAAU,CAAA,CAAE,CAAA;AACtE,QAAA,OAAA,CAAQ,IAAI,CAAA,YAAA,EAAe,QAAA,CAAS,MAAA,CAAO,YAAA,CAAa,QAAQ,CAAA,CAAE,CAAA;AAClE,QAAA,OAAA,CAAQ,GAAA,EAAI;AAEZ,QAAA,OAAA,CAAQ,IAAI,WAAW,CAAA;AACvB,QAAA,OAAA,CAAQ,GAAA,CAAI,mBAAmB,QAAA,CAAS,MAAA,CAAO,SAAS,WAAA,GAAc,QAAA,GAAM,QAAG,CAAA,CAAE,CAAA;AACjF,QAAA,OAAA,CAAQ,GAAA;AAAA,UACP,0BAA0B,QAAA,CAAS,MAAA,CAAO,QAAA,CAAS,kBAAA,GAAqB,WAAM,QAAG,CAAA;AAAA,SAClF;AACA,QAAA,OAAA,CAAQ,GAAA,CAAI,oBAAoB,QAAA,CAAS,MAAA,CAAO,SAAS,aAAA,GAAgB,QAAA,GAAM,QAAG,CAAA,CAAE,CAAA;AACpF,QAAA,IAAI,QAAA,CAAS,MAAA,CAAO,QAAA,CAAS,YAAA,CAAa,SAAS,CAAA,EAAG;AACrD,UAAA,OAAA,CAAQ,GAAA;AAAA,YACP,oBAAoB,QAAA,CAAS,MAAA,CAAO,SAAS,YAAA,CAAa,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,WACrE;AAAA,QACD;AACA,QAAA,OAAA,CAAQ,GAAA,EAAI;AAEZ,QAAA,IAAI,QAAA,CAAS,MAAA,CAAO,WAAA,CAAY,SAAA,CAAU,SAAS,CAAA,EAAG;AACrD,UAAA,OAAA,CAAQ,IAAI,YAAY,CAAA;AACxB,UAAA,KAAA,MAAW,CAAA,IAAK,QAAA,CAAS,MAAA,CAAO,WAAA,CAAY,SAAA,EAAW;AACtD,YAAA,MAAM,GAAA,GAAM,CAAA,CAAE,QAAA,GAAW,YAAA,GAAe,YAAA;AACxC,YAAA,MAAM,MAAM,CAAA,CAAE,OAAA,GAAU,CAAA,WAAA,EAAc,CAAA,CAAE,OAAO,CAAA,CAAA,CAAA,GAAM,EAAA;AACrD,YAAA,OAAA,CAAQ,GAAA,CAAI,KAAK,CAAA,CAAE,IAAI,IAAI,GAAG,CAAA,EAAG,GAAG,CAAA,CAAE,CAAA;AACtC,YAAA,IAAI,EAAE,MAAA,EAAQ;AACb,cAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,CAAA,CAAE,MAAM,CAAA,CAAE,CAAA;AAAA,YAC9B;AAAA,UACD;AACA,UAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,QACb;AAAA,MACD;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,OAAA,CAAQ,KAAA,CAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAChF,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AACH;AAKA,SAAS,qBAAA,GAAiC;AACzC,EAAA,OAAO,IAAIA,OAAAA,CAAQ,UAAU,EAC3B,WAAA,CAAY,mCAAmC,EAC/C,QAAA,CAAS,eAAA,EAAiB,aAAa,CAAA,CACvC,OAAO,QAAA,EAAU,gBAAgB,EACjC,MAAA,CAAO,OAAO,YAAY,OAAA,KAAY;AACtC,IAAA,IAAI;AACH,MAAA,MAAM,QAAA,GAAW,IAAI,gBAAA,EAAiB;AACtC,MAAA,MAAM,MAAA,GAAS,MAAM,QAAA,CAAS,gBAAA,CAAiB,UAAU,CAAA;AAEzD,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAA,MAAO;AACN,QAAA,IAAI,OAAO,KAAA,EAAO;AACjB,UAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,iBAAA,EAAiB,UAAU,CAAA;AAAA,CAAc,CAAA;AAAA,QACtD,CAAA,MAAO;AACN,UAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,iBAAA,EAAiB,UAAU,CAAA;AAAA,CAA4B,CAAA;AACnE,UAAA,KAAA,MAAW,KAAA,IAAS,OAAO,MAAA,EAAQ;AAClC,YAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,KAAK,CAAA,CAAE,CAAA;AAAA,UAC3B;AACA,UAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,QACb;AAEA,QAAA,IAAI,MAAA,CAAO,QAAA,CAAS,MAAA,GAAS,CAAA,EAAG;AAC/B,UAAA,OAAA,CAAQ,IAAI,WAAW,CAAA;AACvB,UAAA,KAAA,MAAW,OAAA,IAAW,OAAO,QAAA,EAAU;AACtC,YAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,gBAAA,EAAS,OAAO,CAAA,CAAE,CAAA;AAAA,UAC/B;AACA,UAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,QACb;AAAA,MACD;AAEA,MAAA,IAAI,CAAC,OAAO,KAAA,EAAO;AAClB,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MACf;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,OAAA,CAAQ,KAAA,CAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAChF,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AACH;AAKA,SAAS,yBAAA,GAAqC;AAC7C,EAAA,OAAO,IAAIA,OAAAA,CAAQ,cAAc,CAAA,CAC/B,WAAA,CAAY,kDAAkD,CAAA,CAC9D,MAAA,CAAO,QAAA,EAAU,gBAAgB,CAAA,CACjC,MAAA,CAAO,OAAO,OAAA,KAAY;AAC1B,IAAA,IAAI;AACH,MAAA,MAAM,QAAA,GAAW,IAAI,gBAAA,EAAiB;AACtC,MAAA,MAAM,YAAA,GAAe,MAAM,QAAA,CAAS,eAAA,EAAgB;AAEpD,MAAA,MAAM,MAAA,GAAS;AAAA,QACd,QAAA,EAAU,KAAA,CAAM,IAAA,CAAK,YAAA,CAAa,QAAQ,CAAA;AAAA,QAC1C,UAAA,EAAY,KAAA,CAAM,IAAA,CAAK,YAAA,CAAa,UAAU,CAAA;AAAA,QAC9C,WAAA,EAAa,KAAA,CAAM,IAAA,CAAK,YAAA,CAAa,WAAW,CAAA;AAAA,QAChD,SAAA,EAAW,KAAA,CAAM,IAAA,CAAK,YAAA,CAAa,SAAS;AAAA,OAC7C;AAEA,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAA,MAAO;AACN,QAAA,OAAA,CAAQ,IAAI,6BAA6B,CAAA;AACzC,QAAA,OAAA,CAAQ,IAAI,WAAW,CAAA;AACvB,QAAA,KAAA,MAAW,OAAA,IAAW,OAAO,QAAA,EAAU;AACtC,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,OAAO,CAAA,CAAE,CAAA;AAAA,QAC7B;AACA,QAAA,OAAA,CAAQ,GAAA,EAAI;AAEZ,QAAA,OAAA,CAAQ,IAAI,aAAa,CAAA;AACzB,QAAA,KAAA,MAAW,SAAA,IAAa,OAAO,UAAA,EAAY;AAC1C,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,SAAS,CAAA,CAAE,CAAA;AAAA,QAC/B;AACA,QAAA,OAAA,CAAQ,GAAA,EAAI;AAEZ,QAAA,OAAA,CAAQ,IAAI,cAAc,CAAA;AAC1B,QAAA,KAAA,MAAW,UAAA,IAAc,OAAO,WAAA,EAAa;AAC5C,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,UAAU,CAAA,CAAE,CAAA;AAAA,QAChC;AACA,QAAA,OAAA,CAAQ,GAAA,EAAI;AAEZ,QAAA,OAAA,CAAQ,IAAI,YAAY,CAAA;AACxB,QAAA,KAAA,MAAW,QAAA,IAAY,OAAO,SAAA,EAAW;AACxC,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,QAAQ,CAAA,CAAE,CAAA;AAAA,QAC9B;AACA,QAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,MACb;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,OAAA,CAAQ,KAAA,CAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAChF,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AACH;AAKO,SAAS,qBAAA,GAAiC;AAChD,EAAA,MAAM,cAAc,IAAIA,OAAAA,CAAQ,UAAU,CAAA,CAAE,YAAY,+BAA+B,CAAA;AAEvF,EAAA,WAAA,CAAY,UAAA,CAAW,mBAAmB,CAAA;AAC1C,EAAA,WAAA,CAAY,UAAA,CAAW,mBAAmB,CAAA;AAC1C,EAAA,WAAA,CAAY,UAAA,CAAW,uBAAuB,CAAA;AAC9C,EAAA,WAAA,CAAY,UAAA,CAAW,2BAA2B,CAAA;AAElD,EAAA,OAAO,WAAA;AACR;AC1NA,eAAsB,aAAa,GAAA,EAA8B;AAChE,EAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,EAAA,MAAM,SAAA,GAAYN,IAAAA,CAAK,GAAA,EAAK,CAAA,aAAA,EAAgB,SAAS,CAAA,CAAE,CAAA;AAGvD,EAAA,MAAM,MAAA,GAASA,IAAAA,CAAK,GAAA,EAAK,KAAK,CAAA;AAC9B,EAAA,IAAI,UAAA,CAAW,MAAM,CAAA,EAAG;AACvB,IAAA,MAAM,EAAA,CAAG,QAAQA,IAAAA,CAAK,SAAA,EAAW,KAAK,CAAA,EAAG,EAAE,SAAA,EAAW,IAAA,EAAM,CAAA;AAAA,EAC7D;AAGA,EAAA,MAAM,aAAA,GAAgB;AAAA,IACrB,cAAA;AAAA,IACA,eAAA;AAAA,IACA,gBAAA;AAAA,IACA,eAAA;AAAA,IACA,aAAA;AAAA,IACA,gBAAA;AAAA,IACA,iBAAA;AAAA,IACA,gBAAA;AAAA,IACA,WAAA;AAAA,IACA,YAAA;AAAA,IACA,MAAA;AAAA,IACA;AAAA,GACD;AAEA,EAAA,KAAA,MAAW,QAAQ,aAAA,EAAe;AACjC,IAAA,MAAM,QAAA,GAAWA,IAAAA,CAAK,GAAA,EAAK,IAAI,CAAA;AAC/B,IAAA,IAAI,UAAA,CAAW,QAAQ,CAAA,EAAG;AACzB,MAAA,MAAM,EAAA,CAAG,QAAA,EAAUA,IAAAA,CAAK,SAAA,EAAW,IAAI,CAAC,CAAA;AAAA,IACzC;AAAA,EACD;AAEA,EAAA,OAAO,SAAA;AACR;AAQA,eAAsB,iBAAA,CACrB,WACA,GAAA,EACgB;AAChB,EAAA,IAAI,CAAC,UAAA,CAAW,SAAS,CAAA,EAAG;AAC3B,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,4BAAA,EAA+B,SAAS,CAAA,CAAE,CAAA;AAAA,EAC3D;AAGA,EAAA,MAAM,YAAA,GAAeA,IAAAA,CAAK,SAAA,EAAW,KAAK,CAAA;AAC1C,EAAA,IAAI,UAAA,CAAW,YAAY,CAAA,EAAG;AAC7B,IAAA,MAAM,YAAA,GAAeA,IAAAA,CAAK,GAAA,EAAK,KAAK,CAAA;AAGpC,IAAA,IAAI,UAAA,CAAW,YAAY,CAAA,EAAG;AAC7B,MAAA,MAAM,GAAG,YAAA,EAAc,EAAE,WAAW,IAAA,EAAM,KAAA,EAAO,MAAM,CAAA;AAAA,IACxD;AAGA,IAAA,MAAM,GAAG,YAAA,EAAc,YAAA,EAAc,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,EACzD;AAGA,EAAA,MAAM,WAAA,GAAc,MAAMD,OAAAA,CAAQ,SAAS,CAAA;AAE3C,EAAA,KAAA,MAAW,QAAQ,WAAA,EAAa;AAC/B,IAAA,IAAI,SAAS,KAAA,EAAO;AACnB,MAAA;AAAA,IACD;AAEA,IAAA,MAAM,cAAA,GAAiBC,IAAAA,CAAK,SAAA,EAAW,IAAI,CAAA;AAC3C,IAAA,MAAM,cAAA,GAAiBA,IAAAA,CAAK,GAAA,EAAK,IAAI,CAAA;AAGrC,IAAA,MAAM,KAAA,GAAQ,MAAMO,IAAAA,CAAK,cAAc,CAAA;AACvC,IAAA,IAAI,KAAA,CAAM,QAAO,EAAG;AACnB,MAAA,MAAM,EAAA,CAAG,gBAAgB,cAAc,CAAA;AAAA,IACxC;AAAA,EACD;AACD;AAOA,eAAsB,aAAa,SAAA,EAAkC;AACpE,EAAA,IAAI,UAAA,CAAW,SAAS,CAAA,EAAG;AAC1B,IAAA,MAAM,GAAG,SAAA,EAAW,EAAE,WAAW,IAAA,EAAM,KAAA,EAAO,MAAM,CAAA;AAAA,EACrD;AACD;;;AChFO,IAAM,uBAAN,MAAqF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAkB3F,MAAM,QAAA,CACL,GAAA,EACA,QACA,QAAA,EACA,OAAA,GAA2B,EAAC,EACT;AAEnB,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,aAAA,CAAc,GAAA,EAAK,QAAQ,QAAQ,CAAA;AAGxD,IAAA,IAAI,QAAQ,MAAA,EAAQ;AACnB,MAAA,MAAM,QAAA,CAAS,QAAA,CAAS,GAAA,EAAK,MAAM,CAAA;AACnC,MAAA,OAAO,OAAA,CAAQ,MAAA;AAAA,IAChB;AAEA,IAAA,IAAI;AAEH,MAAA,MAAM,QAAA,CAAS,QAAA,CAAS,GAAA,EAAK,MAAM,CAAA;AAGnC,MAAA,IAAI,QAAA,CAAS,WAAA,EAAY,IAAK,CAAC,QAAQ,UAAA,EAAY;AAClD,QAAA,OAAA,CAAQ,SAAA,GAAY,MAAM,YAAA,CAAa,GAAG,CAAA;AAAA,MAC3C;AAGA,MAAA,MAAM,QAAA,CAAS,QAAQ,OAAO,CAAA;AAG9B,MAAA,IAAI,QAAQ,SAAA,EAAW;AACtB,QAAA,MAAM,YAAA,CAAa,QAAQ,SAAS,CAAA;AACpC,QAAA,OAAA,CAAQ,SAAA,GAAY,KAAA,CAAA;AAAA,MACrB;AAEA,MAAA,OAAO,OAAA,CAAQ,MAAA;AAAA,IAChB,SAAS,KAAA,EAAO;AAEf,MAAA,IAAI,QAAQ,SAAA,EAAW;AACtB,QAAA,IAAI;AACH,UAAA,MAAM,iBAAA,CAAkB,OAAA,CAAQ,SAAA,EAAW,GAAG,CAAA;AAC9C,UAAA,MAAM,YAAA,CAAa,QAAQ,SAAS,CAAA;AAAA,QACrC,SAAS,aAAA,EAAe;AAEvB,UAAA,MAAM,cACL,aAAA,YAAyB,KAAA,GACtB,aAAA,CAAc,OAAA,GACd,OAAO,aAAa,CAAA;AACxB,UAAA,MAAM,IAAI,KAAA;AAAA,YACT,mBAAmB,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC;AAAA,sBAAA,EAA2B,WAAW,CAAA;AAAA,WAChH;AAAA,QACD;AAAA,MACD;AAEA,MAAA,MAAM,KAAA;AAAA,IACP;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,aAAA,CACP,GAAA,EACA,MAAA,EACA,QAAA,EACoC;AACpC,IAAA,OAAO;AAAA,MACN,GAAA;AAAA,MACA,MAAA;AAAA,MACA,MAAA,EAAQ,SAAS,YAAA,EAAa;AAAA,MAC9B,UAAU;AAAC,KACZ;AAAA,EACD;AACD,CAAA;AC/FO,IAAM,mBAAA,GAAN,MAAM,oBAAA,CAAoB;AAAA,EAChC,OAAwB,YAAA,GAAe,CAAC,MAAA,EAAQ,UAAU,UAAU,CAAA;AAAA;AAAA;AAAA;AAAA,EAKpE,MAAM,cAAA,CACL,GAAA,EACA,IAAA,EACA,iBACA,MAAA,EACgB;AAChB,IAAA,MAAM,SAAA,GAAYP,IAAAA,CAAK,GAAA,EAAK,KAAA,EAAO,UAAU,CAAA;AAE7C,IAAA,IAAI,CAACQ,UAAAA,CAAW,SAAS,CAAA,EAAG;AAC3B,MAAA,MAAM,IAAI,MAAM,wBAAwB,CAAA;AAAA,IACzC;AAEA,IAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,SAAA,EAAW,OAAO,CAAA;AACjD,IAAA,MAAM,YAAA,GAAe,CAAA,QAAA,EAAW,eAAe,CAAA,EAAG,OAAO,cAAc,CAAA,CAAA;AAGvE,IAAA,IAAI,OAAA,CAAQ,QAAA,CAAS,YAAY,CAAA,EAAG;AACnC,MAAA,OAAA,CAAQ,IAAA;AAAA,QACP,CAAA,gBAAA,EAAS,MAAA,CAAO,UAAA,CAAW,MAAA,CAAO,CAAC,CAAA,CAAE,WAAA,EAAY,GAAI,MAAA,CAAO,UAAA,CAAW,KAAA,CAAM,CAAC,CAAC,CAAA,mCAAA;AAAA,OAChF;AACA,MAAA;AAAA,IACD;AAGA,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,gBAAA;AAAA,MAC3B,GAAA;AAAA,MACA,IAAA;AAAA,MACA,YAAA;AAAA,MACA;AAAA,KACD;AAGA,IAAA,MAAM,kBAAkB,CAAA,SAAA,EAAY,YAAY,YAAY,MAAA,CAAO,SAAS,GAAG,IAAI,CAAA,KAAA,CAAA;AACnF,IAAA,MAAM,mBAAmB,QAAA,GACtB,CAAA,EAAA,EAAO,YAAY,CAAA,wBAAA,CAAA,GACnB,KAAO,YAAY,CAAA,cAAA,CAAA;AAEtB,IAAA,IAAI,cAAA,GAAiB,IAAA,CAAK,SAAA,CAAU,OAAA,EAAS,iBAAiB,MAAM,CAAA;AACpE,IAAA,cAAA,GAAiB,IAAA,CAAK,mBAAA;AAAA,MACrB,cAAA;AAAA,MACA,gBAAA;AAAA,MACA;AAAA,KACD;AAEA,IAAA,MAAMO,SAAAA,CAAU,SAAA,EAAW,cAAA,EAAgB,OAAO,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAA,CACL,GAAA,EACA,eAAA,EACA,MAAA,EACmB;AACnB,IAAA,MAAM,SAAA,GAAYT,IAAAA,CAAK,GAAA,EAAK,KAAA,EAAO,UAAU,CAAA;AAE7C,IAAA,IAAI,CAACQ,UAAAA,CAAW,SAAS,CAAA,EAAG;AAC3B,MAAA,OAAO,KAAA;AAAA,IACR;AAEA,IAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,SAAA,EAAW,OAAO,CAAA;AACjD,IAAA,MAAM,YAAA,GAAe,CAAA,QAAA,EAAW,eAAe,CAAA,EAAG,OAAO,cAAc,CAAA,CAAA;AAEvE,IAAA,OAAO,OAAA,CAAQ,SAAS,YAAY,CAAA;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAA,CACP,OAAA,EACA,eAAA,EACA,MAAA,EACS;AACT,IAAA,IAAI,cAAA,GAAiB,OAAA;AACrB,IAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,cAAA,CAAe,MAAA,CAAO,SAAS,CAAA;AAG7D,IAAA,MAAM,qBAAqB,KAAA,CAAM,IAAA,CAAK,OAAA,CAAQ,QAAA,CAAS,gBAAgB,CAAC,CAAA;AAExE,IAAA,IAAI,kBAAA,CAAmB,SAAS,CAAA,EAAG;AAClC,MAAA,MAAM,SAAA,GAAY,kBAAA,CAAmB,kBAAA,CAAmB,MAAA,GAAS,CAAC,CAAA;AAClE,MAAA,MAAM,SAAA,GAAY,SAAA,CAAU,KAAA,GAAS,SAAA,CAAU,CAAC,CAAA,CAAE,MAAA;AAClD,MAAA,OACC,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,SAAS,CAAA,GAC1B;AAAA,EAAK,eAAe,CAAA,CAAA,GACpB,OAAA,CAAQ,KAAA,CAAM,SAAS,CAAA;AAAA,IAEzB;AAGA,IAAA,MAAM,YAAA,GAAe,qBAAoB,YAAA,CAAa,OAAA;AAAA,MACrD,MAAA,CAAO;AAAA,KACR;AAGA,IAAA,KAAA,IAAS,CAAA,GAAI,YAAA,GAAe,CAAA,EAAG,CAAA,IAAK,GAAG,CAAA,EAAA,EAAK;AAC3C,MAAA,MAAM,YAAA,GAAe,oBAAA,CAAoB,YAAA,CAAa,CAAC,CAAA;AACvD,MAAA,MAAM,WAAA,GAAc,KAAK,YAAY,CAAA,EAAA,CAAA;AACrC,MAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,cAAA,CAAe,WAAW,CAAA;AACrD,MAAA,MAAM,kBAAkB,KAAA,CAAM,IAAA,CAAK,OAAA,CAAQ,QAAA,CAAS,aAAa,CAAC,CAAA;AAElE,MAAA,IAAI,eAAA,CAAgB,SAAS,CAAA,EAAG;AAC/B,QAAA,MAAM,SAAA,GAAY,eAAA,CAAgB,eAAA,CAAgB,MAAA,GAAS,CAAC,CAAA;AAC5D,QAAA,MAAM,SAAA,GAAY,SAAA,CAAU,KAAA,GAAS,SAAA,CAAU,CAAC,CAAA,CAAE,MAAA;AAClD,QAAA,MAAM,OAAA,GAAU;;AAAA,GAAA,EAAU,MAAA,CAAO,gBAAA,CAAiB,MAAA,CAAO,CAAC,CAAA,CAAE,WAAA,EAAY,GAAI,MAAA,CAAO,gBAAA,CAAiB,KAAA,CAAM,CAAC,CAAC;AAAA,CAAA;AAC5G,QAAA,OACC,OAAA,CAAQ,MAAM,CAAA,EAAG,SAAS,IAC1B,OAAA,GACA,eAAA,GACA,OAAA,CAAQ,KAAA,CAAM,SAAS,CAAA;AAAA,MAEzB;AAAA,IACD;AAGA,IAAA,MAAM,kBAAkB,OAAA,CAAQ,KAAA;AAAA,MAC/B;AAAA,KACD;AAEA,IAAA,IAAI,eAAA,EAAiB;AACpB,MAAA,MAAM,UAAA,GAAa,eAAA,CAAgB,eAAA,CAAgB,MAAA,GAAS,CAAC,CAAA;AAC7D,MAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,OAAA,CAAQ,UAAU,IAAI,UAAA,CAAW,MAAA;AAC3D,MAAA,MAAM,OAAA,GAAU;;AAAA,GAAA,EAAU,MAAA,CAAO,gBAAA,CAAiB,MAAA,CAAO,CAAC,CAAA,CAAE,WAAA,EAAY,GAAI,MAAA,CAAO,gBAAA,CAAiB,KAAA,CAAM,CAAC,CAAC;AAAA,CAAA;AAC5G,MAAA,OACC,OAAA,CAAQ,MAAM,CAAA,EAAG,SAAS,IAC1B,OAAA,GACA,eAAA,GACA,OAAA,CAAQ,KAAA,CAAM,SAAS,CAAA;AAAA,IAEzB;AAEA,IAAA,OAAO,cAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAA,CACP,OAAA,EACA,gBAAA,EACA,MAAA,EACS;AACT,IAAA,MAAM,eAAA,GAAkB,gCAAA;AACxB,IAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,KAAA,CAAM,eAAe,CAAA;AAE/C,IAAA,IAAI,CAAC,SAAA,EAAW;AACf,MAAA,OAAO,OAAA;AAAA,IACR;AAEA,IAAA,MAAM,QAAA,GAAW,UAAU,CAAC,CAAA;AAC5B,IAAA,MAAM,kBAAA,GAAqB,CAAA,YAAA,EAAe,MAAA,CAAO,cAAc,CAAA,oBAAA,CAAA;AAC/D,IAAA,MAAM,mBAAmB,IAAI,MAAA,CAAO,CAAA,IAAA,EAAO,kBAAkB,IAAI,GAAG,CAAA;AACpE,IAAA,MAAM,kBAAA,GAAqB,QAAA,CAAS,KAAA,CAAM,gBAAgB,CAAA;AAG1D,IAAA,IAAI,kBAAA,EAAoB;AACvB,MAAA,MAAM,QAAA,GAAW,kBAAA,CAAmB,kBAAA,CAAmB,MAAA,GAAS,CAAC,CAAA;AACjE,MAAA,MAAMQ,UAAAA,GACL,UAAU,KAAA,GAAS,SAAA,CAAU,CAAC,CAAA,CAAE,WAAA,CAAY,QAAQ,CAAA,GAAI,QAAA,CAAS,MAAA;AAClE,MAAA,OACC,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAGA,UAAS,CAAA,GAC1B;AAAA,EAAK,gBAAgB,CAAA,CAAA,GACrB,OAAA,CAAQ,KAAA,CAAMA,UAAS,CAAA;AAAA,IAEzB;AAGA,IAAA,MAAM,YAAA,GAAe,qBAAoB,YAAA,CAAa,OAAA;AAAA,MACrD,MAAA,CAAO;AAAA,KACR;AAEA,IAAA,KAAA,IAAS,CAAA,GAAI,YAAA,GAAe,CAAA,EAAG,CAAA,IAAK,GAAG,CAAA,EAAA,EAAK;AAC3C,MAAA,MAAM,YAAA,GAAe,oBAAA,CAAoB,YAAA,CAAa,CAAC,CAAA;AACvD,MAAA,MAAM,cAAA,GACL,aAAa,MAAA,CAAO,CAAC,EAAE,WAAA,EAAY,GAAI,YAAA,CAAa,KAAA,CAAM,CAAC,CAAA;AAC5D,MAAA,MAAM,eAAA,GAAkB,eAAe,cAAc,CAAA,oBAAA,CAAA;AACrD,MAAA,MAAM,gBAAgB,IAAI,MAAA,CAAO,CAAA,IAAA,EAAO,eAAe,IAAI,GAAG,CAAA;AAC9D,MAAA,MAAM,eAAA,GAAkB,QAAA,CAAS,KAAA,CAAM,aAAa,CAAA;AAEpD,MAAA,IAAI,eAAA,EAAiB;AACpB,QAAA,MAAM,QAAA,GAAW,eAAA,CAAgB,eAAA,CAAgB,MAAA,GAAS,CAAC,CAAA;AAC3D,QAAA,MAAMA,UAAAA,GACL,UAAU,KAAA,GACV,SAAA,CAAU,CAAC,CAAA,CAAE,WAAA,CAAY,QAAQ,CAAA,GACjC,QAAA,CAAS,MAAA;AACV,QAAA,MAAMC,QAAAA,GAAU;;AAAA,kBAAA,EAA2B,OAAO,gBAAgB;AAAA,CAAA;AAClE,QAAA,OACC,OAAA,CAAQ,MAAM,CAAA,EAAGD,UAAS,IAC1BC,QAAAA,GACA,gBAAA,GACA,OAAA,CAAQ,KAAA,CAAMD,UAAS,CAAA;AAAA,MAEzB;AAAA,IACD;AAGA,IAAA,MAAM,SAAA,GAAY,UAAU,KAAA,GAAS,SAAA,CAAU,CAAC,CAAA,CAAE,OAAA,CAAQ,GAAG,CAAA,GAAI,CAAA;AACjE,IAAA,MAAM,OAAA,GAAU;AAAA,kBAAA,EAAyB,OAAO,gBAAgB;AAAA,CAAA;AAChE,IAAA,OACC,OAAA,CAAQ,MAAM,CAAA,EAAG,SAAS,IAC1B,OAAA,GACA,gBAAA,GACA,OAAA,CAAQ,KAAA,CAAM,SAAS,CAAA;AAAA,EAEzB;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,SAAA,EAA2B;AAEjD,IAAA,MAAM,UAAA,GAAa,SAAA,CAAU,OAAA,CAAQ,qBAAA,EAAuB,MAAM,CAAA;AAClE,IAAA,OAAO,IAAI,MAAA;AAAA,MACV,wCAAwC,UAAU,CAAA,WAAA,CAAA;AAAA,MAClD;AAAA,KACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,gBAAA,CACb,GAAA,EACA,IAAA,EACA,cACA,MAAA,EACmB;AACnB,IAAA,IAAI;AACH,MAAA,MAAM,UAAA,GAAaV,IAAAA;AAAA,QAClB,GAAA;AAAA,QACA,KAAA;AAAA,QACA,MAAA,CAAO,gBAAA;AAAA,QACP,GAAG,IAAI,CAAA,GAAA;AAAA,OACR;AAEA,MAAA,IAAI,CAACQ,UAAAA,CAAW,UAAU,CAAA,EAAG;AAC5B,QAAA,OAAO,KAAA;AAAA,MACR;AAEA,MAAA,MAAM,aAAA,GAAgB,MAAMN,QAAAA,CAAS,UAAA,EAAY,OAAO,CAAA;AAKxD,MAAA,MAAM,kBAAkB,IAAI,MAAA;AAAA,QAC3B,yBAAyB,YAAY,CAAA,uBAAA,CAAA;AAAA,QACrC;AAAA,OACD;AAEA,MAAA,OAAO,eAAA,CAAgB,KAAK,aAAa,CAAA;AAAA,IAC1C,SAAS,KAAA,EAAO;AAEf,MAAA,OAAO,KAAA;AAAA,IACR;AAAA,EACD;AACD,CAAA;ACpQO,IAAM,oBAAN,MAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAW9B,YAAA,CAAa,MAAc,MAAA,EAAgC;AAC1D,IAAA,MAAM,SAAA,GAAY,mBAAA;AAElB,IAAA,IAAI,CAAC,SAAA,CAAU,IAAA,CAAK,IAAI,CAAA,EAAG;AAC1B,MAAA,MAAM,UAAA,GACL,MAAA,CAAO,UAAA,CAAW,MAAA,CAAO,CAAC,CAAA,CAAE,WAAA,EAAY,GAAI,MAAA,CAAO,UAAA,CAAW,KAAA,CAAM,CAAC,CAAA;AACtE,MAAA,MAAM,IAAI,KAAA;AAAA,QACT,CAAA,EAAG,UAAU,CAAA,+CAAA,EAAkD,MAAA,CAAO,UAAU,CAAA,CAAA;AAAA,OACjF;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,gBAAgB,GAAA,EAAmB;AAClC,IAAA,MAAM,eAAA,GAAkBF,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAA;AAEhD,IAAA,IAAI,CAACQ,UAAAA,CAAW,eAAe,CAAA,EAAG;AACjC,MAAA,MAAM,IAAI,KAAA;AAAA,QACT;AAAA,OACD;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,qBAAA,CAAsB,GAAA,EAAa,IAAA,EAAc,MAAA,EAAgC;AAChF,IAAA,MAAM,WAAWR,IAAAA,CAAK,GAAA,EAAK,OAAO,SAAA,EAAW,CAAA,EAAG,IAAI,CAAA,GAAA,CAAK,CAAA;AAEzD,IAAA,IAAIQ,UAAAA,CAAW,QAAQ,CAAA,EAAG;AACzB,MAAA,MAAM,UAAA,GACL,MAAA,CAAO,UAAA,CAAW,MAAA,CAAO,CAAC,CAAA,CAAE,WAAA,EAAY,GAAI,MAAA,CAAO,UAAA,CAAW,KAAA,CAAM,CAAC,CAAA;AACtE,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,iBAAA,EAAoB,QAAQ,CAAA,CAAE,CAAA;AAAA,IAC5D;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,cAAA,CAAe,GAAA,EAAa,IAAA,EAAc,MAAA,EAAgC;AACzE,IAAA,IAAA,CAAK,YAAA,CAAa,MAAM,MAAM,CAAA;AAC9B,IAAA,IAAA,CAAK,gBAAgB,GAAG,CAAA;AACxB,IAAA,IAAA,CAAK,qBAAA,CAAsB,GAAA,EAAK,IAAA,EAAM,MAAM,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,wBAAwB,OAAA,EAAgC;AACvD,IAAA,IAAI,OAAA,CAAQ,MAAA,IAAU,OAAA,CAAQ,OAAA,EAAS;AACtC,MAAA,MAAM,IAAI,MAAM,8CAA8C,CAAA;AAAA,IAC/D;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,mBAAA,CACC,MACA,OAAA,EACS;AACT,IAAA,IAAI,QAAQ,UAAA,EAAY;AACvB,MAAA,OAAO,OAAA,CAAQ,UAAA;AAAA,IAChB;AAEA,IAAA,IAAI,QAAQ,OAAA,EAAS;AAEpB,MAAA,OAAO,iBAAA;AAAA,IACR;AAGA,IAAA,OAAO,YAAY,IAAI,CAAA,CAAA;AAAA,EACxB;AACD,CAAA;ACzEO,IAAM,kBAAN,MAAsB;AAAA,EACpB,aAAA,uBAAoB,GAAA,EAAwC;AAAA,EAC5D,YAAA;AAAA,EAER,WAAA,GAAc;AAEb,IAAA,MAAMX,WAAAA,GAAaO,aAAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAChD,IAAA,MAAMN,UAAAA,GAAYG,QAAQJ,WAAU,CAAA;AAIpC,IAAA,IAAI,UAAA,GAAaC,UAAAA;AACjB,IAAA,IAAI,aAAA,GAAgB,EAAA;AAGpB,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,CAAA,EAAG,CAAA,EAAA,EAAK;AAC3B,MAAA,MAAM,aAAA,GAAgBE,IAAAA,CAAK,UAAA,EAAY,uBAAuB,CAAA;AAC9D,MAAA,IAAI;AAEH,QAAA,IAAI,QAAA,CAAS,aAAa,CAAA,CAAE,WAAA,EAAY,EAAG;AAC1C,UAAA,aAAA,GAAgB,aAAA;AAChB,UAAA;AAAA,QACD;AAAA,MACD,CAAA,CAAA,MAAQ;AAAA,MAER;AACA,MAAA,UAAA,GAAaC,QAAQ,UAAU,CAAA;AAAA,IAChC;AAEA,IAAA,IAAI,CAAC,aAAA,EAAe;AACnB,MAAA,MAAM,IAAI,KAAA;AAAA,QACT,oEAAoEH,UAAS,CAAA;AAAA,OAC9E;AAAA,IACD;AAEA,IAAA,IAAA,CAAK,YAAA,GAAe,aAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,YAAA,EAAkD;AAEtE,IAAA,IAAI,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,YAAY,CAAA,EAAG;AACzC,MAAA,OAAO,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,YAAY,CAAA;AAAA,IAC3C;AAGA,IAAA,MAAM,QAAA,GAAWE,IAAAA,CAAK,IAAA,CAAK,YAAA,EAAc,YAAY,CAAA;AACrD,IAAA,MAAM,eAAA,GAAkB,YAAA,CAAa,QAAA,EAAU,OAAO,CAAA;AAGtD,IAAA,MAAM,WAAWY,UAAAA,CAAW,OAAA,CAAQ,iBAAiB,EAAE,QAAA,EAAU,MAAM,CAAA;AAGvE,IAAA,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,YAAA,EAAc,QAAQ,CAAA;AAE7C,IAAA,OAAO,QAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,MAAA,EAAgC;AAChD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,mBAAmB,CAAA;AAEtD,IAAA,OAAO,SAAS,MAAM,CAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,MAAA,EAAgC;AAClD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,qBAAqB,CAAA;AACxD,IAAA,OAAO,SAAS,MAAM,CAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,MAAA,EAAyC;AAC7D,IAAA,MAAM,EAAE,YAAW,GAAI,MAAA;AAGvB,IAAA,MAAM,eAAe,UAAA,CAAW,QAAA,CAAS,GAAG,CAAA,IAAK,UAAA,CAAW,SAAS,GAAG,CAAA;AAGxE,IAAA,MAAM,YAAY,YAAA,GACf,KAAA,CAAM,IAAA,CAAK,UAAA,CAAW,SAAS,YAAY,CAAC,CAAA,CAAE,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,CAAC,CAAC,IAC7D,EAAC;AAGJ,IAAA,MAAM,OAAA,GAAU;AAAA,MACf,GAAG,MAAA;AAAA,MACH,YAAA;AAAA,MACA,SAAA;AAAA,MACA,eAAA,EAAiB,SAAA,CAAU,IAAA,CAAK,IAAI;AAAA,KACrC;AAEA,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,uBAAuB,CAAA;AAC1D,IAAA,OAAO,SAAS,OAAO,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,mBACC,MAAA,EACS;AACT,IAAA,QAAQ,OAAO,UAAA;AAAY,MAC1B,KAAK,MAAA;AACJ,QAAA,OAAO,IAAA,CAAK,iBAAiB,MAAM,CAAA;AAAA,MACpC,KAAK,QAAA;AACJ,QAAA,OAAO,IAAA,CAAK,mBAAmB,MAAM,CAAA;AAAA,MACtC,KAAK,UAAA;AACJ,QAAA,IAAI,EAAE,gBAAgB,MAAA,CAAA,EAAS;AAC9B,UAAA,MAAM,IAAI,MAAM,kDAAkD,CAAA;AAAA,QACnE;AACA,QAAA,OAAO,IAAA,CAAK,qBAAqB,MAAM,CAAA;AAAA,MACxC;AACC,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,qBAAA,EAAyB,MAAA,CAA0B,UAAU,CAAA,CAAE,CAAA;AAAA;AACjF,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,MAAA,EAAgC;AACpD,IAAA,MAAM,EAAE,UAAA,EAAY,IAAA,EAAM,eAAA,EAAgB,GAAI,MAAA;AAC9C,IAAA,MAAM,gBAAA,GAAmB,GAAG,UAAU,CAAA,CAAA,CAAA;AACtC,IAAA,MAAM,cAAA,GACL,WAAW,MAAA,CAAO,CAAC,EAAE,WAAA,EAAY,GAAI,UAAA,CAAW,KAAA,CAAM,CAAC,CAAA;AAGxD,IAAA,MAAM,OAAA,GAAU;AAAA,MACf,GAAG,MAAA;AAAA,MACH,gBAAA;AAAA,MACA,cAAA;AAAA,MACA,YAAY,UAAA,KAAe,MAAA;AAAA,MAC3B,cAAc,UAAA,KAAe,QAAA;AAAA,MAC7B,gBAAgB,UAAA,KAAe;AAAA,KAChC;AAEA,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,qBAAqB,CAAA;AACxD,IAAA,OAAO,SAAS,OAAO,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,4BAA4B,MAAA,EAA0D;AACrF,IAAA,MAAM,EAAE,UAAA,EAAY,IAAA,EAAM,WAAA,EAAY,GAAI,MAAA;AAE1C,IAAA,IAAI,eAAe,MAAA,EAAQ;AAC1B,MAAA,OAAO,IAAA,CAAK,2BAAA,CAA4B,IAAA,EAAM,WAAW,CAAA;AAAA,IAC1D,CAAA,MAAA,IAAW,eAAe,QAAA,EAAU;AACnC,MAAA,OAAO,IAAA,CAAK,6BAAA,CAA8B,IAAA,EAAM,WAAW,CAAA;AAAA,IAC5D,CAAA,MAAA,IAAW,eAAe,UAAA,EAAY;AACrC,MAAA,MAAM,aAAc,MAAA,CAAmC,UAAA;AACvD,MAAA,OAAO,IAAA,CAAK,+BAAA,CAAgC,IAAA,EAAM,WAAA,EAAa,UAAU,CAAA;AAAA,IAC1E;AAEA,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,qBAAA,EAAwB,UAAU,CAAA,CAAE,CAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKQ,2BAAA,CAA4B,MAAc,WAAA,EAA6B;AAC9E,IAAA,MAAM,OAAA,GAAU;AAAA,MACf,IAAA;AAAA,MACA,cAAA,EAAgB,IAAA,CAAK,OAAA,CAAQ,IAAA,EAAM,GAAG,CAAA;AAAA,MACtC,WAAA,EAAa,WAAA,IAAe,CAAA,YAAA,EAAe,IAAI,CAAA,qBAAA;AAAA,KAChD;AAEA,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,iCAAiC,CAAA;AACpE,IAAA,OAAO,SAAS,OAAO,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,6BAAA,CACP,MACA,WAAA,EACS;AACT,IAAA,MAAM,OAAA,GAAU;AAAA,MACf,IAAA;AAAA,MACA,cAAA,EAAgB,IAAA,CAAK,OAAA,CAAQ,IAAA,EAAM,GAAG,CAAA;AAAA,MACtC,WAAA,EAAa,WAAA,IAAe,CAAA,YAAA,EAAe,IAAI,CAAA,uBAAA;AAAA,KAChD;AAEA,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,mCAAmC,CAAA;AACtE,IAAA,OAAO,SAAS,OAAO,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,+BAAA,CACP,IAAA,EACA,WAAA,EACA,UAAA,EACS;AACT,IAAA,MAAM,OAAA,GAAU;AAAA,MACf,IAAA;AAAA,MACA,cAAA,EAAgB,IAAA,CAAK,OAAA,CAAQ,IAAA,EAAM,GAAG,CAAA;AAAA,MACtC,aAAa,WAAA,IAAe,eAAA;AAAA,MAC5B,UAAA;AAAA,MACA,gBAAA,EAAkB,UAAA,CAAW,OAAA,CAAQ,YAAA,EAAc,EAAE;AAAA,KACtD;AAEA,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,qCAAqC,CAAA;AACxE,IAAA,OAAO,SAAS,OAAO,CAAA;AAAA,EACxB;AACD,CAAA;ACjQO,SAAS,sBAAsB,GAAA,EAA4B;AACjE,EAAA,MAAM,WAAA,GAAc,CAAC,gBAAA,EAAkB,eAAA,EAAiB,eAAe,CAAA;AACvE,EAAA,KAAA,MAAW,QAAQ,WAAA,EAAa;AAC/B,IAAA,MAAMP,KAAAA,GAAOL,IAAAA,CAAK,GAAA,EAAK,IAAI,CAAA;AAC3B,IAAA,IAAIQ,UAAAA,CAAWH,KAAI,CAAA,EAAG;AACrB,MAAA,OAAOA,KAAAA;AAAA,IACR;AAAA,EACD;AACA,EAAA,OAAO,IAAA;AACR;AAKO,SAAS,WAAW,OAAA,EAAsB;AAChD,EAAA,MAAM,QAAA,GAAW,kBAAkB,OAAO,CAAA;AAC1C,EAAA,OAAO,IAAA,CAAK,MAAM,QAAQ,CAAA;AAC3B;AAKO,SAAS,WAAW,GAAA,EAAkB;AAC5C,EAAA,OAAO,IAAA,CAAK,SAAA,CAAU,GAAA,EAAK,IAAA,EAAM,GAAI,CAAA;AACtC;ACpBO,SAAS,aAAa,GAAA,EAAqB;AACjD,EAAA,OAAO,GAAA,CACL,MAAM,GAAG,CAAA,CACT,IAAI,CAAC,IAAA,KAAS,KAAK,MAAA,CAAO,CAAC,EAAE,WAAA,EAAY,GAAI,KAAK,KAAA,CAAM,CAAC,EAAE,WAAA,EAAa,CAAA,CACxE,IAAA,CAAK,EAAE,CAAA;AACV;AAYO,SAAS,YAAY,GAAA,EAAqB;AAChD,EAAA,OAAO,GAAA,CACL,QAAQ,UAAA,EAAY,KAAK,EACzB,WAAA,EAAY,CACZ,OAAA,CAAQ,IAAA,EAAM,EAAE,CAAA;AACnB;AAYA,eAAsB,WAAW,QAAA,EAAoC;AACpE,EAAA,IAAI;AACH,IAAA,MAAMQ,OAAO,QAAQ,CAAA;AACrB,IAAA,OAAO,IAAA;AAAA,EACR,CAAA,CAAA,MAAQ;AACP,IAAA,OAAO,KAAA;AAAA,EACR;AACD;AAYO,SAAS,WAAW,GAAA,EAAqB;AAC/C,EAAA,OAAO,GAAA,CAAI,OAAO,CAAC,CAAA,CAAE,aAAY,GAAI,GAAA,CAAI,MAAM,CAAC,CAAA;AACjD;;;ACrCO,IAAM,0BAAN,MAA8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOpC,MAAM,eAAe,GAAA,EAAwC;AAC5D,IAAA,MAAM,QAAA,GAA6B;AAAA,MAClC,IAAI,EAAC;AAAA,MACL,IAAI,EAAC;AAAA,MACL,IAAI;AAAC,KACN;AAEA,IAAA,MAAM,YAAA,GAAe,sBAAsB,GAAG,CAAA;AAC9C,IAAA,IAAI,CAAC,YAAA,IAAgB,CAACL,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC/C,MAAA,OAAO,QAAA;AAAA,IACR;AAEA,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,YAAA,EAAc,OAAO,CAAA;AACpD,MAAA,MAAM,MAAA,GAAS,WAAW,OAAO,CAAA;AAGjC,MAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,aAAa,CAAA,EAAG;AACxC,QAAA,QAAA,CAAS,KAAK,MAAA,CAAO,aAAA,CACnB,GAAA,CAAI,CAAC,OAAY,EAAA,CAAG,OAAO,CAAA,CAC3B,MAAA,CAAO,CAAC,CAAA,KAAW,OAAO,MAAM,QAAA,IAAY,CAAA,CAAE,SAAS,CAAC,CAAA;AAAA,MAC3D;AAGA,MAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,YAAY,CAAA,EAAG;AACvC,QAAA,QAAA,CAAS,KAAK,MAAA,CAAO,YAAA,CACnB,GAAA,CAAI,CAAC,OAAY,EAAA,CAAG,OAAO,CAAA,CAC3B,MAAA,CAAO,CAAC,CAAA,KAAW,OAAO,MAAM,QAAA,IAAY,CAAA,CAAE,SAAS,CAAC,CAAA;AAAA,MAC3D;AAGA,MAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,UAAU,CAAA,EAAG;AACrC,QAAA,QAAA,CAAS,KAAK,MAAA,CAAO,UAAA,CACnB,GAAA,CAAI,CAAC,WAAgB,MAAA,CAAO,OAAO,CAAA,CACnC,MAAA,CAAO,CAAC,CAAA,KAAW,OAAO,MAAM,QAAA,IAAY,CAAA,CAAE,SAAS,CAAC,CAAA;AAAA,MAC3D;AAGA,MAAA,IAAI,MAAA,CAAO,EAAA,IAAM,OAAO,MAAA,CAAO,EAAA,CAAG,OAAA,KAAY,QAAA,IAAY,MAAA,CAAO,EAAA,CAAG,OAAA,CAAQ,MAAA,GAAS,CAAA,EAAG;AACvF,QAAA,QAAA,CAAS,EAAA,GAAK,OAAO,EAAA,CAAG,OAAA;AAAA,MACzB;AAAA,IACD,SAAS,KAAA,EAAO;AAGf,MAAA,OAAA,CAAQ,IAAA;AAAA,QACP,6CAA6C,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,OACpG;AAAA,IACD;AAEA,IAAA,OAAO,QAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,eAAe,GAAA,EAA+B;AACnD,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,cAAA,CAAe,GAAG,CAAA;AAC9C,IAAA,OACC,QAAA,CAAS,EAAA,CAAG,MAAA,GAAS,CAAA,IACrB,SAAS,EAAA,CAAG,MAAA,GAAS,CAAA,IACrB,QAAA,CAAS,EAAA,CAAG,MAAA,GAAS,CAAA,IACrB,CAAC,CAAC,QAAA,CAAS,EAAA;AAAA,EAEb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,wBAAwB,QAAA,EAA8C;AACrE,IAAA,MAAM,WAA6B,EAAC;AAGpC,IAAA,KAAA,MAAW,WAAA,IAAe,SAAS,EAAA,EAAI;AACtC,MAAA,MAAM,WAAA,GAAc,IAAA,CAAK,kBAAA,CAAmB,WAAA,EAAa,IAAI,CAAA;AAC7D,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,iBAAA,CAAkB,WAAA,EAAa,IAAI,CAAA;AAE3D,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACb,IAAA,EAAM,IAAA;AAAA,QACN,WAAA;AAAA,QACA,WAAA;AAAA,QACA,eAAA,EAAiB,CAAA,SAAA,EAAY,WAAW,CAAA,2BAAA,EAA8B,UAAU,CAAA,KAAA,CAAA;AAAA,QAChF,YAAA,EAAc;AAAA,UACb,CAAA,kBAAA,EAAqB,WAAW,CAAA,KAAA,EAAQ,WAAW,CAAA,EAAA,CAAA;AAAA,UACnD,CAAA,4CAAA,CAAA;AAAA,UACA,CAAA,mEAAA;AAAA,SACD,CAAE,KAAK,OAAO;AAAA,OACd,CAAA;AAAA,IACF;AAGA,IAAA,KAAA,MAAW,WAAA,IAAe,SAAS,EAAA,EAAI;AACtC,MAAA,MAAM,WAAA,GAAc,IAAA,CAAK,kBAAA,CAAmB,WAAA,EAAa,IAAI,CAAA;AAC7D,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,iBAAA,CAAkB,WAAA,EAAa,IAAI,CAAA;AAE3D,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACb,IAAA,EAAM,IAAA;AAAA,QACN,WAAA;AAAA,QACA,WAAA;AAAA,QACA,eAAA,EAAiB,CAAA,SAAA,EAAY,WAAW,CAAA,2BAAA,EAA8B,UAAU,CAAA,KAAA,CAAA;AAAA,QAChF,YAAA,EAAc;AAAA,UACb,CAAA,eAAA,EAAkB,WAAW,CAAA,KAAA,EAAQ,WAAW,CAAA,EAAA,CAAA;AAAA,UAChD,CAAA,mFAAA,CAAA;AAAA,UACA,CAAA,8EAAA;AAAA,SACD,CAAE,KAAK,OAAO;AAAA,OACd,CAAA;AAAA,IACF;AAGA,IAAA,KAAA,MAAW,WAAA,IAAe,SAAS,EAAA,EAAI;AACtC,MAAA,MAAM,WAAA,GAAc,IAAA,CAAK,kBAAA,CAAmB,WAAA,EAAa,IAAI,CAAA;AAC7D,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,iBAAA,CAAkB,WAAA,EAAa,IAAI,CAAA;AAE3D,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACb,IAAA,EAAM,IAAA;AAAA,QACN,WAAA;AAAA,QACA,WAAA;AAAA,QACA,eAAA,EAAiB,CAAA,SAAA,EAAY,WAAW,CAAA,2BAAA,EAA8B,UAAU,CAAA,KAAA,CAAA;AAAA,QAChF,YAAA,EAAc;AAAA,UACb,CAAA,mBAAA,EAAsB,WAAW,CAAA,KAAA,EAAQ,WAAW,CAAA,EAAA,CAAA;AAAA,UACpD,CAAA,wDAAA,CAAA;AAAA,UACA,CAAA,yDAAA;AAAA,SACD,CAAE,KAAK,OAAO;AAAA,OACd,CAAA;AAAA,IACF;AAGA,IAAA,IAAI,SAAS,EAAA,EAAI;AAChB,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACb,IAAA,EAAM,IAAA;AAAA,QACN,aAAa,QAAA,CAAS,EAAA;AAAA,QACtB,YAAA,EAAc;AAAA,UACb,CAAA,gBAAA,CAAA;AAAA,UACA,CAAA,4BAAA,EAA+B,SAAS,EAAE,CAAA,uCAAA,CAAA;AAAA,UAC1C,CAAA,CAAA;AAAA,UACA,CAAA,sBAAA,CAAA;AAAA,UACA,CAAA,+BAAA,EAAkC,SAAS,EAAE,CAAA,qCAAA;AAAA,SAC9C,CAAE,KAAK,OAAO;AAAA,OACd,CAAA;AAAA,IACF;AAEA,IAAA,OAAO,QAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,uBAAuB,QAAA,EAAoC;AAC1D,IAAA,MAAM,QAAkB,EAAC;AAEzB,IAAA,IAAI,QAAA,CAAS,EAAA,CAAG,MAAA,GAAS,CAAA,EAAG;AAC3B,MAAA,KAAA,CAAM,KAAK,CAAA,IAAA,EAAO,QAAA,CAAS,GAAG,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAAA,IAC3C;AACA,IAAA,IAAI,QAAA,CAAS,EAAA,CAAG,MAAA,GAAS,CAAA,EAAG;AAC3B,MAAA,KAAA,CAAM,KAAK,CAAA,IAAA,EAAO,QAAA,CAAS,GAAG,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAAA,IAC3C;AACA,IAAA,IAAI,QAAA,CAAS,EAAA,CAAG,MAAA,GAAS,CAAA,EAAG;AAC3B,MAAA,KAAA,CAAM,KAAK,CAAA,IAAA,EAAO,QAAA,CAAS,GAAG,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAAA,IAC3C;AACA,IAAA,IAAI,SAAS,EAAA,EAAI;AAChB,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,QAAA,CAAS,EAAE,CAAA,CAAE,CAAA;AAAA,IAChC;AAEA,IAAA,OAAO,KAAA,CAAM,KAAK,KAAK,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,kBAAA,CACP,aACA,WAAA,EACS;AACT,IAAA,MAAM,QAAA,GAAW,aAAa,WAAA,CAAY,WAAA,GAAc,OAAA,CAAQ,IAAA,EAAM,GAAG,CAAC,CAAA;AAC1E,IAAA,MAAM,MAAA,GAAS,YAAY,WAAA,EAAY;AACvC,IAAA,OAAO,CAAA,EAAG,QAAQ,CAAA,EAAG,MAAM,CAAA,CAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,iBAAA,CACP,aACA,WAAA,EACS;AACT,IAAA,MAAM,WAAW,WAAA,CAAY,WAAA,EAAY,CAAE,OAAA,CAAQ,MAAM,GAAG,CAAA;AAC5D,IAAA,OAAO,CAAA,EAAG,WAAW,CAAA,CAAA,EAAI,QAAQ,CAAA,CAAA;AAAA,EAClC;AACD,CAAA;ACvMA,eAAsB,sBAAA,CACrB,GAAA,EACA,UAAA,EACA,IAAA,EACA,aACA,QAAA,EACgB;AAChB,EAAA,MAAM,YAAA,GAAeF,IAAAA,CAAK,GAAA,EAAK,oBAAoB,CAAA;AAEnD,EAAA,IAAI,CAACQ,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC9B,IAAA;AAAA,EACD;AAEA,EAAA,IAAI;AACH,IAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,YAAA,EAAc,OAAO,CAAA;AACpD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAGnC,IAAA,IAAI,CAAC,QAAA,CAAS,UAAU,CAAA,EAAG;AAC1B,MAAA,QAAA,CAAS,UAAU,IAAI,EAAC;AAAA,IACzB;AAGA,IAAA,MAAM,cAAA,GAAiC;AAAA,MACtC,IAAA;AAAA,MACA,IAAA,EAAM,WAAA;AAAA,MACN,UAAA,EAAY,IAAA;AAAA,MACZ,WAAA,EAAa,QAAA;AAAA,MACb,kBAAA,EAAoB;AAAA,KACrB;AAEA,IAAA,QAAA,CAAS,UAAU,CAAA,CAAE,IAAA,CAAK,cAAc,CAAA;AAExC,IAAA,MAAMO,SAAAA,CAAU,cAAc,IAAA,CAAK,SAAA,CAAU,UAAU,IAAA,EAAM,GAAI,GAAG,OAAO,CAAA;AAAA,EAC5E,SAAS,KAAA,EAAO;AACf,IAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,qDAAA,EAA8C,KAAK,CAAA,CAAE,CAAA;AAAA,EACnE;AACD;ACtEO,IAAM,qBAAA,GAAwBK,EAAE,MAAA,CAAO;AAAA;AAAA,EAE7C,UAAA,EAAYA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA;AAAA,EAEhC,MAAA,EAAQA,CAAAA,CAAE,OAAA,EAAQ,CAAE,QAAA,EAAS;AAAA;AAAA,EAE7B,OAAA,EAASA,CAAAA,CAAE,OAAA,EAAQ,CAAE,QAAA;AACtB,CAAC,CAAA;AAOM,IAAM,oBAAA,GAAuBA,EAAE,MAAA,CAAO;AAAA;AAAA,EAE5C,YAAYA,CAAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,QAAA,EAAU,UAAU,CAAC,CAAA;AAAA;AAAA,EAEjD,IAAA,EAAMA,CAAAA,CAAE,MAAA,EAAO,CAAE,MAAM,mBAAA,EAAqB;AAAA,IAC3C,OAAA,EAAS;AAAA,GACT,CAAA;AAAA;AAAA,EAED,WAAA,EAAaA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA;AAAA,EAEjC,eAAeA,CAAAA,CAAE,OAAA,GAAU,QAAA,EAAS,CAAE,QAAQ,IAAI,CAAA;AAAA;AAAA,EAElD,cAAcA,CAAAA,CAAE,OAAA,GAAU,QAAA,EAAS,CAAE,QAAQ,IAAI,CAAA;AAAA;AAAA,EAEjD,eAAA,EAAiB,sBAAsB,QAAA;AACxC,CAAC,CAAA,CAAE,MAAA;AAAA,EACF,CAAC,IAAA,KAAS;AAET,IAAA,IAAI,IAAA,CAAK,UAAA,KAAe,UAAA,IAAc,CAAC,KAAK,eAAA,EAAiB;AAC5D,MAAA,OAAO,KAAA;AAAA,IACR;AACA,IAAA,OAAO,IAAA;AAAA,EACR,CAAA;AAAA,EACA;AAAA,IACC,OAAA,EAAS,6DAAA;AAAA,IACT,IAAA,EAAM,CAAC,iBAAiB;AAAA;AAE1B,CAAA,CAAE,MAAA;AAAA,EACD,CAAC,IAAA,KAAS;AAET,IAAA,IAAI,IAAA,CAAK,eAAA,EAAiB,MAAA,IAAU,IAAA,CAAK,iBAAiB,OAAA,EAAS;AAClE,MAAA,OAAO,KAAA;AAAA,IACR;AACA,IAAA,OAAO,IAAA;AAAA,EACR,CAAA;AAAA,EACA;AAAA,IACC,OAAA,EAAS,8CAAA;AAAA,IACT,IAAA,EAAM,CAAC,iBAAiB;AAAA;AAE1B,CAAA;AAWwCA,EAAE,MAAA,CAAO;AAAA;AAAA,EAEhD,YAAYA,CAAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,QAAA,EAAU,UAAU,CAAC,CAAA;AAAA;AAAA,EAEjD,kBAAkBA,CAAAA,CAAE,IAAA,CAAK,CAAC,OAAA,EAAS,SAAA,EAAW,WAAW,CAAC,CAAA;AAAA;AAAA,EAE1D,SAAA,EAAWA,EAAE,MAAA,EAAO;AAAA;AAAA,EAEpB,cAAA,EAAgBA,EAAE,MAAA;AACnB,CAAC;AAOqCA,EAAE,MAAA,CAAO;AAAA;AAAA,EAE9C,YAAYA,CAAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,QAAA,EAAU,UAAU,CAAC,CAAA;AAAA;AAAA,EAEjD,SAAA,EAAWA,EAAE,MAAA;AACd,CAAC;AAOM,IAAMC,qBAAAA,GAAuBD,EAAE,MAAA,CAAO;AAAA;AAAA,EAE5C,YAAYA,CAAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,QAAA,EAAU,UAAU,CAAC,CAAA;AAAA;AAAA,EAEjD,IAAA,EAAMA,EAAE,MAAA,EAAO;AAAA;AAAA,EAEf,eAAA,EAAiBA,EAAE,MAAA,EAAO;AAAA;AAAA,EAE1B,WAAA,EAAaA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AACzB,CAAC,CAAA;AAO4CC,sBAAqB,MAAA,CAAO;AAAA;AAAA,EAExE,UAAA,EAAYD,CAAAA,CAAE,OAAA,CAAQ,UAAU,CAAA;AAAA;AAAA,EAEhC,UAAA,EAAYA,EAAE,MAAA;AACf,CAAC;AAOuCA,EAAE,MAAA,CAAO;AAAA;AAAA,EAEhD,YAAYA,CAAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,QAAA,EAAU,UAAU,CAAC,CAAA;AAAA;AAAA,EAEjD,kBAAkBA,CAAAA,CAAE,IAAA,CAAK,CAAC,OAAA,EAAS,SAAA,EAAW,WAAW,CAAC,CAAA;AAAA;AAAA,EAE1D,SAAA,EAAWA,EAAE,MAAA,EAAO;AAAA;AAAA,EAEpB,cAAA,EAAgBA,EAAE,MAAA,EAAO;AAAA;AAAA,EAEzB,kBAAA,EAAoBA,CAAAA,CAAE,UAAA,CAAW,MAAM,CAAA;AAAA;AAAA,EAEvC,WAAA,EAAaA,EAAE,MAAA,EAAO;AAAA;AAAA,EAEtB,kBAAA,EAAoBA,EAAE,MAAA;AACvB,CAAC;;;ACtGM,IAAM,yBAAN,MAEP;AAAA,EACS,mBAAA;AAAA,EACA,iBAAA;AAAA,EACA,eAAA;AAAA,EACA,uBAAA;AAAA,EAER,WAAA,GAAc;AACb,IAAA,IAAA,CAAK,mBAAA,GAAsB,IAAI,mBAAA,EAAoB;AACnD,IAAA,IAAA,CAAK,iBAAA,GAAoB,IAAI,iBAAA,EAAkB;AAC/C,IAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,eAAA,EAAgB;AAC3C,IAAA,IAAA,CAAK,uBAAA,GAA0B,IAAI,uBAAA,EAAwB;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAA,CAAS,GAAA,EAAa,MAAA,EAAuC;AAElE,IAAA,MAAM,WAAA,GAAc,oBAAA,CAAqB,SAAA,CAAU,MAAM,CAAA;AACzD,IAAA,IAAI,CAAC,YAAY,OAAA,EAAS;AACzB,MAAA,MAAM,UAAA,GAAa,WAAA,CAAY,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA;AAC7C,MAAA,MAAM,IAAI,KAAA,CAAM,UAAA,CAAW,OAAO,CAAA;AAAA,IACnC;AAEA,IAAA,MAAM,EAAE,UAAA,EAAY,IAAA,EAAK,GAAI,WAAA,CAAY,IAAA;AAGzC,IAAA,MAAM,gBAAA,GAAqC;AAAA,MAC1C,UAAA;AAAA,MACA,SAAA,EAAW,OAAO,UAAU,CAAA,CAAA;AAAA,KAC7B;AAEA,IAAA,IAAA,CAAK,iBAAA,CAAkB,cAAA,CAAe,GAAA,EAAK,IAAA,EAAM,gBAAgB,CAAA;AAGjE,IAAA,IAAI,UAAA,KAAe,UAAA,IAAc,MAAA,CAAO,eAAA,EAAiB;AACxD,MAAA,IAAA,CAAK,iBAAA,CAAkB,uBAAA,CAAwB,MAAA,CAAO,eAAe,CAAA;AAAA,IACtE;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,QACL,OAAA,EACgB;AAChB,IAAA,MAAM,EAAE,GAAA,EAAK,MAAA,EAAQ,MAAA,EAAO,GAAI,OAAA;AAEhC,IAAA,MAAM,EAAE,UAAA,EAAY,IAAA,EAAK,GAAI,MAAA;AAC7B,IAAA,MAAM,eAAA,GAAkB,aAAa,IAAI,CAAA;AACzC,IAAA,MAAM,WAAA,GAAc,OAAO,WAAA,IAAe,uBAAA;AAC1C,IAAA,MAAM,aAAA,GAAgB,OAAO,aAAA,KAAkB,KAAA;AAC/C,IAAA,MAAM,YAAA,GAAe,OAAO,YAAA,KAAiB,KAAA;AAG7C,IAAA,MAAM,cAAA,GAAiB,MAAM,IAAA,CAAK,kBAAA;AAAA,MACjC,GAAA;AAAA,MACA,IAAA;AAAA,MACA,eAAA;AAAA,MACA,WAAA;AAAA,MACA;AAAA,KACD;AACA,IAAA,MAAA,CAAO,YAAA,CAAa,KAAK,cAAc,CAAA;AAGvC,IAAA,IAAI,aAAA,EAAe;AAClB,MAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,iBAAA;AAAA,QAC5B,GAAA;AAAA,QACA,IAAA;AAAA,QACA,eAAA;AAAA,QACA,WAAA;AAAA,QACA;AAAA,OACD;AACA,MAAA,MAAA,CAAO,YAAA,CAAa,IAAA,CAAK,GAAG,SAAS,CAAA;AAAA,IACtC;AAGA,IAAA,IAAI,YAAA,EAAc;AACjB,MAAA,MAAM,kBAAA,GAAyC;AAAA,QAC9C,UAAA;AAAA,QACA,gBAAA,EAAkB,GAAG,UAAU,CAAA,CAAA,CAAA;AAAA,QAC/B,SAAA,EAAW,KAAK,UAAU,CAAA,EAAA,CAAA;AAAA,QAC1B,cAAA,EACC,WAAW,MAAA,CAAO,CAAC,EAAE,WAAA,EAAY,GAAI,UAAA,CAAW,KAAA,CAAM,CAAC;AAAA,OACzD;AAEA,MAAA,MAAM,KAAK,mBAAA,CAAoB,cAAA;AAAA,QAC9B,GAAA;AAAA,QACA,IAAA;AAAA,QACA,eAAA;AAAA,QACA;AAAA,OACD;AACA,MAAA,MAAA,CAAO,UAAA,GAAa,IAAA;AAAA,IACrB;AAGA,IAAA,MAAM,sBAAA;AAAA,MACL,GAAA;AAAA,MACA,GAAG,UAAU,CAAA,CAAA,CAAA;AAAA,MACb,IAAA;AAAA,MACA,CAAA,IAAA,EAAO,UAAU,CAAA,EAAA,EAAK,IAAI,CAAA,GAAA,CAAA;AAAA,MAC1B;AAAA,KACD;AAEA,IAAA,MAAA,CAAO,OAAA,GAAU,IAAA;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAuB;AACtB,IAAA,OAAO,KAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAqC;AACpC,IAAA,OAAO;AAAA,MACN,OAAA,EAAS,KAAA;AAAA,MACT,cAAc,EAAC;AAAA,MACf,UAAA,EAAY,KAAA;AAAA,MACZ,UAAU;AAAC,KACZ;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBAAA,CACb,GAAA,EACA,IAAA,EACA,eAAA,EACA,aACA,MAAA,EACkB;AAClB,IAAA,MAAM,EAAE,UAAA,EAAY,eAAA,EAAgB,GAAI,MAAA;AACxC,IAAA,MAAM,UAAUd,IAAAA,CAAK,GAAA,EAAK,KAAA,EAAO,CAAA,EAAG,UAAU,CAAA,CAAA,CAAG,CAAA;AACjD,IAAA,MAAM,QAAA,GAAWA,IAAAA,CAAK,OAAA,EAAS,CAAA,EAAG,IAAI,CAAA,GAAA,CAAK,CAAA;AAG3C,IAAA,MAAMgB,KAAAA,CAAM,OAAA,EAAS,EAAE,SAAA,EAAW,MAAM,CAAA;AAGxC,IAAA,IAAI,cAAA;AACJ,IAAA,IAAI,eAAe,MAAA,EAAQ;AAC1B,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,uBAAA,CAAwB,eAAe,GAAG,CAAA;AACtE,MAAA,MAAM,WAAA,GACL,QAAA,CAAS,EAAA,CAAG,MAAA,GAAS,KACrB,QAAA,CAAS,EAAA,CAAG,MAAA,GAAS,CAAA,IACrB,SAAS,EAAA,CAAG,MAAA,GAAS,CAAA,IACrB,CAAC,CAAC,QAAA,CAAS,EAAA;AAEZ,MAAA,IAAI,WAAA,EAAa;AAChB,QAAA,MAAM,QAAA,GACL,IAAA,CAAK,uBAAA,CAAwB,uBAAA,CAAwB,QAAQ,CAAA;AAC9D,QAAA,MAAM,OAAA,GACL,IAAA,CAAK,uBAAA,CAAwB,sBAAA,CAAuB,QAAQ,CAAA;AAE7D,QAAA,cAAA,GAAiB;AAAA,UAChB,WAAA,EAAa,IAAA;AAAA,UACb,cAAA,EAAgB,OAAA;AAAA,UAChB,eAAA,EAAiB;AAAA,SAClB;AAAA,MACD,CAAA,MAAO;AACN,QAAA,cAAA,GAAiB;AAAA,UAChB,WAAA,EAAa;AAAA,SACd;AAAA,MACD;AAAA,IACD;AAEA,IAAA,IAAI,OAAA;AAEJ,IAAA,IAAI,UAAA,KAAe,cAAc,eAAA,EAAiB;AAEjD,MAAA,MAAM,UAAA,GAAa,KAAK,iBAAA,CAAkB,mBAAA;AAAA,QACzC,IAAA;AAAA,QACA;AAAA,OACD;AAEA,MAAA,MAAM,cAAA,GAA0C;AAAA,QAC/C,UAAA;AAAA,QACA,IAAA;AAAA,QACA,eAAA;AAAA,QACA,WAAA;AAAA,QACA;AAAA,OACD;AAEA,MAAA,OAAA,GAAU,IAAA,CAAK,eAAA,CAAgB,kBAAA,CAAmB,cAAc,CAAA;AAAA,IACjE,CAAA,MAAO;AACN,MAAA,OAAA,GAAU,IAAA,CAAK,gBAAgB,kBAAA,CAAmB;AAAA,QACjD,UAAA;AAAA,QACA,IAAA;AAAA,QACA,eAAA;AAAA,QACA,WAAA;AAAA,QACA;AAAA,OACA,CAAA;AAAA,IACF;AAEA,IAAA,MAAMP,SAAAA,CAAU,QAAA,EAAU,OAAA,EAAS,OAAO,CAAA;AAC1C,IAAA,OAAO,QAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAA,CACb,GAAA,EACA,IAAA,EACA,eAAA,EACA,aACA,MAAA,EACoB;AACpB,IAAA,MAAM,EAAE,UAAA,EAAY,eAAA,EAAgB,GAAI,MAAA;AACxC,IAAA,MAAM,YAAsB,EAAC;AAG7B,IAAA,MAAM,YAAA,GAAe,MAAM,IAAA,CAAK,gBAAA;AAAA,MAC/B,GAAA;AAAA,MACA,IAAA;AAAA,MACA,eAAA;AAAA,MACA,WAAA;AAAA,MACA;AAAA,KACD;AACA,IAAA,SAAA,CAAU,KAAK,YAAY,CAAA;AAG3B,IAAA,MAAM,mBAAA,GAAsB,MAAM,IAAA,CAAK,uBAAA;AAAA,MACtC,GAAA;AAAA,MACA,IAAA;AAAA,MACA,eAAA;AAAA,MACA,WAAA;AAAA,MACA,UAAA;AAAA,MACA;AAAA,KACD;AACA,IAAA,SAAA,CAAU,KAAK,mBAAmB,CAAA;AAElC,IAAA,OAAO,SAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,gBAAA,CACb,GAAA,EACA,IAAA,EACA,eAAA,EACA,aACA,UAAA,EACkB;AAClB,IAAA,MAAM,UAAUT,IAAAA,CAAK,GAAA,EAAK,QAAQ,MAAA,EAAQ,CAAA,EAAG,UAAU,CAAA,CAAA,CAAG,CAAA;AAC1D,IAAA,MAAM,QAAA,GAAWA,IAAAA,CAAK,OAAA,EAAS,CAAA,EAAG,IAAI,CAAA,QAAA,CAAU,CAAA;AAEhD,IAAA,MAAMgB,KAAAA,CAAM,OAAA,EAAS,EAAE,SAAA,EAAW,MAAM,CAAA;AAExC,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,eAAA,CAAgB,oBAAA,CAAqB;AAAA,MACzD,UAAA;AAAA,MACA,IAAA;AAAA,MACA,eAAA;AAAA,MACA;AAAA,KACA,CAAA;AAED,IAAA,MAAMP,SAAAA,CAAU,QAAA,EAAU,OAAA,EAAS,OAAO,CAAA;AAC1C,IAAA,OAAO,QAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,uBAAA,CACb,GAAA,EACA,MACA,eAAA,EACA,WAAA,EACA,YACA,eAAA,EACkB;AAElB,IAAA,MAAM,OAAA,GAAUT,IAAAA;AAAA,MACf,GAAA;AAAA,MACA,MAAA;AAAA,MACA,aAAA;AAAA,MACA,OAAA;AAAA,MACA,UAAA,KAAe,MAAA,GAAS,EAAA,GAAK,CAAA,EAAG,UAAU,CAAA,CAAA;AAAA,KAC3C;AACA,IAAA,MAAM,QAAA,GAAWA,IAAAA,CAAK,OAAA,EAAS,CAAA,EAAG,IAAI,CAAA,KAAA,CAAO,CAAA;AAE7C,IAAA,MAAMgB,KAAAA,CAAM,OAAA,EAAS,EAAE,SAAA,EAAW,MAAM,CAAA;AAExC,IAAA,IAAI,OAAA;AAEJ,IAAA,IAAI,UAAA,KAAe,cAAc,eAAA,EAAiB;AACjD,MAAA,MAAM,UAAA,GAAa,KAAK,iBAAA,CAAkB,mBAAA;AAAA,QACzC,IAAA;AAAA,QACA;AAAA,OACD;AAEA,MAAA,OAAA,GAAU,IAAA,CAAK,gBAAgB,2BAAA,CAA4B;AAAA,QAC1D,UAAA;AAAA,QACA,IAAA;AAAA,QACA,eAAA;AAAA,QACA,WAAA;AAAA,QACA;AAAA,OACA,CAAA;AAAA,IACF,CAAA,MAAO;AACN,MAAA,OAAA,GAAU,IAAA,CAAK,gBAAgB,2BAAA,CAA4B;AAAA,QAC1D,UAAA;AAAA,QACA,IAAA;AAAA,QACA,eAAA;AAAA,QACA;AAAA,OACA,CAAA;AAAA,IACF;AAEA,IAAA,MAAMP,SAAAA,CAAU,QAAA,EAAU,OAAA,EAAS,OAAO,CAAA;AAC1C,IAAA,OAAO,QAAA;AAAA,EACR;AACD,CAAA;;;AC7UO,IAAM,mBAAN,MAAuB;AAAA,EACrB,YAAA;AAAA,EACA,QAAA;AAAA,EAER,WAAA,GAAc;AACb,IAAA,IAAA,CAAK,YAAA,GAAe,IAAI,oBAAA,EAAqB;AAC7C,IAAA,IAAA,CAAK,QAAA,GAAW,IAAI,sBAAA,EAAuB;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,QAAA,CAAS,GAAA,EAAa,MAAA,EAAiD;AAE5E,IAAA,OAAO,KAAK,YAAA,CAAa,QAAA,CAAS,GAAA,EAAK,MAAA,EAAQ,KAAK,QAAQ,CAAA;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,eAAe,UAAA,EAAoD;AACzE,IAAA,QAAQ,UAAA;AAAY,MACnB,KAAK,MAAA;AACJ,QAAA,OAAO,WAAA;AAAA,MACR,KAAK,QAAA;AACJ,QAAA,OAAO,WAAA;AAAA,MACR,KAAK,UAAA;AACJ,QAAA,OAAO,WAAA;AAAA;AACT,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,qBACN,UAAA,EACS;AACT,IAAA,OAAO,UAAA,CAAW,OAAO,CAAC,CAAA,CAAE,aAAY,GAAI,UAAA,CAAW,MAAM,CAAC,CAAA;AAAA,EAC/D;AACD,CAAA;ACpDO,SAAS,sBAAA,GAAkC;AACjD,EAAA,MAAM,OAAA,GAAU,IAAIH,OAAAA,CAAQ,QAAQ,CAAA,CAClC,WAAA,CAAY,qCAAqC,CAAA,CACjD,QAAA,CAAS,QAAA,EAAU,sCAAsC,CAAA,CACzD,MAAA;AAAA,IACA,sBAAA;AAAA,IACA,oBAAA;AAAA,IACA;AAAA,IAEA,MAAA,CAAO,YAAA,EAAc,2BAA2B,CAAA,CAChD,OAAO,eAAA,EAAiB,iCAAiC,CAAA,CACzD,MAAA,CAAO,UAAU,uBAAuB,CAAA,CACxC,MAAA,CAAO,OAAO,MAAc,OAAA,KAA8B;AAC1D,IAAA,IAAI;AACH,MAAA,MAAM,GAAA,GAAM,QAAQ,GAAA,EAAI;AACxB,MAAA,MAAM,UAAA,GAAa,IAAI,gBAAA,EAAiB;AAGxC,MAAA,MAAM,MAAA,GAAyB;AAAA,QAC9B,UAAA,EAAY,QAAA;AAAA,QACZ,IAAA;AAAA,QACA,aAAa,OAAA,CAAQ,WAAA;AAAA,QACrB,eAAe,OAAA,CAAQ,KAAA;AAAA,QACvB,cAAc,OAAA,CAAQ;AAAA,OACvB;AAGA,MAAA,MAAM,cAAA,GAAiB,MAAM,UAAA,CAAW,QAAA,CAAS,KAAK,MAAM,CAAA;AAG5D,MAAA,MAAM,MAAA,GAA0B;AAAA,QAC/B,SAAS,cAAA,CAAe,OAAA;AAAA,QACxB,UAAA,EAAY,QAAA;AAAA,QACZ,UAAA,EAAY,IAAA;AAAA,QACZ,cAAc,cAAA,CAAe,YAAA;AAAA,QAC7B,YAAY,cAAA,CAAe,UAAA;AAAA,QAC3B,OAAA,EAAS,WAAW,IAAI,CAAA,sBAAA;AAAA,OACzB;AAGA,MAAA,YAAA,CAAa,QAAQ,CAAC,CAAC,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAA,KAAM;AAC3C,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,yBAAA,EAAuB,IAAI;AAAA,CAAI,CAAA;AAE3C,QAAA,KAAA,MAAW,IAAA,IAAQ,EAAE,YAAA,EAAc;AAClC,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,eAAA,EAAa,IAAI,CAAA,CAAE,CAAA;AAAA,QAChC;AAEA,QAAA,IAAI,EAAE,UAAA,EAAY;AACjB,UAAA,OAAA,CAAQ,IAAI,CAAA,iCAAA,CAA8B,CAAA;AAAA,QAC3C;AAEA,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,eAAA,EAAe,IAAI,CAAA;AAAA,CAA2B,CAAA;AAC1D,QAAA,OAAA,CAAQ,IAAI,aAAa,CAAA;AACzB,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,sBAAA,EAAyB,IAAI,CAAA,4BAAA,CAA8B,CAAA;AACvE,QAAA,OAAA,CAAQ,IAAI,CAAA,wCAAA,CAA0C,CAAA;AACtD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA;AAAA,CAAuD,CAAA;AAAA,MACpE,CAAC,CAAA;AAAA,IACF,SAAS,KAAA,EAAO;AACf,MAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAE1E,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,MAAM,MAAA,GAA0B;AAAA,UAC/B,OAAA,EAAS,KAAA;AAAA,UACT,UAAA,EAAY,QAAA;AAAA,UACZ,UAAA,EAAY,IAAA;AAAA,UACZ,cAAc,EAAC;AAAA,UACf,UAAA,EAAY,KAAA;AAAA,UACZ,KAAA,EAAO;AAAA,SACR;AACA,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAA,MAAO;AACN,QAAA,OAAA,CAAQ,KAAA,CAAM;AAAA,cAAA,EAAc,YAAY;AAAA,CAAI,CAAA;AAAA,MAC7C;AACA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AAEF,EAAA,OAAO,OAAA;AACR;AC3EO,SAAS,wBAAA,GAAoC;AACnD,EAAA,MAAM,OAAA,GAAU,IAAIA,OAAAA,CAAQ,UAAU,CAAA,CACpC,WAAA,CAAY,uCAAuC,CAAA,CACnD,QAAA,CAAS,QAAA,EAAU,wCAAwC,CAAA,CAC3D,MAAA;AAAA,IACA,sBAAA;AAAA,IACA,sBAAA;AAAA,IACA;AAAA,GACD,CACC,MAAA;AAAA,IACA,yBAAA;AAAA,IACA;AAAA,GACD,CACC,MAAA;AAAA,IACA,UAAA;AAAA,IACA;AAAA,GACD,CACC,MAAA;AAAA,IACA,WAAA;AAAA,IACA;AAAA,IAEA,MAAA,CAAO,YAAA,EAAc,2BAA2B,CAAA,CAChD,OAAO,eAAA,EAAiB,iCAAiC,CAAA,CACzD,MAAA,CAAO,UAAU,uBAAuB,CAAA,CACxC,MAAA,CAAO,OAAO,MAAc,OAAA,KAAgC;AAE5D,IAAA,IAAI,OAAA,CAAQ,MAAA,IAAU,OAAA,CAAQ,OAAA,EAAS;AACtC,MAAA,MAAM,IAAI,MAAM,8CAA8C,CAAA;AAAA,IAC/D;AAGA,IAAA,IAAI,CAAC,QAAQ,UAAA,EAAY;AACxB,MAAA,IAAI,QAAQ,OAAA,EAAS;AAEpB,QAAA,OAAA,CAAQ,UAAA,GAAa,iBAAA;AAAA,MACtB,CAAA,MAAO;AAEN,QAAA,OAAA,CAAQ,UAAA,GAAa,YAAY,IAAI,CAAA,CAAA;AAAA,MACtC;AAAA,IACD;AAEA,IAAA,IAAI;AACH,MAAA,MAAM,GAAA,GAAM,QAAQ,GAAA,EAAI;AACxB,MAAA,MAAM,UAAA,GAAa,IAAI,gBAAA,EAAiB;AAGxC,MAAA,MAAM,MAAA,GAAyB;AAAA,QAC9B,UAAA,EAAY,UAAA;AAAA,QACZ,IAAA;AAAA,QACA,aAAa,OAAA,CAAQ,WAAA;AAAA,QACrB,eAAe,OAAA,CAAQ,KAAA;AAAA,QACvB,cAAc,OAAA,CAAQ,QAAA;AAAA,QACtB,eAAA,EAAiB;AAAA,UAChB,YAAY,OAAA,CAAQ,UAAA;AAAA,UACpB,QAAQ,OAAA,CAAQ,MAAA;AAAA,UAChB,SAAS,OAAA,CAAQ;AAAA;AAClB,OACD;AAGA,MAAA,MAAM,cAAA,GAAiB,MAAM,UAAA,CAAW,QAAA,CAAS,KAAK,MAAM,CAAA;AAG5D,MAAA,MAAM,MAAA,GAA0B;AAAA,QAC/B,SAAS,cAAA,CAAe,OAAA;AAAA,QACxB,UAAA,EAAY,UAAA;AAAA,QACZ,UAAA,EAAY,IAAA;AAAA,QACZ,cAAc,cAAA,CAAe,YAAA;AAAA,QAC7B,YAAY,cAAA,CAAe,UAAA;AAAA,QAC3B,OAAA,EAAS,aAAa,IAAI,CAAA,sBAAA;AAAA,OAC3B;AAGA,MAAA,YAAA,CAAa,QAAQ,CAAC,CAAC,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAA,KAAM;AAC3C,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,2BAAA,EAAyB,IAAI;AAAA,CAAI,CAAA;AAE7C,QAAA,KAAA,MAAW,IAAA,IAAQ,EAAE,YAAA,EAAc;AAClC,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,eAAA,EAAa,IAAI,CAAA,CAAE,CAAA;AAAA,QAChC;AAEA,QAAA,IAAI,EAAE,UAAA,EAAY;AACjB,UAAA,OAAA,CAAQ,IAAI,CAAA,iCAAA,CAA8B,CAAA;AAAA,QAC3C;AAEA,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,iBAAA,EAAiB,IAAI,CAAA;AAAA,CAA2B,CAAA;AAC5D,QAAA,OAAA,CAAQ,IAAI,aAAa,CAAA;AACzB,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,wBAAA,EAA2B,IAAI,CAAA,4BAAA,CAA8B,CAAA;AACzE,QAAA,OAAA,CAAQ,IAAI,CAAA,wCAAA,CAA0C,CAAA;AACtD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA;AAAA,CAAuD,CAAA;AAAA,MACpE,CAAC,CAAA;AAAA,IACF,SAAS,KAAA,EAAO;AACf,MAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAE1E,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,MAAM,MAAA,GAA0B;AAAA,UAC/B,OAAA,EAAS,KAAA;AAAA,UACT,UAAA,EAAY,UAAA;AAAA,UACZ,UAAA,EAAY,IAAA;AAAA,UACZ,cAAc,EAAC;AAAA,UACf,UAAA,EAAY,KAAA;AAAA,UACZ,KAAA,EAAO;AAAA,SACR;AACA,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAA,MAAO;AACN,QAAA,OAAA,CAAQ,KAAA,CAAM;AAAA,cAAA,EAAc,YAAY;AAAA,CAAI,CAAA;AAAA,MAC7C;AACA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AAEF,EAAA,OAAO,OAAA;AACR;ACxHA,eAAsB,eAAe,GAAA,EAAgC;AAEpE,EAAA,IAAI,MAAM,mBAAA,CAAoB,GAAG,CAAA,EAAG;AACnC,IAAA,OAAO,YAAA;AAAA,EACR;AAGA,EAAA,IAAI,MAAM,eAAA,CAAgB,GAAG,CAAA,EAAG;AAC/B,IAAA,OAAO,QAAA;AAAA,EACR;AAEA,EAAA,OAAO,SAAA;AACR;AAKA,eAAe,oBAAoB,GAAA,EAA+B;AAEjE,EAAA,MAAM,aAAA,GAAgB,CAAC,gBAAA,EAAkB,eAAA,EAAiB,eAAe,CAAA;AACzE,EAAA,KAAA,MAAW,QAAQ,aAAA,EAAe;AACjC,IAAA,IAAIE,UAAAA,CAAWR,IAAAA,CAAK,GAAA,EAAK,IAAI,CAAC,CAAA,EAAG;AAChC,MAAA,OAAO,IAAA;AAAA,IACR;AAAA,EACD;AAGA,EAAA,MAAM,OAAA,GAAUA,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAA;AACxC,EAAA,IAAIQ,UAAAA,CAAW,OAAO,CAAA,EAAG;AACxB,IAAA,IAAI;AACH,MAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAAM,MAAMN,QAAAA,CAAS,OAAA,EAAS,OAAO,CAAC,CAAA;AACvD,MAAA,IAAI,IAAI,YAAA,GAAe,QAAQ,KAAK,GAAA,CAAI,eAAA,GAAkB,UAAU,CAAA,EAAG;AACtE,QAAA,OAAO,IAAA;AAAA,MACR;AAAA,IACD,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACD;AAEA,EAAA,OAAO,KAAA;AACR;AAKA,eAAe,gBAAgB,GAAA,EAA+B;AAE7D,EAAA,MAAM,WAAA,GAAc;AAAA,IACnB,aAAA;AAAA,IACA,gBAAA;AAAA,IACA,iBAAA;AAAA,IACA;AAAA,GACD;AAEA,EAAA,KAAA,MAAW,QAAQ,WAAA,EAAa;AAC/B,IAAA,IAAIM,UAAAA,CAAWR,IAAAA,CAAK,GAAA,EAAK,IAAI,CAAC,CAAA,EAAG;AAChC,MAAA,OAAO,IAAA;AAAA,IACR;AAAA,EACD;AAGA,EAAA,MAAM,OAAA,GAAUA,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAA;AACxC,EAAA,IAAIQ,UAAAA,CAAW,OAAO,CAAA,EAAG;AACxB,IAAA,IAAI;AACH,MAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAAM,MAAMN,QAAAA,CAAS,OAAA,EAAS,OAAO,CAAC,CAAA;AACvD,MAAA,IACC,GAAA,CAAI,YAAA,GAAe,MAAM,CAAA,IACzB,GAAA,CAAI,YAAA,GAAe,qBAAqB,CAAA,IACxC,GAAA,CAAI,eAAA,GAAkB,MAAM,CAAA,EAC3B;AACD,QAAA,OAAO,IAAA;AAAA,MACR;AAAA,IACD,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACD;AAEA,EAAA,OAAO,KAAA;AACR;AAKO,SAAS,iBAAA,CAAkB,KAAa,QAAA,EAA4B;AAC1E,EAAA,QAAQ,QAAA;AAAU,IACjB,KAAK,YAAA;AACJ,MAAA,OAAOF,IAAAA,CAAK,KAAK,cAAc,CAAA;AAAA,IAChC,KAAK,QAAA;AACJ,MAAA,OAAOA,IAAAA,CAAK,KAAK,sBAAsB,CAAA;AAAA,IACxC;AACC,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,kBAAA,EAAqB,QAAQ,CAAA,CAAE,CAAA;AAAA;AAElD;;;ACjGO,SAAS,yBAAA,GAAoC;AACnD,EAAA,OAAO,CAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAoCR;AAKO,SAAS,2BAA2B,QAAA,EAAgC;AAC1E,EAAA,MAAM,mBAAA,GAAsB,gBAAgB,QAAQ,CAAA;AAEpD,EAAA,OAAO,CAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,SAAA,EAOG,mBAAmB,gCAAgC,QAAQ,CAAA;;AAAA;AAAA,YAAA,EAGxD,mBAAmB,CAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAiBjC;AAKO,SAAS,8BAAA,GAAyC;AACxD,EAAA,OAAO,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAmFR;AAKO,SAAS,6BAAA,GAAwC;AACvD,EAAA,OAAO,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAwER;AAKO,SAAS,8BAAA,GAAyC;AACxD,EAAA,OAAO,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAyER;AAKO,SAAS,2BAA2B,QAAA,EAAgC;AAC1E,EAAA,MAAM,SAAA,GAA0C;AAAA,IAC/C,MAAA,EAAQ,CAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAAA,IAeR,KAAA,EAAO,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAAA,IAcP,MAAA,EAAQ,CAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAYT;AAEA,EAAA,OAAO,UAAU,QAAQ,CAAA;AAC1B;AAKA,SAAS,gBAAgB,GAAA,EAAqB;AAC7C,EAAA,OAAO,GAAA,CAAI,OAAO,CAAC,CAAA,CAAE,aAAY,GAAI,GAAA,CAAI,MAAM,CAAC,CAAA;AACjD;AC5WO,SAAS,mBAAA,CACf,UACA,QAAA,EACmB;AACnB,EAAA,MAAM,IAAA,GAAyB;AAAA,IAC9B,cAAc,EAAC;AAAA,IACf,iBAAiB;AAAC,GACnB;AAGA,EAAA,IAAI,aAAa,YAAA,EAAc;AAC9B,IAAA,IAAA,CAAK,YAAA,CAAa,oCAAoC,CAAA,GAAI,SAAA;AAAA,EAC3D;AAGA,EAAA,QAAQ,QAAA;AAAU,IACjB,KAAK,QAAA;AAGJ,MAAA;AAAA,IAED,KAAK,OAAA;AACJ,MAAA,IAAA,CAAK,YAAA,CAAa,OAAO,CAAA,GAAI,QAAA;AAC7B,MAAA;AAAA,IAED,KAAK,QAAA;AACJ,MAAA,IAAA,CAAK,YAAA,CAAa,kBAAkB,CAAA,GAAI,QAAA;AACxC,MAAA;AAAA;AAGF,EAAA,OAAO,IAAA;AACR;AASA,eAAsB,4BAAA,CACrB,KACA,MAAA,EACmB;AACnB,EAAA,MAAM,eAAA,GAAkBA,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAA;AAEhD,EAAA,IAAI,CAACQ,UAAAA,CAAW,eAAe,CAAA,EAAG;AACjC,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,0BAAA,EAA6B,eAAe,CAAA,CAAE,CAAA;AAAA,EAC/D;AAGA,EAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,eAAA,EAAiB,OAAO,CAAA;AACvD,EAAA,MAAM,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAG9B,EAAA,IAAI,QAAA,GAAW,KAAA;AAGf,EAAA,IAAI,OAAO,IAAA,CAAK,MAAA,CAAO,YAAY,CAAA,CAAE,SAAS,CAAA,EAAG;AAChD,IAAA,GAAA,CAAI,YAAA,GAAe,GAAA,CAAI,YAAA,IAAgB,EAAC;AAExC,IAAA,KAAA,MAAW,CAAC,MAAM,OAAO,CAAA,IAAK,OAAO,OAAA,CAAQ,MAAA,CAAO,YAAY,CAAA,EAAG;AAClE,MAAA,IAAI,CAAC,GAAA,CAAI,YAAA,CAAa,IAAI,CAAA,EAAG;AAC5B,QAAA,GAAA,CAAI,YAAA,CAAa,IAAI,CAAA,GAAI,OAAA;AACzB,QAAA,QAAA,GAAW,IAAA;AAAA,MACZ;AAAA,IACD;AAGA,IAAA,GAAA,CAAI,YAAA,GAAe,UAAA,CAAW,GAAA,CAAI,YAAY,CAAA;AAAA,EAC/C;AAGA,EAAA,IAAI,OAAO,IAAA,CAAK,MAAA,CAAO,eAAe,CAAA,CAAE,SAAS,CAAA,EAAG;AACnD,IAAA,GAAA,CAAI,eAAA,GAAkB,GAAA,CAAI,eAAA,IAAmB,EAAC;AAE9C,IAAA,KAAA,MAAW,CAAC,MAAM,OAAO,CAAA,IAAK,OAAO,OAAA,CAAQ,MAAA,CAAO,eAAe,CAAA,EAAG;AACrE,MAAA,IAAI,CAAC,GAAA,CAAI,eAAA,CAAgB,IAAI,CAAA,EAAG;AAC/B,QAAA,GAAA,CAAI,eAAA,CAAgB,IAAI,CAAA,GAAI,OAAA;AAC5B,QAAA,QAAA,GAAW,IAAA;AAAA,MACZ;AAAA,IACD;AAGA,IAAA,GAAA,CAAI,eAAA,GAAkB,UAAA,CAAW,GAAA,CAAI,eAAe,CAAA;AAAA,EACrD;AAGA,EAAA,IAAI,QAAA,EAAU;AACb,IAAA,MAAMO,SAAAA;AAAA,MACL,eAAA;AAAA,MACA,IAAA,CAAK,SAAA,CAAU,GAAA,EAAK,IAAA,EAAM,CAAC,CAAA,GAAI,IAAA;AAAA,MAC/B;AAAA,KACD;AAAA,EACD;AAEA,EAAA,OAAO,QAAA;AACR;AAoGA,SAAS,WAAW,GAAA,EAAqD;AACxE,EAAA,OAAO,MAAA,CAAO,IAAA,CAAK,GAAG,CAAA,CACpB,MAAK,CACL,MAAA;AAAA,IACA,CAAC,QAAQ,GAAA,KAAQ;AAChB,MAAA,MAAA,CAAO,GAAG,CAAA,GAAI,GAAA,CAAI,GAAG,CAAA;AACrB,MAAA,OAAO,MAAA;AAAA,IACR,CAAA;AAAA,IACA;AAAC,GACF;AACF;AC3MO,IAAM,YAAA,GAAe;AAAA,EAC3B,OAAA,EAAS;AAAA,IACR,IAAA,EAAM,cAAA;AAAA,IACN,WAAA,EAAa,uBAAA;AAAA,IACb,SAAA,EAAW,wBAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA,EACA,UAAA,EAAY;AAAA,IACX,IAAA,EAAM,iBAAA;AAAA,IACN,WAAA,EAAa,0BAAA;AAAA,IACb,SAAA,EAAW,2BAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA,EACA,WAAA,EAAa;AAAA,IACZ,IAAA,EAAM,WAAA;AAAA,IACN,WAAA,EAAa,oBAAA;AAAA,IACb,SAAA,EAAW,qBAAA;AAAA,IACX,WAAA,EAAa;AAAA;AAEf,CAAA;AAKO,IAAM,eAAA,GAAkB;AAAA;AAAA,EAE9B,EAAA,EAAI;AAAA,IACH,IAAA,EAAM,aAAA;AAAA,IACN,WAAA,EAAa,sBAAA;AAAA,IACb,SAAA,EAAW,uBAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA,EACA,EAAA,EAAI;AAAA,IACH,IAAA,EAAM,aAAA;AAAA,IACN,WAAA,EAAa,sBAAA;AAAA,IACb,SAAA,EAAW,uBAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA,EACA,OAAA,EAAS;AAAA,IACR,IAAA,EAAM,kBAAA;AAAA,IACN,WAAA,EAAa,2BAAA;AAAA,IACb,SAAA,EAAW,4BAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA;AAAA,EAEA,EAAA,EAAI;AAAA,IACH,IAAA,EAAM,aAAA;AAAA,IACN,WAAA,EAAa,sBAAA;AAAA,IACb,SAAA,EAAW,uBAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA,EACA,gBAAA,EAAkB;AAAA,IACjB,IAAA,EAAM,2BAAA;AAAA,IACN,WAAA,EAAa,oCAAA;AAAA,IACb,SAAA,EAAW,qCAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA,EAMA;AAAA,EAEA,EAAA,EAAI;AAAA,IACH,IAAA,EAAM,aAAA;AAAA,IACN,WAAA,EAAa,sBAAA;AAAA,IACb,SAAA,EAAW,uBAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA,EACA,SAAA,EAAW;AAAA,IACV,IAAA,EAAM,oBAAA;AAAA,IACN,WAAA,EAAa,6BAAA;AAAA,IACb,SAAA,EAAW,8BAAA;AAAA,IACX,WAAA,EAAa;AAAA,GACd;AAAA;AAAA,EAEA,UAAA,EAAY;AAAA,IACX,IAAA,EAAM,qBAAA;AAAA,IACN,WAAA,EAAa,8BAAA;AAAA,IACb,SAAA,EAAW,+BAAA;AAAA,IACX,WAAA,EAAa;AAAA;AAEf,CAAA;AAmBO,IAAM,gBAAN,MAAoB;AAAA;AAAA;AAAA;AAAA,EAI1B,MAAM,SAAA,CACL,QAAA,EACA,MAAA,EACmB;AACnB,IAAA,IAAI,CAACD,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO,KAAA;AAAA,IACR;AAEA,IAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAChD,IAAA,OACC,OAAA,CAAQ,SAAS,MAAA,CAAO,WAAW,KAAK,OAAA,CAAQ,QAAA,CAAS,OAAO,SAAS,CAAA;AAAA,EAE3E;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAA,CACL,QAAA,EACA,MAAA,EACmB;AACnB,IAAA,MAAM,OAAA,GAAU,MAAMA,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAEhD,IAAA,MAAM,QAAA,GAAW,OAAA,CAAQ,OAAA,CAAQ,MAAA,CAAO,WAAW,CAAA;AACnD,IAAA,MAAM,MAAA,GAAS,OAAA,CAAQ,OAAA,CAAQ,MAAA,CAAO,SAAS,CAAA;AAE/C,IAAA,IAAI,QAAA,KAAa,EAAA,IAAM,MAAA,KAAW,EAAA,EAAI;AACrC,MAAA,OAAO,KAAA;AAAA,IACR;AAGA,IAAA,MAAM,eAAe,OAAA,CAAQ,KAAA;AAAA,MAC5B,QAAA,GAAW,OAAO,WAAA,CAAY,MAAA;AAAA,MAC9B;AAAA,KACD;AAGA,IAAA,MAAM,OAAA,GAAU,aAAa,IAAA,EAAK;AAClC,IAAA,OACC,OAAA,KAAY,MACZ,OAAA,CAAQ,UAAA,CAAW,IAAI,CAAA,IACvB,OAAA,CAAQ,WAAW,GAAG,CAAA;AAAA,EAExB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAM,cAAA,CACL,QAAA,EACA,QACA,OAAA,EACA,OAAA,GAKI,EAAC,EAC4B;AACjC,IAAA,IAAI,CAACM,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,mBAAmB,QAAQ,CAAA;AAAA,OACnC;AAAA,IACD;AAEA,IAAA,MAAM,WAAA,GAAc,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAGpD,IAAA,MAAM,QAAA,GAAW,WAAA,CAAY,OAAA,CAAQ,MAAA,CAAO,WAAW,CAAA;AACvD,IAAA,MAAM,MAAA,GAAS,WAAA,CAAY,OAAA,CAAQ,MAAA,CAAO,SAAS,CAAA;AAEnD,IAAA,IAAI,QAAA,KAAa,EAAA,IAAM,MAAA,KAAW,EAAA,EAAI;AACrC,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,yBAAyB,MAAA,CAAO,IAAI,sBAAsB,MAAA,CAAO,WAAW,CAAA,KAAA,EAAQ,MAAA,CAAO,SAAS,CAAA;AAAA,OAC5G;AAAA,IACD;AAGA,IAAA,MAAM,eAAe,WAAA,CAAY,KAAA;AAAA,MAChC,QAAA,GAAW,OAAO,WAAA,CAAY,MAAA;AAAA,MAC9B;AAAA,KACD;AACA,IAAA,MAAM,OAAA,GACL,YAAA,CAAa,IAAA,EAAK,KAAM,MACxB,YAAA,CAAa,IAAA,EAAK,CAAE,UAAA,CAAW,IAAI,CAAA,IACnC,YAAA,CAAa,IAAA,EAAK,CAAE,WAAW,GAAG,CAAA;AAEnC,IAAA,IAAI,CAAC,OAAA,IAAW,CAAC,OAAA,CAAQ,KAAA,EAAO;AAC/B,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,IAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,OAAA,EAAS,CAAA,aAAA,EAAgB,MAAA,CAAO,IAAI,CAAA,kDAAA;AAAA,OACrC;AAAA,IACD;AAGA,IAAA,IAAI,aAAA,GAAgB,OAAA;AACpB,IAAA,IAAI,QAAQ,MAAA,EAAQ;AACnB,MAAA,aAAA,GAAgB,QACd,KAAA,CAAM,IAAI,CAAA,CACV,GAAA,CAAI,CAAC,IAAA,KAAU,IAAA,CAAK,IAAA,EAAK,GAAI,QAAQ,MAAA,GAAS,IAAA,GAAO,IAAK,CAAA,CAC1D,KAAK,IAAI,CAAA;AAAA,IACZ;AAGA,IAAA,MAAM,SAAS,WAAA,CAAY,KAAA,CAAM,GAAG,QAAA,GAAW,MAAA,CAAO,YAAY,MAAM,CAAA;AACxE,IAAA,MAAM,KAAA,GAAQ,WAAA,CAAY,KAAA,CAAM,MAAM,CAAA;AACtC,IAAA,MAAM,UAAA,GAAa,MAAA,GAAS,IAAA,GAAO,aAAA,GAAgB,IAAA,GAAO,KAAA;AAE1D,IAAA,MAAMO,SAAAA,CAAU,QAAA,EAAU,UAAA,EAAY,OAAO,CAAA;AAE7C,IAAA,OAAO;AAAA,MACN,OAAA,EAAS,IAAA;AAAA,MACT,QAAA,EAAU;AAAA,KACX;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAA,CACL,QAAA,EACA,MAAA,EACiC;AACjC,IAAA,IAAI,CAACD,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,mBAAmB,QAAQ,CAAA;AAAA,OACnC;AAAA,IACD;AAEA,IAAA,MAAM,WAAA,GAAc,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAEpD,IAAA,MAAM,QAAA,GAAW,WAAA,CAAY,OAAA,CAAQ,MAAA,CAAO,WAAW,CAAA;AACvD,IAAA,MAAM,MAAA,GAAS,WAAA,CAAY,OAAA,CAAQ,MAAA,CAAO,SAAS,CAAA;AAEnD,IAAA,IAAI,QAAA,KAAa,EAAA,IAAM,MAAA,KAAW,EAAA,EAAI;AACrC,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,CAAA,sBAAA,EAAyB,MAAA,CAAO,IAAI,CAAA;AAAA,OAC5C;AAAA,IACD;AAGA,IAAA,MAAM,SAAS,WAAA,CAAY,KAAA,CAAM,GAAG,QAAA,GAAW,MAAA,CAAO,YAAY,MAAM,CAAA;AACxE,IAAA,MAAM,KAAA,GAAQ,WAAA,CAAY,KAAA,CAAM,MAAM,CAAA;AACtC,IAAA,MAAM,UAAA,GAAa,MAAA,GAAS,OAAA,GAAU,MAAA,CAAO,cAAc,IAAA,GAAO,KAAA;AAElE,IAAA,MAAMO,SAAAA,CAAU,QAAA,EAAU,UAAA,EAAY,OAAO,CAAA;AAE7C,IAAA,OAAO;AAAA,MACN,OAAA,EAAS,IAAA;AAAA,MACT,QAAA,EAAU;AAAA,KACX;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,iBAAA,CACL,QAAA,EACA,MAAA,EACA,QAAA,EACiC;AACjC,IAAA,IAAI,CAACD,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,mBAAmB,QAAQ,CAAA;AAAA,OACnC;AAAA,IACD;AAEA,IAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAGhD,IAAA,IAAI,OAAA,CAAQ,QAAA,CAAS,MAAA,CAAO,WAAW,CAAA,EAAG;AACzC,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,IAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,OAAA,EAAS,CAAA,aAAA,EAAgB,MAAA,CAAO,IAAI,CAAA,eAAA;AAAA,OACrC;AAAA,IACD;AAEA,IAAA,MAAM,WAAA,GAAc;AAAA,EAAK,OAAO,WAAW;AAAA,GAAA,EAAQ,OAAO,WAAW;AAAA,EAAK,OAAO,SAAS;AAAA,CAAA;AAC1F,IAAA,MAAM,UAAA,GACL,QAAQ,KAAA,CAAM,CAAA,EAAG,QAAQ,CAAA,GAAI,WAAA,GAAc,OAAA,CAAQ,KAAA,CAAM,QAAQ,CAAA;AAElE,IAAA,MAAMO,SAAAA,CAAU,QAAA,EAAU,UAAA,EAAY,OAAO,CAAA;AAE7C,IAAA,OAAO;AAAA,MACN,OAAA,EAAS,IAAA;AAAA,MACT,QAAA,EAAU;AAAA,KACX;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAA,CACL,QAAA,EACA,eAAA,EACiD;AACjD,IAAA,IAAI,CAACD,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO;AAAA,QACN,KAAA,EAAO,KAAA;AAAA,QACP,SAAS,eAAA,CAAgB,GAAA,CAAI,CAAC,CAAA,KAAM,EAAE,IAAI;AAAA,OAC3C;AAAA,IACD;AAEA,IAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAChD,IAAA,MAAM,UAAoB,EAAC;AAE3B,IAAA,KAAA,MAAW,UAAU,eAAA,EAAiB;AACrC,MAAA,IACC,CAAC,OAAA,CAAQ,QAAA,CAAS,MAAA,CAAO,WAAW,CAAA,IACpC,CAAC,OAAA,CAAQ,QAAA,CAAS,MAAA,CAAO,SAAS,CAAA,EACjC;AACD,QAAA,OAAA,CAAQ,IAAA,CAAK,OAAO,IAAI,CAAA;AAAA,MACzB;AAAA,IACD;AAEA,IAAA,OAAO;AAAA,MACN,KAAA,EAAO,QAAQ,MAAA,KAAW,CAAA;AAAA,MAC1B;AAAA,KACD;AAAA,EACD;AACD,CAAA;;;AChWA,eAAsB,mBAAA,CACrB,UACA,QAAA,EACmB;AACnB,EAAA,IAAI,CAACM,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,uBAAA,EAA0B,QAAQ,CAAA,CAAE,CAAA;AAAA,EACrD;AAEA,EAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAEhD,EAAA,IAAI,WAAA;AACJ,EAAA,IAAI,aAAa,YAAA,EAAc;AAC9B,IAAA,WAAA,GAAc,MAAM,iBAAA,CAAkB,QAAA,EAAU,OAAO,CAAA;AAAA,EACxD,CAAA,MAAA,IAAW,aAAa,QAAA,EAAU;AACjC,IAAA,WAAA,GAAc,cAAc,OAAO,CAAA;AAAA,EACpC,CAAA,MAAO;AACN,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,sBAAA,EAAyB,QAAQ,CAAA,CAAE,CAAA;AAAA,EACpD;AAGA,EAAA,IAAI,gBAAgB,OAAA,EAAS;AAC5B,IAAA,MAAMO,SAAAA,CAAU,QAAA,EAAU,WAAA,EAAa,OAAO,CAAA;AAC9C,IAAA,OAAO,IAAA;AAAA,EACR;AAEA,EAAA,OAAO,KAAA;AACR;AAKA,eAAe,iBAAA,CACd,UACA,OAAA,EACkB;AAElB,EAAA,IAAI,QAAQ,QAAA,CAAS,iBAAiB,KAAK,OAAA,CAAQ,QAAA,CAAS,eAAe,CAAA,EAAG;AAC7E,IAAA,OAAO,OAAA;AAAA,EACR;AAEA,EAAA,MAAM,aAAA,GAAgB,IAAI,aAAA,EAAc;AAGxC,EAAA,MAAM,gBAAA,GAAmB,MAAM,aAAA,CAAc,SAAA;AAAA,IAC5C,QAAA;AAAA,IACA,YAAA,CAAa;AAAA,GACd;AACA,EAAA,MAAM,mBAAA,GAAsB,MAAM,aAAA,CAAc,SAAA;AAAA,IAC/C,QAAA;AAAA,IACA,YAAA,CAAa;AAAA,GACd;AAGA,EAAA,MAAM,WAAA,GAAc,CAAA;AAAA,sDAAA,CAAA;AAIpB,EAAA,MAAM,cAAA,GAAiB,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAA,CAAA;AA+BvB,EAAA,IAAI,oBAAoB,mBAAA,EAAqB;AAE5C,IAAA,MAAM,aAAA,GAAgB,MAAM,aAAA,CAAc,cAAA;AAAA,MACzC,QAAA;AAAA,MACA,YAAA,CAAa,OAAA;AAAA,MACb;AAAA,KACD;AAGA,IAAA,MAAM,gBAAA,GAAmB,MAAM,aAAA,CAAc,cAAA;AAAA,MAC5C,QAAA;AAAA,MACA,YAAA,CAAa,UAAA;AAAA,MACb;AAAA,KACD;AAEA,IAAA,IAAI,aAAA,CAAc,OAAA,IAAW,gBAAA,CAAiB,OAAA,EAAS;AAEtD,MAAA,OAAO,MAAMP,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAAA,IACxC;AAGA,IAAA,OAAA,CAAQ,IAAA;AAAA,MACP;AAAA,KACD;AAAA,EACD;AAGA,EAAA,OAAO,uBAAuB,OAAO,CAAA;AACtC;AAKA,SAAS,uBAAuB,OAAA,EAAyB;AAExD,EAAA,MAAM,WAAA,GAAc,CAAA;AAAA;AAAA,CAAA;AAKpB,EAAA,MAAM,WAAA,GAAc,mBAAA;AACpB,EAAA,IAAI,eAAA,GAAkB,CAAA;AACtB,EAAA,IAAI,KAAA;AAEJ,EAAA,OAAA,CAAQ,KAAA,GAAQ,WAAA,CAAY,IAAA,CAAK,OAAO,OAAO,IAAA,EAAM;AACpD,IAAA,eAAA,GAAkB,KAAA,CAAM,KAAA,GAAQ,KAAA,CAAM,CAAC,CAAA,CAAE,MAAA;AAAA,EAC1C;AAGA,EAAA,IAAI,MAAA,GAAS,OAAA;AACb,EAAA,IAAI,kBAAkB,CAAA,EAAG;AACxB,IAAA,MAAA,GACC,OAAA,CAAQ,MAAM,CAAA,EAAG,eAAe,IAChC,IAAA,GACA,WAAA,GACA,OAAA,CAAQ,KAAA,CAAM,eAAe,CAAA;AAAA,EAC/B,CAAA,MAAO;AAEN,IAAA,MAAA,GAAS,cAAc,IAAA,GAAO,OAAA;AAAA,EAC/B;AAGA,EAAA,MAAM,iBAAA,GACL,sHAAA;AACD,EAAA,MAAM,UAAA,GAAa,iBAAA,CAAkB,IAAA,CAAK,MAAM,CAAA;AAEhD,EAAA,IAAI,UAAA,EAAY;AACf,IAAA,MAAM,cAAA,GAAiB,UAAA,CAAW,KAAA,GAAQ,UAAA,CAAW,CAAC,CAAA,CAAE,MAAA;AAExD,IAAA,MAAM,cAAA,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAgCvB,IAAA,MAAA,GACC,MAAA,CAAO,MAAM,CAAA,EAAG,cAAc,IAAI,cAAA,GAAiB,MAAA,CAAO,MAAM,cAAc,CAAA;AAAA,EAChF;AAEA,EAAA,OAAO,MAAA;AACR;AAKA,SAAS,cAAc,OAAA,EAAyB;AAE/C,EAAA,IAAI,QAAQ,QAAA,CAAS,iBAAiB,KAAK,OAAA,CAAQ,QAAA,CAAS,eAAe,CAAA,EAAG;AAC7E,IAAA,OAAO,OAAA;AAAA,EACR;AAGA,EAAA,MAAM,WAAA,GAAc,CAAA;AAAA;AAAA,CAAA;AAKpB,EAAA,MAAM,WAAA,GAAc,mBAAA;AACpB,EAAA,IAAI,eAAA,GAAkB,CAAA;AACtB,EAAA,IAAI,KAAA;AAEJ,EAAA,OAAA,CAAQ,KAAA,GAAQ,WAAA,CAAY,IAAA,CAAK,OAAO,OAAO,IAAA,EAAM;AACpD,IAAA,eAAA,GAAkB,KAAA,CAAM,KAAA,GAAQ,KAAA,CAAM,CAAC,CAAA,CAAE,MAAA;AAAA,EAC1C;AAGA,EAAA,IAAI,MAAA,GAAS,OAAA;AACb,EAAA,IAAI,kBAAkB,CAAA,EAAG;AACxB,IAAA,MAAA,GACC,OAAA,CAAQ,MAAM,CAAA,EAAG,eAAe,IAChC,IAAA,GACA,WAAA,GACA,OAAA,CAAQ,KAAA,CAAM,eAAe,CAAA;AAAA,EAC/B,CAAA,MAAO;AACN,IAAA,MAAA,GAAS,cAAc,IAAA,GAAO,OAAA;AAAA,EAC/B;AAGA,EAAA,MAAM,gBAAA,GACL,iEAAA;AACD,EAAA,MAAM,SAAA,GAAY,gBAAA,CAAiB,IAAA,CAAK,MAAM,CAAA;AAE9C,EAAA,IAAI,SAAA,EAAW;AACd,IAAA,MAAM,cAAA,GAAiB,SAAA,CAAU,KAAA,GAAQ,SAAA,CAAU,CAAC,CAAA,CAAE,MAAA;AAGtD,IAAA,MAAM,aAAa,MAAA,CAAO,KAAA,CAAM,cAAc,CAAA,CAAE,MAAM,IAAI,CAAA;AAC1D,IAAA,IAAI,UAAA,EAAY;AACf,MAAA,MAAM,aAAA,GAAgB,cAAA,GAAiB,UAAA,CAAW,KAAA,GAAS,CAAA;AAE3D,MAAA,MAAM,cAAA,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAgCvB,MAAA,MAAA,GACC,MAAA,CAAO,MAAM,CAAA,EAAG,aAAa,IAC7B,cAAA,GACA,MAAA,CAAO,MAAM,aAAa,CAAA;AAAA,IAC5B;AAAA,EACD;AAEA,EAAA,OAAO,MAAA;AACR;AAoFA,eAAsB,kBAAkB,QAAA,EAAoC;AAC3E,EAAA,IAAI,CAACM,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,IAAA,OAAO,KAAA;AAAA,EACR;AAEA,EAAA,MAAM,aAAA,GAAgB,IAAI,aAAA,EAAc;AAGxC,EAAA,MAAM,UAAA,GACJ,MAAM,aAAA,CAAc,SAAA,CAAU,QAAA,EAAU,YAAA,CAAa,OAAO,CAAA,IAC5D,MAAM,aAAA,CAAc,SAAA,CAAU,QAAA,EAAU,aAAa,UAAU,CAAA;AAEjE,EAAA,IAAI,UAAA,EAAY;AAEf,IAAA,MAAM,YAAA,GAAe,MAAM,aAAA,CAAc,aAAA;AAAA,MACxC,QAAA;AAAA,MACA,YAAA,CAAa;AAAA,KACd;AACA,IAAA,MAAM,eAAA,GAAkB,MAAM,aAAA,CAAc,aAAA;AAAA,MAC3C,QAAA;AAAA,MACA,YAAA,CAAa;AAAA,KACd;AAEA,IAAA,OAAO,CAAC,gBAAgB,CAAC,eAAA;AAAA,EAC1B;AAGA,EAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAChD,EAAA,OACC,OAAA,CAAQ,QAAA,CAAS,iBAAiB,CAAA,KACjC,OAAA,CAAQ,SAAS,yBAAyB,CAAA,IAC1C,OAAA,CAAQ,QAAA,CAAS,eAAe,CAAA,CAAA;AAEnC;AC7YO,IAAM,aAAN,MAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUvB,MAAM,YAAA,CACL,QAAA,EACA,SACA,OAAA,EACA,OAAA,GAGI,EAAC,EACsB;AAC3B,IAAA,IAAI,CAACM,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,mBAAmB,QAAQ,CAAA;AAAA,OACnC;AAAA,IACD;AAEA,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAChD,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAGjC,MAAA,IAAI,CAAC,MAAA,CAAO,OAAO,CAAA,EAAG;AACrB,QAAA,MAAA,CAAO,OAAO,IAAI,EAAC;AAAA,MACpB;AAGA,MAAA,IAAI,QAAA,GAAW,KAAA;AACf,MAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,KAAK,MAAA,CAAO,OAAA,CAAQ,OAAO,CAAA,EAAG;AACnD,QAAA,IAAI,EAAE,GAAA,IAAO,MAAA,CAAO,OAAO,CAAA,CAAA,IAAM,QAAQ,SAAA,EAAW;AACnD,UAAA,MAAA,CAAO,OAAO,CAAA,CAAE,GAAG,CAAA,GAAI,KAAA;AACvB,UAAA,QAAA,GAAW,IAAA;AAAA,QACZ;AAAA,MACD;AAEA,MAAA,IAAI,QAAA,EAAU;AACb,QAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAU,MAAM,CAAA;AACxC,QAAA,MAAMO,SAAAA,CAAU,QAAA,EAAU,UAAA,EAAY,OAAO,CAAA;AAAA,MAC9C;AAEA,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,IAAA;AAAA,QACT;AAAA,OACD;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,qBAAqB,KAAK,CAAA;AAAA,OAClC;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,UAAA,CACL,QAAA,EACA,OAAA,EACA,IAAA,EAC2B;AAC3B,IAAA,IAAI,CAACD,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,mBAAmB,QAAQ,CAAA;AAAA,OACnC;AAAA,IACD;AAEA,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAChD,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAEjC,MAAA,IAAI,CAAC,MAAA,CAAO,OAAO,CAAA,EAAG;AACrB,QAAA,OAAO;AAAA,UACN,OAAA,EAAS,IAAA;AAAA,UACT,QAAA,EAAU;AAAA,SACX;AAAA,MACD;AAEA,MAAA,IAAI,QAAA,GAAW,KAAA;AACf,MAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACvB,QAAA,IAAI,GAAA,IAAO,MAAA,CAAO,OAAO,CAAA,EAAG;AAC3B,UAAA,OAAO,MAAA,CAAO,OAAO,CAAA,CAAE,GAAG,CAAA;AAC1B,UAAA,QAAA,GAAW,IAAA;AAAA,QACZ;AAAA,MACD;AAEA,MAAA,IAAI,QAAA,EAAU;AAEb,QAAA,IAAI,OAAO,IAAA,CAAK,MAAA,CAAO,OAAO,CAAC,CAAA,CAAE,WAAW,CAAA,EAAG;AAC9C,UAAA,OAAO,OAAO,OAAO,CAAA;AAAA,QACtB;AAEA,QAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAU,MAAM,CAAA;AACxC,QAAA,MAAMO,SAAAA,CAAU,QAAA,EAAU,UAAA,EAAY,OAAO,CAAA;AAAA,MAC9C;AAEA,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,IAAA;AAAA,QACT;AAAA,OACD;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,KAAA;AAAA,QACT,QAAA,EAAU,KAAA;AAAA,QACV,KAAA,EAAO,qBAAqB,KAAK,CAAA;AAAA,OAClC;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,OAAA,CACL,QAAA,EACA,OAAA,EACA,IAAA,EACmC;AACnC,IAAA,IAAI,CAACD,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO,MAAA,CAAO,WAAA,CAAY,IAAA,CAAK,GAAA,CAAI,CAAC,MAAM,CAAC,CAAA,EAAG,KAAK,CAAC,CAAC,CAAA;AAAA,IACtD;AAEA,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAChD,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAEjC,MAAA,IAAI,CAAC,MAAA,CAAO,OAAO,CAAA,EAAG;AACrB,QAAA,OAAO,MAAA,CAAO,WAAA,CAAY,IAAA,CAAK,GAAA,CAAI,CAAC,MAAM,CAAC,CAAA,EAAG,KAAK,CAAC,CAAC,CAAA;AAAA,MACtD;AAEA,MAAA,OAAO,MAAA,CAAO,WAAA,CAAY,IAAA,CAAK,GAAA,CAAI,CAAC,CAAA,KAAM,CAAC,CAAA,EAAG,CAAA,IAAK,MAAA,CAAO,OAAO,CAAC,CAAC,CAAC,CAAA;AAAA,IACrE,SAAS,KAAA,EAAO;AACf,MAAA,OAAO,MAAA,CAAO,WAAA,CAAY,IAAA,CAAK,GAAA,CAAI,CAAC,MAAM,CAAC,CAAA,EAAG,KAAK,CAAC,CAAC,CAAA;AAAA,IACtD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,QAAA,CACL,QAAA,EACA,OAAA,EACA,GAAA,EAC2B;AAC3B,IAAA,IAAI,CAACM,UAAAA,CAAW,QAAQ,CAAA,EAAG;AAC1B,MAAA,OAAO,MAAA;AAAA,IACR;AAEA,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAChD,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAEjC,MAAA,OAAO,MAAA,CAAO,OAAO,CAAA,GAAI,GAAG,CAAA;AAAA,IAC7B,SAAS,KAAA,EAAO;AACf,MAAA,OAAO,MAAA;AAAA,IACR;AAAA,EACD;AACD,CAAA;;;ACxLO,SAAS,mBAAmB,QAAA,EAAkC;AACpE,EAAA,QAAQ,QAAA;AAAU,IACjB,KAAK,QAAA;AACJ,MAAA,OAAO,CAAC,mBAAA,EAAqB,eAAA,EAAiB,YAAY,CAAA;AAAA,IAC3D,KAAK,OAAA;AACJ,MAAA,OAAO;AAAA,QACN,cAAA;AAAA,QACA,iBAAA;AAAA,QACA,qBAAA;AAAA,QACA;AAAA,OACD;AAAA,IACD,KAAK,QAAA;AACJ,MAAA,OAAO,CAAC,kBAAkB,kBAAkB,CAAA;AAAA;AAE/C;AAUA,eAAe,kBAAA,CACd,cACA,QAAA,EACmB;AACnB,EAAA,IAAI,CAACM,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC9B,IAAA,OAAO,KAAA;AAAA,EACR;AAEA,EAAA,MAAM,UAAA,GAAa,IAAI,UAAA,EAAW;AAClC,EAAA,MAAM,YAAA,GAAe,mBAAmB,QAAQ,CAAA;AAGhD,EAAA,MAAM,YAAA,GAAe,MAAM,UAAA,CAAW,OAAA;AAAA,IACrC,YAAA;AAAA,IACA,MAAA;AAAA,IACA;AAAA,GACD;AAEA,EAAA,IAAI,MAAA,CAAO,OAAO,YAAY,CAAA,CAAE,KAAK,CAAC,MAAA,KAAW,MAAM,CAAA,EAAG;AACzD,IAAA,OAAO,KAAA;AAAA,EACR;AAGA,EAAA,MAAM,UAAkC,EAAC;AACzC,EAAA,KAAA,MAAW,WAAW,YAAA,EAAc;AACnC,IAAA,OAAA,CAAQ,OAAO,CAAA,GAAI,EAAA;AAAA,EACpB;AAEA,EAAA,MAAM,SAAS,MAAM,UAAA,CAAW,YAAA,CAAa,YAAA,EAAc,QAAQ,OAAO,CAAA;AAE1E,EAAA,OAAO,MAAA,CAAO,QAAA;AACf;AAUA,eAAe,mBAAA,CACd,cACA,QAAA,EACmB;AACnB,EAAA,IAAI,CAACA,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC9B,IAAA,OAAO,KAAA;AAAA,EACR;AAEA,EAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,YAAA,EAAc,OAAO,CAAA;AAGpD,EAAA,MAAM,MAAA,GAAS,WAAW,OAAO,CAAA;AAGjC,EAAA,MAAM,YAAA,GAAe,mBAAmB,QAAQ,CAAA;AAChD,EAAA,IAAI,MAAA,CAAO,IAAA,IAAQ,YAAA,CAAa,IAAA,CAAK,CAAC,CAAA,KAAM,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA,KAAM,MAAS,CAAA,EAAG;AAC1E,IAAA,OAAO,KAAA;AAAA,EACR;AAGA,EAAA,MAAM,aAAA,GAAgB,IAAI,aAAA,EAAc;AAGxC,EAAA,MAAM,SAAA,GAAY,MAAM,aAAA,CAAc,SAAA;AAAA,IACrC,YAAA;AAAA,IACA,YAAA,CAAa;AAAA,GACd;AAEA,EAAA,IAAI,CAAC,SAAA,EAAW;AAGf,IAAA,IAAI,CAAC,OAAO,IAAA,EAAM;AACjB,MAAA,MAAA,CAAO,OAAO,EAAC;AAAA,IAChB;AAEA,IAAA,KAAA,MAAW,WAAW,YAAA,EAAc;AACnC,MAAA,MAAA,CAAO,IAAA,CAAK,OAAO,CAAA,GAAI,EAAA;AAAA,IACxB;AAGA,IAAA,MAAMO,UAAU,YAAA,EAAc,UAAA,CAAW,MAAM,CAAA,GAAI,MAAM,OAAO,CAAA;AAChE,IAAA,OAAO,IAAA;AAAA,EACR;AAGA,EAAA,MAAM,WAAA,GAAc,YAAA,CAClB,GAAA,CAAI,CAAC,OAAA,KAAY,MAAQ,OAAO,CAAA,KAAA,CAAO,CAAA,CACvC,IAAA,CAAK,KAAK,CAAA;AAEZ,EAAA,MAAM,QAAA,GAAW,CAAA;AAAA,EAAc,WAAW;AAAA,GAAA,CAAA;AAG1C,EAAA,MAAM,MAAA,GAAS,MAAM,aAAA,CAAc,cAAA;AAAA,IAClC,YAAA;AAAA,IACA,YAAA,CAAa,WAAA;AAAA,IACb,QAAA;AAAA,IACA,EAAE,QAAQ,GAAA;AAAK,GAChB;AAEA,EAAA,OAAO,MAAA,CAAO,QAAA;AACf;AAUA,eAAsB,oBAAA,CACrB,KACA,QAAA,EACmB;AACnB,EAAA,MAAM,YAAA,GAAe,sBAAsB,GAAG,CAAA;AAE9C,EAAA,IAAI,CAAC,YAAA,EAAc;AAClB,IAAA,OAAO,KAAA;AAAA,EACR;AAGA,EAAA,IAAI,YAAA,CAAa,QAAA,CAAS,OAAO,CAAA,EAAG;AACnC,IAAA,OAAO,kBAAA,CAAmB,cAAc,QAAQ,CAAA;AAAA,EACjD,CAAA,MAAO;AAEN,IAAA,OAAO,mBAAA,CAAoB,cAAc,QAAQ,CAAA;AAAA,EAClD;AACD;AASA,eAAsB,kBAAA,CACrB,KACA,QAAA,EACmB;AACnB,EAAA,MAAM,UAAA,GAAaT,IAAAA,CAAK,GAAA,EAAK,aAAa,CAAA;AAE1C,EAAA,MAAM,YAAA,GAAe,mBAAmB,QAAQ,CAAA;AAEhD,EAAA,IAAI,SAAc,EAAC;AAEnB,EAAA,IAAIQ,UAAAA,CAAW,UAAU,CAAA,EAAG;AAC3B,IAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,UAAA,EAAY,OAAO,CAAA;AAClD,IAAA,MAAA,GAAS,IAAA,CAAK,MAAM,OAAO,CAAA;AAG3B,IAAA,IACC,MAAA,CAAO,GAAA,IACP,YAAA,CAAa,IAAA,CAAK,CAAC,CAAA,KAAc,MAAA,CAAO,GAAA,CAAI,CAAC,CAAA,KAAM,MAAS,CAAA,EAC3D;AACD,MAAA,OAAO,KAAA;AAAA,IACR;AAAA,EACD;AAGA,EAAA,MAAA,CAAO,GAAA,GAAM,MAAA,CAAO,GAAA,IAAO,EAAC;AAE5B,EAAA,KAAA,MAAW,WAAW,YAAA,EAAc;AACnC,IAAA,MAAA,CAAO,IAAI,OAAO,CAAA,GAAI,CAAA,CAAA,EAAI,OAAA,CAAQ,aAAa,CAAA,CAAA;AAAA,EAChD;AAEA,EAAA,MAAMO,SAAAA,CAAU,YAAY,IAAA,CAAK,SAAA,CAAU,QAAQ,IAAA,EAAM,CAAC,CAAA,GAAI,IAAA,EAAM,OAAO,CAAA;AAC3E,EAAA,OAAO,IAAA;AACR;AAUA,eAAsB,gBAAA,CACrB,GAAA,EACA,QAAA,EACA,OAAA,EACmB;AACnB,EAAA,MAAM,OAAA,GAAUT,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAA;AAExC,EAAA,IAAIQ,UAAAA,CAAW,OAAO,CAAA,EAAG;AACxB,IAAA,MAAM,QAAA,GAAW,MAAMN,QAAAA,CAAS,OAAA,EAAS,OAAO,CAAA;AAGhD,IAAA,MAAM,YAAA,GAAe,mBAAmB,QAAQ,CAAA;AAChD,IAAA,IAAI,YAAA,CAAa,KAAK,CAAC,CAAA,KAAM,SAAS,QAAA,CAAS,CAAC,CAAC,CAAA,EAAG;AACnD,MAAA,OAAO,KAAA;AAAA,IACR;AAGA,IAAA,MAAMO,SAAAA,CAAU,OAAA,EAAS,QAAA,GAAW,IAAA,GAAO,SAAS,OAAO,CAAA;AAAA,EAC5D,CAAA,MAAO;AAEN,IAAA,MAAMA,SAAAA,CAAU,OAAA,EAAS,OAAA,EAAS,OAAO,CAAA;AAAA,EAC1C;AAEA,EAAA,OAAO,IAAA;AACR;AC5OA,IAAM,SAAA,GAAY,UAAU,IAAI,CAAA;AAqDzB,IAAM,iBAAN,MAAqB;AAAA,EACnB,aAAA;AAAA,EAER,WAAA,GAAc;AACb,IAAA,IAAA,CAAK,aAAA,GAAgB,IAAI,aAAA,EAAc;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SACL,OAAA,EACgC;AAChC,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,WAAA,CAAY,OAAO,CAAA;AAC7C,IAAA,MAAM,MAAA,GAA+B;AAAA,MACpC,MAAA,EAAQ,IAAA;AAAA,MACR,cAAc,EAAC;AAAA,MACf,cAAc,EAAC;AAAA,MACf,UAAA,EAAY,KAAA;AAAA,MACZ,QAAQ;AAAC,KACV;AAGA,IAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC3B,MAAA,IAAI;AACH,QAAA,MAAM,MAAA,GAAS,MAAM,KAAA,CAAM,QAAA,EAAS;AAEpC,QAAA,IAAI,MAAA,EAAQ;AACX,UAAA,MAAA,CAAO,YAAA,CAAa,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AAAA,QACpC,CAAA,MAAO;AACN,UAAA,MAAA,CAAO,YAAA,CAAa,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AACnC,UAAA,MAAA,CAAO,MAAA,CAAO,KAAK,CAAA,EAAG,KAAA,CAAM,IAAI,CAAA,EAAA,EAAK,KAAA,CAAM,YAAY,CAAA,CAAE,CAAA;AAEzD,UAAA,IAAI,MAAM,QAAA,EAAU;AACnB,YAAA,MAAA,CAAO,MAAA,GAAS,KAAA;AAAA,UACjB;AAAA,QACD;AAAA,MACD,SAAS,KAAA,EAAO;AACf,QAAA,MAAA,CAAO,YAAA,CAAa,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AACnC,QAAA,MAAA,CAAO,OAAO,IAAA,CAAK,CAAA,EAAG,MAAM,IAAI,CAAA,EAAA,EAAK,KAAK,CAAA,CAAE,CAAA;AAE5C,QAAA,IAAI,MAAM,QAAA,EAAU;AACnB,UAAA,MAAA,CAAO,MAAA,GAAS,KAAA;AAAA,QACjB;AAAA,MACD;AAAA,IACD;AAGA,IAAA,IACC,CAAC,MAAA,CAAO,MAAA,IACR,OAAA,CAAQ,iBAAA,IACR,QAAQ,SAAA,EACP;AACD,MAAA,IAAI;AACH,QAAA,MAAM,iBAAA,CAAkB,OAAA,CAAQ,SAAA,EAAW,OAAA,CAAQ,GAAG,CAAA;AACtD,QAAA,MAAA,CAAO,UAAA,GAAa,IAAA;AAAA,MACrB,SAAS,KAAA,EAAO;AACf,QAAA,MAAA,CAAO,MAAA,CAAO,IAAA,CAAK,CAAA,iBAAA,EAAoB,KAAK,CAAA,CAAE,CAAA;AAAA,MAC/C;AAAA,IACD;AAEA,IAAA,OAAO,MAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YACb,OAAA,EAC6B;AAC7B,IAAA,MAAM,SAA4B,EAAC;AAGnC,IAAA,IAAI,CAAC,QAAQ,aAAA,EAAe;AAC3B,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,IAAA,EAAM,YAAA;AAAA,QACN,WAAA,EAAa,wBAAA;AAAA,QACb,UAAU,YAAY;AACrB,UAAA,IAAI;AACH,YAAA,MAAM,UAAU,kBAAA,EAAoB,EAAE,GAAA,EAAK,OAAA,CAAQ,KAAK,CAAA;AACxD,YAAA,OAAO,IAAA;AAAA,UACR,SAAS,KAAA,EAAO;AACf,YAAA,OAAO,KAAA;AAAA,UACR;AAAA,QACD,CAAA;AAAA,QACA,YAAA,EACC,qFAAA;AAAA,QACD,QAAA,EAAU;AAAA,OACV,CAAA;AAAA,IACF;AAGA,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,IAAA,EAAM,mBAAA;AAAA,MACN,WAAA,EAAa,0BAAA;AAAA,MACb,UAAU,YAAY;AACrB,QAAA,MAAM,SAAA,GAAYT,IAAAA,CAAK,OAAA,CAAQ,GAAA,EAAK,cAAc,CAAA;AAClD,QAAA,IAAI,CAACQ,UAAAA,CAAW,SAAS,CAAA,EAAG,OAAO,KAAA;AAEnC,QAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,SAAA,EAAW,OAAO,CAAA;AACjD,QAAA,OACC,QAAQ,QAAA,CAAS,gBAAgB,CAAA,IAAK,OAAA,CAAQ,SAAS,aAAa,CAAA;AAAA,MAEtE,CAAA;AAAA,MACA,YAAA,EAAc,0DAAA;AAAA,MACd,QAAA,EAAU;AAAA,KACV,CAAA;AAGD,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,IAAA,EAAM,iBAAA;AAAA,MACN,WAAA,EAAa,qBAAA;AAAA,MACb,UAAU,YAAY;AACrB,QAAA,MAAM,SAAA,GAAYF,IAAAA,CAAK,OAAA,CAAQ,GAAA,EAAK,cAAc,CAAA;AAClD,QAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,aAAA,CAAc,gBAAgB,SAAA,EAAW;AAAA,UACtE,YAAA,CAAa,OAAA;AAAA,UACb,YAAA,CAAa;AAAA,SACb,CAAA;AACD,QAAA,OAAO,UAAA,CAAW,KAAA;AAAA,MACnB,CAAA;AAAA,MACA,YAAA,EACC,uFAAA;AAAA,MACD,QAAA,EAAU;AAAA;AAAA,KACV,CAAA;AAGD,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,IAAA,EAAM,cAAA;AAAA,MACN,WAAA,EAAa,oBAAA;AAAA,MACb,UAAU,YAAY;AACrB,QAAA,MAAM,SAAA,GAAYA,IAAAA,CAAK,OAAA,CAAQ,GAAA,EAAK,cAAc,CAAA;AAClD,QAAA,IAAI,CAACQ,UAAAA,CAAW,SAAS,CAAA,EAAG,OAAO,KAAA;AAEnC,QAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,SAAA,EAAW,OAAO,CAAA;AACjD,QAAA,OACC,QAAQ,QAAA,CAAS,iBAAiB,CAAA,IAClC,OAAA,CAAQ,SAAS,qBAAqB,CAAA;AAAA,MAExC,CAAA;AAAA,MACA,YAAA,EAAc,6CAAA;AAAA,MACd,QAAA,EAAU;AAAA,KACV,CAAA;AAGD,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,IAAA,EAAM,iBAAA;AAAA,MACN,WAAA,EAAa,uBAAA;AAAA,MACb,UAAU,YAAY;AACrB,QAAA,MAAM,SAAA,GAAYF,IAAAA,CAAK,OAAA,CAAQ,GAAA,EAAK,cAAc,CAAA;AAClD,QAAA,IAAI,CAACQ,UAAAA,CAAW,SAAS,CAAA,EAAG,OAAO,KAAA;AAEnC,QAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,SAAA,EAAW,OAAO,CAAA;AACjD,QAAA,OACC,QAAQ,QAAA,CAAS,eAAe,CAAA,IAAK,OAAA,CAAQ,SAAS,eAAe,CAAA;AAAA,MAEvE,CAAA;AAAA,MACA,YAAA,EAAc,qDAAA;AAAA,MACd,QAAA,EAAU;AAAA,KACV,CAAA;AAGD,IAAA,IAAI,QAAQ,QAAA,EAAU;AACrB,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,IAAA,EAAM,aAAA;AAAA,QACN,WAAA,EAAa,uBAAA;AAAA,QACb,UAAU,YAAY;AACrB,UAAA,MAAM,YAAA,GAAe,qBAAA,CAAsB,OAAA,CAAQ,GAAG,CAAA;AACtD,UAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,UAAA,MAAM,OAAA,GAAU,MAAMA,QAAAA,CAAS,YAAA,EAAc,OAAO,CAAA;AAEpD,UAAA,IAAI,OAAA,CAAQ,aAAa,QAAA,EAAU;AAClC,YAAA,OACC,QAAQ,QAAA,CAAS,mBAAmB,CAAA,IACpC,OAAA,CAAQ,SAAS,eAAe,CAAA;AAAA,UAElC,CAAA,MAAA,IAAW,OAAA,CAAQ,QAAA,KAAa,OAAA,EAAS;AACxC,YAAA,OACC,QAAQ,QAAA,CAAS,cAAc,CAAA,IAC/B,OAAA,CAAQ,SAAS,iBAAiB,CAAA;AAAA,UAEpC,CAAA,MAAA,IAAW,OAAA,CAAQ,QAAA,KAAa,QAAA,EAAU;AACzC,YAAA,OACC,QAAQ,QAAA,CAAS,gBAAgB,CAAA,IACjC,OAAA,CAAQ,SAAS,kBAAkB,CAAA;AAAA,UAErC;AACA,UAAA,OAAO,IAAA;AAAA,QACR,CAAA;AAAA,QACA,YAAA,EAAc,gDAAA;AAAA,QACd,QAAA,EAAU;AAAA,OACV,CAAA;AAAA,IACF;AAGA,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,IAAA,EAAM,kBAAA;AAAA,MACN,WAAA,EAAa,oBAAA;AAAA,MACb,UAAU,YAAY;AACrB,QAAA,MAAM,OAAA,GAAUF,IAAAA,CAAK,OAAA,CAAQ,GAAA,EAAK,UAAU,CAAA;AAC5C,QAAA,MAAM,aAAA,GAAgB,CAAC,WAAA,EAAa,UAAU,CAAA;AAE9C,QAAA,IAAI,QAAQ,QAAA,EAAU;AACrB,UAAA,aAAA,CAAc,IAAA,CAAK,CAAA,UAAA,EAAa,OAAA,CAAQ,QAAQ,CAAA,GAAA,CAAK,CAAA;AAAA,QACtD;AAEA,QAAA,OAAO,aAAA,CAAc,MAAM,CAAC,CAAA,KAAMQ,WAAWR,IAAAA,CAAK,OAAA,EAAS,CAAC,CAAC,CAAC,CAAA;AAAA,MAC/D,CAAA;AAAA,MACA,YAAA,EAAc,6BAAA;AAAA,MACd,QAAA,EAAU;AAAA,KACV,CAAA;AAGD,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,IAAA,EAAM,sBAAA;AAAA,MACN,WAAA,EAAa,sBAAA;AAAA,MACb,UAAU,YAAY;AACrB,QAAA,MAAM,SAAA,GAAYA,IAAAA,CAAK,OAAA,CAAQ,GAAA,EAAK,cAAc,CAAA;AAClD,QAAA,IAAI,CAACQ,UAAAA,CAAW,SAAS,CAAA,EAAG,OAAO,KAAA;AAEnC,QAAA,MAAM,OAAA,GAAU,MAAMN,QAAAA,CAAS,SAAA,EAAW,OAAO,CAAA;AACjD,QAAA,MAAM,WAAA,GAAc,OAAA,CAClB,KAAA,CAAM,IAAI,CAAA,CACV,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,IAAA,EAAK,CAAE,UAAA,CAAW,QAAQ,CAAC,CAAA;AAG7C,QAAA,MAAM,cAAc,WAAA,CAAY,MAAA;AAAA,UAC/B,CAAC,MAAM,CAAA,CAAE,QAAA,CAAS,iBAAiB,CAAA,IAAK,CAAA,CAAE,SAAS,qBAAqB;AAAA,SACzE;AAEA,QAAA,OAAO,YAAY,MAAA,IAAU,CAAA;AAAA,MAC9B,CAAA;AAAA,MACA,YAAA,EAAc,gEAAA;AAAA,MACd,QAAA,EAAU;AAAA,KACV,CAAA;AAED,IAAA,OAAO,MAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cACL,OAAA,EACgC;AAChC,IAAA,OAAO,KAAK,QAAA,CAAS;AAAA,MACpB,GAAG,OAAA;AAAA,MACH,aAAA,EAAe,IAAA;AAAA,MACf,iBAAA,EAAmB;AAAA,KACnB,CAAA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBACL,OAAA,EACgC;AAChC,IAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,WAAA,CAAY,OAAO,CAAA;AAChD,IAAA,MAAM,iBAAiB,SAAA,CAAU,MAAA,CAAO,CAAC,CAAA,KAAM,EAAE,QAAQ,CAAA;AAEzD,IAAA,MAAM,MAAA,GAA+B;AAAA,MACpC,MAAA,EAAQ,IAAA;AAAA,MACR,cAAc,EAAC;AAAA,MACf,cAAc,EAAC;AAAA,MACf,UAAA,EAAY,KAAA;AAAA,MACZ,QAAQ;AAAC,KACV;AAEA,IAAA,KAAA,MAAW,SAAS,cAAA,EAAgB;AACnC,MAAA,IAAI;AACH,QAAA,MAAM,MAAA,GAAS,MAAM,KAAA,CAAM,QAAA,EAAS;AAEpC,QAAA,IAAI,MAAA,EAAQ;AACX,UAAA,MAAA,CAAO,YAAA,CAAa,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AAAA,QACpC,CAAA,MAAO;AACN,UAAA,MAAA,CAAO,YAAA,CAAa,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AACnC,UAAA,MAAA,CAAO,MAAA,CAAO,KAAK,CAAA,EAAG,KAAA,CAAM,IAAI,CAAA,EAAA,EAAK,KAAA,CAAM,YAAY,CAAA,CAAE,CAAA;AACzD,UAAA,MAAA,CAAO,MAAA,GAAS,KAAA;AAAA,QACjB;AAAA,MACD,SAAS,KAAA,EAAO;AACf,QAAA,MAAA,CAAO,YAAA,CAAa,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AACnC,QAAA,MAAA,CAAO,OAAO,IAAA,CAAK,CAAA,EAAG,MAAM,IAAI,CAAA,EAAA,EAAK,KAAK,CAAA,CAAE,CAAA;AAC5C,QAAA,MAAA,CAAO,MAAA,GAAS,KAAA;AAAA,MACjB;AAAA,IACD;AAEA,IAAA,OAAO,MAAA;AAAA,EACR;AACD,CAAA;;;ACtSO,IAAM,uBAAN,MAEP;AAAA;AAAA;AAAA;AAAA,EAIC,MAAM,QAAA,CAAS,GAAA,EAAa,MAAA,EAA2C;AAEtE,IAAA,IAAI,CAACM,UAAAA,CAAWR,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAC,CAAA,EAAG;AAC3C,MAAA,MAAM,IAAI,MAAM,gDAAgD,CAAA;AAAA,IACjE;AAEA,IAAA,IAAI,CAACQ,UAAAA,CAAWR,IAAAA,CAAK,GAAA,EAAK,KAAK,CAAC,CAAA,EAAG;AAClC,MAAA,MAAM,IAAI,MAAM,iDAAiD,CAAA;AAAA,IAClE;AAGA,IAAA,MAAM,gBAAA,GAAmB,MAAA,CAAO,QAAA,IAAa,MAAM,eAAe,GAAG,CAAA;AAErE,IAAA,IAAI,qBAAqB,SAAA,EAAW;AACnC,MAAA,MAAM,IAAI,KAAA;AAAA,QACT;AAAA,OACD;AAAA,IACD;AAGA,IAAA,MAAA,CAAO,QAAA,GAAW,gBAAA;AAGlB,IAAA,MAAM,UAAA,GAAa,iBAAA,CAAkB,GAAA,EAAK,MAAA,CAAO,QAAQ,CAAA;AACzD,IAAA,IAAIQ,WAAW,UAAU,CAAA,IAAM,MAAM,iBAAA,CAAkB,UAAU,CAAA,EAAI;AACpE,MAAA,IAAI,CAAC,OAAO,KAAA,EAAO;AAClB,QAAA,MAAM,IAAI,KAAA;AAAA,UACT;AAAA,SACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,MAAM,QACL,OAAA,EACgB;AAChB,IAAA,MAAM,EAAE,GAAA,EAAK,MAAA,EAAQ,MAAA,EAAO,GAAI,OAAA;AAChC,IAAA,MAAM,EAAE,QAAA,EAAU,QAAA,EAAS,GAAI,MAAA;AAG/B,IAAA,MAAM,iBAAA,GAAoB,QAAA;AAG1B,IAAA,MAAA,CAAO,QAAA,GAAW,iBAAA;AAGlB,IAAA,IAAI,OAAO,KAAA,EAAO;AACjB,MAAA,MAAA,CAAO,QAAA,EAAU,KAAK,mDAAmD,CAAA;AAAA,IAC1E;AAGA,IAAA,MAAM,OAAA,GAAUR,IAAAA,CAAK,GAAA,EAAK,UAAU,CAAA;AACpC,IAAA,MAAMgB,KAAAA,CAAM,OAAA,EAAS,EAAE,SAAA,EAAW,MAAM,CAAA;AACxC,IAAA,MAAMA,KAAAA,CAAMhB,KAAK,OAAA,EAAS,WAAW,GAAG,EAAE,SAAA,EAAW,MAAM,CAAA;AAG3D,IAAA,MAAM,IAAA,CAAK,iBAAA,CAAkB,GAAA,EAAK,QAAA,EAAU,MAAM,CAAA;AAGlD,IAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,GAAA,EAAK,QAAA,EAAU,mBAAmB,MAAM,CAAA;AAGnE,IAAA,MAAM,IAAA,CAAK,mBAAA,CAAoB,GAAA,EAAK,iBAAA,EAAmB,MAAM,CAAA;AAG7D,IAAA,MAAM,IAAA,CAAK,iBAAA,CAAkB,GAAA,EAAK,QAAA,EAAU,mBAAmB,MAAM,CAAA;AAGrE,IAAA,MAAM,KAAK,uBAAA,CAAwB,GAAA,EAAK,QAAA,EAAU,OAAA,CAAQ,WAAW,MAAM,CAAA;AAE3E,IAAA,MAAA,CAAO,OAAA,GAAU,IAAA;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAuB;AACtB,IAAA,OAAO,IAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAA8B;AAC7B,IAAA,OAAO;AAAA,MACN,OAAA,EAAS,KAAA;AAAA,MACT,QAAA,EAAU,EAAA;AAAA;AAAA,MACV,QAAA,EAAU,SAAA;AAAA,MACV,cAAc,EAAC;AAAA,MACf,eAAe,EAAC;AAAA,MAChB,UAAU;AAAC,KACZ;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAA,CACb,GAAA,EACA,QAAA,EACA,MAAA,EACgB;AAChB,IAAA,MAAM,OAAA,GAAUA,IAAAA,CAAK,GAAA,EAAK,UAAU,CAAA;AAGpC,IAAA,MAAM,SAAA,GAAYA,IAAAA,CAAK,OAAA,EAAS,UAAU,CAAA;AAC1C,IAAA,MAAMS,SAAAA,CAAU,SAAA,EAAW,yBAAA,EAA2B,CAAA;AACtD,IAAA,MAAA,CAAO,YAAA,CAAa,KAAK,SAAS,CAAA;AAGlC,IAAA,MAAM,UAAA,GAAaT,IAAAA,CAAK,OAAA,EAAS,WAAW,CAAA;AAC5C,IAAA,MAAMS,SAAAA,CAAU,UAAA,EAAY,0BAAA,CAA2B,QAAQ,CAAC,CAAA;AAChE,IAAA,MAAA,CAAO,YAAA,CAAa,KAAK,UAAU,CAAA;AAGnC,IAAA,MAAM,YAAA,GAAeT,IAAAA,CAAK,OAAA,EAAS,CAAA,UAAA,EAAa,QAAQ,CAAA,GAAA,CAAK,CAAA;AAC7D,IAAA,IAAI,gBAAA;AAEJ,IAAA,QAAQ,QAAA;AAAU,MACjB,KAAK,QAAA;AACJ,QAAA,gBAAA,GAAmB,8BAAA,EAA+B;AAClD,QAAA;AAAA,MACD,KAAK,OAAA;AACJ,QAAA,gBAAA,GAAmB,6BAAA,EAA8B;AACjD,QAAA;AAAA,MACD,KAAK,QAAA;AACJ,QAAA,gBAAA,GAAmB,8BAAA,EAA+B;AAClD,QAAA;AAAA;AAGF,IAAA,MAAMS,SAAAA,CAAU,cAAc,gBAAgB,CAAA;AAC9C,IAAA,MAAA,CAAO,YAAA,CAAa,KAAK,YAAY,CAAA;AAGrC,IAAA,MAAA,CAAO,QAAA,GAAW,QAAA;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAA,CACb,GAAA,EACA,QAAA,EACA,UACA,MAAA,EACgB;AAChB,IAAA,MAAM,IAAA,GAAO,mBAAA,CAAoB,QAAA,EAAU,QAAQ,CAAA;AACnD,IAAA,MAAM,QAAA,GAAW,MAAM,4BAAA,CAA6B,GAAA,EAAK,IAAI,CAAA;AAE7D,IAAA,IAAI,QAAA,EAAU;AACb,MAAA,MAAA,CAAO,aAAA,CAAc,IAAA,CAAKT,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAC,CAAA;AAAA,IACpD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAA,CACb,GAAA,EACA,QAAA,EACA,MAAA,EACgB;AAChB,IAAA,MAAM,UAAA,GAAa,iBAAA,CAAkB,GAAA,EAAK,QAAQ,CAAA;AAElD,IAAA,IAAI,CAACQ,UAAAA,CAAW,UAAU,CAAA,EAAG;AAC5B,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,uBAAA,EAA0B,UAAU,CAAA,CAAE,CAAA;AAAA,IACvD;AAEA,IAAA,MAAM,QAAA,GAAW,MAAM,mBAAA,CAAoB,UAAA,EAAY,QAAQ,CAAA;AAE/D,IAAA,IAAI,QAAA,EAAU;AACb,MAAA,MAAA,CAAO,aAAA,CAAc,KAAK,UAAU,CAAA;AAAA,IACrC;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAA,CACb,GAAA,EACA,QAAA,EACA,UACA,MAAA,EACgB;AAEhB,IAAA,IAAI,aAAa,YAAA,EAAc;AAC9B,MAAA,MAAMS,SAAAA,GAAW,MAAM,oBAAA,CAAqB,GAAA,EAAK,QAAQ,CAAA;AACzD,MAAA,IAAIA,SAAAA,EAAU;AACb,QAAA,MAAM,YAAA,GAAe,sBAAsB,GAAG,CAAA;AAC9C,QAAA,IAAI,YAAA,EAAc;AACjB,UAAA,MAAA,CAAO,aAAA,CAAc,KAAK,YAAY,CAAA;AAAA,QACvC;AAAA,MACD;AAAA,IACD,CAAA,MAAA,IAAW,aAAa,QAAA,EAAU;AACjC,MAAA,MAAMA,SAAAA,GAAW,MAAM,kBAAA,CAAmB,GAAA,EAAK,QAAQ,CAAA;AACvD,MAAA,IAAIA,SAAAA,EAAU;AACb,QAAA,MAAM,UAAA,GAAajB,IAAAA,CAAK,GAAA,EAAK,aAAa,CAAA;AAC1C,QAAA,IAAI,MAAA,CAAO,YAAA,CAAa,QAAA,CAAS,UAAU,CAAA,EAAG,CAE9C,MAAA,IAAWQ,UAAAA,CAAW,UAAU,CAAA,EAAG;AAClC,UAAA,MAAA,CAAO,aAAA,CAAc,KAAK,UAAU,CAAA;AAAA,QACrC,CAAA,MAAO;AACN,UAAA,MAAA,CAAO,YAAA,CAAa,KAAK,UAAU,CAAA;AAAA,QACpC;AAAA,MACD;AAAA,IACD;AAGA,IAAA,MAAM,UAAA,GAAa,2BAA2B,QAAQ,CAAA;AACtD,IAAA,MAAM,QAAA,GAAW,MAAM,gBAAA,CAAiB,GAAA,EAAK,UAAU,UAAU,CAAA;AAEjE,IAAA,IAAI,QAAA,EAAU;AACb,MAAA,MAAM,OAAA,GAAUR,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAA;AACxC,MAAA,IAAIQ,UAAAA,CAAW,OAAO,CAAA,EAAG;AACxB,QAAA,MAAA,CAAO,aAAA,CAAc,KAAK,OAAO,CAAA;AAAA,MAClC,CAAA,MAAO;AACN,QAAA,MAAA,CAAO,YAAA,CAAa,KAAK,OAAO,CAAA;AAAA,MACjC;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,uBAAA,CACb,GAAA,EACA,QAAA,EACA,WACA,MAAA,EACgB;AAChB,IAAA,MAAM,cAAA,GAAiB,IAAI,cAAA,EAAe;AAI1C,IAAA,MAAM,gBAAA,GAAmB,MAAM,cAAA,CAAe,aAAA,CAAc;AAAA,MAC3D,GAAA;AAAA,MACA,SAAA;AAAA,MACA,QAAA;AAAA,MACA,iBAAA,EAAmB;AAAA;AAAA,KACnB,CAAA;AAGD,IAAA,IAAI,CAAC,iBAAiB,MAAA,EAAQ;AAC7B,MAAA,MAAM,YAAA,GAAe;AAAA,QACpB,wCAAA;AAAA,QACA,GAAG,gBAAA,CAAiB;AAAA,OACrB,CAAE,KAAK,QAAQ,CAAA;AAEf,MAAA,MAAM,IAAI,MAAM,YAAY,CAAA;AAAA,IAC7B;AAGA,IAAA,IAAI,gBAAA,CAAiB,YAAA,CAAa,MAAA,GAAS,CAAA,EAAG;AAC7C,MAAA,MAAA,CAAO,QAAA,EAAU,IAAA;AAAA,QAChB,CAAA,0BAAA,EAAwB,gBAAA,CAAiB,YAAA,CAAa,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,OACjE;AAAA,IACD;AAAA,EACD;AACD,CAAA;;;ACnUO,IAAM,iBAAN,MAAqB;AAAA,EACnB,YAAA;AAAA,EACA,QAAA;AAAA,EAER,WAAA,GAAc;AACb,IAAA,IAAA,CAAK,YAAA,GAAe,IAAI,oBAAA,EAAqB;AAC7C,IAAA,IAAA,CAAK,QAAA,GAAW,IAAI,oBAAA,EAAqB;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAQ,OAAA,EAAiD;AAC9D,IAAA,MAAM,GAAA,GAAM,OAAA,CAAQ,GAAA,IAAO,OAAA,CAAQ,GAAA,EAAI;AACvC,IAAA,MAAM,MAAA,GAAS,QAAQ,MAAA,IAAU,KAAA;AACjC,IAAA,MAAM,UAAA,GAAa,QAAQ,MAAA,KAAW,KAAA;AAGtC,IAAA,MAAM,MAAA,GAA6B;AAAA,MAClC,UAAU,OAAA,CAAQ,QAAA;AAAA,MAClB,UAAU,OAAA,CAAQ,QAAA;AAAA,MAClB,GAAA;AAAA,MACA,OAAO,OAAA,CAAQ;AAAA,KAChB;AAGA,IAAA,IAAI,MAAA,EAAQ;AACX,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,QAAA,CAAS,YAAA,EAAa;AAC1C,MAAA,MAAA,CAAO,WAAW,OAAA,CAAQ,QAAA;AAC1B,MAAA,MAAA,CAAO,QAAA,EAAU,KAAK,kCAAkC,CAAA;AAGxD,MAAA,IAAI;AACH,QAAA,MAAM,IAAA,CAAK,QAAA,CAAS,QAAA,CAAS,GAAA,EAAK,MAAM,CAAA;AAExC,QAAA,MAAA,CAAO,QAAA,GAAW,OAAO,QAAA,IAAY,SAAA;AACrC,QAAA,MAAA,CAAO,OAAA,GAAU,IAAA;AAAA,MAClB,SAAS,KAAA,EAAO;AACf,QAAA,MAAA,CAAO,QAAQ,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAAA,MACrE;AAEA,MAAA,OAAO,MAAA;AAAA,IACR;AAGA,IAAA,IAAI;AACH,MAAA,OAAO,MAAM,IAAA,CAAK,YAAA,CAAa,SAAS,GAAA,EAAK,MAAA,EAAQ,KAAK,QAAA,EAAU;AAAA,QACnE,UAAA;AAAA,QACA,MAAA,EAAQ;AAAA,OACR,CAAA;AAAA,IACF,SAAS,KAAA,EAAO;AAEf,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,QAAA,CAAS,YAAA,EAAa;AAC1C,MAAA,MAAA,CAAO,WAAW,OAAA,CAAQ,QAAA;AAE1B,MAAA,MAAA,CAAO,QAAA,GAAW,OAAO,QAAA,IAAY,SAAA;AACrC,MAAA,MAAA,CAAO,QAAQ,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AACpE,MAAA,OAAO,MAAA;AAAA,IACR;AAAA,EACD;AACD,CAAA;;;ACnDA,eAAsB,QACrB,OAAA,EACyB;AACzB,EAAA,MAAM,UAAA,GAAa,IAAI,cAAA,EAAe;AAEtC,EAAA,MAAM,eAAA,GAAkC;AAAA,IACvC,UAAU,OAAA,CAAQ,QAAA;AAAA,IAClB,UAAU,OAAA,CAAQ,QAAA;AAAA,IAClB,OAAO,OAAA,CAAQ,KAAA;AAAA,IACf,QAAQ,OAAA,CAAQ,MAAA;AAAA,IAChB,QAAQ,OAAA,CAAQ,MAAA;AAAA,IAChB,KAAK,OAAA,CAAQ;AAAA,GACd;AAEA,EAAA,MAAM,MAAA,GAAS,MAAM,UAAA,CAAW,OAAA,CAAQ,eAAe,CAAA;AAGvD,EAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,IAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,EAC5C,CAAA,MAAO;AACN,IAAA,wBAAA,CAAyB,MAAM,CAAA;AAAA,EAChC;AAEA,EAAA,OAAO,MAAA;AACR;AAKA,SAAS,yBAAyB,MAAA,EAA6B;AAC9D,EAAA,IAAI,OAAO,OAAA,EAAS;AACnB,IAAA,OAAA,CAAQ,IAAI,+CAA0C,CAAA;AAEtD,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,UAAA,EAAa,MAAA,CAAO,QAAQ,CAAA,CAAE,CAAA;AAC1C,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,UAAA,EAAa,MAAA,CAAO,QAAQ;AAAA,CAAI,CAAA;AAE5C,IAAA,IAAI,MAAA,CAAO,YAAA,CAAa,MAAA,GAAS,CAAA,EAAG;AACnC,MAAA,OAAA,CAAQ,IAAI,gBAAgB,CAAA;AAC5B,MAAA,KAAA,MAAW,IAAA,IAAQ,OAAO,YAAA,EAAc;AACvC,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,IAAI,CAAA,CAAE,CAAA;AAAA,MAC1B;AACA,MAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,IACb;AAEA,IAAA,IAAI,MAAA,CAAO,aAAA,CAAc,MAAA,GAAS,CAAA,EAAG;AACpC,MAAA,OAAA,CAAQ,IAAI,iBAAiB,CAAA;AAC7B,MAAA,KAAA,MAAW,IAAA,IAAQ,OAAO,aAAA,EAAe;AACxC,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,IAAI,CAAA,CAAE,CAAA;AAAA,MAC1B;AACA,MAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,IACb;AAEA,IAAA,IAAI,MAAA,CAAO,QAAA,IAAY,MAAA,CAAO,QAAA,CAAS,SAAS,CAAA,EAAG;AAClD,MAAA,OAAA,CAAQ,IAAI,yBAAe,CAAA;AAC3B,MAAA,KAAA,MAAW,OAAA,IAAW,OAAO,QAAA,EAAU;AACtC,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAA,EAAK,OAAO,CAAA,CAAE,CAAA;AAAA,MAC3B;AACA,MAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,IACb;AAEA,IAAA,OAAA,CAAQ,IAAI,aAAa,CAAA;AACzB,IAAA,OAAA,CAAQ,IAAI,qDAAqD,CAAA;AACjE,IAAA,OAAA,CAAQ,IAAI,sDAAsD,CAAA;AAElE,IAAA,IAAI,MAAA,CAAO,aAAa,YAAA,EAAc;AACrC,MAAA,OAAA,CAAQ,IAAI,+CAA+C,CAAA;AAC3D,MAAA,OAAA,CAAQ,IAAI,sCAAsC,CAAA;AAAA,IACnD,CAAA,MAAO;AACN,MAAA,OAAA,CAAQ,IAAI,6CAA6C,CAAA;AACzD,MAAA,OAAA,CAAQ,IAAI,sCAAsC,CAAA;AAAA,IACnD;AAEA,IAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,EACb,CAAA,MAAO;AACN,IAAA,OAAA,CAAQ,MAAM,yCAAoC,CAAA;AAClD,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,OAAA,EAAU,MAAA,CAAO,KAAK;AAAA,CAAI,CAAA;AAExC,IAAA,IAAI,MAAA,CAAO,QAAA,IAAY,MAAA,CAAO,QAAA,CAAS,SAAS,CAAA,EAAG;AAClD,MAAA,OAAA,CAAQ,MAAM,WAAW,CAAA;AACzB,MAAA,KAAA,MAAW,OAAA,IAAW,OAAO,QAAA,EAAU;AACtC,QAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAA,EAAK,OAAO,CAAA,CAAE,CAAA;AAAA,MAC7B;AACA,MAAA,OAAA,CAAQ,KAAA,EAAM;AAAA,IACf;AAEA,IAAA,IAAI,OAAO,SAAA,EAAW;AACrB,MAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,qBAAA,EAAwB,MAAA,CAAO,SAAS,CAAA,CAAE,CAAA;AACxD,MAAA,OAAA,CAAQ,MAAM,wDAAwD,CAAA;AAAA,IACvE;AAEA,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EACf;AACD;AAKO,SAAS,uBACf,OAAA,EACO;AACP,EAAA,IAAI,CAAC,QAAQ,QAAA,EAAU;AACtB,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAEA,EAAA,MAAM,cAAA,GAAiB,CAAC,QAAA,EAAU,OAAA,EAAS,QAAQ,CAAA;AACnD,EAAA,IAAI,CAAC,cAAA,CAAe,QAAA,CAAS,OAAA,CAAQ,QAAQ,CAAA,EAAG;AAC/C,IAAA,MAAM,IAAI,KAAA;AAAA,MACT,qBAAqB,OAAA,CAAQ,QAAQ,qBAAqB,cAAA,CAAe,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,KACpF;AAAA,EACD;AAEA,EAAA,IACC,OAAA,CAAQ,QAAA,IACR,CAAC,CAAC,YAAA,EAAc,QAAQ,CAAA,CAAE,QAAA,CAAS,OAAA,CAAQ,QAAQ,CAAA,EAClD;AACD,IAAA,MAAM,IAAI,KAAA;AAAA,MACT,CAAA,kBAAA,EAAqB,QAAQ,QAAQ,CAAA,8BAAA;AAAA,KACtC;AAAA,EACD;AACD;AAKO,SAAS,oBAAA,GAAgC;AAC/C,EAAA,MAAM,UAAU,IAAIF,OAAAA,CAAQ,MAAM,CAAA,CAChC,WAAA,CAAY,uCAAuC,CAAA,CACnD,cAAA;AAAA,IACA,uBAAA;AAAA,IACA;AAAA,GACD,CACC,MAAA;AAAA,IACA,uBAAA;AAAA,IACA;AAAA,IAEA,MAAA,CAAO,SAAA,EAAW,iDAAiD,CAAA,CACnE,MAAA,CAAO,aAAa,gDAAgD,CAAA,CACpE,OAAO,aAAA,EAAe,2CAA2C,EACjE,MAAA,CAAO,QAAA,EAAU,uBAAuB,CAAA,CACxC,MAAA,CAAO,OAAO,OAAA,KAAmC;AACjD,IAAA,IAAI;AAEH,MAAA,sBAAA,CAAuB,OAAO,CAAA;AAG9B,MAAA,MAAM,QAAQ,OAAO,CAAA;AAAA,IACtB,SAAS,KAAA,EAAO;AACf,MAAA,MAAM,eACL,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAEtD,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,MAAM,MAAA,GAAwB;AAAA,UAC7B,OAAA,EAAS,KAAA;AAAA,UACT,QAAA,EAAU,QAAQ,QAAA,IAAY,SAAA;AAAA,UAC9B,QAAA,EAAU,SAAA;AAAA,UACV,cAAc,EAAC;AAAA,UACf,eAAe,EAAC;AAAA,UAChB,KAAA,EAAO;AAAA,SACR;AACA,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAA,MAAO;AACN,QAAA,OAAA,CAAQ,KAAA,CAAM;AAAA,cAAA,EAAc,YAAY;AAAA,CAAI,CAAA;AAAA,MAC7C;AACA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AAEF,EAAA,OAAO,OAAA;AACR;;;ACgGO,SAAS,gBAAgB,IAAA,EAA8C;AAC5E,EAAA,OAAO,IAAA,KAAS,IAAA,IAAQ,IAAA,KAAS,IAAA,IAAQ,IAAA,KAAS,IAAA;AACpD;AA4BO,SAAS,eAAe,IAAA,EAA2B;AACxD,EAAA,MAAM,IAAA,GAAoC;AAAA,IACxC,EAAA,EAAI,eAAA;AAAA,IACJ,EAAA,EAAI,cAAA;AAAA,IACJ,EAAA,EAAI,YAAA;AAAA,IACJ,MAAA,EAAQ,QAAA;AAAA,IACR,EAAA,EAAI,IAAA;AAAA,IACJ,SAAA,EAAW,WAAA;AAAA,IACX,UAAA,EAAY;AAAA,GACd;AACA,EAAA,OAAO,KAAK,IAAI,CAAA;AAClB;ACtTO,IAAM,mBAAN,MAAuB;AAAA,EACrB,aAAA,GAAgB,IAAI,aAAA,EAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAO1C,MAAM,qBAAA,CACL,GAAA,EACA,MAAA,EACA,OAAA,GAAmC,EAAC,EACpB;AAChB,IAAA,MAAM;AAAA,MACL,eAAA,GAAkB,IAAA;AAAA,MAClB,YAAA,GAAe,IAAA;AAAA,MACf,qBAAA,GAAwB;AAAA,KACzB,GAAI,OAAA;AAEJ,IAAA,MAAM,SAAmC,EAAC;AAG1C,IAAA,IAAI,qBAAA,EAAuB;AAC1B,MAAA,MAAM,eAAA,GAAkB,MAAM,IAAA,CAAK,wBAAA,CAAyB,GAAG,CAAA;AAC/D,MAAA,MAAA,CAAO,IAAA,CAAK,GAAG,eAAe,CAAA;AAAA,IAC/B;AAGA,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,mBAAA,CAAoB,MAAA,CAAO,WAAW,CAAA;AAC7D,IAAA,IAAI,SAAA,EAAW;AACd,MAAA,MAAA,CAAO,KAAK,SAAS,CAAA;AAAA,IACtB;AAGA,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,mBAAA,CAAoB,MAAA,CAAO,WAAW,CAAA;AAC7D,IAAA,IAAI,SAAA,EAAW;AACd,MAAA,MAAA,CAAO,KAAK,SAAS,CAAA;AAAA,IACtB;AAGA,IAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,uBAAA,CAAwB,MAAM,CAAA;AAC1D,IAAA,MAAA,CAAO,IAAA,CAAK,GAAG,cAAc,CAAA;AAG7B,IAAA,IAAI,eAAA,EAAiB;AACpB,MAAA,MAAM,cAAA,GAAiB,MAAM,IAAA,CAAK,0BAAA,CAA2B,KAAK,MAAM,CAAA;AACxE,MAAA,IAAI,cAAA,EAAgB;AACnB,QAAA,MAAA,CAAO,KAAK,cAAc,CAAA;AAAA,MAC3B;AAAA,IACD;AAGA,IAAA,IAAI,YAAA,EAAc;AACjB,MAAA,MAAM,YAAA,GAAe,MAAM,IAAA,CAAK,oBAAA,CAAqB,KAAK,MAAM,CAAA;AAChE,MAAA,MAAA,CAAO,IAAA,CAAK,GAAG,YAAY,CAAA;AAAA,IAC5B;AAGA,IAAA,IAAI,MAAA,CAAO,SAAS,CAAA,EAAG;AACtB,MAAA,MAAM,aAAA,GAAgB,MAAA,CAAO,GAAA,CAAI,CAAC,CAAA,KAAM;AACvC,QAAA,IAAI,MAAM,CAAA,CAAE,OAAA;AACZ,QAAA,IAAI,EAAE,KAAA,EAAO,GAAA,GAAM,GAAG,CAAA,CAAE,KAAK,KAAK,GAAG,CAAA,CAAA;AACrC,QAAA,IAAI,CAAA,CAAE,UAAA,EAAY,GAAA,IAAO,CAAA,EAAA,EAAK,EAAE,UAAU,CAAA,CAAA,CAAA;AAC1C,QAAA,OAAO,GAAA;AAAA,MACR,CAAC,CAAA;AACD,MAAA,MAAM,IAAI,KAAA;AAAA,QACT,CAAA;AAAA,EAA+B,aAAA,CAAc,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,IAAA,EAAO,CAAC,CAAA,CAAE,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,OAC/E;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,yBACb,GAAA,EACoC;AACpC,IAAA,MAAM,SAAmC,EAAC;AAG1C,IAAA,MAAM,YAAA,GAAeN,IAAAA,CAAK,GAAA,EAAK,gBAAgB,CAAA;AAC/C,IAAA,IAAI,CAACQ,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC9B,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,OAAA,EAAS,0BAAA;AAAA,QACT,KAAA,EAAO,SAAA;AAAA,QACP,UAAA,EACC;AAAA,OACD,CAAA;AAAA,IACF;AAGA,IAAA,MAAM,WAAA,GAAcR,IAAAA,CAAK,GAAA,EAAK,cAAc,CAAA;AAC5C,IAAA,IAAI,CAACQ,UAAAA,CAAW,WAAW,CAAA,EAAG;AAC7B,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,OAAA,EAAS,wBAAA;AAAA,QACT,KAAA,EAAO,SAAA;AAAA,QACP,UAAA,EAAY;AAAA,OACZ,CAAA;AAAA,IACF;AAGA,IAAA,MAAM,OAAA,GAAUR,IAAAA,CAAK,GAAA,EAAK,KAAK,CAAA;AAC/B,IAAA,IAAI,CAACQ,UAAAA,CAAW,OAAO,CAAA,EAAG;AACzB,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,OAAA,EAAS,yBAAA;AAAA,QACT,KAAA,EAAO,SAAA;AAAA,QACP,UAAA,EAAY;AAAA,OACZ,CAAA;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,oBAAoB,IAAA,EAA6C;AAExE,IAAA,IAAI,CAAC,QAAA,CAAS,IAAA,CAAK,IAAI,CAAA,EAAG;AACzB,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,kDAAA;AAAA,QACT,KAAA,EAAO,aAAA;AAAA,QACP,UAAA,EAAY,CAAA,mCAAA,EAAsC,IAAA,CAAK,WAAA,EAAa,CAAA,CAAA;AAAA,OACrE;AAAA,IACD;AAGA,IAAA,IAAI,CAAC,mBAAA,CAAoB,IAAA,CAAK,IAAI,CAAA,EAAG;AACpC,MAAA,OAAO;AAAA,QACN,OAAA,EACC,4EAAA;AAAA,QACD,KAAA,EAAO,aAAA;AAAA,QACP,UAAA,EAAY;AAAA,OACb;AAAA,IACD;AAGA,IAAA,IAAI,IAAA,CAAK,QAAA,CAAS,GAAG,CAAA,EAAG;AACvB,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,4CAAA;AAAA,QACT,KAAA,EAAO,aAAA;AAAA,QACP,YAAY,CAAA,4BAAA,EAA+B,IAAA,CAAK,KAAA,CAAM,CAAA,EAAG,EAAE,CAAC,CAAA;AAAA,OAC7D;AAAA,IACD;AAGA,IAAA,IAAI,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA,EAAG;AACxB,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,kDAAA;AAAA,QACT,KAAA,EAAO,aAAA;AAAA,QACP,UAAA,EAAY;AAAA,OACb;AAAA,IACD;AAEA,IAAA,OAAO,IAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,IAAA,EAA6C;AACxE,IAAA,MAAM,cAAA,GAAiB;AAAA,MACtB,IAAA;AAAA,MACA,IAAA;AAAA,MACA,IAAA;AAAA,MACA,QAAA;AAAA,MACA,IAAA;AAAA,MACA,WAAA;AAAA,MACA;AAAA,KACD;AAEA,IAAA,IAAI,CAAC,cAAA,CAAe,QAAA,CAAS,IAAI,CAAA,EAAG;AACnC,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,6BAA6B,IAAI,CAAA,CAAA;AAAA,QAC1C,KAAA,EAAO,aAAA;AAAA,QACP,UAAA,EAAY,CAAA,iBAAA,EAAoB,cAAA,CAAe,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,OAC1D;AAAA,IACD;AAGA,IAAA,IAAI,CAAC,eAAA,CAAgB,IAAW,CAAA,EAAG;AAClC,MAAA,OAAO;AAAA,QACN,OAAA,EAAS,iBAAiB,IAAI,CAAA,wBAAA,CAAA;AAAA,QAC9B,KAAA,EAAO,aAAA;AAAA,QACP,UAAA,EAAY;AAAA,OACb;AAAA,IACD;AAEA,IAAA,OAAO,IAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKQ,wBACP,MAAA,EAC2B;AAC3B,IAAA,MAAM,SAAmC,EAAC;AAG1C,IAAA,IAAI,MAAA,CAAO,gBAAgB,IAAA,EAAM;AAEhC,MAAA,IACC,OAAO,YAAA,IACP,CAAC,eAAe,IAAA,CAAK,MAAA,CAAO,YAAY,CAAA,EACvC;AACD,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACX,OAAA,EAAS,sDAAA;AAAA,UACT,KAAA,EAAO,cAAA;AAAA,UACP,UAAA,EACC;AAAA,SACD,CAAA;AAAA,MACF;AAAA,IACD;AAGA,IAAA,IAAI,MAAA,CAAO,gBAAgB,IAAA,EAAM;AAChC,MAAA,IAAI,OAAO,UAAA,IAAc,CAAC,eAAe,IAAA,CAAK,MAAA,CAAO,UAAU,CAAA,EAAG;AACjE,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACX,OAAA,EAAS,oDAAA;AAAA,UACT,KAAA,EAAO,YAAA;AAAA,UACP,UAAA,EACC;AAAA,SACD,CAAA;AAAA,MACF;AAAA,IACD;AAEA,IAAA,OAAO,MAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,0BAAA,CACb,GAAA,EACA,MAAA,EACyC;AACzC,IAAA,MAAM,YAAA,GAAeR,IAAAA,CAAK,GAAA,EAAK,gBAAgB,CAAA;AAE/C,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAME,QAAAA,CAAS,YAAA,EAAc,OAAO,CAAA;AAGpD,MAAA,MAAM,WAAA,GAAc,OAAA,CAAQ,OAAA,CAAQ,WAAA,EAAa,EAAE,CAAA;AACnD,MAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,KAAA,CAAM,WAAW,CAAA;AAG7C,MAAA,MAAM,GAAA,GAAM,cAAA,CAAe,MAAA,CAAO,WAAW,CAAA;AAG7C,MAAA,IAAI,aAAA,GAAgB,KAAA;AAEpB,MAAA,IAAI,MAAA,CAAO,gBAAgB,IAAA,EAAM;AAChC,QAAA,MAAM,UAAA,GAAa,cAAA,CAAe,aAAA,IAAiB,EAAC;AACpD,QAAA,aAAA,GAAgB,UAAA,CAAW,IAAA;AAAA,UAC1B,CAAC,CAAA,KAAM,CAAA,CAAE,OAAA,KAAY,MAAA,CAAO;AAAA,SAC7B;AAAA,MACD,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,IAAA,EAAM;AACvC,QAAA,MAAM,UAAA,GAAa,cAAA,CAAe,YAAA,IAAgB,EAAC;AACnD,QAAA,aAAA,GAAgB,UAAA,CAAW,IAAA;AAAA,UAC1B,CAAC,CAAA,KAAM,CAAA,CAAE,OAAA,KAAY,MAAA,CAAO;AAAA,SAC7B;AAAA,MACD,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,IAAA,EAAM;AACvC,QAAA,MAAM,UAAA,GAAa,cAAA,CAAe,UAAA,IAAc,EAAC;AACjD,QAAA,aAAA,GAAgB,UAAA,CAAW,IAAA;AAAA,UAC1B,CAAC,CAAA,KAAM,CAAA,CAAE,OAAA,KAAY,MAAA,CAAO;AAAA,SAC7B;AAAA,MACD,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,IAAA,EAAM;AACvC,QAAA,aAAA,GAAgB,cAAA,CAAe,EAAA,EAAI,OAAA,KAAY,MAAA,CAAO,WAAA;AAAA,MACvD,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,WAAA,EAAa;AAC9C,QAAA,MAAM,iBAAA,GAAoB,cAAA,CAAe,SAAA,IAAa,EAAC;AACvD,QAAA,aAAA,GAAgB,iBAAA,CAAkB,IAAA;AAAA,UACjC,CAAC,CAAA,KAAM,CAAA,CAAE,OAAA,KAAY,MAAA,CAAO;AAAA,SAC7B;AAAA,MACD,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,YAAA,EAAc;AAC/C,QAAA,MAAM,kBAAA,GAAqB,cAAA,CAAe,UAAA,IAAc,EAAC;AACzD,QAAA,aAAA,GAAgB,kBAAA,CAAmB,IAAA;AAAA,UAClC,CAAC,CAAA,KAAM,CAAA,CAAE,OAAA,KAAY,MAAA,CAAO;AAAA,SAC7B;AAAA,MACD;AAEA,MAAA,IAAI,aAAA,EAAe;AAClB,QAAA,OAAO;AAAA,UACN,OAAA,EAAS,CAAA,SAAA,EAAY,MAAA,CAAO,WAAW,CAAA,kCAAA,CAAA;AAAA,UACvC,KAAA,EAAO,aAAA;AAAA,UACP,UAAA,EAAY;AAAA,SACb;AAAA,MACD;AAAA,IACD,SAAS,KAAA,EAAY;AAGpB,MAAA,IAAI,KAAA,CAAM,OAAA,EAAS,QAAA,CAAS,MAAM,CAAA,EAAG;AACpC,QAAA,OAAO;AAAA,UACN,OAAA,EAAS,gCAAA;AAAA,UACT,KAAA,EAAO,UAAA;AAAA,UACP,UAAA,EACC;AAAA,SACF;AAAA,MACD;AAAA,IACD;AAEA,IAAA,OAAO,IAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAA,CACb,GAAA,EACA,MAAA,EACoC;AACpC,IAAA,MAAM,SAAmC,EAAC;AAG1C,IAAA,MAAM,YAAA,GAAeF,IAAAA,CAAK,GAAA,EAAK,gBAAgB,CAAA;AAC/C,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,gBAAA,CAAiB,MAAA,CAAO,WAAW,CAAA;AAE9D,IAAA,IAAI,aAAA,EAAe;AAClB,MAAA,MAAM,oBACL,MAAM,IAAA,CAAK,aAAA,CAAc,SAAA,CAAU,cAAc,aAAa,CAAA;AAC/D,MAAA,IAAI,CAAC,iBAAA,EAAmB;AACvB,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACX,OAAA,EAAS,CAAA,wCAAA,EAA2C,aAAA,CAAc,IAAI,CAAA,CAAA;AAAA,UACtE,KAAA,EAAO,SAAA;AAAA,UACP,UAAA,EACC;AAAA,SACD,CAAA;AAAA,MACF;AAAA,IACD;AAGA,IAAA,MAAM,SAAA,GAAYA,IAAAA,CAAK,GAAA,EAAK,KAAA,EAAO,UAAU,CAAA;AAC7C,IAAA,MAAM,gBAAA,GAAmB,MAAM,IAAA,CAAK,aAAA,CAAc,SAAA;AAAA,MACjD,SAAA;AAAA,MACA,eAAA,CAAgB;AAAA,KACjB;AACA,IAAA,IAAI,CAAC,gBAAA,EAAkB;AACtB,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,OAAA,EAAS,CAAA,sCAAA,EAAyC,eAAA,CAAgB,OAAA,CAAQ,IAAI,CAAA,CAAA;AAAA,QAC9E,KAAA,EAAO,SAAA;AAAA,QACP,UAAA,EACC;AAAA,OACD,CAAA;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,IAAA,EAA6E;AACrG,IAAA,QAAQ,IAAA;AAAM,MACb,KAAK,IAAA;AACJ,QAAA,OAAO,eAAA,CAAgB,EAAA;AAAA,MACxB,KAAK,IAAA;AACJ,QAAA,OAAO,eAAA,CAAgB,EAAA;AAAA,MACxB,KAAK,IAAA;AACJ,QAAA,OAAO,eAAA,CAAgB,EAAA;AAAA,MACxB,KAAK,QAAA;AACJ,QAAA,OAAO,eAAA,CAAgB,gBAAA;AAAA,MACxB,KAAK,IAAA;AACJ,QAAA,OAAO,eAAA,CAAgB,EAAA;AAAA,MACxB,KAAK,WAAA;AACJ,QAAA,OAAO,eAAA,CAAgB,SAAA;AAAA,MACxB,KAAK,YAAA;AACJ,QAAA,OAAO,eAAA,CAAgB,UAAA;AAAA,MACxB;AACC,QAAA,OAAO,IAAA;AAAA;AACT,EACD;AACD,CAAA;ACvXO,IAAM,yBAAN,MAA6B;AAAA,EAC3B,aAAA,uBAAoB,GAAA,EAAwC;AAAA,EAC5D,YAAA;AAAA,EAER,WAAA,GAAc;AAEb,IAAA,MAAMH,WAAAA,GAAaO,aAAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAChD,IAAA,MAAMN,UAAAA,GAAYG,QAAQJ,WAAU,CAAA;AAGpC,IAAA,IAAI,UAAA,GAAaC,UAAAA;AACjB,IAAA,IAAI,aAAA,GAAgB,EAAA;AAGpB,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,CAAA,EAAG,CAAA,EAAA,EAAK;AAC3B,MAAA,MAAM,aAAA,GAAgBE,IAAAA,CAAK,UAAA,EAAY,gCAAgC,CAAA;AACvE,MAAA,IAAI;AAEH,QAAA,IAAIkB,QAAAA,CAAS,aAAa,CAAA,CAAE,WAAA,EAAY,EAAG;AAC1C,UAAA,aAAA,GAAgB,aAAA;AAChB,UAAA;AAAA,QACD;AAAA,MACD,CAAA,CAAA,MAAQ;AAAA,MAER;AACA,MAAA,UAAA,GAAajB,QAAQ,UAAU,CAAA;AAAA,IAChC;AAEA,IAAA,IAAI,CAAC,aAAA,EAAe;AACnB,MAAA,MAAM,IAAI,KAAA;AAAA,QACT,6EAA6EH,UAAS,CAAA;AAAA,OACvF;AAAA,IACD;AAEA,IAAA,IAAA,CAAK,YAAA,GAAe,aAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,aAAa,YAAA,EAAkD;AAEtE,IAAA,IAAI,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,YAAY,CAAA,EAAG;AACzC,MAAA,OAAO,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,YAAY,CAAA;AAAA,IAC3C;AAGA,IAAA,MAAM,QAAA,GAAWE,IAAAA,CAAK,IAAA,CAAK,YAAA,EAAc,YAAY,CAAA;AACrD,IAAA,MAAM,eAAA,GAAkBmB,YAAAA,CAAa,QAAA,EAAU,OAAO,CAAA;AAGtD,IAAA,MAAM,WAAWP,UAAAA,CAAW,OAAA,CAAQ,iBAAiB,EAAE,QAAA,EAAU,MAAM,CAAA;AAGvE,IAAA,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,YAAA,EAAc,QAAQ,CAAA;AAE7C,IAAA,OAAO,QAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,iBAAiB,IAAA,EAAmC;AACnD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,eAAe,CAAA;AAClD,IAAA,OAAO,SAAS,IAAI,CAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,iBAAiB,IAAA,EAAmC;AACnD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,eAAe,CAAA;AAClD,IAAA,OAAO,SAAS,IAAI,CAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,iBAAiB,IAAA,EAAmC;AACnD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,CAAa,eAAe,CAAA;AAClD,IAAA,OAAO,SAAS,IAAI,CAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,cAAA,CACC,aACA,IAAA,EACS;AACT,IAAA,QAAQ,WAAA;AAAa,MACpB,KAAK,IAAA;AACJ,QAAA,OAAO,IAAA,CAAK,iBAAiB,IAAI,CAAA;AAAA,MAClC,KAAK,IAAA;AACJ,QAAA,OAAO,IAAA,CAAK,iBAAiB,IAAI,CAAA;AAAA,MAClC,KAAK,IAAA;AACJ,QAAA,OAAO,IAAA,CAAK,iBAAiB,IAAI,CAAA;AAAA,MAClC,KAAK,QAAA;AAAA,MACL,KAAK,IAAA;AAAA,MACL,KAAK,WAAA;AAAA,MACL,KAAK,YAAA;AACJ,QAAA,MAAM,IAAI,KAAA;AAAA,UACT,iBAAiB,WAAW,CAAA,mCAAA;AAAA,SAC7B;AAAA,MACD;AACC,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,sBAAA,EAAyB,WAAW,CAAA,CAAE,CAAA;AAAA;AACxD,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,gBAAA,CACL,GAAA,EACA,WAAA,EACA,IAAA,EACkB;AAElB,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,cAAA,CAAe,WAAA,EAAa,IAAI,CAAA;AAGrD,IAAA,MAAM,WAAA,GAAcZ,IAAAA,CAAK,GAAA,EAAK,KAAA,EAAO,SAAS,UAAU,CAAA;AACxD,IAAA,MAAM,QAAA,GAAW,CAAA,EAAG,WAAW,CAAA,CAAA,EAAI,KAAK,UAAU,CAAA,GAAA,CAAA;AAClD,IAAA,MAAM,UAAA,GAAaA,IAAAA,CAAK,WAAA,EAAa,QAAQ,CAAA;AAG7C,IAAA,IAAI,CAACQ,UAAAA,CAAW,WAAW,CAAA,EAAG;AAC7B,MAAA,MAAMQ,KAAAA,CAAM,WAAA,EAAa,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,IAC7C;AAGA,IAAA,MAAMP,SAAAA,CAAU,UAAA,EAAY,OAAA,EAAS,OAAO,CAAA;AAE5C,IAAA,OAAO,UAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,aAAA,CACC,GAAA,EACA,WAAA,EACA,SAAA,EACS;AACT,IAAA,OAAOT,IAAAA,CAAK,KAAK,KAAA,EAAO,OAAA,EAAS,YAAY,CAAA,EAAG,WAAW,CAAA,CAAA,EAAI,SAAS,CAAA,GAAA,CAAK,CAAA;AAAA,EAC9E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,uBAAA,CACC,eAAA,EACA,WAAA,EACA,SAAA,EACS;AACT,IAAA,OAAO,CAAA,SAAA,EAAY,eAAe,CAAA,0BAAA,EAA6B,WAAW,IAAI,SAAS,CAAA,KAAA,CAAA;AAAA,EACxF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAmB;AAClB,IAAA,IAAA,CAAK,cAAc,KAAA,EAAM;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,eAAA,GAA0B;AACzB,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACb;AACD,CAAA;AC1MA,eAAsB,YAAA,CACrB,GAAA,EACA,WAAA,EACA,IAAA,EACmB;AACnB,EAAA,MAAM,YAAA,GAAe,sBAAsB,GAAG,CAAA;AAE9C,EAAA,IAAI,CAAC,YAAA,IAAgB,CAAC,YAAA,CAAa,QAAA,CAAS,QAAQ,CAAA,EAAG;AACtD,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAEA,EAAA,MAAM,aAAA,GAAgB,IAAI,aAAA,EAAc;AAGxC,EAAA,MAAM,SAAA,GAAY,MAAM,aAAA,CAAc,SAAA;AAAA,IACrC,YAAA;AAAA,IACA,eAAA,CAAgB;AAAA,GACjB;AACA,EAAA,IAAI,CAAC,SAAA,EAAW;AACf,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAGA,EAAA,MAAM,YAOH,CAAA;AAAA;AAAA,eAAA,EAEa,WAAW,CAAA;AAAA,kDAAA,EACwB,WAAW,CAAA;AAAA;AAAA,GAAA,CAAA;AAK9D,EAAA,MAAM,MAAA,GAAS,MAAM,aAAA,CAAc,cAAA;AAAA,IAClC,YAAA;AAAA,IACA,eAAA,CAAgB,EAAA;AAAA,IAChB,SAAA;AAAA,IACA,EAAE,QAAQ,GAAA;AAAK,GAChB;AAEA,EAAA,OAAO,MAAA,CAAO,QAAA;AACf;AAWA,eAAsB,YAAA,CACrB,GAAA,EACA,WAAA,EACA,YAAA,EACA,UAAA,EACmB;AACnB,EAAA,MAAM,YAAA,GAAe,sBAAsB,GAAG,CAAA;AAE9C,EAAA,IAAI,CAAC,YAAA,IAAgB,CAAC,YAAA,CAAa,QAAA,CAAS,QAAQ,CAAA,EAAG;AACtD,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAEA,EAAA,MAAM,aAAA,GAAgB,IAAI,aAAA,EAAc;AAGxC,EAAA,MAAM,SAAA,GAAY,MAAM,aAAA,CAAc,SAAA;AAAA,IACrC,YAAA;AAAA,IACA,eAAA,CAAgB;AAAA,GACjB;AACA,EAAA,IAAI,CAAC,SAAA,EAAW;AACf,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAGA,EAAA,MAAM,YAQH,CAAA;AAAA;AAAA,eAAA,EAEa,WAAW,CAAA;AAAA,qBAAA,EACL,YAAY,CAAA;AAAA,iDAAA,EACgB,YAAY,CAAA;AAAA;AAAA,GAAA,CAAA;AAK9D,EAAA,MAAM,MAAA,GAAS,MAAM,aAAA,CAAc,cAAA;AAAA,IAClC,YAAA;AAAA,IACA,eAAA,CAAgB,EAAA;AAAA,IAChB,SAAA;AAAA,IACA,EAAE,QAAQ,GAAA;AAAK,GAChB;AAEA,EAAA,OAAO,MAAA,CAAO,QAAA;AACf;AAWA,eAAsB,YAAA,CACrB,GAAA,EACA,WAAA,EACA,UAAA,EACA,iBAAA,EACmB;AACnB,EAAA,MAAM,YAAA,GAAe,sBAAsB,GAAG,CAAA;AAE9C,EAAA,IAAI,CAAC,YAAA,IAAgB,CAAC,YAAA,CAAa,QAAA,CAAS,QAAQ,CAAA,EAAG;AACtD,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAEA,EAAA,MAAM,aAAA,GAAgB,IAAI,aAAA,EAAc;AAGxC,EAAA,MAAM,SAAA,GAAY,MAAM,aAAA,CAAc,SAAA;AAAA,IACrC,YAAA;AAAA,IACA,eAAA,CAAgB;AAAA,GACjB;AACA,EAAA,IAAI,CAAC,SAAA,EAAW;AACf,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAGA,EAAA,IAAI,SAAA;AACJ,EAQO;AACN,IAAA,SAAA,GAAY,CAAA;AAAA;AAAA,eAAA,EAEG,WAAW,CAAA;AAAA,mBAAA,EACP,UAAU,CAAA;AAAA;AAAA,GAAA,CAAA;AAAA,EAG9B;AAGA,EAAA,MAAM,MAAA,GAAS,MAAM,aAAA,CAAc,cAAA;AAAA,IAClC,YAAA;AAAA,IACA,eAAA,CAAgB,EAAA;AAAA,IAChB,SAAA;AAAA,IACA,EAAE,QAAQ,GAAA;AAAK,GAChB;AAEA,EAAA,OAAO,MAAA,CAAO,QAAA;AACf;AASA,eAAsB,gBAAA,CACrB,KACA,eAAA,EACmB;AACnB,EAAA,MAAM,SAAA,GAAYA,IAAAA,CAAK,GAAA,EAAK,KAAA,EAAO,UAAU,CAAA;AAE7C,EAAA,IAAI,CAACQ,UAAAA,CAAW,SAAS,CAAA,EAAG;AAC3B,IAAA,MAAM,IAAI,MAAM,wBAAwB,CAAA;AAAA,EACzC;AAEA,EAAA,MAAM,aAAA,GAAgB,IAAI,aAAA,EAAc;AAGxC,EAAA,MAAM,SAAA,GAAY,MAAM,aAAA,CAAc,SAAA;AAAA,IACrC,SAAA;AAAA,IACA,eAAA,CAAgB;AAAA,GACjB;AACA,EAAA,IAAI,CAAC,SAAA,EAAW;AACf,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAGA,EAAA,MAAM,WAAA,GAAc,MAAMN,QAAAA,CAAS,SAAA,EAAW,OAAO,CAAA;AAGrD,EAAA,MAAM,SAAS,eAAA,CAAgB,OAAA;AAC/B,EAAA,MAAM,QAAA,GAAW,WAAA,CAAY,OAAA,CAAQ,MAAA,CAAO,WAAW,CAAA;AACvD,EAAA,MAAM,MAAA,GAAS,WAAA,CAAY,OAAA,CAAQ,MAAA,CAAO,SAAS,CAAA;AAEnD,EAAA,IAAI,QAAA,KAAa,EAAA,IAAM,MAAA,KAAW,EAAA,EAAI;AACrC,IAAA,MAAM,IAAI,MAAM,0CAA0C,CAAA;AAAA,EAC3D;AAEA,EAAA,MAAM,cAAA,GAAiB,YACrB,KAAA,CAAM,QAAA,GAAW,OAAO,WAAA,CAAY,MAAA,EAAQ,MAAM,CAAA,CAClD,IAAA,EAAK;AAGP,EAAA,IAAI,cAAA,CAAe,QAAA,CAAS,eAAA,CAAgB,IAAA,EAAM,CAAA,EAAG;AACpD,IAAA,OAAO,KAAA;AAAA,EACR;AAGA,EAAA,IAAI,UAAA;AACJ,EAAA,IAAI,cAAA,KAAmB,EAAA,IAAM,cAAA,CAAe,UAAA,CAAW,IAAI,CAAA,EAAG;AAE7D,IAAA,UAAA,GAAa,eAAA;AAAA,EACd,CAAA,MAAO;AAEN,IAAA,UAAA,GAAa,iBAAiB,IAAA,GAAO,eAAA;AAAA,EACtC;AAGA,EAAA,MAAM,MAAA,GAAS,MAAM,aAAA,CAAc,cAAA;AAAA,IAClC,SAAA;AAAA,IACA,eAAA,CAAgB,OAAA;AAAA,IAChB,UAAA;AAAA,IACA,EAAE,OAAO,IAAA;AAAK,GACf;AAEA,EAAA,OAAO,MAAA,CAAO,QAAA;AACf;;;ACrPA,IAAMkB,UAAAA,GAAYC,UAAUC,IAAI,CAAA;AAKhC,SAASC,aAAY,GAAA,EAAqB;AACzC,EAAA,OAAO,GAAA,CAAI,WAAA,EAAY,CAAE,OAAA,CAAQ,MAAM,GAAG,CAAA;AAC3C;AAKA,SAAS,YAAY,GAAA,EAAqB;AACzC,EAAA,MAAM,KAAA,GAAQA,aAAY,GAAG,CAAA;AAC7B,EAAA,OAAO,KAAA,CAAM,QAAQ,WAAA,EAAa,CAAC,GAAG,MAAA,KAAW,MAAA,CAAO,aAAa,CAAA;AACtE;AAKA,SAASC,cAAa,GAAA,EAAqB;AAC1C,EAAA,MAAM,KAAA,GAAQ,YAAY,GAAG,CAAA;AAC7B,EAAA,OAAO,KAAA,CAAM,OAAO,CAAC,CAAA,CAAE,aAAY,GAAI,KAAA,CAAM,MAAM,CAAC,CAAA;AACrD;AAQO,IAAM,0BAAN,MAEP;AAAA,EACS,SAAA,GAAY,IAAI,gBAAA,EAAiB;AAAA,EACjC,eAAA,GAAkB,IAAI,sBAAA,EAAuB;AAAA;AAAA;AAAA;AAAA,EAKrD,MAAM,QAAA,CAAS,GAAA,EAAa,MAAA,EAA8C;AACzE,IAAA,MAAM,IAAA,CAAK,SAAA,CAAU,qBAAA,CAAsB,GAAA,EAAK,MAAM,CAAA;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,MAAM,QACL,OAAA,EACgB;AAChB,IAAA,MAAM,EAAE,GAAA,EAAK,MAAA,EAAQ,MAAA,EAAO,GAAI,OAAA;AAGhC,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,oBAAA,CAAqB,MAAM,CAAA;AAGrD,IAAA,IAAI,CAAC,OAAO,UAAA,EAAY;AACvB,MAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,eAAA,CAAgB,gBAAA;AAAA,QAC7C,GAAA;AAAA,QACA,MAAA,CAAO,WAAA;AAAA,QACP;AAAA,OACD;AACA,MAAA,MAAA,CAAO,UAAA,GAAa,UAAA;AACpB,MAAA,MAAA,CAAO,YAAA,CAAa,KAAK,UAAU,CAAA;AAAA,IACpC;AAGA,IAAA,MAAM,IAAA,CAAK,oBAAA,CAAqB,GAAA,EAAK,MAAA,EAAQ,MAAM,CAAA;AAGnD,IAAA,IAAI,CAAC,OAAO,UAAA,EAAY;AACvB,MAAA,MAAM,eAAA,GAAkB,KAAK,eAAA,CAAgB,uBAAA;AAAA,QAC5C,YAAA,CAAa,iBAAA;AAAA,QACb,MAAA,CAAO,WAAA;AAAA,QACP,YAAA,CAAa;AAAA,OACd;AAEA,MAAA,MAAM,WAAA,GAAc,MAAM,gBAAA,CAAiB,GAAA,EAAK,eAAe,CAAA;AAC/D,MAAA,IAAI,WAAA,EAAa;AAChB,QAAA,MAAA,CAAO,aAAA,CAAc,IAAA,CAAK,CAAA,EAAG,GAAG,CAAA,aAAA,CAAe,CAAA;AAAA,MAChD;AAAA,IACD;AAGA,IAAA,IAAI,CAAC,OAAO,WAAA,EAAa;AACxB,MAAA,MAAM,IAAA,CAAK,YAAA,CAAa,GAAA,EAAK,MAAM,CAAA;AAAA,IACpC;AAGA,IAAA,MAAA,CAAO,SAAA,GAAY,IAAA,CAAK,iBAAA,CAAkB,MAAA,EAAQ,MAAM,CAAA;AAExD,IAAA,MAAA,CAAO,OAAA,GAAU,IAAA;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAuB;AACtB,IAAA,OAAO,IAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAsC;AACrC,IAAA,OAAO;AAAA,MACN,OAAA,EAAS,KAAA;AAAA,MACT,WAAA,EAAa,IAAA;AAAA;AAAA,MACb,WAAA,EAAa,EAAA;AAAA;AAAA,MACb,cAAc,EAAC;AAAA,MACf,eAAe,EAAC;AAAA,MAChB,WAAW,EAAC;AAAA,MACZ,UAAU;AAAC,KACZ;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKQ,qBACP,MAAA,EACsB;AACtB,IAAA,MAAM,SAAA,GAAYD,YAAAA,CAAY,MAAA,CAAO,WAAW,CAAA;AAChD,IAAA,MAAM,UAAA,GAAaC,aAAAA,CAAa,MAAA,CAAO,WAAW,CAAA;AAClD,IAAA,MAAM,SAAA,GAAY,WAAA,CAAY,MAAA,CAAO,WAAW,CAAA;AAGhD,IAAA,MAAM,UAAA,GAAa,MAAA,CAAO,WAAA,CAAY,WAAA,EAAY;AAElD,IAAA,MAAM,IAAA,GAA4B;AAAA,MACjC,cAAc,MAAA,CAAO,WAAA;AAAA,MACrB,iBAAA,EAAmB,CAAA,EAAG,UAAU,CAAA,EAAG,UAAU,CAAA,CAAA;AAAA,MAC7C,UAAA,EAAY,SAAA;AAAA,MACZ,UAAA,EAAY,SAAA;AAAA,MACZ,WAAA,EAAa;AAAA,KACd;AAGA,IAAA,IAAI,MAAA,CAAO,gBAAgB,IAAA,EAAM;AAChC,MAAA,IAAA,CAAK,aAAA,GAAgB,OAAO,YAAA,IAAgB,SAAA;AAAA,IAC7C;AAEA,IAAA,IAAI,MAAA,CAAO,gBAAgB,IAAA,EAAM;AAChC,MAAA,IAAA,CAAK,WAAA,GAAc,OAAO,UAAA,IAAc,SAAA;AAAA,IACzC;AAEA,IAAA,OAAO,IAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAA,CACb,GAAA,EACA,MAAA,EACA,MAAA,EACgB;AAChB,IAAA,IAAI,QAAA,GAAW,KAAA;AAEf,IAAA,IAAI,MAAA,CAAO,gBAAgB,IAAA,EAAM;AAChC,MAAA,QAAA,GAAW,MAAM,YAAA,CAAa,GAAA,EAAK,MAAA,CAAO,WAAW,CAAA;AAAA,IACtD,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,IAAA,EAAM;AACvC,MAAA,MAAM,YAAA,GACL,MAAA,CAAO,YAAA,IAAgBD,YAAAA,CAAY,OAAO,WAAW,CAAA;AACtD,MAAA,QAAA,GAAW,MAAM,YAAA,CAAa,GAAA,EAAK,MAAA,CAAO,aAAa,YAAY,CAAA;AAAA,IACpE,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,IAAA,EAAM;AACvC,MAAA,MAAM,UAAA,GAAa,MAAA,CAAO,UAAA,IAAcA,YAAAA,CAAY,OAAO,WAAW,CAAA;AACtE,MAAA,QAAA,GAAW,MAAM,YAAA,CAAa,GAAA,EAAK,MAAA,CAAO,aAAa,UAAU,CAAA;AAAA,IAClE,CAAA,MAAO;AACN,MAAA,MAAM,IAAI,KAAA;AAAA,QACT,CAAA,cAAA,EAAiB,OAAO,WAAW,CAAA,wBAAA;AAAA,OACpC;AAAA,IACD;AAEA,IAAA,IAAI,QAAA,EAAU;AACb,MAAA,MAAA,CAAO,aAAA,CAAc,IAAA,CAAK,CAAA,EAAG,GAAG,CAAA,eAAA,CAAiB,CAAA;AAAA,IAClD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YAAA,CACb,GAAA,EACA,MAAA,EACgB;AAChB,IAAA,IAAI;AAEH,MAAA,MAAM,eAAA,GAAkB,GAAG,GAAG,CAAA,aAAA,CAAA;AAC9B,MAAA,IAAI,CAACf,UAAAA,CAAW,eAAe,CAAA,EAAG;AACjC,QAAA,MAAA,CAAO,QAAA,EAAU,KAAK,6CAA6C,CAAA;AACnE,QAAA;AAAA,MACD;AAGA,MAAA,MAAM,EAAE,MAAA,EAAQ,MAAA,EAAO,GAAI,MAAMY,WAAU,oBAAA,EAAsB;AAAA,QAChE,GAAA;AAAA,QACA,OAAA,EAAS;AAAA;AAAA,OACT,CAAA;AAED,MAAA,IAAI,MAAA,IAAU,CAAC,MAAA,CAAO,QAAA,CAAS,MAAM,CAAA,EAAG;AACvC,QAAA,MAAA,CAAO,QAAA,EAAU,IAAA,CAAK,CAAA,qBAAA,EAAwB,MAAM,CAAA,CAAE,CAAA;AAAA,MACvD;AAGA,MAAA,MAAM,gBAAA,GAAmB,GAAG,GAAG,CAAA,0BAAA,CAAA;AAC/B,MAAA,IAAIZ,UAAAA,CAAW,gBAAgB,CAAA,EAAG;AACjC,QAAA,MAAA,CAAO,aAAA,CAAc,KAAK,gBAAgB,CAAA;AAAA,MAC3C;AAAA,IACD,SAAS,KAAA,EAAO;AACf,MAAA,MAAA,CAAO,QAAA,EAAU,IAAA;AAAA,QAChB,6BAA6B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,oCAAA;AAAA,OACpF;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAA,CACP,QACA,MAAA,EACW;AACX,IAAA,MAAM,QAAkB,EAAC;AACzB,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,oBAAA,CAAqB,MAAM,CAAA;AAErD,IAAA,IAAI,MAAA,CAAO,gBAAgB,IAAA,EAAM;AAChC,MAAA,KAAA,CAAM,IAAA;AAAA,QACL,CAAA,uDAAA,EAA0D,OAAO,WAAW,CAAA;AAAA,OAC7E;AACA,MAAA,KAAA,CAAM,IAAA;AAAA,QACL;AAAA,OACD;AACA,MAAA,KAAA,CAAM,IAAA;AAAA,QACL,CAAA,2CAAA,EAA8C,YAAA,CAAa,iBAAiB,CAAA,KAAA,EAAQ,OAAO,WAAW,CAAA,CAAA;AAAA,OACvG;AAAA,IACD,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,IAAA,EAAM;AACvC,MAAA,MAAM,YAAA,GACL,MAAA,CAAO,YAAA,IAAgBe,YAAAA,CAAY,OAAO,WAAW,CAAA;AACtD,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA,4CAAA,EAA+C,YAAY,CAAA,CAAE,CAAA;AACxE,MAAA,KAAA,CAAM,IAAA;AAAA,QACL;AAAA,OACD;AACA,MAAA,KAAA,CAAM,IAAA;AAAA,QACL,8CAA8C,YAAY,CAAA,oBAAA;AAAA,OAC3D;AACA,MAAA,KAAA,CAAM,IAAA;AAAA,QACL,CAAA,2CAAA,EAA8C,YAAA,CAAa,iBAAiB,CAAA,KAAA,EAAQ,OAAO,WAAW,CAAA,CAAA;AAAA,OACvG;AAAA,IACD,CAAA,MAAA,IAAW,MAAA,CAAO,WAAA,KAAgB,IAAA,EAAM;AACvC,MAAA,MAAM,UAAA,GAAa,MAAA,CAAO,UAAA,IAAcA,YAAAA,CAAY,OAAO,WAAW,CAAA;AACtE,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA,kDAAA,EAAqD,UAAU,CAAA,CAAE,CAAA;AAC5E,MAAA,KAAA,CAAM,IAAA;AAAA,QACL,CAAA,2CAAA,EAA8C,YAAA,CAAa,iBAAiB,CAAA,KAAA,EAAQ,OAAO,WAAW,CAAA,CAAA;AAAA,OACvG;AACA,MAAA,KAAA,CAAM,IAAA;AAAA,QACL,CAAA,iEAAA;AAAA,OACD;AAAA,IACD;AAEA,IAAA,KAAA,CAAM,KAAK,wCAAwC,CAAA;AAEnD,IAAA,OAAO,KAAA;AAAA,EACR;AACD,CAAA;;;ACxRO,IAAM,oBAAN,MAAwB;AAAA,EACtB,YAAA;AAAA,EAIA,QAAA;AAAA,EAER,WAAA,GAAc;AACb,IAAA,IAAA,CAAK,YAAA,GAAe,IAAI,oBAAA,EAAqB;AAC7C,IAAA,IAAA,CAAK,QAAA,GAAW,IAAI,uBAAA,EAAwB;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,QAAA,CACL,GAAA,EACA,MAAA,EACiC;AAEjC,IAAA,MAAM,UAAA,GAAa,OAAO,UAAA,KAAe,IAAA;AAGzC,IAAA,IAAI;AACH,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,YAAA,CAAa,QAAA;AAAA,QACtC,GAAA;AAAA,QACA,MAAA;AAAA,QACA,IAAA,CAAK,QAAA;AAAA,QACL;AAAA,UACC,UAAA;AAAA,UACA,MAAA,EAAQ;AAAA;AACT,OACD;AAGA,MAAA,MAAA,CAAO,cAAc,MAAA,CAAO,WAAA;AAC5B,MAAA,MAAA,CAAO,cAAc,MAAA,CAAO,WAAA;AAE5B,MAAA,OAAO,MAAA;AAAA,IACR,SAAS,KAAA,EAAO;AAEf,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,QAAA,CAAS,YAAA,EAAa;AAC1C,MAAA,MAAA,CAAO,cAAc,MAAA,CAAO,WAAA;AAC5B,MAAA,MAAA,CAAO,cAAc,MAAA,CAAO,WAAA;AAC5B,MAAA,MAAA,CAAO,QAAQ,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAGpE,MAAA,IAAI,CAAC,UAAA,EAAY;AAChB,QAAA,MAAA,CAAO,QAAA,EAAU,KAAK,4CAA4C,CAAA;AAAA,MACnE;AAEA,MAAA,OAAO,MAAA;AAAA,IACR;AAAA,EACD;AACD,CAAA;;;AC7CA,SAAS,yBAAA,CACR,aACA,OAAA,EACO;AAEP,EAAA,MAAM,UAAA,GAA4B;AAAA,IACjC,IAAA;AAAA,IACA,IAAA;AAAA,IACA,IAAA;AAAA,IACA,QAAA;AAAA,IACA,IAAA;AAAA,IACA,WAAA;AAAA,IACA;AAAA,GACD;AACA,EAAA,IAAI,CAAC,UAAA,CAAW,QAAA,CAAS,WAA0B,CAAA,EAAG;AACrD,IAAA,MAAM,IAAI,KAAA;AAAA,MACT,yBAAyB,WAAW,CAAA,gBAAA,EAAmB,UAAA,CAAW,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,KAC7E;AAAA,EACD;AAGA,EAAA,IAAI,CAAC,eAAA,CAAgB,WAA0B,CAAA,EAAG;AACjD,IAAA,MAAM,IAAI,KAAA;AAAA,MACT,iBAAiB,WAAW,CAAA,oDAAA;AAAA,KAC7B;AAAA,EACD;AAGA,EAAA,IAAI,CAAC,QAAQ,IAAA,EAAM;AAClB,IAAA,MAAM,IAAI,MAAM,0CAA0C,CAAA;AAAA,EAC3D;AAGA,EAAA,IAAI,CAAC,mBAAA,CAAoB,IAAA,CAAK,OAAA,CAAQ,IAAI,CAAA,EAAG;AAC5C,IAAA,MAAM,IAAI,KAAA;AAAA,MACT,CAAA,iEAAA;AAAA,KACD;AAAA,EACD;AAMD;AAKA,eAAsB,UAAA,CACrB,aACA,OAAA,EACiC;AACjC,EAAA,MAAM,UAAA,GAAa,IAAI,iBAAA,EAAkB;AAEzC,EAAA,MAAM,MAAA,GAAgC;AAAA,IACrC,WAAA;AAAA,IACA,aAAa,OAAA,CAAQ,IAAA;AAAA,IACrB,cAAc,OAAA,CAAQ,QAAA;AAAA,IACtB,YAAY,OAAA,CAAQ,MAAA;AAAA,IACpB,YAAY,OAAA,CAAQ,UAAA;AAAA,IACpB,aAAa,OAAA,CAAQ;AAAA,GACtB;AAEA,EAAA,MAAM,MAAA,GAAS,MAAM,UAAA,CAAW,QAAA;AAAA,IAC/B,OAAA,CAAQ,GAAA,IAAO,OAAA,CAAQ,GAAA,EAAI;AAAA,IAC3B;AAAA,GACD;AAGA,EAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,IAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,EAC5C,CAAA,MAAO;AACN,IAAAE,0BAAyB,MAAM,CAAA;AAAA,EAChC;AAEA,EAAA,OAAO,MAAA;AACR;AAKA,SAASA,0BAAyB,MAAA,EAAqC;AACtE,EAAA,IAAI,OAAO,OAAA,EAAS;AACnB,IAAA,OAAA,CAAQ,GAAA;AAAA,MACP;AAAA,OAAA,EAAO,MAAA,CAAO,WAAA,CAAY,WAAA,EAAa,CAAA;AAAA;AAAA,KACxC;AAEA,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,SAAA,EAAY,MAAA,CAAO,WAAW,CAAA,CAAE,CAAA;AAC5C,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,MAAA,EAAS,MAAA,CAAO,WAAA,CAAY,aAAa;AAAA,CAAI,CAAA;AAEzD,IAAA,IAAI,OAAO,UAAA,EAAY;AACtB,MAAA,OAAA,CAAQ,IAAI,eAAe,CAAA;AAC3B,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,MAAA,CAAO,UAAU;AAAA,CAAI,CAAA;AAAA,IACzC;AAEA,IAAA,IAAI,MAAA,CAAO,YAAA,CAAa,MAAA,GAAS,CAAA,EAAG;AACnC,MAAA,OAAA,CAAQ,IAAI,gBAAgB,CAAA;AAC5B,MAAA,KAAA,MAAW,IAAA,IAAQ,OAAO,YAAA,EAAc;AACvC,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,IAAI,CAAA,CAAE,CAAA;AAAA,MAC1B;AACA,MAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,IACb;AAEA,IAAA,IAAI,MAAA,CAAO,aAAA,CAAc,MAAA,GAAS,CAAA,EAAG;AACpC,MAAA,OAAA,CAAQ,IAAI,iBAAiB,CAAA;AAC7B,MAAA,KAAA,MAAW,IAAA,IAAQ,OAAO,aAAA,EAAe;AACxC,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,IAAA,EAAO,IAAI,CAAA,CAAE,CAAA;AAAA,MAC1B;AACA,MAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,IACb;AAEA,IAAA,IAAI,MAAA,CAAO,QAAA,IAAY,MAAA,CAAO,QAAA,CAAS,SAAS,CAAA,EAAG;AAClD,MAAA,OAAA,CAAQ,IAAI,yBAAe,CAAA;AAC3B,MAAA,KAAA,MAAW,OAAA,IAAW,OAAO,QAAA,EAAU;AACtC,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAA,EAAK,OAAO,CAAA,CAAE,CAAA;AAAA,MAC3B;AACA,MAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,IACb;AAEA,IAAA,IAAI,MAAA,CAAO,SAAA,CAAU,MAAA,GAAS,CAAA,EAAG;AAChC,MAAA,OAAA,CAAQ,IAAI,aAAa,CAAA;AACzB,MAAA,KAAA,MAAW,IAAA,IAAQ,OAAO,SAAA,EAAW;AACpC,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAA,EAAK,IAAI,CAAA,CAAE,CAAA;AAAA,MACxB;AACA,MAAA,OAAA,CAAQ,GAAA,EAAI;AAAA,IACb;AAAA,EACD,CAAA,MAAO;AACN,IAAA,OAAA,CAAQ,MAAM,kCAA6B,CAAA;AAC3C,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,OAAA,EAAU,MAAA,CAAO,KAAA,IAAS,eAAe;AAAA,CAAI,CAAA;AAE3D,IAAA,IAAI,MAAA,CAAO,QAAA,IAAY,MAAA,CAAO,QAAA,CAAS,SAAS,CAAA,EAAG;AAClD,MAAA,OAAA,CAAQ,MAAM,WAAW,CAAA;AACzB,MAAA,KAAA,MAAW,OAAA,IAAW,OAAO,QAAA,EAAU;AACtC,QAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAA,EAAK,OAAO,CAAA,CAAE,CAAA;AAAA,MAC7B;AACA,MAAA,OAAA,CAAQ,KAAA,EAAM;AAAA,IACf;AAEA,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EACf;AACD;AAKO,SAAS,uBAAA,GAAmC;AAClD,EAAA,MAAM,OAAA,GAAU,IAAInB,OAAAA,CAAQ,SAAS,EACnC,WAAA,CAAY,mEAAmE,CAAA,CAC/E,QAAA,CAAS,UAAU,6BAA6B,CAAA,CAChD,cAAA,CAAe,eAAA,EAAiB,kCAAkC,CAAA,CAClE,MAAA;AAAA,IACA,mBAAA;AAAA,IACA;AAAA,GACD,CACC,MAAA;AAAA,IACA,iBAAA;AAAA,IACA;AAAA,GACD,CACC,MAAA,CAAO,eAAA,EAAiB,8BAA8B,CAAA,CACtD,MAAA,CAAO,gBAAA,EAAkB,yBAAyB,CAAA,CAClD,MAAA,CAAO,QAAA,EAAU,uBAAuB,CAAA,CACxC,MAAA;AAAA,IACA,OAAO,aAAqB,OAAA,KAAsC;AACjE,MAAA,IAAI;AAEH,QAAA,yBAAA,CAA0B,aAAa,OAAO,CAAA;AAG9C,QAAA,MAAM,UAAA,CAAW,aAAkC,OAAO,CAAA;AAAA,MAC3D,SAAS,KAAA,EAAO;AACf,QAAA,MAAM,eACL,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAEtD,QAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,UAAA,MAAM,MAAA,GAAgC;AAAA,YACrC,OAAA,EAAS,KAAA;AAAA,YACT,WAAA;AAAA,YACA,WAAA,EAAa,QAAQ,IAAA,IAAQ,SAAA;AAAA,YAC7B,cAAc,EAAC;AAAA,YACf,eAAe,EAAC;AAAA,YAChB,WAAW,EAAC;AAAA,YACZ,KAAA,EAAO;AAAA,WACR;AACA,UAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,QAC5C,CAAA,MAAO;AACN,UAAA,OAAA,CAAQ,KAAA,CAAM;AAAA,cAAA,EAAc,YAAY;AAAA,CAAI,CAAA;AAAA,QAC7C;AACA,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MACf;AAAA,IACD;AAAA,GACD;AAED,EAAA,OAAO,OAAA;AACR;;;ACnMO,SAAS,oBAAA,GAAgC;AAC/C,EAAA,MAAM,OAAA,GAAU,IAAIA,OAAAA,CAAQ,MAAM,CAAA,CAChC,WAAA,CAAY,mCAAmC,CAAA,CAC/C,QAAA,CAAS,QAAA,EAAU,oCAAoC,CAAA,CACvD,MAAA;AAAA,IACA,sBAAA;AAAA,IACA,kBAAA;AAAA,IACA;AAAA,GACD,CACC,OAAO,YAAA,EAAc,2BAA2B,EAChD,MAAA,CAAO,eAAA,EAAiB,iCAAiC,CAAA,CACzD,MAAA;AAAA,IACA,mBAAA;AAAA,IACA,uCAAA;AAAA,IACA;AAAA,GACD,CACC,OAAO,QAAA,EAAU,uBAAuB,EACxC,MAAA,CAAO,OAAO,MAAc,OAAA,KAA4B;AACxD,IAAA,IAAI;AACH,MAAA,MAAM,GAAA,GAAM,QAAQ,GAAA,EAAI;AACxB,MAAA,MAAM,UAAA,GAAa,IAAI,gBAAA,EAAiB;AAGxC,MAAA,MAAM,MAAA,GAAyB;AAAA,QAC9B,UAAA,EAAY,MAAA;AAAA,QACZ,IAAA;AAAA,QACA,aAAa,OAAA,CAAQ,WAAA;AAAA,QACrB,eAAe,OAAA,CAAQ,KAAA;AAAA,QACvB,cAAc,OAAA,CAAQ;AAAA,OACvB;AAGA,MAAA,MAAM,cAAA,GAAiB,MAAM,UAAA,CAAW,QAAA,CAAS,KAAK,MAAM,CAAA;AAG5D,MAAA,MAAM,MAAA,GAA0B;AAAA,QAC/B,SAAS,cAAA,CAAe,OAAA;AAAA,QACxB,UAAA,EAAY,MAAA;AAAA,QACZ,UAAA,EAAY,IAAA;AAAA,QACZ,cAAc,cAAA,CAAe,YAAA;AAAA,QAC7B,YAAY,cAAA,CAAe,UAAA;AAAA,QAC3B,OAAA,EAAS,SAAS,IAAI,CAAA,sBAAA;AAAA,OACvB;AAGA,MAAA,YAAA,CAAa,QAAQ,CAAC,CAAC,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAA,KAAM;AAC3C,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,uBAAA,EAAqB,IAAI;AAAA,CAAI,CAAA;AAEzC,QAAA,KAAA,MAAW,IAAA,IAAQ,EAAE,YAAA,EAAc;AAClC,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,eAAA,EAAa,IAAI,CAAA,CAAE,CAAA;AAAA,QAChC;AAEA,QAAA,IAAI,EAAE,UAAA,EAAY;AACjB,UAAA,OAAA,CAAQ,IAAI,CAAA,iCAAA,CAA8B,CAAA;AAAA,QAC3C;AAEA,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,aAAA,EAAa,IAAI,CAAA;AAAA,CAA2B,CAAA;AACxD,QAAA,OAAA,CAAQ,IAAI,aAAa,CAAA;AACzB,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,oBAAA,EAAuB,IAAI,CAAA,4BAAA,CAA8B,CAAA;AACrE,QAAA,OAAA,CAAQ,IAAI,CAAA,wCAAA,CAA0C,CAAA;AACtD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA;AAAA,CAAuD,CAAA;AAAA,MACpE,CAAC,CAAA;AAAA,IACF,SAAS,KAAA,EAAO;AACf,MAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAE1E,MAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,QAAA,MAAM,MAAA,GAA0B;AAAA,UAC/B,OAAA,EAAS,KAAA;AAAA,UACT,UAAA,EAAY,MAAA;AAAA,UACZ,UAAA,EAAY,IAAA;AAAA,UACZ,cAAc,EAAC;AAAA,UACf,UAAA,EAAY,KAAA;AAAA,UACZ,KAAA,EAAO;AAAA,SACR;AACA,QAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAA,MAAO;AACN,QAAA,OAAA,CAAQ,KAAA,CAAM;AAAA,cAAA,EAAc,YAAY;AAAA,CAAI,CAAA;AAAA,MAC7C;AACA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AAEF,EAAA,OAAO,OAAA;AACR;AAKO,SAAS,gBAAA,GAA4B;AAC3C,EAAA,MAAM,MAAA,GAAS,IAAIA,OAAAA,CAAQ,KAAK,CAAA,CAAE,WAAA;AAAA,IACjC;AAAA,GACD;AAEA,EAAA,MAAA,CAAO,UAAA,CAAW,sBAAsB,CAAA;AACxC,EAAA,MAAA,CAAO,UAAA,CAAW,wBAAwB,CAAA;AAC1C,EAAA,MAAA,CAAO,UAAA,CAAW,0BAA0B,CAAA;AAC5C,EAAA,MAAA,CAAO,UAAA,CAAW,sBAAsB,CAAA;AACxC,EAAA,MAAA,CAAO,UAAA,CAAW,yBAAyB,CAAA;AAE3C,EAAA,OAAO,MAAA;AACR;ACjHA,IAAM,UAAA,GAAaF,aAAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAC9BC,cAAAA,CAAK,OAAA,CAAQ,UAAU;AAyDlC,SAASqB,sBAAAA,GAAiC;AAChD,EAAA,OAAO,IAAIpB,QAAQ,UAAU,CAAA,CAC3B,YAAY,yDAAyD,CAAA,CACrE,OAAO,OAAA,EAAS,yCAAyC,EACzD,MAAA,CAAO,UAAA,EAAY,oCAAoC,CAAA,CACvD,MAAA,CAAO,UAAU,uBAAuB,CAAA,CACxC,MAAA,CAAO,OAAO,OAAA,KAAY;AAC1B,IAAA,MAAM,GAAA,GAAM,QAAQ,GAAA,EAAI;AAExB,IAAA,MAAM,MAAA,GAAS,MAAM,eAAA,CAAgB,GAAA,EAAK,OAAO,CAAA;AAGjD,IAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,MAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,IAC5C,CAAA,MAAO;AACN,MAAA,OAAA,CAAQ,IAAI,8CAAuC,CAAA;AACnD,MAAA,sBAAA,CAAuB,MAAM,CAAA;AAAA,IAC9B;AAGA,IAAA,IAAI,CAAC,OAAO,MAAA,EAAQ;AACnB,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IACf;AAAA,EACD,CAAC,CAAA;AACH;AAKA,eAAsB,eAAA,CACrB,GAAA,EACA,OAAA,GAA+C,EAAC,EACpB;AAC5B,EAAA,MAAM,SAA4B,EAAC;AAGnC,EAAA,MAAM,YAAA,GAAeD,cAAAA,CAAK,IAAA,CAAK,GAAA,EAAK,oBAAoB,CAAA;AACxD,EAAA,IAAI,QAAA,GAAuC,IAAA;AAE3C,EAAA,IAAI;AACH,IAAA,MAAM,eAAA,GAAkB,MAAM,EAAA,CAAG,QAAA,CAAS,cAAc,OAAO,CAAA;AAC/D,IAAA,QAAA,GAAW,IAAA,CAAK,MAAM,eAAe,CAAA;AAAA,EACtC,SAAS,KAAA,EAAO;AACf,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,QAAA,EAAU,OAAA;AAAA,MACV,QAAA,EAAU,UAAA;AAAA,MACV,OAAA,EAAS,yCAAA;AAAA,MACT,IAAA,EAAM,oBAAA;AAAA,MACN,UAAA,EAAY;AAAA,KACZ,CAAA;AACD,IAAA,OAAO,aAAa,MAAM,CAAA;AAAA,EAC3B;AAGA,EAAA,MAAM,QAAA,GAAWA,cAAAA,CAAK,IAAA,CAAK,GAAA,EAAK,OAAO,OAAO,CAAA;AAC9C,EAAA,MAAM,WAAA,GAAc,MAAM,aAAA,CAAc,QAAQ,CAAA;AAGhD,EAAA,MAAM,SAAA,GAAYA,cAAAA,CAAK,IAAA,CAAK,GAAA,EAAK,OAAO,UAAU,CAAA;AAClD,EAAA,MAAM,eAAA,GAAkB,MAAM,sBAAA,CAAuB,SAAS,CAAA;AAG9D,EAAA,KAAA,MAAW,YAAY,WAAA,EAAa;AACnC,IAAA,MAAM,WAAWA,cAAAA,CAAK,QAAA,CAAS,UAAUA,cAAAA,CAAK,OAAA,CAAQ,QAAQ,CAAC,CAAA;AAG/D,IAAA,IAAI,QAAA,CAAS,UAAA,CAAW,UAAU,CAAA,EAAG;AACpC,MAAA;AAAA,IACD;AAGA,IAAA,MAAM,YAAA,GAAe,eAAA,CAAgB,QAAA,CAAS,QAAQ,CAAA;AACtD,IAAA,IAAI,CAAC,YAAA,EAAc;AAElB,MAAA,MAAM,UAAA,GAAa,QAAA,CACjB,KAAA,CAAM,GAAG,CAAA,CACT,GAAA,CAAI,CAAC,IAAA,KAAS,UAAA,CAAW,IAAI,CAAC,CAAA,CAC9B,KAAK,EAAE,CAAA;AACT,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,cAAA;AAAA,QACV,OAAA,EAAS,SAAS,QAAQ,CAAA,mCAAA,CAAA;AAAA,QAC1B,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY,CAAA,sBAAA,EAAyB,UAAU,CAAA,qBAAA,EAAwB,QAAQ,CAAA;AAAA,QAAA,EAAkB,UAAU,CAAA,kBAAA;AAAA,OAC3G,CAAA;AAAA,IACF;AAGA,IAAA,MAAM,eAAeA,cAAAA,CAAK,IAAA;AAAA,MACzB,GAAA;AAAA,MACA,MAAA;AAAA,MACA,MAAA;AAAA,MACA,OAAA;AAAA,MACA,GAAG,QAAQ,CAAA,QAAA;AAAA,KACZ;AACA,IAAA,MAAM,WAAA,GAAc,MAAMsB,WAAAA,CAAW,YAAY,CAAA;AACjD,IAAA,IAAI,CAAC,WAAA,EAAa;AACjB,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,SAAA;AAAA,QACV,QAAA,EAAU,SAAA;AAAA,QACV,OAAA,EAAS,SAAS,QAAQ,CAAA,sBAAA,CAAA;AAAA,QAC1B,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY,0BAA0B,QAAQ,CAAA,QAAA;AAAA,OAC9C,CAAA;AAAA,IACF;AAGA,IAAA,MAAM,sBAAsBtB,cAAAA,CAAK,IAAA;AAAA,MAChC,GAAA;AAAA,MACA,MAAA;AAAA,MACA,aAAA;AAAA,MACA,OAAA;AAAA,MACA,GAAG,QAAQ,CAAA,KAAA;AAAA,KACZ;AACA,IAAA,MAAM,kBAAA,GAAqB,MAAMsB,WAAAA,CAAW,mBAAmB,CAAA;AAC/D,IAAA,IAAI,CAAC,kBAAA,EAAoB;AACxB,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,SAAA;AAAA,QACV,QAAA,EAAU,SAAA;AAAA,QACV,OAAA,EAAS,SAAS,QAAQ,CAAA,6BAAA,CAAA;AAAA,QAC1B,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY,iCAAiC,QAAQ,CAAA,KAAA;AAAA,OACrD,CAAA;AAAA,IACF;AAGA,IAAA,IAAI,kBAAA,EAAoB;AACvB,MAAA,MAAM,UAAA,GAAa,MAAM,YAAA,CAAa,mBAAA,EAAqB,QAAQ,CAAA;AACnE,MAAA,MAAA,CAAO,IAAA,CAAK,GAAG,UAAU,CAAA;AAAA,IAC1B;AAAA,EACD;AAGA,EAAA,KAAA,MAAW,kBAAkB,eAAA,EAAiB;AAC7C,IAAA,MAAM,QAAA,GAAW,WAAA,CAAY,IAAA,CAAK,CAAC,CAAA,KAAM;AACxC,MAAA,MAAM,WAAWtB,cAAAA,CAAK,QAAA,CAAS,GAAGA,cAAAA,CAAK,OAAA,CAAQ,CAAC,CAAC,CAAA;AACjD,MAAA,OAAO,QAAA,KAAa,cAAA;AAAA,IACrB,CAAC,CAAA;AACD,IAAA,IAAI,CAAC,QAAA,EAAU;AACd,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,cAAA;AAAA,QACV,OAAA,EAAS,SAAS,cAAc,CAAA,sCAAA,CAAA;AAAA,QAChC,IAAA,EAAM,cAAA;AAAA,QACN,UAAA,EAAY,2CAA2C,cAAc,CAAA,GAAA;AAAA,OACrE,CAAA;AAAA,IACF;AAAA,EACD;AAGA,EAAA,MAAM,YAAA,GAAe,MAAM,qBAAA,CAAsB,GAAG,CAAA;AACpD,EAAA,MAAA,CAAO,IAAA,CAAK,GAAG,YAAY,CAAA;AAG3B,EAAA,IAAI,QAAA,EAAU;AACb,IAAA,MAAM,iBAAiB,MAAM,gBAAA;AAAA,MAC5B,QAAA;AAAA,MACA,WAAA;AAAA,MACA,eAAA;AAAA,MACA;AAAA,KACD;AACA,IAAA,MAAA,CAAO,IAAA,CAAK,GAAG,cAAc,CAAA;AAAA,EAC9B;AAEA,EAAA,OAAO,YAAA,CAAa,MAAA,EAAQ,OAAA,CAAQ,MAAM,CAAA;AAC3C;AAKA,eAAe,cAAc,QAAA,EAAqC;AACjE,EAAA,IAAI;AACH,IAAA,MAAM,KAAA,GAAQ,MAAM,EAAA,CAAG,OAAA,CAAQ,QAAQ,CAAA;AACvC,IAAA,OAAO,KAAA,CACL,OAAO,CAAC,CAAA,KAAM,EAAE,QAAA,CAAS,KAAK,KAAK,CAAC,CAAA,CAAE,SAAS,UAAU,CAAC,EAC1D,GAAA,CAAI,CAAC,MAAMA,cAAAA,CAAK,IAAA,CAAK,QAAA,EAAU,CAAC,CAAC,CAAA;AAAA,EACpC,SAAS,KAAA,EAAO;AACf,IAAA,OAAO,EAAC;AAAA,EACT;AACD;AAKA,eAAe,uBAAuB,SAAA,EAAsC;AAC3E,EAAA,IAAI;AACH,IAAA,MAAM,OAAA,GAAU,MAAM,EAAA,CAAG,QAAA,CAAS,WAAW,OAAO,CAAA;AACpD,IAAA,MAAM,aAAuB,EAAC;AAG9B,IAAA,MAAM,aAAA,GAAgB,oCAAA;AACtB,IAAA,IAAI,KAAA;AAEJ,IAAA,OAAA,CAAQ,KAAA,GAAQ,aAAA,CAAc,IAAA,CAAK,OAAO,OAAO,IAAA,EAAM;AACtD,MAAA,MAAM,QAAA,GAAW,WAAA,CAAY,KAAA,CAAM,CAAC,CAAC,CAAA;AACrC,MAAA,UAAA,CAAW,KAAK,QAAQ,CAAA;AAAA,IACzB;AAEA,IAAA,OAAO,UAAA;AAAA,EACR,SAAS,KAAA,EAAO;AACf,IAAA,OAAO,EAAC;AAAA,EACT;AACD;AAKA,eAAe,YAAA,CACd,UACA,QAAA,EAC6B;AAC7B,EAAA,MAAM,SAA4B,EAAC;AAEnC,EAAA,IAAI;AACH,IAAA,MAAM,OAAA,GAAU,MAAM,EAAA,CAAG,QAAA,CAAS,UAAU,OAAO,CAAA;AACnD,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAG/B,IAAA,IAAI,CAAC,KAAK,IAAA,EAAM;AACf,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,MAAA;AAAA,QACV,OAAA,EAAS,yBAAyB,QAAQ,CAAA,yBAAA,CAAA;AAAA,QAC1C,IAAA,EAAM;AAAA,OACN,CAAA;AAAA,IACF;AAEA,IAAA,IAAI,CAAC,KAAK,IAAA,EAAM;AACf,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,MAAA;AAAA,QACV,OAAA,EAAS,yBAAyB,QAAQ,CAAA,yBAAA,CAAA;AAAA,QAC1C,IAAA,EAAM;AAAA,OACN,CAAA;AAAA,IACF;AAEA,IAAA,IAAI,CAAC,KAAK,UAAA,IAAc,CAAC,MAAM,OAAA,CAAQ,IAAA,CAAK,UAAU,CAAA,EAAG;AACxD,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,MAAA;AAAA,QACV,OAAA,EAAS,yBAAyB,QAAQ,CAAA,+BAAA,CAAA;AAAA,QAC1C,IAAA,EAAM;AAAA,OACN,CAAA;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,IAAA,IAAQ,IAAA,CAAK,IAAA,KAAS,QAAA,EAAU;AACxC,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,SAAA;AAAA,QACV,QAAA,EAAU,MAAA;AAAA,QACV,OAAA,EAAS,CAAA,4BAAA,EAA+B,IAAA,CAAK,IAAI,8BAA8B,QAAQ,CAAA,CAAA,CAAA;AAAA,QACvF,IAAA,EAAM;AAAA,OACN,CAAA;AAAA,IACF;AAAA,EACD,SAAS,KAAA,EAAO;AACf,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,QAAA,EAAU,OAAA;AAAA,MACV,QAAA,EAAU,MAAA;AAAA,MACV,OAAA,EAAS,CAAA,sBAAA,EAAyB,QAAQ,CAAA,oBAAA,EAAuB,KAAA,YAAiB,QAAQ,KAAA,CAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAA;AAAA,MACvH,IAAA,EAAM;AAAA,KACN,CAAA;AAAA,EACF;AAEA,EAAA,OAAO,MAAA;AACR;AAKA,eAAe,sBAAsB,GAAA,EAAyC;AAC7E,EAAA,MAAM,SAA4B,EAAC;AAGnC,EAAA,MAAM,iBAAA,GAAoBA,cAAAA,CAAK,IAAA,CAAK,GAAA,EAAK,gBAAgB,CAAA;AACzD,EAAA,MAAM,gBAAA,GAAmBA,cAAAA,CAAK,IAAA,CAAK,GAAA,EAAK,eAAe,CAAA;AAEvD,EAAA,IAAI,YAAA,GAA8B,IAAA;AAClC,EAAA,IAAI,MAAMsB,WAAAA,CAAW,iBAAiB,CAAA,EAAG;AACxC,IAAA,YAAA,GAAe,iBAAA;AAAA,EAChB,CAAA,MAAA,IAAW,MAAMA,WAAAA,CAAW,gBAAgB,CAAA,EAAG;AAC9C,IAAA,YAAA,GAAe,gBAAA;AAAA,EAChB;AAEA,EAAA,IAAI,CAAC,YAAA,EAAc;AAClB,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,QAAA,EAAU,OAAA;AAAA,MACV,QAAA,EAAU,eAAA;AAAA,MACV,OAAA,EAAS,2CAAA;AAAA,MACT,UAAA,EACC;AAAA,KACD,CAAA;AACD,IAAA,OAAO,MAAA;AAAA,EACR;AAGA,EAAA,IAAI,MAAA;AACJ,EAAA,IAAI;AACH,IAAA,MAAM,OAAA,GAAU,MAAM,EAAA,CAAG,QAAA,CAAS,cAAc,OAAO,CAAA;AAEvD,IAAA,MAAM,WAAA,GAAc,QAClB,OAAA,CAAQ,mBAAA,EAAqB,EAAE,CAAA,CAC/B,OAAA,CAAQ,WAAW,EAAE,CAAA;AACvB,IAAA,MAAA,GAAS,IAAA,CAAK,MAAM,WAAW,CAAA;AAAA,EAChC,SAAS,KAAA,EAAO;AACf,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,QAAA,EAAU,OAAA;AAAA,MACV,QAAA,EAAU,eAAA;AAAA,MACV,OAAA,EAAS,CAAA,gBAAA,EAAmBtB,cAAAA,CAAK,QAAA,CAAS,YAAY,CAAC,CAAA,EAAA,EAAK,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAA;AAAA,MAClH,IAAA,EAAM,YAAA;AAAA,MACN,UAAA,EAAY;AAAA,KACZ,CAAA;AACD,IAAA,OAAO,MAAA;AAAA,EACR;AAGA,EAAA,MAAM,cAAA,GAAiB,CAAC,MAAA,EAAQ,MAAA,EAAQ,oBAAoB,CAAA;AAC5D,EAAA,KAAA,MAAW,SAAS,cAAA,EAAgB;AACnC,IAAA,IAAI,CAAC,MAAA,CAAO,KAAK,CAAA,EAAG;AACnB,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,eAAA;AAAA,QACV,SAAS,CAAA,wBAAA,EAA2B,KAAK,QAAQA,cAAAA,CAAK,QAAA,CAAS,YAAY,CAAC,CAAA,CAAA;AAAA,QAC5E,IAAA,EAAM;AAAA,OACN,CAAA;AAAA,IACF;AAAA,EACD;AAGA,EAAA,IAAI,CAAC,OAAO,eAAA,EAAiB;AAC5B,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,QAAA,EAAU,OAAA;AAAA,MACV,QAAA,EAAU,eAAA;AAAA,MACV,OAAA,EAAS,yCAAA;AAAA,MACT,IAAA,EAAM,YAAA;AAAA,MACN,UAAA,EACC;AAAA,KACD,CAAA;AAAA,EACF,CAAA,MAAO;AACN,IAAA,MAAM,iBAAiB,MAAA,CAAO,eAAA;AAC9B,IAAA,MAAM,WAAW,cAAA,CAAe,QAAA;AAEhC,IAAA,IAAI,CAAC,QAAA,IAAY,CAAC,KAAA,CAAM,OAAA,CAAQ,QAAQ,CAAA,EAAG;AAC1C,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,eAAA;AAAA,QACV,OAAA,EAAS,2CAAA;AAAA,QACT,IAAA,EAAM;AAAA,OACN,CAAA;AAAA,IACF,CAAA,MAAO;AAEN,MAAA,MAAM,aAAa,QAAA,CAAS,IAAA;AAAA,QAC3B,CAAC,CAAA,KAAM,CAAA,CAAE,IAAA,KAAS;AAAA,OACnB;AACA,MAAA,IAAI,CAAC,UAAA,EAAY;AAChB,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACX,QAAA,EAAU,OAAA;AAAA,UACV,QAAA,EAAU,eAAA;AAAA,UACV,OAAA,EACC,0DAAA;AAAA,UACD,IAAA,EAAM,YAAA;AAAA,UACN,UAAA,EACC;AAAA,SACD,CAAA;AAAA,MACF,CAAA,MAAO;AAEN,QAAA,IAAI,CAAC,WAAW,UAAA,EAAY;AAC3B,UAAA,MAAA,CAAO,IAAA,CAAK;AAAA,YACX,QAAA,EAAU,OAAA;AAAA,YACV,QAAA,EAAU,eAAA;AAAA,YACV,OAAA,EAAS,0CAAA;AAAA,YACT,IAAA,EAAM;AAAA,WACN,CAAA;AAAA,QACF,CAAA,MAAO;AAEN,UAAA,MAAM,SAAA,GAAYA,cAAAA,CAAK,IAAA,CAAK,GAAA,EAAK,OAAO,UAAU,CAAA;AAClD,UAAA,IAAI;AACH,YAAA,MAAM,YAAA,GAAe,MAAM,EAAA,CAAG,QAAA,CAAS,WAAW,OAAO,CAAA;AACzD,YAAA,MAAM,YAAY,UAAA,CAAW,UAAA;AAC7B,YAAA,MAAM,aAAa,IAAI,MAAA;AAAA,cACtB,sBAAsB,SAAS,CAAA,uBAAA;AAAA,aAChC;AACA,YAAA,IAAI,CAAC,UAAA,CAAW,IAAA,CAAK,YAAY,CAAA,EAAG;AACnC,cAAA,MAAA,CAAO,IAAA,CAAK;AAAA,gBACX,QAAA,EAAU,OAAA;AAAA,gBACV,QAAA,EAAU,eAAA;AAAA,gBACV,OAAA,EAAS,UAAU,SAAS,CAAA,sDAAA,CAAA;AAAA,gBAC5B,IAAA,EAAM,YAAA;AAAA,gBACN,UAAA,EAAY,6CAA6C,SAAS,CAAA,sBAAA;AAAA,eAClE,CAAA;AAAA,YACF;AAAA,UACD,SAAS,KAAA,EAAO;AAAA,UAEhB;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAGA,EAAA,IAAI,CAAC,OAAO,UAAA,EAAY;AACvB,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,QAAA,EAAU,OAAA;AAAA,MACV,QAAA,EAAU,eAAA;AAAA,MACV,OAAA,EAAS,0DAAA;AAAA,MACT,IAAA,EAAM,YAAA;AAAA,MACN,UAAA,EACC;AAAA,KACD,CAAA;AAAA,EACF,CAAA,MAAO;AACN,IAAA,MAAM,aAAa,MAAA,CAAO,UAAA;AAC1B,IAAA,IAAI,CAAC,KAAA,CAAM,OAAA,CAAQ,UAAU,CAAA,EAAG;AAC/B,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,eAAA;AAAA,QACV,OAAA,EAAS,6BAAA;AAAA,QACT,IAAA,EAAM;AAAA,OACN,CAAA;AAAA,IACF,CAAA,MAAA,IAAW,UAAA,CAAW,MAAA,KAAW,CAAA,EAAG;AACnC,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,OAAA;AAAA,QACV,QAAA,EAAU,eAAA;AAAA,QACV,OAAA,EAAS,2BAAA;AAAA,QACT,IAAA,EAAM,YAAA;AAAA,QACN,UAAA,EACC;AAAA,OACD,CAAA;AAAA,IACF,CAAA,MAAO;AAEN,MAAA,MAAM,gBAAA,GAAmB,UAAA,CAAW,IAAA,CAAK,CAAC,CAAA,KAAM;AAC/C,QAAA,MAAM,gBAAgB,CAAA,CAAE,kBAAA;AACxB,QAAA,OACC,KAAA,CAAM,OAAA,CAAQ,aAAa,CAAA,IAC3B,aAAA,CAAc,IAAA;AAAA,UAAK,CAAC,MACnB,CAAA,CAAE,QAAA,CAAS,gBAAgB,CAAA,IAAK,CAAA,CAAE,SAAS,UAAU;AAAA,SACtD;AAAA,MAEF,CAAC,CAAA;AAED,MAAA,IAAI,CAAC,gBAAA,EAAkB;AACtB,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACX,QAAA,EAAU,SAAA;AAAA,UACV,QAAA,EAAU,eAAA;AAAA,UACV,OAAA,EACC,4DAAA;AAAA,UACD,IAAA,EAAM,YAAA;AAAA,UACN,UAAA,EACC;AAAA,SACD,CAAA;AAAA,MACF;AAAA,IACD;AAAA,EACD;AAGA,EAAA,IAAI,OAAO,GAAA,EAAK;AACf,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,QAAA,EAAU,OAAA;AAAA,MACV,QAAA,EAAU,eAAA;AAAA,MACV,OAAA,EACC,yEAAA;AAAA,MACD,IAAA,EAAM,YAAA;AAAA,MACN,UAAA,EACC;AAAA,KACD,CAAA;AAAA,EACF;AAEA,EAAA,OAAO,MAAA;AACR;AAKA,eAAe,gBAAA,CACd,QAAA,EACA,WAAA,EACA,eAAA,EACA,GAAA,EAC6B;AAC7B,EAAA,MAAM,SAA4B,EAAC;AAGnC,EAAA,IAAI,CAAC,SAAS,KAAA,IAAS,CAAC,MAAM,OAAA,CAAQ,QAAA,CAAS,KAAK,CAAA,EAAG;AACtD,IAAA,MAAA,CAAO,IAAA,CAAK;AAAA,MACX,QAAA,EAAU,SAAA;AAAA,MACV,QAAA,EAAU,UAAA;AAAA,MACV,OAAA,EAAS,2CAAA;AAAA,MACT,IAAA,EAAM,oBAAA;AAAA,MACN,UAAA,EAAY;AAAA,KACZ,CAAA;AACD,IAAA,OAAO,MAAA;AAAA,EACR;AAGA,EAAA,MAAM,eAAA,GAAkB,YACtB,GAAA,CAAI,CAAC,MAAMA,cAAAA,CAAK,QAAA,CAAS,GAAGA,cAAAA,CAAK,OAAA,CAAQ,CAAC,CAAC,CAAC,EAC5C,MAAA,CAAO,CAAC,SAAS,CAAC,IAAA,CAAK,UAAA,CAAW,UAAU,CAAC,CAAA;AAG/C,EAAA,KAAA,MAAW,IAAA,IAAQ,SAAS,KAAA,EAAO;AAClC,IAAA,IAAI,CAAC,eAAA,CAAgB,QAAA,CAAS,IAAA,CAAK,IAAI,CAAA,EAAG;AACzC,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,SAAA;AAAA,QACV,QAAA,EAAU,UAAA;AAAA,QACV,OAAA,EAAS,CAAA,MAAA,EAAS,IAAA,CAAK,IAAI,CAAA,qCAAA,CAAA;AAAA,QAC3B,IAAA,EAAM,oBAAA;AAAA,QACN,UAAA,EAAY;AAAA,OACZ,CAAA;AAAA,IACF;AAAA,EACD;AAGA,EAAA,KAAA,MAAW,YAAY,eAAA,EAAiB;AACvC,IAAA,MAAM,UAAA,GAAa,SAAS,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,SAAS,QAAQ,CAAA;AACjE,IAAA,IAAI,CAAC,UAAA,EAAY;AAChB,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,QAAA,EAAU,MAAA;AAAA,QACV,QAAA,EAAU,UAAA;AAAA,QACV,OAAA,EAAS,SAAS,QAAQ,CAAA,8CAAA,CAAA;AAAA,QAC1B,IAAA,EAAM,oBAAA;AAAA,QACN,UAAA,EAAY;AAAA,OACZ,CAAA;AAAA,IACF,CAAA,MAAO;AAEN,MAAA,MAAM,YAAA,GAAe,eAAA,CAAgB,QAAA,CAAS,QAAQ,CAAA;AACtD,MAAA,IAAI,UAAA,CAAW,eAAe,YAAA,EAAc;AAC3C,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACX,QAAA,EAAU,MAAA;AAAA,UACV,QAAA,EAAU,UAAA;AAAA,UACV,OAAA,EAAS,SAAS,QAAQ,CAAA,wDAAA,CAAA;AAAA,UAC1B,IAAA,EAAM;AAAA,SACN,CAAA;AAAA,MACF;AAEA,MAAA,MAAM,eAAeA,cAAAA,CAAK,IAAA;AAAA,QACzB,GAAA;AAAA,QACA,MAAA;AAAA,QACA,MAAA;AAAA,QACA,OAAA;AAAA,QACA,GAAG,QAAQ,CAAA,QAAA;AAAA,OACZ;AACA,MAAA,MAAM,WAAA,GAAc,MAAMsB,WAAAA,CAAW,YAAY,CAAA;AACjD,MAAA,IAAI,UAAA,CAAW,gBAAgB,WAAA,EAAa;AAC3C,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACX,QAAA,EAAU,MAAA;AAAA,UACV,QAAA,EAAU,UAAA;AAAA,UACV,OAAA,EAAS,SAAS,QAAQ,CAAA,qDAAA,CAAA;AAAA,UAC1B,IAAA,EAAM;AAAA,SACN,CAAA;AAAA,MACF;AAAA,IACD;AAAA,EACD;AAEA,EAAA,OAAO,MAAA;AACR;AAKA,eAAeA,YAAW,QAAA,EAAoC;AAC7D,EAAA,IAAI;AACH,IAAA,MAAM,EAAA,CAAG,OAAO,QAAQ,CAAA;AACxB,IAAA,OAAO,IAAA;AAAA,EACR,CAAA,CAAA,MAAQ;AACP,IAAA,OAAO,KAAA;AAAA,EACR;AACD;AAKA,SAAS,YAAA,CACR,MAAA,EACA,MAAA,GAAS,KAAA,EACU;AACnB,EAAA,MAAM,OAAA,GAAU;AAAA,IACf,MAAA,EAAQ,OAAO,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,QAAA,KAAa,OAAO,CAAA,CAAE,MAAA;AAAA,IACrD,QAAA,EAAU,OAAO,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,QAAA,KAAa,SAAS,CAAA,CAAE,MAAA;AAAA,IACzD,IAAA,EAAM,OAAO,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,QAAA,KAAa,MAAM,CAAA,CAAE;AAAA,GACnD;AAEA,EAAA,MAAM,MAAA,GAAS,SACZ,OAAA,CAAQ,MAAA,KAAW,KAAK,OAAA,CAAQ,QAAA,KAAa,CAAA,GAC7C,OAAA,CAAQ,MAAA,KAAW,CAAA;AAEtB,EAAA,OAAO,EAAE,MAAA,EAAQ,MAAA,EAAQ,OAAA,EAAQ;AAClC;AAKA,SAAS,uBAAuB,MAAA,EAAgC;AAC/D,EAAA,IAAI,MAAA,CAAO,MAAA,CAAO,MAAA,KAAW,CAAA,EAAG;AAC/B,IAAA,OAAA,CAAQ,IAAI,6CAAwC,CAAA;AACpD,IAAA;AAAA,EACD;AAGA,EAAA,MAAM,UAAA,uBAAiB,GAAA,EAA+B;AACtD,EAAA,KAAA,MAAW,KAAA,IAAS,OAAO,MAAA,EAAQ;AAClC,IAAA,MAAM,WAAW,UAAA,CAAW,GAAA,CAAI,KAAA,CAAM,QAAQ,KAAK,EAAC;AACpD,IAAA,QAAA,CAAS,KAAK,KAAK,CAAA;AACnB,IAAA,UAAA,CAAW,GAAA,CAAI,KAAA,CAAM,QAAA,EAAU,QAAQ,CAAA;AAAA,EACxC;AAGA,EAAA,KAAA,MAAW,CAAC,QAAA,EAAU,MAAM,CAAA,IAAK,UAAA,EAAY;AAC5C,IAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,EAAK,QAAQ,CAAA,CAAA,CAAG,CAAA;AAC5B,IAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC3B,MAAA,MAAM,IAAA,GACL,MAAM,QAAA,KAAa,OAAA,GAChB,WACA,KAAA,CAAM,QAAA,KAAa,YAClB,cAAA,GACA,cAAA;AACL,MAAA,OAAA,CAAQ,IAAI,CAAA,EAAA,EAAK,IAAI,CAAA,CAAA,EAAI,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AACxC,MAAA,IAAI,MAAM,IAAA,EAAM;AACf,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,WAAA,EAAc,KAAA,CAAM,IAAI,CAAA,CAAE,CAAA;AAAA,MACvC;AACA,MAAA,IAAI,MAAM,UAAA,EAAY;AACrB,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,iBAAA,EAAoB,KAAA,CAAM,UAAU,CAAA,CAAE,CAAA;AAAA,MACnD;AAAA,IACD;AAAA,EACD;AAGA,EAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,EAAK,GAAA,CAAI,MAAA,CAAO,EAAE,CAAC,CAAA,CAAE,CAAA;AACjC,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,SAAA,EAAY,MAAA,CAAO,OAAA,CAAQ,MAAM,CAAA,SAAA,EAAY,MAAA,CAAO,OAAA,CAAQ,QAAQ,CAAA,WAAA,EAAc,MAAA,CAAO,OAAA,CAAQ,IAAI,CAAA,KAAA,CAAO,CAAA;AAExH,EAAA,IAAI,OAAO,MAAA,EAAQ;AAClB,IAAA,OAAA,CAAQ,IAAI,iDAA4C,CAAA;AAAA,EACzD,CAAA,MAAO;AACN,IAAA,OAAA,CAAQ,IAAI,+CAA0C,CAAA;AAAA,EACvD;AACD;ACppBO,IAAM,eAAN,MAAmB;AAAA,EACzB,YAAoB,MAAA,EAAsB;AAAtB,IAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AAAA,EAAuB;AAAA;AAAA;AAAA;AAAA,EAK3C,aAAA,GAAyB;AACxB,IAAA,OAAO,IAAIrB,OAAAA,CAAQ,IAAA,CAAK,MAAA,CAAO,gBAAgB,CAAA,CAC7C,WAAA;AAAA,MACA,CAAA,SAAA,EAAY,IAAA,CAAK,MAAA,CAAO,gBAAgB,CAAA,0BAAA;AAAA,KACzC,CACC,MAAA,CAAO,YAAA,EAAc,gBAAgB,CAAA,CACrC,MAAA;AAAA,MACA,uBAAA;AAAA,MACA,oEAAA;AAAA,MACA;AAAA,KACD,CACC,MAAA;AAAA,MACA,iBAAA;AAAA,MACA,CAAA,gBAAA,EAAmB,IAAA,CAAK,MAAA,CAAO,gBAAgB,CAAA,UAAA;AAAA,KAChD,CACC,MAAA,CAAO,OAAO,OAAA,KAAY;AAC1B,MAAA,MAAM,GAAA,GAAM,QAAQ,GAAA,EAAI;AAExB,MAAA,IAAI;AACH,QAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,gBAAA;AAAA,UAC3B,GAAA;AAAA,UACA,OAAA,CAAQ;AAAA,SACT;AAGA,QAAA,MAAM,QAAA,GAAW,IAAA,CAAK,cAAA,CAAe,QAAA,EAAU,QAAQ,MAAM,CAAA;AAG7D,QAAA,IAAI,QAAQ,IAAA,EAAM;AACjB,UAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,QAAA,EAAU,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,QAC9C,CAAA,MAAO;AACN,UAAA,IAAA,CAAK,WAAW,QAAQ,CAAA;AAAA,QACzB;AAAA,MACD,SAAS,KAAA,EAAO;AACf,QAAA,OAAA,CAAQ,KAAA;AAAA,UACP,iBAAY,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,SACnE;AACA,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MACf;AAAA,IACD,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,gBAAA,CACL,GAAA,EACA,eAAA,GAAkB,KAAA,EACM;AACxB,IAAA,MAAM,WAAyB,EAAC;AAGhC,IAAA,MAAM,YAAYD,cAAAA,CAAK,IAAA,CAAK,GAAA,EAAK,IAAA,CAAK,OAAO,SAAS,CAAA;AACtD,IAAA,IAAI,cAAwB,EAAC;AAE7B,IAAA,IAAI;AACH,MAAA,MAAM,KAAA,GAAQ,MAAMuB,EAAAA,CAAG,OAAA,CAAQ,SAAS,CAAA;AACxC,MAAA,WAAA,GAAc,KAAA,CACZ,OAAO,CAAC,CAAA,KAAM,EAAE,QAAA,CAAS,KAAK,CAAA,IAAK,CAAC,CAAA,CAAE,QAAA,CAAS,UAAU,CAAC,CAAA,CAC1D,OAAO,CAAC,CAAA,KAAM,mBAAmB,CAAC,CAAA,CAAE,UAAA,CAAW,UAAU,CAAC,CAAA;AAAA,IAC7D,SAAS,KAAA,EAAO;AACf,MAAA,MAAM,IAAI,KAAA;AAAA,QACT,CAAA,EAAG,IAAA,CAAK,MAAA,CAAO,SAAS,CAAA,wDAAA;AAAA,OACzB;AAAA,IACD;AAGA,IAAA,MAAM,SAAA,GAAYvB,cAAAA,CAAK,IAAA,CAAK,GAAA,EAAK,OAAO,UAAU,CAAA;AAClD,IAAA,MAAM,kBAAA,GAAqB,MAAM,IAAA,CAAK,kBAAA,CAAmB,SAAS,CAAA;AAGlE,IAAA,KAAA,MAAW,QAAQ,WAAA,EAAa;AAC/B,MAAA,MAAM,UAAA,GAAaA,cAAAA,CAAK,QAAA,CAAS,IAAA,EAAM,KAAK,CAAA;AAC5C,MAAA,MAAM,UAAA,GAAaA,cAAAA,CAAK,IAAA,CAAK,SAAA,EAAW,IAAI,CAAA;AAG5C,MAAA,MAAM,UAAA,GAAa,kBAAA,CAAmB,QAAA,CAAS,UAAU,CAAA;AAGzD,MAAA,MAAM,eAAeA,cAAAA,CAAK,IAAA;AAAA,QACzB,GAAA;AAAA,QACA,KAAK,MAAA,CAAO,WAAA;AAAA,QACZ,GAAG,UAAU,CAAA,QAAA;AAAA,OACd;AACA,MAAA,MAAM,WAAA,GAAc,MAAM,UAAA,CAAW,YAAY,CAAA;AAGjD,MAAA,MAAM,sBAAsBA,cAAAA,CAAK,IAAA;AAAA,QAChC,GAAA;AAAA,QACA,KAAK,MAAA,CAAO,kBAAA;AAAA,QACZ,GAAG,UAAU,CAAA,KAAA;AAAA,OACd;AACA,MAAA,MAAM,kBAAA,GAAqB,MAAM,UAAA,CAAW,mBAAmB,CAAA;AAG/D,MAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,kBAAA,CAAmB,UAAU,CAAA;AAE5D,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACb,IAAA,EAAM,UAAA;AAAA,QACN,IAAA,EAAMA,cAAAA,CAAK,QAAA,CAAS,GAAA,EAAK,UAAU,CAAA;AAAA,QACnC,UAAA;AAAA,QACA,WAAA;AAAA,QACA,kBAAA;AAAA,QACA;AAAA,OACA,CAAA;AAAA,IACF;AAEA,IAAA,OAAO,QAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,mBAAmB,SAAA,EAAsC;AAC9D,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAMuB,EAAAA,CAAG,QAAA,CAAS,WAAW,OAAO,CAAA;AACpD,MAAA,MAAM,aAAuB,EAAC;AAE9B,MAAA,IAAI,KAAA;AAEJ,MAAA,OAAA,CAAQ,QAAQ,IAAA,CAAK,MAAA,CAAO,oBAAoB,IAAA,CAAK,OAAO,OAAO,IAAA,EAAM;AACxE,QAAA,MAAM,UAAA,GAAa,WAAA,CAAY,KAAA,CAAM,CAAC,CAAC,CAAA;AACvC,QAAA,UAAA,CAAW,KAAK,UAAU,CAAA;AAAA,MAC3B;AAEA,MAAA,OAAO,UAAA;AAAA,IACR,SAAS,KAAA,EAAO;AACf,MAAA,OAAO,EAAC;AAAA,IACT;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,CAAe,UAAwB,MAAA,EAA8B;AACpE,IAAA,QAAQ,MAAA,CAAO,aAAY;AAAG,MAC7B,KAAK,YAAA;AACJ,QAAA,OAAO,QAAA,CAAS,MAAA,CAAO,CAAC,CAAA,KAAM,EAAE,UAAU,CAAA;AAAA,MAC3C,KAAK,cAAA;AACJ,QAAA,OAAO,SAAS,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,EAAE,UAAU,CAAA;AAAA,MAC5C,KAAK,QAAA;AACJ,QAAA,OAAO,SAAS,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,WAAA,IAAe,EAAE,kBAAkB,CAAA;AAAA,MACpE,KAAK,UAAA;AACJ,QAAA,OAAO,QAAA,CAAS,OAAO,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,WAAA,IAAe,CAAC,CAAA,CAAE,kBAAkB,CAAA;AAAA,MACtE,KAAK,KAAA;AAAA,MACL;AACC,QAAA,OAAO,QAAA;AAAA;AACT,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,QAAA,EAA8B;AACxC,IAAA,IAAI,QAAA,CAAS,WAAW,CAAA,EAAG;AAC1B,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,GAAA,EAAM,IAAA,CAAK,MAAA,CAAO,gBAAgB,CAAA;AAAA,CAAW,CAAA;AACzD,MAAA;AAAA,IACD;AAEA,IAAA,OAAA,CAAQ,GAAA;AAAA,MACP;AAAA,MAAA,EAAW,QAAA,CAAS,MAAM,CAAA,CAAA,EAAI,QAAA,CAAS,MAAA,KAAW,CAAA,GAAI,IAAA,CAAK,MAAA,CAAO,UAAA,GAAa,IAAA,CAAK,MAAA,CAAO,gBAAgB,CAAA;AAAA;AAAA,KAC5G;AAGA,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,GAAA,CAAI,EAAA,EAAI,GAAG,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,IAAA,CAAK,MAAM,CAAC,CAAA;AACpE,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,GAAA,CAAI,EAAA,EAAI,GAAG,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,IAAA,CAAK,MAAM,CAAC,CAAA;AAGpE,IAAA,MAAM,MAAA,GAAS,CAAA,EAAG,MAAA,CAAO,MAAA,CAAO,SAAS,CAAC,CAAA,sBAAA,EAAyB,MAAA,CAAO,MAAA,CAAO,SAAS,CAAC,CAAA,CAAA;AAC3F,IAAA,OAAA,CAAQ,IAAI,MAAM,CAAA;AAClB,IAAA,OAAA,CAAQ,GAAA,CAAI,GAAA,CAAI,MAAA,CAAO,MAAA,CAAO,MAAM,CAAC,CAAA;AAGrC,IAAA,KAAA,MAAW,UAAU,QAAA,EAAU;AAC9B,MAAA,MAAM,IAAA,GAAO,MAAA,CAAO,IAAA,CAAK,MAAA,CAAO,SAAS,CAAA;AACzC,MAAA,MAAM,GAAA,GAAM,MAAA,CAAO,UAAA,GAAa,UAAA,GAAQ,UAAA;AACxC,MAAA,MAAM,IAAA,GAAO,MAAA,CAAO,WAAA,GAAc,UAAA,GAAQ,UAAA;AAC1C,MAAA,MAAM,GAAA,GAAM,MAAA,CAAO,kBAAA,GAAqB,UAAA,GAAQ,UAAA;AAChD,MAAA,MAAM,IAAA,GAAO,MAAA,CAAO,IAAA,CAAK,MAAA,CAAO,SAAS,CAAA;AAEzC,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAG,IAAI,CAAA,GAAA,EAAM,GAAG,CAAA,GAAA,EAAM,IAAI,CAAA,GAAA,EAAM,GAAG,CAAA,GAAA,EAAM,IAAI,CAAA,CAAE,CAAA;AAG3D,MAAA,IAAI,MAAA,CAAO,WAAA,IAAe,MAAA,CAAO,WAAA,KAAgB,gBAAA,EAAkB;AAClE,QAAA,OAAA,CAAQ,GAAA,CAAI,GAAG,EAAA,CAAG,MAAA,CAAO,SAAS,CAAC,CAAA,GAAA,EAAM,MAAA,CAAO,WAAW,CAAA,CAAE,CAAA;AAAA,MAC9D;AAAA,IACD;AAGA,IAAA,MAAM,aAAa,QAAA,CAAS,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,UAAU,CAAA,CAAE,MAAA;AACxD,IAAA,MAAM,gBAAgB,QAAA,CAAS,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,WAAW,CAAA,CAAE,MAAA;AAC5D,IAAA,MAAM,uBAAuB,QAAA,CAAS,MAAA;AAAA,MACrC,CAAC,MAAM,CAAA,CAAE;AAAA,KACV,CAAE,MAAA;AAEF,IAAA,OAAA,CAAQ,IAAI,YAAY,CAAA;AACxB,IAAA,OAAA,CAAQ,IAAI,CAAA,oBAAA,EAAuB,UAAU,CAAA,CAAA,EAAI,QAAA,CAAS,MAAM,CAAA,CAAE,CAAA;AAClE,IAAA,OAAA,CAAQ,IAAI,CAAA,oBAAA,EAAuB,aAAa,CAAA,CAAA,EAAI,QAAA,CAAS,MAAM,CAAA,CAAE,CAAA;AACrE,IAAA,OAAA,CAAQ,GAAA;AAAA,MACP,CAAA,qBAAA,EAAwB,oBAAoB,CAAA,CAAA,EAAI,QAAA,CAAS,MAAM,CAAA;AAAA,KAChE;AACA,IAAA,OAAA,CAAQ,IAAI,EAAE,CAAA;AAAA,EACf;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAmB,QAAA,EAAmC;AACnE,IAAA,IAAI;AACH,MAAA,MAAM,OAAA,GAAU,MAAMA,EAAAA,CAAG,QAAA,CAAS,UAAU,OAAO,CAAA;AAGnD,MAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,KAAA,CAAM,IAAA,CAAK,OAAO,kBAAkB,CAAA;AAE1D,MAAA,IAAI,KAAA,IAAS,KAAA,CAAM,CAAC,CAAA,EAAG;AACtB,QAAA,OAAO,MAAM,CAAC,CAAA;AAAA,MACf;AAGA,MAAA,MAAM,WAAA,GAAc,6BAAA;AACpB,MAAA,MAAM,WAAA,GAAc,OAAA,CAAQ,KAAA,CAAM,WAAW,CAAA;AAE7C,MAAA,IAAI,WAAA,IAAe,WAAA,CAAY,CAAC,CAAA,EAAG;AAClC,QAAA,OAAO,WAAA,CAAY,CAAC,CAAA,CAAE,IAAA,EAAK;AAAA,MAC5B;AAEA,MAAA,OAAO,gBAAA;AAAA,IACR,SAAS,KAAA,EAAO;AACf,MAAA,OAAO,gBAAA;AAAA,IACR;AAAA,EACD;AACD,CAAA;;;ACpQA,IAAM,WAAA,GAA4B;AAAA,EACjC,UAAA,EAAY,MAAA;AAAA,EACZ,gBAAA,EAAkB,OAAA;AAAA,EAClB,SAAA,EAAW,WAAA;AAAA,EACX,mBAAA,EAAqB,oCAAA;AAAA,EACrB,WAAA,EAAa,iBAAA;AAAA,EACb,kBAAA,EAAoB,wBAAA;AAAA,EACpB,kBAAA,EACC;AACF,CAAA;AAKO,SAAS,sBAAA,GAAkC;AACjD,EAAA,OAAO,IAAI,YAAA,CAAa,WAAW,CAAA,CAAE,aAAA,EAAc;AACpD;;;AChBA,IAAM,aAAA,GAA8B;AAAA,EACnC,UAAA,EAAY,QAAA;AAAA,EACZ,gBAAA,EAAkB,SAAA;AAAA,EAClB,SAAA,EAAW,aAAA;AAAA,EACX,mBAAA,EAAqB,sCAAA;AAAA,EACrB,WAAA,EAAa,mBAAA;AAAA,EACb,kBAAA,EAAoB,gCAAA;AAAA,EACpB,kBAAA,EACC;AACF,CAAA;AAKO,SAAS,wBAAA,GAAoC;AACnD,EAAA,OAAO,IAAI,YAAA,CAAa,aAAa,CAAA,CAAE,aAAA,EAAc;AACtD;;;AChBA,IAAM,eAAA,GAAgC;AAAA,EACrC,UAAA,EAAY,UAAA;AAAA,EACZ,gBAAA,EAAkB,WAAA;AAAA,EAClB,SAAA,EAAW,eAAA;AAAA,EACX,mBAAA,EAAqB,wCAAA;AAAA,EACrB,WAAA,EAAa,qBAAA;AAAA,EACb,kBAAA,EAAoB,kCAAA;AAAA,EACpB,kBAAA,EACC;AACF,CAAA;AAKO,SAAS,0BAAA,GAAsC;AACrD,EAAA,OAAO,IAAI,YAAA,CAAa,eAAe,CAAA,CAAE,aAAA,EAAc;AACxD;;;AC1BO,SAASC,kBAAAA,GAA6B;AAC5C,EAAA,MAAM,cAAc,IAAIvB,OAAAA,CAAQ,MAAM,CAAA,CACpC,YAAY,yDAAyD,CAAA;AAGvE,EAAA,WAAA,CAAY,UAAA,CAAW,wBAAwB,CAAA;AAC/C,EAAA,WAAA,CAAY,UAAA,CAAW,0BAA0B,CAAA;AACjD,EAAA,WAAA,CAAY,UAAA,CAAW,4BAA4B,CAAA;AAEnD,EAAA,OAAO,WAAA;AACR","file":"index.js","sourcesContent":["/**\n * Zod Validation Schemas for Template System\n *\n * Runtime validation for template configurations.\n */\n\nimport { z } from \"zod\";\n\n/**\n * Template variable schema\n */\nexport const TemplateVariableSchema = z.object({\n\tname: z\n\t\t.string()\n\t\t.min(1)\n\t\t.regex(/^[A-Z][A-Z0-9_]*$/, \"Variable name must be uppercase with underscores\"),\n\trequired: z.boolean(),\n\tdefault: z.string().optional(),\n\tprompt: z.string().optional(),\n\tpattern: z.string().optional(),\n});\n\n/**\n * Post-scaffold configuration schema\n */\nexport const PostScaffoldConfigSchema = z.object({\n\tinstall: z.boolean(),\n\tinstallCommand: z.string().optional(),\n\tpostInstall: z.array(z.string()).optional(),\n\tsmokeTest: z.string().optional(),\n});\n\n/**\n * Template capabilities schema\n */\nexport const TemplateCapabilitiesSchema = z.object({\n\truntime: z.string().min(1),\n\ttransport: z.array(z.string().min(1)).min(1),\n\tdeployment: z.enum([\"remote\", \"local\"]),\n\tlanguage: z.enum([\"typescript\", \"javascript\"]),\n});\n\n/**\n * Template dependencies schema\n */\nexport const TemplateDependenciesSchema = z.object({\n\tmcp_sdk: z.string().optional(),\n\tagents: z.string().optional(),\n\truntime_specific: z.record(z.string()).optional(),\n});\n\n/**\n * CLI commands schema\n */\nexport const TemplateCLICommandsSchema = z.object({\n\tdev: z.string().min(1),\n\ttest: z.string().min(1),\n\tdeploy: z.string().optional(),\n\ttypeCheck: z.string().optional(),\n});\n\n/**\n * Template features schema\n */\nexport const TemplateFeaturesSchema = z.object({\n\tunitTesting: z.boolean(),\n\tintegrationTesting: z.boolean(),\n\texampleTools: z.array(z.string()),\n\tdocumentation: z.boolean(),\n});\n\n/**\n * Compatibility requirements schema\n */\nexport const TemplateCompatibilitySchema = z.object({\n\tnode: z.string().optional(),\n\tnpm: z.string().optional(),\n\tpnpm: z.string().optional(),\n\tyarn: z.string().optional(),\n});\n\n/**\n * Complete template configuration schema\n */\nexport const TemplateConfigSchema = z.object({\n\tid: z\n\t\t.string()\n\t\t.min(1)\n\t\t.regex(/^[a-z0-9-]+$/, \"Template ID must be lowercase with hyphens\"),\n\tversion: z.string().regex(/^\\d+\\.\\d+\\.\\d+$/, \"Version must be semver (e.g., 1.0.0)\"),\n\tname: z.string().min(1),\n\tdescription: z.string().min(1),\n\tcapabilities: TemplateCapabilitiesSchema,\n\tdependencies: TemplateDependenciesSchema,\n\tscaffolding: z.object({\n\t\tvariables: z.array(TemplateVariableSchema),\n\t\tpostScaffold: PostScaffoldConfigSchema.optional(),\n\t}),\n\tcli: TemplateCLICommandsSchema,\n\tfeatures: TemplateFeaturesSchema,\n\tcompatibility: TemplateCompatibilitySchema,\n});\n\n/**\n * Scaffold metadata schema\n */\nexport const ScaffoldMetadataSchema = z.object({\n\tid: z.string(),\n\tversion: z.string(),\n\tname: z.string(),\n\tmcp_sdk_version: z.string().optional(),\n\tagents_version: z.string().optional(),\n\tscaffolded_at: z.string(),\n\tvariables: z.record(z.string()),\n});\n\n/**\n * Scaffold options schema\n */\nexport const ScaffoldOptionsSchema = z.object({\n\ttemplate: z.string().min(1),\n\ttargetDir: z.string().min(1),\n\tvariables: z.record(z.string()),\n\tnoInstall: z.boolean().optional(),\n\tpackageManager: z.enum([\"npm\", \"pnpm\", \"yarn\", \"bun\"]).optional(),\n\tsmokeTest: z.boolean().optional(),\n});\n\n/**\n * Template filter schema\n */\nexport const TemplateFilterSchema = z.object({\n\truntime: z.string().optional(),\n\ttransport: z.string().optional(),\n\tdeployment: z.enum([\"remote\", \"local\"]).optional(),\n\tlanguage: z.enum([\"typescript\", \"javascript\"]).optional(),\n});\n\n/**\n * Validation helper: Parse and validate template config\n */\nexport function validateTemplateConfig(config: unknown): {\n\tsuccess: boolean;\n\tdata?: z.infer<typeof TemplateConfigSchema>;\n\terrors?: z.ZodError;\n} {\n\tconst result = TemplateConfigSchema.safeParse(config);\n\n\tif (result.success) {\n\t\treturn { success: true, data: result.data };\n\t}\n\n\treturn { success: false, errors: result.error };\n}\n\n/**\n * Validation helper: Parse and validate scaffold options\n */\nexport function validateScaffoldOptions(options: unknown): {\n\tsuccess: boolean;\n\tdata?: z.infer<typeof ScaffoldOptionsSchema>;\n\terrors?: z.ZodError;\n} {\n\tconst result = ScaffoldOptionsSchema.safeParse(options);\n\n\tif (result.success) {\n\t\treturn { success: true, data: result.data };\n\t}\n\n\treturn { success: false, errors: result.error };\n}\n","/**\n * Template Registry\n *\n * Discovers, validates, and manages templates.\n */\n\nimport { readdir, readFile, access } from \"node:fs/promises\";\nimport { join, dirname } from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\nimport type {\n\tTemplate,\n\tTemplateConfig,\n\tTemplateFilter,\n\tTemplateValidationResult,\n} from \"./types.js\";\nimport { validateTemplateConfig } from \"./schemas.js\";\n\n/**\n * Get the templates directory path\n * Works both in development and when installed as a package\n */\nfunction getTemplatesDir(): string {\n\tconst __filename = fileURLToPath(import.meta.url);\n\tconst __dirname = dirname(__filename);\n\n\t// Check if we're running from src/ or dist/\n\tif (__dirname.includes(\"/src/\")) {\n\t\t// Running from source (tests): src/core/template-system -> ../../../templates\n\t\treturn join(__dirname, \"../../../templates\");\n\t} else {\n\t\t// Running from dist (CLI): dist/ -> ../templates\n\t\treturn join(__dirname, \"../templates\");\n\t}\n}\n\n/**\n * Template Registry - discovers and validates templates\n */\nexport class TemplateRegistry {\n\tprivate templatesDir: string;\n\tprivate templatesCache: Map<string, Template> = new Map();\n\n\tconstructor(templatesDir?: string) {\n\t\t// Default to templates directory in project root\n\t\tthis.templatesDir = templatesDir || getTemplatesDir();\n\t}\n\n\t/**\n\t * Discover all templates in the templates directory\n\t */\n\tasync discoverTemplates(): Promise<TemplateConfig[]> {\n\t\ttry {\n\t\t\tconst entries = await readdir(this.templatesDir, { withFileTypes: true });\n\n\t\t\tconst templates: TemplateConfig[] = [];\n\n\t\t\tfor (const entry of entries) {\n\t\t\t\tif (!entry.isDirectory()) continue;\n\n\t\t\t\tconst templatePath = join(this.templatesDir, entry.name);\n\t\t\t\tconst configPath = join(templatePath, \"template.config.json\");\n\n\t\t\t\ttry {\n\t\t\t\t\t// Check if template.config.json exists\n\t\t\t\t\tawait access(configPath);\n\t\t\t\t} catch {\n\t\t\t\t\t// Silently skip directories without template.config.json\n\t\t\t\t\t// (they're not project templates, e.g., scaffolding/, utilities/, etc.)\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\t// Load and parse config\n\t\t\t\t\tconst configContent = await readFile(configPath, \"utf-8\");\n\t\t\t\t\tconst config = JSON.parse(configContent);\n\n\t\t\t\t\t// Validate config\n\t\t\t\t\tconst validation = validateTemplateConfig(config);\n\n\t\t\t\t\tif (validation.success && validation.data) {\n\t\t\t\t\t\ttemplates.push(validation.data);\n\n\t\t\t\t\t\t// Cache the template\n\t\t\t\t\t\tthis.templatesCache.set(validation.data.id, {\n\t\t\t\t\t\t\tconfig: validation.data,\n\t\t\t\t\t\t\tpath: templatePath,\n\t\t\t\t\t\t\tfilesPath: join(templatePath, \"files\"),\n\t\t\t\t\t\t\thooksPath: join(templatePath, \"hooks\"),\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Warn about templates with invalid config format\n\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t`Skipping template ${entry.name}: Invalid config format`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// Warn about templates with parse errors or other issues\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`Skipping template ${entry.name}: ${error instanceof Error ? error.message : String(error)}`,\n\t\t\t\t\t);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn templates;\n\t\t} catch (error) {\n\t\t\tthrow new Error(`Failed to discover templates: ${error}`);\n\t\t}\n\t}\n\n\t/**\n\t * Get a specific template by ID\n\t */\n\tasync getTemplate(id: string): Promise<Template> {\n\t\t// Check cache first\n\t\tif (this.templatesCache.has(id)) {\n\t\t\treturn this.templatesCache.get(id)!;\n\t\t}\n\n\t\t// Discover templates (which will populate cache)\n\t\tawait this.discoverTemplates();\n\n\t\t// Check cache again\n\t\tif (this.templatesCache.has(id)) {\n\t\t\treturn this.templatesCache.get(id)!;\n\t\t}\n\n\t\tthrow new Error(`Template not found: ${id}`);\n\t}\n\n\t/**\n\t * Validate a specific template\n\t */\n\tasync validateTemplate(id: string): Promise<TemplateValidationResult> {\n\t\tconst errors: string[] = [];\n\t\tconst warnings: string[] = [];\n\n\t\ttry {\n\t\t\tconst template = await this.getTemplate(id);\n\n\t\t\t// Validate config schema (already done in getTemplate)\n\t\t\t// Additional validations:\n\n\t\t\t// 1. Check if files directory exists\n\t\t\ttry {\n\t\t\t\tawait access(template.filesPath);\n\t\t\t} catch {\n\t\t\t\terrors.push(`Files directory not found: ${template.filesPath}`);\n\t\t\t}\n\n\t\t\t// 2. Check if required files exist\n\t\t\tconst requiredFiles = [\"package.json.hbs\", \"tsconfig.json\", \"README.md.hbs\"];\n\n\t\t\tfor (const file of requiredFiles) {\n\t\t\t\ttry {\n\t\t\t\t\tawait access(join(template.filesPath, file));\n\t\t\t\t} catch {\n\t\t\t\t\twarnings.push(`Recommended file missing: ${file}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 3. Validate variables\n\t\t\tfor (const variable of template.config.scaffolding.variables) {\n\t\t\t\tif (variable.required && variable.default) {\n\t\t\t\t\twarnings.push(`Variable ${variable.name} is required but has a default value`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 4. Check capabilities\n\t\t\tif (template.config.capabilities.transport.length === 0) {\n\t\t\t\terrors.push(\"Template must support at least one transport\");\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tvalid: errors.length === 0,\n\t\t\t\terrors,\n\t\t\t\twarnings,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\tvalid: false,\n\t\t\t\terrors: [`Failed to validate template: ${error}`],\n\t\t\t\twarnings: [],\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * List all templates with optional filtering\n\t */\n\tasync listTemplates(filter?: TemplateFilter): Promise<TemplateConfig[]> {\n\t\tconst templates = await this.discoverTemplates();\n\n\t\tif (!filter) {\n\t\t\treturn templates;\n\t\t}\n\n\t\treturn templates.filter((template) => {\n\t\t\t// Filter by runtime\n\t\t\tif (filter.runtime && template.capabilities.runtime !== filter.runtime) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Filter by transport\n\t\t\tif (filter.transport && !template.capabilities.transport.includes(filter.transport)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Filter by deployment\n\t\t\tif (filter.deployment && template.capabilities.deployment !== filter.deployment) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Filter by language\n\t\t\tif (filter.language && template.capabilities.language !== filter.language) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\t/**\n\t * Check if a template exists\n\t */\n\tasync templateExists(id: string): Promise<boolean> {\n\t\ttry {\n\t\t\tawait this.getTemplate(id);\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Get template capabilities (for filtering/discovery)\n\t */\n\tasync getCapabilities(): Promise<{\n\t\truntimes: Set<string>;\n\t\ttransports: Set<string>;\n\t\tdeployments: Set<string>;\n\t\tlanguages: Set<string>;\n\t}> {\n\t\tconst templates = await this.discoverTemplates();\n\n\t\tconst runtimes = new Set<string>();\n\t\tconst transports = new Set<string>();\n\t\tconst deployments = new Set<string>();\n\t\tconst languages = new Set<string>();\n\n\t\tfor (const template of templates) {\n\t\t\truntimes.add(template.capabilities.runtime);\n\t\t\tfor (const transport of template.capabilities.transport) {\n\t\t\t\ttransports.add(transport);\n\t\t\t}\n\t\t\tdeployments.add(template.capabilities.deployment);\n\t\t\tlanguages.add(template.capabilities.language);\n\t\t}\n\n\t\treturn { runtimes, transports, deployments, languages };\n\t}\n\n\t/**\n\t * Clear templates cache\n\t */\n\tclearCache(): void {\n\t\tthis.templatesCache.clear();\n\t}\n}\n","/**\n * Template Processor\n *\n * Handles scaffolding projects from templates:\n * - Variable substitution\n * - File copying\n * - Hook execution\n * - Dependency installation\n */\n\nimport { mkdir, readdir, readFile, writeFile, copyFile, stat } from \"node:fs/promises\";\nimport { join, dirname, basename } from \"node:path\";\nimport Handlebars from \"handlebars\";\nimport type {\n\tScaffoldOptions,\n\tScaffoldResult,\n\tScaffoldMetadata,\n\tTemplateHookContext,\n\tTemplate,\n\tTemplateVariable,\n} from \"./types.js\";\nimport { TemplateRegistry } from \"./registry.js\";\n\n/**\n * Template Processor - scaffolds projects from templates\n */\nexport class TemplateProcessor {\n\tprivate registry: TemplateRegistry;\n\n\tconstructor(registry: TemplateRegistry) {\n\t\tthis.registry = registry;\n\t}\n\n\t/**\n\t * Scaffold a project from a template\n\t */\n\tasync scaffold(options: ScaffoldOptions): Promise<ScaffoldResult> {\n\t\ttry {\n\t\t\t// 1. Load template\n\t\t\tconst template = await this.registry.getTemplate(options.template);\n\n\t\t\t// 2. Validate variables\n\t\t\tconst variables = this.validateVariables(\n\t\t\t\toptions.variables,\n\t\t\t\ttemplate.config.scaffolding.variables,\n\t\t\t);\n\n\t\t\t// 3. Create target directory\n\t\t\tawait mkdir(options.targetDir, { recursive: true });\n\n\t\t\t// 4. Run pre-scaffold hook (if exists)\n\t\t\tawait this.runHook(template, \"pre-scaffold\", {\n\t\t\t\ttemplate: template.config,\n\t\t\t\ttargetDir: options.targetDir,\n\t\t\t\tvariables,\n\t\t\t\tpackageManager: options.packageManager,\n\t\t\t});\n\n\t\t\t// 5. Copy template files with variable substitution\n\t\t\tawait this.copyTemplateFiles(template, options.targetDir, variables);\n\n\t\t\t// 6. Run post-scaffold hook (if exists)\n\t\t\tawait this.runHook(template, \"post-scaffold\", {\n\t\t\t\ttemplate: template.config,\n\t\t\t\ttargetDir: options.targetDir,\n\t\t\t\tvariables,\n\t\t\t\tpackageManager: options.packageManager,\n\t\t\t});\n\n\t\t\t// 7. Install dependencies (if enabled)\n\t\t\tif (!options.noInstall && template.config.scaffolding.postScaffold?.install) {\n\t\t\t\tawait this.installDependencies(\n\t\t\t\t\toptions.targetDir,\n\t\t\t\t\toptions.packageManager,\n\t\t\t\t\ttemplate.config.scaffolding.postScaffold.installCommand,\n\t\t\t\t);\n\n\t\t\t\t// 7.5. Run post-install commands (if configured)\n\t\t\t\tif (template.config.scaffolding.postScaffold?.postInstall) {\n\t\t\t\t\tawait this.runPostInstallCommands(\n\t\t\t\t\t\toptions.targetDir,\n\t\t\t\t\t\ttemplate.config.scaffolding.postScaffold.postInstall,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 8. Run smoke test (if configured and requested)\n\t\t\tif (options.smokeTest && template.config.scaffolding.postScaffold?.smokeTest) {\n\t\t\t\tawait this.runSmokeTest(\n\t\t\t\t\toptions.targetDir,\n\t\t\t\t\ttemplate.config.scaffolding.postScaffold.smokeTest,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// 9. Write scaffold metadata\n\t\t\tawait this.writeMetadata(options.targetDir, template, variables);\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\ttemplate: template.config.id,\n\t\t\t\tpath: options.targetDir,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\ttemplate: options.template,\n\t\t\t\tpath: options.targetDir,\n\t\t\t\terror: error instanceof Error ? error.message : String(error),\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Validate and merge variables with defaults\n\t */\n\tprivate validateVariables(\n\t\tprovided: Record<string, string>,\n\t\tdefinitions: TemplateVariable[],\n\t): Record<string, string> {\n\t\tconst variables: Record<string, string> = {};\n\n\t\tfor (const def of definitions) {\n\t\t\t// Check if required variable is provided\n\t\t\tif (def.required && !provided[def.name]) {\n\t\t\t\tthrow new Error(`Required variable missing: ${def.name}`);\n\t\t\t}\n\n\t\t\t// Use provided value or default\n\t\t\tconst value = provided[def.name] || def.default || \"\";\n\n\t\t\t// Validate pattern (if specified)\n\t\t\tif (def.pattern && value) {\n\t\t\t\tconst regex = new RegExp(def.pattern);\n\t\t\t\tif (!regex.test(value)) {\n\t\t\t\t\tthrow new Error(`Variable ${def.name} does not match pattern: ${def.pattern}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvariables[def.name] = value;\n\t\t}\n\n\t\t// Include any extra variables not in definitions\n\t\tfor (const [key, value] of Object.entries(provided)) {\n\t\t\tif (!variables[key]) {\n\t\t\t\tvariables[key] = value;\n\t\t\t}\n\t\t}\n\n\t\treturn variables;\n\t}\n\n\t/**\n\t * Copy template files to target directory with variable substitution\n\t */\n\tprivate async copyTemplateFiles(\n\t\ttemplate: Template,\n\t\ttargetDir: string,\n\t\tvariables: Record<string, string>,\n\t): Promise<void> {\n\t\tawait this.copyDirectoryRecursive(template.filesPath, targetDir, variables);\n\t}\n\n\t/**\n\t * Recursively copy directory with variable substitution\n\t */\n\tprivate async copyDirectoryRecursive(\n\t\tsourceDir: string,\n\t\ttargetDir: string,\n\t\tvariables: Record<string, string>,\n\t): Promise<void> {\n\t\tconst entries = await readdir(sourceDir, { withFileTypes: true });\n\n\t\tfor (const entry of entries) {\n\t\t\tconst sourcePath = join(sourceDir, entry.name);\n\t\t\tlet targetPath = join(targetDir, entry.name);\n\n\t\t\t// Process filename (remove .hbs extension, substitute variables)\n\t\t\tif (entry.name.endsWith(\".hbs\")) {\n\t\t\t\ttargetPath = join(targetDir, entry.name.slice(0, -4)); // Remove .hbs\n\t\t\t}\n\n\t\t\tif (entry.isDirectory()) {\n\t\t\t\t// Create directory and recurse\n\t\t\t\tawait mkdir(targetPath, { recursive: true });\n\t\t\t\tawait this.copyDirectoryRecursive(sourcePath, targetPath, variables);\n\t\t\t} else {\n\t\t\t\t// Process file\n\t\t\t\tawait this.processFile(sourcePath, targetPath, variables);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Process a single file (with or without Handlebars templating)\n\t */\n\tprivate async processFile(\n\t\tsourcePath: string,\n\t\ttargetPath: string,\n\t\tvariables: Record<string, string>,\n\t): Promise<void> {\n\t\t// Ensure target directory exists\n\t\tawait mkdir(dirname(targetPath), { recursive: true });\n\n\t\t// Check if file should be templated\n\t\tif (sourcePath.endsWith(\".hbs\")) {\n\t\t\t// Read template file\n\t\t\tconst templateContent = await readFile(sourcePath, \"utf-8\");\n\n\t\t\t// Compile and execute Handlebars template\n\t\t\tconst template = Handlebars.compile(templateContent);\n\t\t\tconst processedContent = template(variables);\n\n\t\t\t// Write processed file\n\t\t\tawait writeFile(targetPath, processedContent, \"utf-8\");\n\t\t} else {\n\t\t\t// Binary file or non-templated file - just copy\n\t\t\tawait copyFile(sourcePath, targetPath);\n\t\t}\n\t}\n\n\t/**\n\t * Run a template hook\n\t */\n\tprivate async runHook(\n\t\ttemplate: Template,\n\t\thookName: string,\n\t\tcontext: TemplateHookContext,\n\t): Promise<void> {\n\t\tif (!template.hooksPath) return;\n\n\t\tconst hookPath = join(template.hooksPath, `${hookName}.js`);\n\n\t\ttry {\n\t\t\t// Check if hook exists\n\t\t\tawait stat(hookPath);\n\n\t\t\t// Import and execute hook\n\t\t\tconst hook = await import(hookPath);\n\n\t\t\tif (typeof hook.default === \"function\") {\n\t\t\t\tawait hook.default(context);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// Only warn if hook exists but failed to execute\n\t\t\t// Don't warn if hook doesn't exist (ENOENT) - hooks are optional\n\t\t\tconst isNotFound = error instanceof Error &&\n\t\t\t\t'code' in error &&\n\t\t\t\t(error as NodeJS.ErrnoException).code === 'ENOENT';\n\n\t\t\tif (!isNotFound) {\n\t\t\t\tconsole.warn(`  Hook ${hookName} failed: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Install dependencies\n\t */\n\tprivate async installDependencies(\n\t\ttargetDir: string,\n\t\tpackageManager: string | undefined,\n\t\tcustomCommand?: string,\n\t): Promise<void> {\n\t\tconst { spawn } = await import(\"node:child_process\");\n\n\t\t// Use custom command or detect package manager\n\t\tconst command = customCommand || this.getInstallCommand(packageManager);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst [cmd, ...args] = command.split(\" \");\n\n\t\t\tconst proc = spawn(cmd, args, {\n\t\t\t\tcwd: targetDir,\n\t\t\t\tstdio: \"inherit\",\n\t\t\t\tshell: true,\n\t\t\t});\n\n\t\t\tproc.on(\"close\", (code) => {\n\t\t\t\tif (code === 0) {\n\t\t\t\t\tresolve();\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(`Install command failed with code ${code}`));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tproc.on(\"error\", (error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Run post-install commands\n\t */\n\tprivate async runPostInstallCommands(\n\t\ttargetDir: string,\n\t\tcommands: string[],\n\t): Promise<void> {\n\t\tconst { spawn } = await import(\"node:child_process\");\n\n\t\tconsole.log(`\\n Running ${commands.length} post-install command(s)...\\n`);\n\n\t\tfor (const command of commands) {\n\t\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\t\tconst [cmd, ...args] = command.split(\" \");\n\n\t\t\t\tconst proc = spawn(cmd, args, {\n\t\t\t\t\tcwd: targetDir,\n\t\t\t\t\tstdio: \"inherit\",\n\t\t\t\t\tshell: true,\n\t\t\t\t});\n\n\t\t\t\tproc.on(\"close\", (code) => {\n\t\t\t\t\tif (code === 0) {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error(`Post-install command \"${command}\" failed with code ${code}`));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tproc.on(\"error\", (error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get install command for package manager\n\t */\n\tprivate getInstallCommand(packageManager?: string): string {\n\t\tswitch (packageManager) {\n\t\t\tcase \"pnpm\":\n\t\t\t\treturn \"pnpm install\";\n\t\t\tcase \"yarn\":\n\t\t\t\treturn \"yarn install\";\n\t\t\tcase \"bun\":\n\t\t\t\treturn \"bun install\";\n\t\t\tcase \"npm\":\n\t\t\tdefault:\n\t\t\t\treturn \"npm install\";\n\t\t}\n\t}\n\n\t/**\n\t * Run smoke test\n\t */\n\tprivate async runSmokeTest(targetDir: string, smokeTestCommand: string): Promise<void> {\n\t\tconst { spawn } = await import(\"node:child_process\");\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst [cmd, ...args] = smokeTestCommand.split(\" \");\n\n\t\t\tconst proc = spawn(cmd, args, {\n\t\t\t\tcwd: targetDir,\n\t\t\t\tstdio: \"inherit\",\n\t\t\t\tshell: true,\n\t\t\t});\n\n\t\t\tproc.on(\"close\", (code) => {\n\t\t\t\tif (code === 0) {\n\t\t\t\t\tresolve();\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(`Smoke test failed with code ${code} (continuing anyway)`);\n\t\t\t\t\tresolve(); // Don't fail scaffolding due to smoke test failure\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tproc.on(\"error\", (error) => {\n\t\t\t\tconsole.warn(`Smoke test error: ${error} (continuing anyway)`);\n\t\t\t\tresolve(); // Don't fail scaffolding\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Write scaffold metadata to .mcp-template.json\n\t */\n\tprivate async writeMetadata(\n\t\ttargetDir: string,\n\t\ttemplate: Template,\n\t\tvariables: Record<string, string>,\n\t): Promise<void> {\n\t\tconst metadata: ScaffoldMetadata = {\n\t\t\tid: template.config.id,\n\t\t\tversion: template.config.version,\n\t\t\tname: template.config.name,\n\t\t\tmcp_sdk_version: template.config.dependencies.mcp_sdk,\n\t\t\tagents_version: template.config.dependencies.agents,\n\t\t\tscaffolded_at: new Date().toISOString(),\n\t\t\tvariables,\n\t\t};\n\n\t\tconst metadataPath = join(targetDir, \".mcp-template.json\");\n\t\tawait writeFile(metadataPath, JSON.stringify(metadata, null, \"\\t\"), \"utf-8\");\n\t}\n}\n","/**\n * JSON Output Utility\n *\n * Handles outputting command results in either JSON or human-readable format.\n */\n\n/**\n * Output a result in JSON or human-readable format\n *\n * @param result - The result object to output\n * @param jsonMode - Whether to output as JSON\n * @param fallbackFormatter - Function to format result as human-readable text\n */\nexport function outputResult<T>(\n\tresult: T,\n\tjsonMode: boolean,\n\tfallbackFormatter?: (result: T) => void,\n): void {\n\tif (jsonMode) {\n\t\tconsole.log(JSON.stringify(result, null, 2));\n\t} else if (fallbackFormatter) {\n\t\tfallbackFormatter(result);\n\t}\n}\n","/**\n * Progress reporter for long-running CLI operations\n *\n * Provides real-time progress feedback in both JSON (NDJSON) and text modes.\n * Designed for AI agent consumption with structured, parseable output.\n */\n\nexport interface ProgressStep {\n\tid: string;\n\tdescription: string;\n\tstatus: \"pending\" | \"in_progress\" | \"completed\" | \"failed\";\n\terror?: string;\n}\n\nexport interface ProgressEvent {\n\ttype: \"start\" | \"step_update\" | \"complete\";\n\ttimestamp: string;\n\tstep?: ProgressStep;\n\ttotalSteps?: number;\n\tcompletedSteps?: number;\n}\n\n/**\n * Progress reporter for CLI operations\n *\n * JSON mode: Outputs NDJSON (newline-delimited JSON) events\n * Text mode: Outputs formatted progress with visual indicators\n */\nexport class ProgressReporter {\n\tprivate steps: Map<string, ProgressStep> = new Map();\n\tprivate startTime: number = 0;\n\n\tconstructor(private jsonMode: boolean = false) {}\n\n\t/**\n\t * Start progress tracking with a list of steps\n\t */\n\tstart(stepDescriptions: string[]): void {\n\t\tthis.startTime = Date.now();\n\t\tthis.steps.clear();\n\n\t\t// Initialize all steps as pending\n\t\tstepDescriptions.forEach((description, index) => {\n\t\t\tconst id = `step-${index + 1}`;\n\t\t\tthis.steps.set(id, {\n\t\t\t\tid,\n\t\t\t\tdescription,\n\t\t\t\tstatus: \"pending\",\n\t\t\t});\n\t\t});\n\n\t\tthis.emitEvent({\n\t\t\ttype: \"start\",\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t\ttotalSteps: this.steps.size,\n\t\t\tcompletedSteps: 0,\n\t\t});\n\n\t\tif (!this.jsonMode) {\n\t\t\tconsole.log(\"\\n Starting operation...\\n\");\n\t\t}\n\t}\n\n\t/**\n\t * Update the status of a specific step\n\t */\n\tupdateStep(\n\t\tstepId: string,\n\t\tstatus: ProgressStep[\"status\"],\n\t\terror?: string,\n\t): void {\n\t\tconst step = this.steps.get(stepId);\n\t\tif (!step) {\n\t\t\tthrow new Error(`Unknown step: ${stepId}`);\n\t\t}\n\n\t\tstep.status = status;\n\t\tif (error) {\n\t\t\tstep.error = error;\n\t\t}\n\n\t\tthis.emitEvent({\n\t\t\ttype: \"step_update\",\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t\tstep: { ...step },\n\t\t\ttotalSteps: this.steps.size,\n\t\t\tcompletedSteps: this.getCompletedCount(),\n\t\t});\n\n\t\tif (!this.jsonMode) {\n\t\t\tthis.renderTextStep(step);\n\t\t}\n\t}\n\n\t/**\n\t * Mark operation as complete\n\t */\n\tcomplete(): void {\n\t\tconst duration = Date.now() - this.startTime;\n\n\t\tthis.emitEvent({\n\t\t\ttype: \"complete\",\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t\ttotalSteps: this.steps.size,\n\t\t\tcompletedSteps: this.getCompletedCount(),\n\t\t});\n\n\t\tif (!this.jsonMode) {\n\t\t\tconst failed = Array.from(this.steps.values()).filter(\n\t\t\t\t(s) => s.status === \"failed\",\n\t\t\t);\n\t\t\tif (failed.length === 0) {\n\t\t\t\tconsole.log(`\\n Operation completed in ${duration}ms\\n`);\n\t\t\t} else {\n\t\t\t\tconsole.log(\n\t\t\t\t\t`\\n  Operation completed with ${failed.length} failed step(s) in ${duration}ms\\n`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get current progress summary\n\t */\n\tgetProgress(): {\n\t\ttotal: number;\n\t\tcompleted: number;\n\t\tfailed: number;\n\t\tinProgress: number;\n\t} {\n\t\tconst steps = Array.from(this.steps.values());\n\t\treturn {\n\t\t\ttotal: steps.length,\n\t\t\tcompleted: steps.filter((s) => s.status === \"completed\").length,\n\t\t\tfailed: steps.filter((s) => s.status === \"failed\").length,\n\t\t\tinProgress: steps.filter((s) => s.status === \"in_progress\").length,\n\t\t};\n\t}\n\n\t/**\n\t * Get all steps\n\t */\n\tgetSteps(): ProgressStep[] {\n\t\treturn Array.from(this.steps.values());\n\t}\n\n\t/**\n\t * Emit a progress event (NDJSON in JSON mode)\n\t */\n\tprivate emitEvent(event: ProgressEvent): void {\n\t\tif (this.jsonMode) {\n\t\t\tconsole.log(JSON.stringify(event));\n\t\t}\n\t}\n\n\t/**\n\t * Render a step in text mode\n\t */\n\tprivate renderTextStep(step: ProgressStep): void {\n\t\tlet icon: string;\n\t\tlet color: string;\n\n\t\tswitch (step.status) {\n\t\t\tcase \"pending\":\n\t\t\t\ticon = \"\";\n\t\t\t\tcolor = \"\\x1b[90m\"; // Gray\n\t\t\t\tbreak;\n\t\t\tcase \"in_progress\":\n\t\t\t\ticon = \"\";\n\t\t\t\tcolor = \"\\x1b[36m\"; // Cyan\n\t\t\t\tbreak;\n\t\t\tcase \"completed\":\n\t\t\t\ticon = \"\";\n\t\t\t\tcolor = \"\\x1b[32m\"; // Green\n\t\t\t\tbreak;\n\t\t\tcase \"failed\":\n\t\t\t\ticon = \"\";\n\t\t\t\tcolor = \"\\x1b[31m\"; // Red\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst reset = \"\\x1b[0m\";\n\t\tconsole.log(`${color}${icon} ${step.description}${reset}`);\n\n\t\tif (step.error) {\n\t\t\tconsole.log(`   ${color} ${step.error}${reset}`);\n\t\t}\n\t}\n\n\t/**\n\t * Get count of completed steps\n\t */\n\tprivate getCompletedCount(): number {\n\t\treturn Array.from(this.steps.values()).filter(\n\t\t\t(s) => s.status === \"completed\",\n\t\t).length;\n\t}\n}\n","/**\n * New Server Command\n *\n * Scaffolds a new MCP server project from a template.\n */\n\nimport { Command } from \"commander\";\nimport { TemplateRegistry } from \"../template-system/registry.js\";\nimport { TemplateProcessor } from \"../template-system/processor.js\";\nimport type { PackageManager } from \"../template-system/types.js\";\nimport type { NewServerResult } from \"../../types/command-results.js\";\nimport { outputResult } from \"./shared/json-output.js\";\nimport { ProgressReporter } from \"../../services/progress-reporter.js\";\nimport * as path from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\n\n/**\n * Create the 'new server' command\n */\nexport function createNewServerCommand(): Command {\n\tconst command = new Command(\"server\")\n\t\t.description(\"Scaffold a new MCP server project\")\n\t\t.showHelpAfterError('\\n Tip: Run with --help to see all available options')\n\t\t.requiredOption(\"--name <name>\", \"Project name (lowercase with hyphens)\")\n\t\t.option(\"--template <id>\", \"Template ID to use\", \"cloudflare-remote\")\n\t\t.option(\"--description <desc>\", \"Project description\")\n\t\t.option(\"--port <port>\", \"Development server port\", \"8788\")\n\t\t.option(\"--output <path>\", \"Output directory (defaults to current directory). Tip: Use $(git rev-parse --show-toplevel) for git root\")\n\t\t.option(\"--no-install\", \"Skip dependency installation\")\n\t\t.option(\"--pm <manager>\", \"Package manager (npm, pnpm, yarn, bun)\", \"npm\")\n\t\t.option(\"--dev\", \"Development mode: use local mcp-server-kit paths instead of published package\")\n\t\t.option(\"--json\", \"Output result as JSON\")\n\t\t.action(async (options) => {\n\t\t\t// Initialize progress reporter (outside try block for catch access)\n\t\t\tlet progress: ProgressReporter | undefined;\n\n\t\t\ttry {\n\t\t\t\tprogress = new ProgressReporter(!!options.json);\n\n\t\t\t\t// Define scaffolding steps\n\t\t\t\tconst steps = [\n\t\t\t\t\t\"Validating configuration\",\n\t\t\t\t\t\"Loading template\",\n\t\t\t\t\t\"Creating project structure\",\n\t\t\t\t];\n\n\t\t\t\t// Add dependency installation step if enabled\n\t\t\t\tif (options.install) {\n\t\t\t\t\tsteps.push(\"Installing dependencies\");\n\t\t\t\t\tsteps.push(\"Running post-install commands\");\n\t\t\t\t}\n\n\t\t\t\tsteps.push(\"Finalizing project\");\n\n\t\t\t\tprogress.start(steps);\n\n\t\t\t\t// Step 1: Validating configuration\n\t\t\t\tprogress.updateStep(\"step-1\", \"in_progress\");\n\n\t\t\t\t// Validate package manager\n\t\t\t\tconst validPMs = [\"npm\", \"pnpm\", \"yarn\", \"bun\"];\n\t\t\t\tif (!validPMs.includes(options.pm)) {\n\t\t\t\t\tconst errorMessage = `Invalid package manager '${options.pm}'. Valid options: ${validPMs.join(\", \")}`;\n\t\t\t\t\tprogress.updateStep(\"step-1\", \"failed\", errorMessage);\n\t\t\t\t\tprogress.complete();\n\n\t\t\t\t\tif (options.json) {\n\t\t\t\t\t\tconst result: NewServerResult = {\n\t\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\t\tprojectName: options.name,\n\t\t\t\t\t\t\ttemplateId: options.template,\n\t\t\t\t\t\t\tpath: \"\",\n\t\t\t\t\t\t\tnextSteps: [],\n\t\t\t\t\t\t\terror: errorMessage,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(` Error: ${errorMessage}`);\n\t\t\t\t\t}\n\t\t\t\t\tprocess.exit(1);\n\t\t\t\t}\n\n\t\t\t\t// Create registry and processor\n\t\t\t\tconst registry = new TemplateRegistry();\n\t\t\t\tconst processor = new TemplateProcessor(registry);\n\n\t\t\t\tprogress.updateStep(\"step-1\", \"completed\");\n\n\t\t\t\t// Step 2: Loading template\n\t\t\t\tprogress.updateStep(\"step-2\", \"in_progress\");\n\n\t\t\t\t// Check if template exists\n\t\t\t\tconst templateExists = await registry.templateExists(options.template);\n\t\t\t\tif (!templateExists) {\n\t\t\t\t\tconst templates = await registry.listTemplates();\n\t\t\t\t\tconst availableTemplates = templates.map((t) => `${t.id}: ${t.name}`).join(\", \");\n\t\t\t\t\tconst errorMessage = `Template '${options.template}' not found. Available: ${availableTemplates}`;\n\n\t\t\t\t\tprogress.updateStep(\"step-2\", \"failed\", errorMessage);\n\t\t\t\t\tprogress.complete();\n\n\t\t\t\t\tif (options.json) {\n\t\t\t\t\t\tconst result: NewServerResult = {\n\t\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\t\tprojectName: options.name,\n\t\t\t\t\t\t\ttemplateId: options.template,\n\t\t\t\t\t\t\tpath: \"\",\n\t\t\t\t\t\t\tnextSteps: [],\n\t\t\t\t\t\t\terror: errorMessage,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(` Error: Template '${options.template}' not found`);\n\t\t\t\t\t\tconsole.error(\"\\nAvailable templates:\");\n\t\t\t\t\t\tfor (const t of templates) {\n\t\t\t\t\t\t\tconsole.error(`  - ${t.id}: ${t.name}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tprocess.exit(1);\n\t\t\t\t}\n\n\t\t\t\t// Build variables\n\t\t\t\tconst variables: Record<string, string> = {\n\t\t\t\t\tPROJECT_NAME: options.name,\n\t\t\t\t\tMCP_SERVER_NAME: options.description || options.name,\n\t\t\t\t\tPORT: options.port,\n\t\t\t\t};\n\n\t\t\t\tif (options.description) {\n\t\t\t\t\tvariables.DESCRIPTION = options.description;\n\t\t\t\t}\n\n\t\t\t\t// In dev mode, calculate absolute path to mcp-server-kit\n\t\t\t\tif (options.dev) {\n\t\t\t\t\tconst __filename = fileURLToPath(import.meta.url);\n\t\t\t\t\tconst __dirname = path.dirname(__filename);\n\t\t\t\t\tconst mcpKitRoot = path.resolve(__dirname, \"../\");\n\t\t\t\t\tvariables.DEV_MODE = \"true\";\n\t\t\t\t\tvariables.MCP_KIT_PATH = mcpKitRoot;\n\t\t\t\t\tif (!options.json) {\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t` Development mode: Using local mcp-server-kit at ${mcpKitRoot}\\n`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Determine target directory\n\t\t\t\tconst targetDir = options.output\n\t\t\t\t\t? path.join(options.output, options.name)\n\t\t\t\t\t: `./${options.name}`;\n\n\t\t\t\tprogress.updateStep(\"step-2\", \"completed\");\n\n\t\t\t\t// Step 3: Creating project structure\n\t\t\t\tprogress.updateStep(\"step-3\", \"in_progress\");\n\n\t\t\t\t// Scaffold the project (this handles steps 3-5 internally)\n\t\t\t\tconst scaffoldResult = await processor.scaffold({\n\t\t\t\t\ttemplate: options.template,\n\t\t\t\t\ttargetDir,\n\t\t\t\t\tvariables,\n\t\t\t\t\tnoInstall: !options.install,\n\t\t\t\t\tpackageManager: options.pm as PackageManager,\n\t\t\t\t});\n\n\t\t\t\t// Note: The scaffold operation internally handles:\n\t\t\t\t// - Creating project structure (step 3)\n\t\t\t\t// - Installing dependencies (step 4, if enabled)\n\t\t\t\t// - Running post-install commands (step 5, if enabled)\n\n\t\t\t\t// Mark appropriate steps as completed based on what scaffold did\n\t\t\t\tprogress.updateStep(\"step-3\", \"completed\");\n\n\t\t\t\tif (options.install) {\n\t\t\t\t\tprogress.updateStep(\"step-4\", \"completed\");\n\t\t\t\t\tprogress.updateStep(\"step-5\", \"completed\");\n\t\t\t\t\tprogress.updateStep(\"step-6\", \"in_progress\");\n\t\t\t\t} else {\n\t\t\t\t\tprogress.updateStep(\"step-4\", \"in_progress\");\n\t\t\t\t}\n\n\t\t\t\t// Handle result\n\t\t\t\tif (scaffoldResult.success) {\n\t\t\t\t\t// Mark final step as completed\n\t\t\t\t\tconst finalStepId = options.install ? \"step-6\" : \"step-4\";\n\t\t\t\t\tprogress.updateStep(finalStepId, \"completed\");\n\t\t\t\t\tprogress.complete();\n\n\t\t\t\t\tconst nextSteps = [];\n\t\t\t\t\tnextSteps.push(`cd ${targetDir}`);\n\t\t\t\t\tif (!options.install) {\n\t\t\t\t\t\tnextSteps.push(`${options.pm} install`);\n\t\t\t\t\t}\n\t\t\t\t\tnextSteps.push(`${options.pm} run dev`);\n\n\t\t\t\t\tconst result: NewServerResult = {\n\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\tprojectName: options.name,\n\t\t\t\t\t\ttemplateId: options.template,\n\t\t\t\t\t\tpath: path.resolve(targetDir),\n\t\t\t\t\t\tnextSteps,\n\t\t\t\t\t\tdevMode: options.dev,\n\t\t\t\t\t};\n\n\t\t\t\t\toutputResult(result, !!options.json, (r) => {\n\t\t\t\t\t\tconsole.log(`\\n Creating MCP server: ${options.name}\\n`);\n\t\t\t\t\t\tconsole.log(`\\n Successfully created ${options.name}!\\n`);\n\t\t\t\t\t\tif (options.dev) {\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t\" Development mode enabled - using local mcp-server-kit\\n\",\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log(\"Next steps:\");\n\t\t\t\t\t\tfor (const step of r.nextSteps) {\n\t\t\t\t\t\t\tconsole.log(`  ${step}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log(\"\\nHappy coding! \\n\");\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Mark current step as failed\n\t\t\t\t\tconst currentStepId = \"step-3\";\n\t\t\t\t\tprogress.updateStep(currentStepId, \"failed\", scaffoldResult.error);\n\t\t\t\t\tprogress.complete();\n\n\t\t\t\t\tconst result: NewServerResult = {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tprojectName: options.name,\n\t\t\t\t\t\ttemplateId: options.template,\n\t\t\t\t\t\tpath: targetDir,\n\t\t\t\t\t\tnextSteps: [],\n\t\t\t\t\t\terror: scaffoldResult.error,\n\t\t\t\t\t};\n\n\t\t\t\t\tif (options.json) {\n\t\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(`\\n Error: ${scaffoldResult.error}\\n`);\n\t\t\t\t\t}\n\t\t\t\t\tprocess.exit(1);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconst errorMessage = error instanceof Error ? error.message : String(error);\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconst result: NewServerResult = {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tprojectName: options.name,\n\t\t\t\t\t\ttemplateId: options.template,\n\t\t\t\t\t\tpath: \"\",\n\t\t\t\t\t\tnextSteps: [],\n\t\t\t\t\t\terror: errorMessage,\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`\\n Error: ${errorMessage}\\n`);\n\t\t\t\t}\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n\n\treturn command;\n}\n\n/**\n * Create the 'new' command with 'server' subcommand\n */\nexport function createNewCommand(): Command {\n\tconst newCmd = new Command(\"new\").description(\"Create a new MCP server or component\");\n\n\tnewCmd.addCommand(createNewServerCommand());\n\n\treturn newCmd;\n}\n","/**\n * Template Commands\n *\n * Commands for managing and discovering templates.\n */\n\nimport { Command } from \"commander\";\nimport { TemplateRegistry } from \"../template-system/registry.js\";\nimport type { TemplateFilter } from \"../template-system/types.js\";\n\n/**\n * Create the 'template list' command\n */\nfunction createListCommand(): Command {\n\treturn new Command(\"list\")\n\t\t.description(\"List available templates\")\n\t\t.option(\"--json\", \"Output as JSON\")\n\t\t.option(\"--runtime <runtime>\", \"Filter by runtime\")\n\t\t.option(\"--transport <transport>\", \"Filter by transport\")\n\t\t.option(\"--deployment <deployment>\", \"Filter by deployment (remote/local)\")\n\t\t.option(\"--language <language>\", \"Filter by language (typescript/javascript)\")\n\t\t.action(async (options) => {\n\t\t\ttry {\n\t\t\t\tconst registry = new TemplateRegistry();\n\n\t\t\t\t// Build filter\n\t\t\t\tconst filter: TemplateFilter = {};\n\t\t\t\tif (options.runtime) filter.runtime = options.runtime;\n\t\t\t\tif (options.transport) filter.transport = options.transport;\n\t\t\t\tif (options.deployment) filter.deployment = options.deployment;\n\t\t\t\tif (options.language) filter.language = options.language;\n\n\t\t\t\t// Get templates\n\t\t\t\tconst templates = await registry.listTemplates(filter);\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconsole.log(JSON.stringify(templates, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tif (templates.length === 0) {\n\t\t\t\t\t\tconsole.log(\"No templates found matching the filter criteria.\\n\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(`\\nAvailable Templates (${templates.length}):\\n`);\n\t\t\t\t\tfor (const template of templates) {\n\t\t\t\t\t\tconsole.log(`  ${template.id}`);\n\t\t\t\t\t\tconsole.log(`    Name: ${template.name}`);\n\t\t\t\t\t\tconsole.log(`    Description: ${template.description}`);\n\t\t\t\t\t\tconsole.log(`    Runtime: ${template.capabilities.runtime}`);\n\t\t\t\t\t\tconsole.log(`    Transport: ${template.capabilities.transport.join(\", \")}`);\n\t\t\t\t\t\tconsole.log(`    Deployment: ${template.capabilities.deployment}`);\n\t\t\t\t\t\tconsole.log(`    Language: ${template.capabilities.language}`);\n\t\t\t\t\t\tconsole.log();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Error: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n}\n\n/**\n * Create the 'template info' command\n */\nfunction createInfoCommand(): Command {\n\treturn new Command(\"info\")\n\t\t.description(\"Show detailed information about a template\")\n\t\t.argument(\"<template-id>\", \"Template ID\")\n\t\t.option(\"--json\", \"Output as JSON\")\n\t\t.action(async (templateId, options) => {\n\t\t\ttry {\n\t\t\t\tconst registry = new TemplateRegistry();\n\t\t\t\tconst template = await registry.getTemplate(templateId);\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconsole.log(JSON.stringify(template.config, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(`\\nTemplate: ${template.config.name}\\n`);\n\t\t\t\t\tconsole.log(`ID: ${template.config.id}`);\n\t\t\t\t\tconsole.log(`Version: ${template.config.version}`);\n\t\t\t\t\tconsole.log(`Description: ${template.config.description}`);\n\t\t\t\t\tconsole.log();\n\n\t\t\t\t\tconsole.log(\"Capabilities:\");\n\t\t\t\t\tconsole.log(`  Runtime: ${template.config.capabilities.runtime}`);\n\t\t\t\t\tconsole.log(`  Transport: ${template.config.capabilities.transport.join(\", \")}`);\n\t\t\t\t\tconsole.log(`  Deployment: ${template.config.capabilities.deployment}`);\n\t\t\t\t\tconsole.log(`  Language: ${template.config.capabilities.language}`);\n\t\t\t\t\tconsole.log();\n\n\t\t\t\t\tconsole.log(\"Features:\");\n\t\t\t\t\tconsole.log(`  Unit Testing: ${template.config.features.unitTesting ? \"\" : \"\"}`);\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t`  Integration Testing: ${template.config.features.integrationTesting ? \"\" : \"\"}`,\n\t\t\t\t\t);\n\t\t\t\t\tconsole.log(`  Documentation: ${template.config.features.documentation ? \"\" : \"\"}`);\n\t\t\t\t\tif (template.config.features.exampleTools.length > 0) {\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t`  Example Tools: ${template.config.features.exampleTools.join(\", \")}`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log();\n\n\t\t\t\t\tif (template.config.scaffolding.variables.length > 0) {\n\t\t\t\t\t\tconsole.log(\"Variables:\");\n\t\t\t\t\t\tfor (const v of template.config.scaffolding.variables) {\n\t\t\t\t\t\t\tconst req = v.required ? \"(required)\" : \"(optional)\";\n\t\t\t\t\t\t\tconst def = v.default ? ` [default: ${v.default}]` : \"\";\n\t\t\t\t\t\t\tconsole.log(`  ${v.name} ${req}${def}`);\n\t\t\t\t\t\t\tif (v.prompt) {\n\t\t\t\t\t\t\t\tconsole.log(`    ${v.prompt}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Error: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n}\n\n/**\n * Create the 'template validate' command\n */\nfunction createValidateCommand(): Command {\n\treturn new Command(\"validate\")\n\t\t.description(\"Validate a template configuration\")\n\t\t.argument(\"<template-id>\", \"Template ID\")\n\t\t.option(\"--json\", \"Output as JSON\")\n\t\t.action(async (templateId, options) => {\n\t\t\ttry {\n\t\t\t\tconst registry = new TemplateRegistry();\n\t\t\t\tconst result = await registry.validateTemplate(templateId);\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tif (result.valid) {\n\t\t\t\t\t\tconsole.log(`\\n Template '${templateId}' is valid\\n`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(`\\n Template '${templateId}' has validation errors:\\n`);\n\t\t\t\t\t\tfor (const error of result.errors) {\n\t\t\t\t\t\t\tconsole.log(`  - ${error}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result.warnings.length > 0) {\n\t\t\t\t\t\tconsole.log(\"Warnings:\");\n\t\t\t\t\t\tfor (const warning of result.warnings) {\n\t\t\t\t\t\t\tconsole.log(`    ${warning}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!result.valid) {\n\t\t\t\t\tprocess.exit(1);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Error: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n}\n\n/**\n * Create the 'template capabilities' command\n */\nfunction createCapabilitiesCommand(): Command {\n\treturn new Command(\"capabilities\")\n\t\t.description(\"Show all available capabilities across templates\")\n\t\t.option(\"--json\", \"Output as JSON\")\n\t\t.action(async (options) => {\n\t\t\ttry {\n\t\t\t\tconst registry = new TemplateRegistry();\n\t\t\t\tconst capabilities = await registry.getCapabilities();\n\n\t\t\t\tconst output = {\n\t\t\t\t\truntimes: Array.from(capabilities.runtimes),\n\t\t\t\t\ttransports: Array.from(capabilities.transports),\n\t\t\t\t\tdeployments: Array.from(capabilities.deployments),\n\t\t\t\t\tlanguages: Array.from(capabilities.languages),\n\t\t\t\t};\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconsole.log(JSON.stringify(output, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"\\nAvailable Capabilities:\\n\");\n\t\t\t\t\tconsole.log(\"Runtimes:\");\n\t\t\t\t\tfor (const runtime of output.runtimes) {\n\t\t\t\t\t\tconsole.log(`  - ${runtime}`);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log();\n\n\t\t\t\t\tconsole.log(\"Transports:\");\n\t\t\t\t\tfor (const transport of output.transports) {\n\t\t\t\t\t\tconsole.log(`  - ${transport}`);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log();\n\n\t\t\t\t\tconsole.log(\"Deployments:\");\n\t\t\t\t\tfor (const deployment of output.deployments) {\n\t\t\t\t\t\tconsole.log(`  - ${deployment}`);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log();\n\n\t\t\t\t\tconsole.log(\"Languages:\");\n\t\t\t\t\tfor (const language of output.languages) {\n\t\t\t\t\t\tconsole.log(`  - ${language}`);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Error: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n}\n\n/**\n * Create the main 'template' command\n */\nexport function createTemplateCommand(): Command {\n\tconst templateCmd = new Command(\"template\").description(\"Manage and discover templates\");\n\n\ttemplateCmd.addCommand(createListCommand());\n\ttemplateCmd.addCommand(createInfoCommand());\n\ttemplateCmd.addCommand(createValidateCommand());\n\ttemplateCmd.addCommand(createCapabilitiesCommand());\n\n\treturn templateCmd;\n}\n","/**\n * Backup and Restore Utilities\n *\n * Provides safe file backup/restore functionality for add-auth command.\n * Creates timestamped backups and supports rollback on failure.\n */\n\nimport { cp, rm, readdir, stat } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\n\n/**\n * Create a backup of important project files\n *\n * @param cwd - Project root directory\n * @returns Path to backup directory\n */\nexport async function createBackup(cwd: string): Promise<string> {\n\tconst timestamp = Date.now();\n\tconst backupDir = join(cwd, `.backup-auth-${timestamp}`);\n\n\t// Backup src directory\n\tconst srcDir = join(cwd, \"src\");\n\tif (existsSync(srcDir)) {\n\t\tawait cp(srcDir, join(backupDir, \"src\"), { recursive: true });\n\t}\n\n\t// Backup important config files\n\tconst filesToBackup = [\n\t\t\"package.json\",\n\t\t\"wrangler.toml\",\n\t\t\"wrangler.jsonc\",\n\t\t\"wrangler.json\",\n\t\t\"vercel.json\",\n\t\t\"next.config.js\",\n\t\t\"next.config.mjs\",\n\t\t\"next.config.ts\",\n\t\t\"README.md\",\n\t\t\".gitignore\",\n\t\t\".env\",\n\t\t\".env.local\",\n\t];\n\n\tfor (const file of filesToBackup) {\n\t\tconst filePath = join(cwd, file);\n\t\tif (existsSync(filePath)) {\n\t\t\tawait cp(filePath, join(backupDir, file));\n\t\t}\n\t}\n\n\treturn backupDir;\n}\n\n/**\n * Restore project from backup directory\n *\n * @param backupDir - Path to backup directory\n * @param cwd - Project root directory\n */\nexport async function restoreFromBackup(\n\tbackupDir: string,\n\tcwd: string,\n): Promise<void> {\n\tif (!existsSync(backupDir)) {\n\t\tthrow new Error(`Backup directory not found: ${backupDir}`);\n\t}\n\n\t// Restore src directory\n\tconst backupSrcDir = join(backupDir, \"src\");\n\tif (existsSync(backupSrcDir)) {\n\t\tconst targetSrcDir = join(cwd, \"src\");\n\n\t\t// Remove current src directory if it exists\n\t\tif (existsSync(targetSrcDir)) {\n\t\t\tawait rm(targetSrcDir, { recursive: true, force: true });\n\t\t}\n\n\t\t// Restore from backup\n\t\tawait cp(backupSrcDir, targetSrcDir, { recursive: true });\n\t}\n\n\t// Restore config files\n\tconst backupFiles = await readdir(backupDir);\n\n\tfor (const file of backupFiles) {\n\t\tif (file === \"src\") {\n\t\t\tcontinue; // Already handled\n\t\t}\n\n\t\tconst backupFilePath = join(backupDir, file);\n\t\tconst targetFilePath = join(cwd, file);\n\n\t\t// Only restore if it's a file, not a directory\n\t\tconst stats = await stat(backupFilePath);\n\t\tif (stats.isFile()) {\n\t\t\tawait cp(backupFilePath, targetFilePath);\n\t\t}\n\t}\n}\n\n/**\n * Remove backup directory\n *\n * @param backupDir - Path to backup directory\n */\nexport async function removeBackup(backupDir: string): Promise<void> {\n\tif (existsSync(backupDir)) {\n\t\tawait rm(backupDir, { recursive: true, force: true });\n\t}\n}\n\n/**\n * List all backup directories in a project\n *\n * @param cwd - Project root directory\n * @returns Array of backup directory paths\n */\nexport async function listBackups(cwd: string): Promise<string[]> {\n\tif (!existsSync(cwd)) {\n\t\treturn [];\n\t}\n\n\tconst entries = await readdir(cwd);\n\tconst backups: string[] = [];\n\n\tfor (const entry of entries) {\n\t\tif (entry.startsWith(\".backup-auth-\")) {\n\t\t\tconst fullPath = join(cwd, entry);\n\t\t\tconst stats = await stat(fullPath);\n\n\t\t\tif (stats.isDirectory()) {\n\t\t\t\tbackups.push(fullPath);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Sort by timestamp (newest first)\n\treturn backups.sort().reverse();\n}\n","/**\n * Scaffold Orchestrator\n *\n * Implements the Template Method pattern to orchestrate scaffolding operations.\n * Eliminates duplication by extracting common flow: validate  backup  execute  cleanup/rollback.\n *\n * Strategies implement only their specific logic, while orchestrator handles:\n * - Validation coordination\n * - Backup/restore on failure\n * - Error handling\n * - Success cleanup\n */\n\nimport {\n\tcreateBackup,\n\trestoreFromBackup,\n\tremoveBackup,\n} from \"../backup-restore.js\";\nimport type {\n\tScaffoldStrategy,\n\tScaffoldContext,\n\tScaffoldOptions,\n} from \"./types.js\";\n\n/**\n * Orchestrator for scaffolding operations\n *\n * Uses Strategy Pattern to delegate specific logic while handling common orchestration\n */\nexport class ScaffoldOrchestrator<TConfig = any, TResult extends Record<string, any> = any> {\n\t/**\n\t * Execute scaffolding with given strategy\n\t *\n\t * Template Method that defines the scaffolding algorithm:\n\t * 1. Create context\n\t * 2. Validate\n\t * 3. Backup (if needed)\n\t * 4. Execute strategy\n\t * 5. Cleanup backup on success\n\t * 6. Rollback on failure\n\t *\n\t * @param cwd - Current working directory\n\t * @param config - Configuration for scaffolding\n\t * @param strategy - Strategy to execute\n\t * @param options - Optional orchestration options\n\t * @returns Result from strategy\n\t */\n\tasync scaffold(\n\t\tcwd: string,\n\t\tconfig: TConfig,\n\t\tstrategy: ScaffoldStrategy<TConfig, TResult>,\n\t\toptions: ScaffoldOptions = {},\n\t): Promise<TResult> {\n\t\t// Create context\n\t\tconst context = this.createContext(cwd, config, strategy);\n\n\t\t// Dry run mode - validate only\n\t\tif (options.dryRun) {\n\t\t\tawait strategy.validate(cwd, config);\n\t\t\treturn context.result;\n\t\t}\n\n\t\ttry {\n\t\t\t// Step 1: Validation\n\t\t\tawait strategy.validate(cwd, config);\n\n\t\t\t// Step 2: Backup (if needed and not skipped)\n\t\t\tif (strategy.needsBackup() && !options.skipBackup) {\n\t\t\t\tcontext.backupDir = await createBackup(cwd);\n\t\t\t}\n\n\t\t\t// Step 3: Execute strategy-specific logic\n\t\t\tawait strategy.execute(context);\n\n\t\t\t// Step 4: Cleanup backup on success\n\t\t\tif (context.backupDir) {\n\t\t\t\tawait removeBackup(context.backupDir);\n\t\t\t\tcontext.backupDir = undefined;\n\t\t\t}\n\n\t\t\treturn context.result;\n\t\t} catch (error) {\n\t\t\t// Step 5: Rollback on failure\n\t\t\tif (context.backupDir) {\n\t\t\t\ttry {\n\t\t\t\t\tawait restoreFromBackup(context.backupDir, cwd);\n\t\t\t\t\tawait removeBackup(context.backupDir);\n\t\t\t\t} catch (rollbackError) {\n\t\t\t\t\t// Add rollback failure to error context\n\t\t\t\t\tconst rollbackMsg =\n\t\t\t\t\t\trollbackError instanceof Error\n\t\t\t\t\t\t\t? rollbackError.message\n\t\t\t\t\t\t\t: String(rollbackError);\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Original error: ${error instanceof Error ? error.message : String(error)}\\nRollback also failed: ${rollbackMsg}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t/**\n\t * Create scaffolding context\n\t *\n\t * @param cwd - Current working directory\n\t * @param config - Configuration\n\t * @param strategy - Strategy (used to create initial result)\n\t * @returns Initial context\n\t */\n\tprivate createContext(\n\t\tcwd: string,\n\t\tconfig: TConfig,\n\t\tstrategy: ScaffoldStrategy<TConfig, TResult>,\n\t): ScaffoldContext<TConfig, TResult> {\n\t\treturn {\n\t\t\tcwd,\n\t\t\tconfig,\n\t\t\tresult: strategy.createResult(),\n\t\t\tmetadata: {},\n\t\t};\n\t}\n}\n","/**\n * Registration Service\n *\n * Handles entity registration in src/index.ts\n * Shared logic for adding imports and registration calls\n */\n\nimport { readFile, writeFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\n\n/**\n * Configuration for entity registration\n */\nexport interface RegistrationConfig {\n\t/** Entity type (tool, prompt, resource) */\n\tentityType: \"tool\" | \"prompt\" | \"resource\";\n\t/** Entity type plural (tools, prompts, resources) */\n\tentityTypePlural: \"tools\" | \"prompts\" | \"resources\";\n\t/** Directory path (e.g., \"./tools/\") */\n\tdirectory: string;\n\t/** Function name suffix (e.g., \"Tool\", \"Prompt\", \"Resource\") */\n\tfunctionSuffix: string;\n}\n\n/**\n * Service for managing entity registrations in index.ts\n */\nexport class RegistrationService {\n\tprivate static readonly ENTITY_ORDER = [\"tool\", \"prompt\", \"resource\"];\n\n\t/**\n\t * Register an entity in src/index.ts\n\t */\n\tasync registerEntity(\n\t\tcwd: string,\n\t\tname: string,\n\t\tcapitalizedName: string,\n\t\tconfig: RegistrationConfig,\n\t): Promise<void> {\n\t\tconst indexPath = join(cwd, \"src\", \"index.ts\");\n\n\t\tif (!existsSync(indexPath)) {\n\t\t\tthrow new Error(\"src/index.ts not found\");\n\t\t}\n\n\t\tconst content = await readFile(indexPath, \"utf-8\");\n\t\tconst functionName = `register${capitalizedName}${config.functionSuffix}`;\n\n\t\t// Check if already registered\n\t\tif (content.includes(functionName)) {\n\t\t\tconsole.warn(\n\t\t\t\t`    ${config.entityType.charAt(0).toUpperCase() + config.entityType.slice(1)} already registered in src/index.ts`,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// Detect if function needs env parameter by reading the tool file\n\t\tconst needsEnv = await this.functionNeedsEnv(\n\t\t\tcwd,\n\t\t\tname,\n\t\t\tfunctionName,\n\t\t\tconfig,\n\t\t);\n\n\t\t// Add import and registration call\n\t\tconst importStatement = `import { ${functionName} } from \"${config.directory}${name}.js\";`;\n\t\tconst registrationCall = needsEnv\n\t\t\t? `\\t\\t${functionName}(this.server, this.env);`\n\t\t\t: `\\t\\t${functionName}(this.server);`;\n\n\t\tlet updatedContent = this.addImport(content, importStatement, config);\n\t\tupdatedContent = this.addRegistrationCall(\n\t\t\tupdatedContent,\n\t\t\tregistrationCall,\n\t\t\tconfig,\n\t\t);\n\n\t\tawait writeFile(indexPath, updatedContent, \"utf-8\");\n\t}\n\n\t/**\n\t * Check if an entity is already registered\n\t */\n\tasync isRegistered(\n\t\tcwd: string,\n\t\tcapitalizedName: string,\n\t\tconfig: RegistrationConfig,\n\t): Promise<boolean> {\n\t\tconst indexPath = join(cwd, \"src\", \"index.ts\");\n\n\t\tif (!existsSync(indexPath)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst content = await readFile(indexPath, \"utf-8\");\n\t\tconst functionName = `register${capitalizedName}${config.functionSuffix}`;\n\n\t\treturn content.includes(functionName);\n\t}\n\n\t/**\n\t * Add import statement to the file\n\t */\n\tprivate addImport(\n\t\tcontent: string,\n\t\timportStatement: string,\n\t\tconfig: RegistrationConfig,\n\t): string {\n\t\tlet updatedContent = content;\n\t\tconst currentTypeRegex = this.getImportRegex(config.directory);\n\n\t\t// Try to add after imports of the same type\n\t\tconst currentTypeMatches = Array.from(content.matchAll(currentTypeRegex));\n\n\t\tif (currentTypeMatches.length > 0) {\n\t\t\tconst lastMatch = currentTypeMatches[currentTypeMatches.length - 1];\n\t\t\tconst insertPos = lastMatch.index! + lastMatch[0].length;\n\t\t\treturn (\n\t\t\t\tcontent.slice(0, insertPos) +\n\t\t\t\t`\\n${importStatement}` +\n\t\t\t\tcontent.slice(insertPos)\n\t\t\t);\n\t\t}\n\n\t\t// No imports of same type, try fallback types in order\n\t\tconst currentIndex = RegistrationService.ENTITY_ORDER.indexOf(\n\t\t\tconfig.entityType,\n\t\t);\n\n\t\t// Try to add after previous entity types\n\t\tfor (let i = currentIndex - 1; i >= 0; i--) {\n\t\t\tconst fallbackType = RegistrationService.ENTITY_ORDER[i];\n\t\t\tconst fallbackDir = `./${fallbackType}s/`;\n\t\t\tconst fallbackRegex = this.getImportRegex(fallbackDir);\n\t\t\tconst fallbackMatches = Array.from(content.matchAll(fallbackRegex));\n\n\t\t\tif (fallbackMatches.length > 0) {\n\t\t\t\tconst lastMatch = fallbackMatches[fallbackMatches.length - 1];\n\t\t\t\tconst insertPos = lastMatch.index! + lastMatch[0].length;\n\t\t\t\tconst comment = `\\n\\n// ${config.entityTypePlural.charAt(0).toUpperCase() + config.entityTypePlural.slice(1)}\\n`;\n\t\t\t\treturn (\n\t\t\t\t\tcontent.slice(0, insertPos) +\n\t\t\t\t\tcomment +\n\t\t\t\t\timportStatement +\n\t\t\t\t\tcontent.slice(insertPos)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// Add after any imports\n\t\tconst lastImportMatch = content.match(\n\t\t\t/import\\s+[^;]+;(?=\\s*\\n\\s*(?:\\/\\*|\\/\\/|\\n|export|class))/g,\n\t\t);\n\n\t\tif (lastImportMatch) {\n\t\t\tconst lastImport = lastImportMatch[lastImportMatch.length - 1];\n\t\t\tconst insertPos = content.indexOf(lastImport) + lastImport.length;\n\t\t\tconst comment = `\\n\\n// ${config.entityTypePlural.charAt(0).toUpperCase() + config.entityTypePlural.slice(1)}\\n`;\n\t\t\treturn (\n\t\t\t\tcontent.slice(0, insertPos) +\n\t\t\t\tcomment +\n\t\t\t\timportStatement +\n\t\t\t\tcontent.slice(insertPos)\n\t\t\t);\n\t\t}\n\n\t\treturn updatedContent;\n\t}\n\n\t/**\n\t * Add registration call to init() method\n\t */\n\tprivate addRegistrationCall(\n\t\tcontent: string,\n\t\tregistrationCall: string,\n\t\tconfig: RegistrationConfig,\n\t): string {\n\t\tconst initMethodRegex = /async\\s+init\\(\\)\\s*\\{([^}]*)\\}/;\n\t\tconst initMatch = content.match(initMethodRegex);\n\n\t\tif (!initMatch) {\n\t\t\treturn content;\n\t\t}\n\n\t\tconst initBody = initMatch[1];\n\t\tconst currentTypePattern = `register\\\\w+${config.functionSuffix}\\\\(this\\\\.server\\\\);`;\n\t\tconst currentTypeRegex = new RegExp(`\\\\s+${currentTypePattern}`, \"g\");\n\t\tconst currentTypeMatches = initBody.match(currentTypeRegex);\n\n\t\t// Add after registrations of the same type\n\t\tif (currentTypeMatches) {\n\t\t\tconst lastCall = currentTypeMatches[currentTypeMatches.length - 1];\n\t\t\tconst insertPos =\n\t\t\t\tinitMatch.index! + initMatch[0].lastIndexOf(lastCall) + lastCall.length;\n\t\t\treturn (\n\t\t\t\tcontent.slice(0, insertPos) +\n\t\t\t\t`\\n${registrationCall}` +\n\t\t\t\tcontent.slice(insertPos)\n\t\t\t);\n\t\t}\n\n\t\t// Try fallback types in order\n\t\tconst currentIndex = RegistrationService.ENTITY_ORDER.indexOf(\n\t\t\tconfig.entityType,\n\t\t);\n\n\t\tfor (let i = currentIndex - 1; i >= 0; i--) {\n\t\t\tconst fallbackType = RegistrationService.ENTITY_ORDER[i];\n\t\t\tconst fallbackSuffix =\n\t\t\t\tfallbackType.charAt(0).toUpperCase() + fallbackType.slice(1);\n\t\t\tconst fallbackPattern = `register\\\\w+${fallbackSuffix}\\\\(this\\\\.server\\\\);`;\n\t\t\tconst fallbackRegex = new RegExp(`\\\\s+${fallbackPattern}`, \"g\");\n\t\t\tconst fallbackMatches = initBody.match(fallbackRegex);\n\n\t\t\tif (fallbackMatches) {\n\t\t\t\tconst lastCall = fallbackMatches[fallbackMatches.length - 1];\n\t\t\t\tconst insertPos =\n\t\t\t\t\tinitMatch.index! +\n\t\t\t\t\tinitMatch[0].lastIndexOf(lastCall) +\n\t\t\t\t\tlastCall.length;\n\t\t\t\tconst comment = `\\n\\n\\t\\t// Register all ${config.entityTypePlural}\\n`;\n\t\t\t\treturn (\n\t\t\t\t\tcontent.slice(0, insertPos) +\n\t\t\t\t\tcomment +\n\t\t\t\t\tregistrationCall +\n\t\t\t\t\tcontent.slice(insertPos)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// Add at start of init method\n\t\tconst insertPos = initMatch.index! + initMatch[0].indexOf(\"{\") + 1;\n\t\tconst comment = `\\n\\t\\t// Register all ${config.entityTypePlural}\\n`;\n\t\treturn (\n\t\t\tcontent.slice(0, insertPos) +\n\t\t\tcomment +\n\t\t\tregistrationCall +\n\t\t\tcontent.slice(insertPos)\n\t\t);\n\t}\n\n\t/**\n\t * Get import regex pattern for a directory\n\t */\n\tprivate getImportRegex(directory: string): RegExp {\n\t\t// Escape special regex characters in directory\n\t\tconst escapedDir = directory.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n\t\treturn new RegExp(\n\t\t\t`import\\\\s+\\\\{[^}]+\\\\}\\\\s+from\\\\s+[\"']${escapedDir}[^\"']+[\"'];`,\n\t\t\t\"g\",\n\t\t);\n\t}\n\n\t/**\n\t * Detect if a registration function needs the env parameter\n\t * Reads the entity file and checks the function signature\n\t */\n\tprivate async functionNeedsEnv(\n\t\tcwd: string,\n\t\tname: string,\n\t\tfunctionName: string,\n\t\tconfig: RegistrationConfig,\n\t): Promise<boolean> {\n\t\ttry {\n\t\t\tconst entityPath = join(\n\t\t\t\tcwd,\n\t\t\t\t\"src\",\n\t\t\t\tconfig.entityTypePlural,\n\t\t\t\t`${name}.ts`,\n\t\t\t);\n\n\t\t\tif (!existsSync(entityPath)) {\n\t\t\t\treturn false; // File doesn't exist, assume no env needed\n\t\t\t}\n\n\t\t\tconst entityContent = await readFile(entityPath, \"utf-8\");\n\n\t\t\t// Look for the function declaration\n\t\t\t// Pattern: export function functionName(server: McpServer, env?: Env)\n\t\t\t// OR: export function functionName(server: McpServer, env: Env)\n\t\t\tconst functionPattern = new RegExp(\n\t\t\t\t`export\\\\s+function\\\\s+${functionName}\\\\s*\\\\([^)]*env[^)]*\\\\)`,\n\t\t\t\t\"i\",\n\t\t\t);\n\n\t\t\treturn functionPattern.test(entityContent);\n\t\t} catch (error) {\n\t\t\t// If we can't read the file, assume no env needed\n\t\t\treturn false;\n\t\t}\n\t}\n}\n","/**\n * Validation Service\n *\n * Handles entity validation for add commands\n * Shared logic for validating names, projects, and options\n */\n\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\n\n/**\n * Configuration for entity validation\n */\nexport interface ValidationConfig {\n\t/** Entity type (tool, prompt, resource) */\n\tentityType: \"tool\" | \"prompt\" | \"resource\";\n\t/** Directory where entity file will be created */\n\tsourceDir: string;\n}\n\n/**\n * Options for resource-specific validation\n */\nexport interface ResourceOptions {\n\tstatic?: boolean;\n\tdynamic?: boolean;\n\turiPattern?: string;\n}\n\n/**\n * Service for validating entity creation\n */\nexport class ValidationService {\n\t/**\n\t * Validate entity name format\n\t *\n\t * Names must:\n\t * - Start with a lowercase letter\n\t * - Contain only lowercase letters, numbers, and hyphens\n\t * - Follow kebab-case convention\n\t *\n\t * @throws Error if name is invalid\n\t */\n\tvalidateName(name: string, config: ValidationConfig): void {\n\t\tconst nameRegex = /^[a-z][a-z0-9-]*$/;\n\n\t\tif (!nameRegex.test(name)) {\n\t\t\tconst entityName =\n\t\t\t\tconfig.entityType.charAt(0).toUpperCase() + config.entityType.slice(1);\n\t\t\tthrow new Error(\n\t\t\t\t`${entityName} name must be lowercase with hyphens (e.g., my-${config.entityType})`,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Validate we're in a valid MCP project\n\t *\n\t * @throws Error if not in a valid project\n\t */\n\tvalidateProject(cwd: string): void {\n\t\tconst packageJsonPath = join(cwd, \"package.json\");\n\n\t\tif (!existsSync(packageJsonPath)) {\n\t\t\tthrow new Error(\n\t\t\t\t\"Not in a valid project directory (no package.json found)\",\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Check if entity file already exists\n\t *\n\t * @throws Error if entity file already exists\n\t */\n\tvalidateFileNotExists(cwd: string, name: string, config: ValidationConfig): void {\n\t\tconst filePath = join(cwd, config.sourceDir, `${name}.ts`);\n\n\t\tif (existsSync(filePath)) {\n\t\t\tconst entityName =\n\t\t\t\tconfig.entityType.charAt(0).toUpperCase() + config.entityType.slice(1);\n\t\t\tthrow new Error(`${entityName} already exists: ${filePath}`);\n\t\t}\n\t}\n\n\t/**\n\t * Validate all basic requirements for entity creation\n\t *\n\t * @throws Error if any validation fails\n\t */\n\tvalidateEntity(cwd: string, name: string, config: ValidationConfig): void {\n\t\tthis.validateName(name, config);\n\t\tthis.validateProject(cwd);\n\t\tthis.validateFileNotExists(cwd, name, config);\n\t}\n\n\t/**\n\t * Validate resource-specific options\n\t *\n\t * @throws Error if options are invalid\n\t */\n\tvalidateResourceOptions(options: ResourceOptions): void {\n\t\tif (options.static && options.dynamic) {\n\t\t\tthrow new Error(\"Cannot use both --static and --dynamic flags\");\n\t\t}\n\t}\n\n\t/**\n\t * Determine URI pattern for a resource\n\t *\n\t * - If uriPattern is explicitly provided, use it\n\t * - If --dynamic flag is set, use dynamic pattern (resource://{id})\n\t * - Otherwise, default to static pattern (config://name)\n\t */\n\tdetermineUriPattern(\n\t\tname: string,\n\t\toptions: ResourceOptions,\n\t): string {\n\t\tif (options.uriPattern) {\n\t\t\treturn options.uriPattern;\n\t\t}\n\n\t\tif (options.dynamic) {\n\t\t\t// Explicit dynamic pattern\n\t\t\treturn \"resource://{id}\";\n\t\t}\n\n\t\t// Default to static pattern (simpler, more common)\n\t\treturn `config://${name}`;\n\t}\n}\n","/**\n * Template Service\n *\n * Handles file content generation from templates\n * Shared logic for generating entity files, unit tests, and integration tests\n */\n\nimport Handlebars from \"handlebars\";\nimport { readFileSync, statSync } from \"node:fs\";\nimport { join, dirname } from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\n\n/**\n * Binding context for template generation\n */\nexport interface BindingContext {\n\t/** Whether the project has any bindings configured */\n\thasBindings: boolean;\n\t/** Compact binding summary (e.g., \"KV: MY_CACHE | D1: USER_DB | AI: AI\") */\n\tbindingSummary?: string;\n\t/** Array of binding examples with imports and usage */\n\tbindingExamples?: Array<{\n\t\ttype: string;\n\t\tbindingName: string;\n\t\thelperClass?: string; // Optional for AI (no helper class)\n\t\timportStatement?: string; // Optional for AI (no import needed)\n\t\tusageExample: string;\n\t}>;\n}\n\n/**\n * Configuration for template generation\n */\nexport interface TemplateConfig {\n\t/** Entity type (tool, prompt, resource) */\n\tentityType: \"tool\" | \"prompt\" | \"resource\";\n\t/** Entity name in kebab-case */\n\tname: string;\n\t/** Entity name in PascalCase */\n\tcapitalizedName: string;\n\t/** Description of the entity */\n\tdescription: string;\n\t/** Binding context (optional - only for tools that may use bindings) */\n\tbindingContext?: BindingContext;\n}\n\n/**\n * Resource-specific template options\n */\nexport interface ResourceTemplateOptions extends TemplateConfig {\n\t/** URI pattern for the resource */\n\turiPattern: string;\n}\n\n/**\n * Service for generating entity file content from templates\n */\nexport class TemplateService {\n\tprivate templateCache = new Map<string, HandlebarsTemplateDelegate>();\n\tprivate templatesDir: string;\n\n\tconstructor() {\n\t\t// Get the project root directory (where templates/ folder is)\n\t\tconst __filename = fileURLToPath(import.meta.url);\n\t\tconst __dirname = dirname(__filename);\n\n\t\t// Find templates directory by searching upward from current file\n\t\t// Works from both dist/cli.js and dist/core/commands/shared/\n\t\tlet currentDir = __dirname;\n\t\tlet templatesPath = \"\";\n\n\t\t// Search up to 5 levels for templates/scaffolding\n\t\tfor (let i = 0; i < 5; i++) {\n\t\t\tconst candidatePath = join(currentDir, \"templates/scaffolding\");\n\t\t\ttry {\n\t\t\t\t// Check if directory exists (sync is ok in constructor)\n\t\t\t\tif (statSync(candidatePath).isDirectory()) {\n\t\t\t\t\ttemplatesPath = candidatePath;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Directory doesn't exist, try parent\n\t\t\t}\n\t\t\tcurrentDir = dirname(currentDir);\n\t\t}\n\n\t\tif (!templatesPath) {\n\t\t\tthrow new Error(\n\t\t\t\t`Could not locate templates/scaffolding directory. Searched from: ${__dirname}`,\n\t\t\t);\n\t\t}\n\n\t\tthis.templatesDir = templatesPath;\n\t}\n\n\t/**\n\t * Load and compile a Handlebars template\n\t */\n\tprivate loadTemplate(templatePath: string): HandlebarsTemplateDelegate {\n\t\t// Check cache first\n\t\tif (this.templateCache.has(templatePath)) {\n\t\t\treturn this.templateCache.get(templatePath)!;\n\t\t}\n\n\t\t// Load template from file\n\t\tconst fullPath = join(this.templatesDir, templatePath);\n\t\tconst templateContent = readFileSync(fullPath, \"utf-8\");\n\n\t\t// Compile template\n\t\tconst compiled = Handlebars.compile(templateContent, { noEscape: true });\n\n\t\t// Cache it\n\t\tthis.templateCache.set(templatePath, compiled);\n\n\t\treturn compiled;\n\t}\n\n\t/**\n\t * Generate tool file content\n\t */\n\tgenerateToolFile(config: TemplateConfig): string {\n\t\tconst template = this.loadTemplate(\"entities/tool.hbs\");\n\t\t// Pass full config including bindingContext\n\t\treturn template(config);\n\t}\n\n\t/**\n\t * Generate prompt file content\n\t */\n\tgeneratePromptFile(config: TemplateConfig): string {\n\t\tconst template = this.loadTemplate(\"entities/prompt.hbs\");\n\t\treturn template(config);\n\t}\n\n\t/**\n\t * Generate resource file content\n\t */\n\tgenerateResourceFile(config: ResourceTemplateOptions): string {\n\t\tconst { uriPattern } = config;\n\n\t\t// Check if URI pattern has variables\n\t\tconst hasVariables = uriPattern.includes(\"{\") && uriPattern.includes(\"}\");\n\n\t\t// Extract variable names from pattern\n\t\tconst variables = hasVariables\n\t\t\t? Array.from(uriPattern.matchAll(/\\{(\\w+)\\}/g)).map((m) => m[1])\n\t\t\t: [];\n\n\t\t// Prepare template context\n\t\tconst context = {\n\t\t\t...config,\n\t\t\thasVariables,\n\t\t\tvariables,\n\t\t\tvariablesJoined: variables.join(\", \"),\n\t\t};\n\n\t\tconst template = this.loadTemplate(\"entities/resource.hbs\");\n\t\treturn template(context);\n\t}\n\n\t/**\n\t * Generate entity file content based on entity type\n\t */\n\tgenerateEntityFile(\n\t\tconfig: TemplateConfig | ResourceTemplateOptions,\n\t): string {\n\t\tswitch (config.entityType) {\n\t\t\tcase \"tool\":\n\t\t\t\treturn this.generateToolFile(config);\n\t\t\tcase \"prompt\":\n\t\t\t\treturn this.generatePromptFile(config);\n\t\t\tcase \"resource\":\n\t\t\t\tif (!(\"uriPattern\" in config)) {\n\t\t\t\t\tthrow new Error(\"Resource template config must include uriPattern\");\n\t\t\t\t}\n\t\t\t\treturn this.generateResourceFile(config);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unknown entity type: ${(config as TemplateConfig).entityType}`);\n\t\t}\n\t}\n\n\t/**\n\t * Generate unit test file content\n\t */\n\tgenerateUnitTestFile(config: TemplateConfig): string {\n\t\tconst { entityType, name, capitalizedName } = config;\n\t\tconst entityTypePlural = `${entityType}s`;\n\t\tconst functionSuffix =\n\t\t\tentityType.charAt(0).toUpperCase() + entityType.slice(1);\n\n\t\t// Prepare template context\n\t\tconst context = {\n\t\t\t...config,\n\t\t\tentityTypePlural,\n\t\t\tfunctionSuffix,\n\t\t\tisToolType: entityType === \"tool\",\n\t\t\tisPromptType: entityType === \"prompt\",\n\t\t\tisResourceType: entityType === \"resource\",\n\t\t};\n\n\t\tconst template = this.loadTemplate(\"unit-tests/main.hbs\");\n\t\treturn template(context);\n\t}\n\n\t/**\n\t * Generate integration test YAML content\n\t */\n\tgenerateIntegrationTestYaml(config: TemplateConfig | ResourceTemplateOptions): string {\n\t\tconst { entityType, name, description } = config;\n\n\t\tif (entityType === \"tool\") {\n\t\t\treturn this.generateToolIntegrationYaml(name, description);\n\t\t} else if (entityType === \"prompt\") {\n\t\t\treturn this.generatePromptIntegrationYaml(name, description);\n\t\t} else if (entityType === \"resource\") {\n\t\t\tconst uriPattern = (config as ResourceTemplateOptions).uriPattern;\n\t\t\treturn this.generateResourceIntegrationYaml(name, description, uriPattern);\n\t\t}\n\n\t\tthrow new Error(`Unknown entity type: ${entityType}`);\n\t}\n\n\t/**\n\t * Generate tool integration test YAML\n\t */\n\tprivate generateToolIntegrationYaml(name: string, description: string): string {\n\t\tconst context = {\n\t\t\tname,\n\t\t\tnameWithSpaces: name.replace(/_/g, \" \"),\n\t\t\tdescription: description || `Verify that ${name} tool works correctly`,\n\t\t};\n\n\t\tconst template = this.loadTemplate(\"integration-tests/tool.yaml.hbs\");\n\t\treturn template(context);\n\t}\n\n\t/**\n\t * Generate prompt integration test YAML\n\t */\n\tprivate generatePromptIntegrationYaml(\n\t\tname: string,\n\t\tdescription: string,\n\t): string {\n\t\tconst context = {\n\t\t\tname,\n\t\t\tnameWithSpaces: name.replace(/_/g, \" \"),\n\t\t\tdescription: description || `Verify that ${name} prompt works correctly`,\n\t\t};\n\n\t\tconst template = this.loadTemplate(\"integration-tests/prompt.yaml.hbs\");\n\t\treturn template(context);\n\t}\n\n\t/**\n\t * Generate resource integration test YAML\n\t */\n\tprivate generateResourceIntegrationYaml(\n\t\tname: string,\n\t\tdescription: string,\n\t\turiPattern: string,\n\t): string {\n\t\tconst context = {\n\t\t\tname,\n\t\t\tnameWithSpaces: name.replace(/_/g, \" \"),\n\t\t\tdescription: description || \"Test resource\",\n\t\t\turiPattern,\n\t\t\turiPatternNoVars: uriPattern.replace(/\\{[^}]+\\}/g, \"\"),\n\t\t};\n\n\t\tconst template = this.loadTemplate(\"integration-tests/resource.yaml.hbs\");\n\t\treturn template(context);\n\t}\n}\n","/**\n * Wrangler Configuration Utilities\n *\n * Shared utilities for reading and writing wrangler configuration files.\n * Supports both TOML and JSONC formats.\n */\n\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport stripJsonComments from \"strip-json-comments\";\n\n/**\n * Detect which wrangler config file exists\n * Prioritizes: wrangler.jsonc > wrangler.json > wrangler.toml\n */\nexport function getWranglerConfigPath(cwd: string): string | null {\n\tconst configFiles = [\"wrangler.jsonc\", \"wrangler.json\", \"wrangler.toml\"];\n\tfor (const file of configFiles) {\n\t\tconst path = join(cwd, file);\n\t\tif (existsSync(path)) {\n\t\t\treturn path;\n\t\t}\n\t}\n\treturn null;\n}\n\n/**\n * Parse JSONC (JSON with comments)\n */\nexport function parseJSONC(content: string): any {\n\tconst stripped = stripJsonComments(content);\n\treturn JSON.parse(stripped);\n}\n\n/**\n * Format JSON with proper indentation (tabs)\n */\nexport function formatJSON(obj: any): string {\n\treturn JSON.stringify(obj, null, \"\\t\");\n}\n","/**\n * Shared Utility Functions\n *\n * Common utilities used across multiple commands.\n * All functions are pure and have no side effects.\n */\n\nimport { access } from \"node:fs/promises\";\n\n/**\n * Convert kebab-case to PascalCase\n *\n * @param str - String in kebab-case format\n * @returns String in PascalCase format\n *\n * @example\n * toPascalCase(\"my-tool-name\")  \"MyToolName\"\n * toPascalCase(\"api-client\")  \"ApiClient\"\n */\nexport function toPascalCase(str: string): string {\n\treturn str\n\t\t.split(\"-\")\n\t\t.map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n\t\t.join(\"\");\n}\n\n/**\n * Convert PascalCase to kebab-case\n *\n * @param str - String in PascalCase format\n * @returns String in kebab-case format\n *\n * @example\n * toKebabCase(\"MyToolName\")  \"my-tool-name\"\n * toKebabCase(\"APIClient\")  \"api-client\"\n */\nexport function toKebabCase(str: string): string {\n\treturn str\n\t\t.replace(/([A-Z])/g, \"-$1\")\n\t\t.toLowerCase()\n\t\t.replace(/^-/, \"\");\n}\n\n/**\n * Check if a file exists\n *\n * @param filePath - Path to check\n * @returns true if file exists, false otherwise\n *\n * @example\n * await fileExists(\"/path/to/file.ts\")  true\n * await fileExists(\"/non/existent.ts\")  false\n */\nexport async function fileExists(filePath: string): Promise<boolean> {\n\ttry {\n\t\tawait access(filePath);\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Capitalize first letter of a string\n *\n * @param str - String to capitalize\n * @returns String with first letter capitalized\n *\n * @example\n * capitalize(\"hello\")  \"Hello\"\n * capitalize(\"world\")  \"World\"\n */\nexport function capitalize(str: string): string {\n\treturn str.charAt(0).toUpperCase() + str.slice(1);\n}\n","/**\n * Binding Detection Service\n *\n * Detects Cloudflare bindings (KV, D1, R2, AI) configured in wrangler.jsonc.\n * Used by tool scaffolding to generate context-aware templates with binding usage examples.\n */\n\nimport { existsSync } from \"node:fs\";\nimport { readFile } from \"node:fs/promises\";\nimport type { Phase1BindingType, Phase2BindingType } from \"@/types/binding-types.js\";\nimport { getWranglerConfigPath, parseJSONC } from \"./config/wrangler-utils.js\";\nimport { toPascalCase } from \"./utils.js\";\n\n/**\n * Detected bindings organized by type\n */\nexport interface DetectedBindings {\n\tkv: string[]; // e.g., ['MY_CACHE', 'SESSION_STORE']\n\td1: string[]; // e.g., ['USER_DB', 'ANALYTICS_DB']\n\tr2: string[]; // e.g., ['MY_BUCKET', 'UPLOADS']\n\tai?: string; // e.g., 'AI' (singleton binding)\n}\n\n/**\n * Binding usage example with import and usage code\n */\nexport interface BindingExample {\n\ttype: Phase1BindingType | Phase2BindingType;\n\tbindingName: string;\n\thelperClass?: string; // Optional for AI (no helper class)\n\timportStatement?: string; // Optional for AI (no import needed)\n\tusageExample: string;\n}\n\n/**\n * Service for detecting configured Cloudflare bindings\n */\nexport class BindingDetectionService {\n\t/**\n\t * Detect all bindings configured in wrangler.jsonc\n\t *\n\t * @param cwd - Project root directory\n\t * @returns Detected bindings organized by type\n\t */\n\tasync detectBindings(cwd: string): Promise<DetectedBindings> {\n\t\tconst bindings: DetectedBindings = {\n\t\t\tkv: [],\n\t\t\td1: [],\n\t\t\tr2: [],\n\t\t};\n\n\t\tconst wranglerPath = getWranglerConfigPath(cwd);\n\t\tif (!wranglerPath || !existsSync(wranglerPath)) {\n\t\t\treturn bindings; // No wrangler config = no bindings\n\t\t}\n\n\t\ttry {\n\t\t\tconst content = await readFile(wranglerPath, \"utf-8\");\n\t\t\tconst config = parseJSONC(content);\n\n\t\t\t// Detect KV namespaces\n\t\t\tif (Array.isArray(config.kv_namespaces)) {\n\t\t\t\tbindings.kv = config.kv_namespaces\n\t\t\t\t\t.map((ns: any) => ns.binding)\n\t\t\t\t\t.filter((b: any) => typeof b === \"string\" && b.length > 0);\n\t\t\t}\n\n\t\t\t// Detect D1 databases\n\t\t\tif (Array.isArray(config.d1_databases)) {\n\t\t\t\tbindings.d1 = config.d1_databases\n\t\t\t\t\t.map((db: any) => db.binding)\n\t\t\t\t\t.filter((b: any) => typeof b === \"string\" && b.length > 0);\n\t\t\t}\n\n\t\t\t// Detect R2 buckets\n\t\t\tif (Array.isArray(config.r2_buckets)) {\n\t\t\t\tbindings.r2 = config.r2_buckets\n\t\t\t\t\t.map((bucket: any) => bucket.binding)\n\t\t\t\t\t.filter((b: any) => typeof b === \"string\" && b.length > 0);\n\t\t\t}\n\n\t\t\t// Detect AI binding (singleton)\n\t\t\tif (config.ai && typeof config.ai.binding === \"string\" && config.ai.binding.length > 0) {\n\t\t\t\tbindings.ai = config.ai.binding;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// Graceful fallback: If parsing fails, return empty bindings\n\t\t\t// Don't throw - we don't want to break tool scaffolding\n\t\t\tconsole.warn(\n\t\t\t\t`Warning: Could not parse wrangler config: ${error instanceof Error ? error.message : String(error)}`,\n\t\t\t);\n\t\t}\n\n\t\treturn bindings;\n\t}\n\n\t/**\n\t * Check if project has any bindings configured\n\t *\n\t * @param cwd - Project root directory\n\t * @returns True if at least one binding is configured\n\t */\n\tasync hasAnyBindings(cwd: string): Promise<boolean> {\n\t\tconst bindings = await this.detectBindings(cwd);\n\t\treturn (\n\t\t\tbindings.kv.length > 0 ||\n\t\t\tbindings.d1.length > 0 ||\n\t\t\tbindings.r2.length > 0 ||\n\t\t\t!!bindings.ai\n\t\t);\n\t}\n\n\t/**\n\t * Generate binding usage examples for template comments\n\t *\n\t * @param bindings - Detected bindings\n\t * @returns Array of binding examples with imports and usage\n\t */\n\tgenerateBindingExamples(bindings: DetectedBindings): BindingExample[] {\n\t\tconst examples: BindingExample[] = [];\n\n\t\t// Generate KV examples\n\t\tfor (const bindingName of bindings.kv) {\n\t\t\tconst helperClass = this.getHelperClassName(bindingName, \"kv\");\n\t\t\tconst helperFile = this.getHelperFileName(bindingName, \"kv\");\n\n\t\t\texamples.push({\n\t\t\t\ttype: \"kv\",\n\t\t\t\tbindingName,\n\t\t\t\thelperClass,\n\t\t\t\timportStatement: `import { ${helperClass} } from \"../utils/bindings/${helperFile}.js\";`,\n\t\t\t\tusageExample: [\n\t\t\t\t\t`const cache = new ${helperClass}(env.${bindingName});`,\n\t\t\t\t\t`const data = await cache.get<MyType>('key');`,\n\t\t\t\t\t`await cache.set('key', { value: 'data' }, { expirationTtl: 3600 });`,\n\t\t\t\t].join(\"\\n// \"),\n\t\t\t});\n\t\t}\n\n\t\t// Generate D1 examples\n\t\tfor (const bindingName of bindings.d1) {\n\t\t\tconst helperClass = this.getHelperClassName(bindingName, \"d1\");\n\t\t\tconst helperFile = this.getHelperFileName(bindingName, \"d1\");\n\n\t\t\texamples.push({\n\t\t\t\ttype: \"d1\",\n\t\t\t\tbindingName,\n\t\t\t\thelperClass,\n\t\t\t\timportStatement: `import { ${helperClass} } from \"../utils/bindings/${helperFile}.js\";`,\n\t\t\t\tusageExample: [\n\t\t\t\t\t`const db = new ${helperClass}(env.${bindingName});`,\n\t\t\t\t\t`const users = await db.query<User>('SELECT * FROM users WHERE active = ?', [true]);`,\n\t\t\t\t\t`await db.execute('INSERT INTO logs (message) VALUES (?)', ['User logged in']);`,\n\t\t\t\t].join(\"\\n// \"),\n\t\t\t});\n\t\t}\n\n\t\t// Generate R2 examples\n\t\tfor (const bindingName of bindings.r2) {\n\t\t\tconst helperClass = this.getHelperClassName(bindingName, \"r2\");\n\t\t\tconst helperFile = this.getHelperFileName(bindingName, \"r2\");\n\n\t\t\texamples.push({\n\t\t\t\ttype: \"r2\",\n\t\t\t\tbindingName,\n\t\t\t\thelperClass,\n\t\t\t\timportStatement: `import { ${helperClass} } from \"../utils/bindings/${helperFile}.js\";`,\n\t\t\t\tusageExample: [\n\t\t\t\t\t`const bucket = new ${helperClass}(env.${bindingName});`,\n\t\t\t\t\t`await bucket.putText('files/readme.txt', 'Hello World');`,\n\t\t\t\t\t`const content = await bucket.getText('files/readme.txt');`,\n\t\t\t\t].join(\"\\n// \"),\n\t\t\t});\n\t\t}\n\n\t\t// Generate AI examples (no helper class - direct binding usage)\n\t\tif (bindings.ai) {\n\t\t\texamples.push({\n\t\t\t\ttype: \"ai\",\n\t\t\t\tbindingName: bindings.ai,\n\t\t\t\tusageExample: [\n\t\t\t\t\t`// RAG with LLM:`,\n\t\t\t\t\t`const ragResult = await env.${bindings.ai}.aiSearch('my-instance', 'query text');`,\n\t\t\t\t\t``,\n\t\t\t\t\t`// Vector-only search:`,\n\t\t\t\t\t`const searchResult = await env.${bindings.ai}.search('my-instance', 'query text');`,\n\t\t\t\t].join(\"\\n// \"),\n\t\t\t});\n\t\t}\n\n\t\treturn examples;\n\t}\n\n\t/**\n\t * Generate compact binding summary for template comments\n\t * Format: \"KV: MY_CACHE, SESSION_STORE | D1: USER_DB | R2: UPLOADS | AI: AI\"\n\t *\n\t * @param bindings - Detected bindings\n\t * @returns Compact summary string\n\t */\n\tgenerateBindingSummary(bindings: DetectedBindings): string {\n\t\tconst parts: string[] = [];\n\n\t\tif (bindings.kv.length > 0) {\n\t\t\tparts.push(`KV: ${bindings.kv.join(\", \")}`);\n\t\t}\n\t\tif (bindings.d1.length > 0) {\n\t\t\tparts.push(`D1: ${bindings.d1.join(\", \")}`);\n\t\t}\n\t\tif (bindings.r2.length > 0) {\n\t\t\tparts.push(`R2: ${bindings.r2.join(\", \")}`);\n\t\t}\n\t\tif (bindings.ai) {\n\t\t\tparts.push(`AI: ${bindings.ai}`);\n\t\t}\n\n\t\treturn parts.join(\" | \");\n\t}\n\n\t/**\n\t * Get helper class name for a binding\n\t * Example: MY_CACHE (kv) -> MyCacheKV\n\t */\n\tprivate getHelperClassName(\n\t\tbindingName: string,\n\t\tbindingType: Phase1BindingType,\n\t): string {\n\t\tconst baseName = toPascalCase(bindingName.toLowerCase().replace(/_/g, \"-\"));\n\t\tconst suffix = bindingType.toUpperCase();\n\t\treturn `${baseName}${suffix}`;\n\t}\n\n\t/**\n\t * Get helper file name for a binding\n\t * Example: MY_CACHE (kv) -> kv-my-cache\n\t */\n\tprivate getHelperFileName(\n\t\tbindingName: string,\n\t\tbindingType: Phase1BindingType,\n\t): string {\n\t\tconst fileName = bindingName.toLowerCase().replace(/_/g, \"-\");\n\t\treturn `${bindingType}-${fileName}`;\n\t}\n}\n","/**\n * Template Metadata Management\n *\n * Functions for reading and updating .mcp-template.json\n */\n\nimport { readFile, writeFile } from \"node:fs/promises\";\nimport { join } from \"node:path\";\nimport { existsSync } from \"node:fs\";\n\n/**\n * Entity metadata structure\n */\nexport interface EntityMetadata {\n\tname: string;\n\tfile: string;\n\tregistered: boolean;\n\thasUnitTest: boolean;\n\thasIntegrationTest: boolean;\n}\n\n/**\n * Supported entity types\n */\nexport type EntityType = \"tools\" | \"prompts\" | \"resources\";\n\n/**\n * Update .mcp-template.json with new entity metadata\n *\n * @param cwd - Current working directory\n * @param entityType - Type of entity (tools, prompts, resources)\n * @param name - Entity name (kebab-case)\n * @param fileSubpath - Path to entity file relative to project root (e.g., \"src/tools/my-tool.ts\")\n * @param hasTests - Whether tests were generated\n *\n * @example\n * await updateTemplateMetadata(\n *   process.cwd(),\n *   \"tools\",\n *   \"my-tool\",\n *   \"src/tools/my-tool.ts\",\n *   true\n * );\n */\nexport async function updateTemplateMetadata(\n\tcwd: string,\n\tentityType: EntityType,\n\tname: string,\n\tfileSubpath: string,\n\thasTests: boolean,\n): Promise<void> {\n\tconst metadataPath = join(cwd, \".mcp-template.json\");\n\n\tif (!existsSync(metadataPath)) {\n\t\treturn; // Optional file\n\t}\n\n\ttry {\n\t\tconst content = await readFile(metadataPath, \"utf-8\");\n\t\tconst metadata = JSON.parse(content);\n\n\t\t// Initialize array if it doesn't exist\n\t\tif (!metadata[entityType]) {\n\t\t\tmetadata[entityType] = [];\n\t\t}\n\n\t\t// Add new entity\n\t\tconst entityMetadata: EntityMetadata = {\n\t\t\tname,\n\t\t\tfile: fileSubpath,\n\t\t\tregistered: true,\n\t\t\thasUnitTest: hasTests,\n\t\t\thasIntegrationTest: hasTests,\n\t\t};\n\n\t\tmetadata[entityType].push(entityMetadata);\n\n\t\tawait writeFile(metadataPath, JSON.stringify(metadata, null, \"\\t\"), \"utf-8\");\n\t} catch (error) {\n\t\tconsole.warn(`    Could not update .mcp-template.json: ${error}`);\n\t}\n}\n\n/**\n * Read template metadata from .mcp-template.json\n *\n * @param cwd - Current working directory\n * @returns Parsed metadata or null if file doesn't exist\n *\n * @example\n * const metadata = await readTemplateMetadata(process.cwd());\n * if (metadata) {\n *   console.log(metadata.tools);\n * }\n */\nexport async function readTemplateMetadata(\n\tcwd: string,\n): Promise<Record<string, unknown> | null> {\n\tconst metadataPath = join(cwd, \".mcp-template.json\");\n\n\tif (!existsSync(metadataPath)) {\n\t\treturn null;\n\t}\n\n\ttry {\n\t\tconst content = await readFile(metadataPath, \"utf-8\");\n\t\treturn JSON.parse(content);\n\t} catch (error) {\n\t\tconsole.warn(`    Could not read .mcp-template.json: ${error}`);\n\t\treturn null;\n\t}\n}\n","/**\n * Zod Schemas for Configuration Validation\n *\n * Provides runtime validation and type safety for all service configurations\n */\n\nimport { z } from \"zod\";\n\n/**\n * Schema for resource-specific options\n */\nexport const ResourceOptionsSchema = z.object({\n\t/** URI pattern for the resource */\n\turiPattern: z.string().optional(),\n\t/** Whether this is a static resource */\n\tstatic: z.boolean().optional(),\n\t/** Whether this is a dynamic resource with variables */\n\tdynamic: z.boolean().optional(),\n});\n\nexport type ResourceOptions = z.infer<typeof ResourceOptionsSchema>;\n\n/**\n * Schema for entity scaffolding configuration\n */\nexport const ScaffoldConfigSchema = z.object({\n\t/** Entity type (tool, prompt, resource) */\n\tentityType: z.enum([\"tool\", \"prompt\", \"resource\"]),\n\t/** Entity name in kebab-case */\n\tname: z.string().regex(/^[a-z][a-z0-9-]*$/, {\n\t\tmessage: \"Entity name must be lowercase with hyphens (e.g., my-entity)\",\n\t}),\n\t/** Description of the entity */\n\tdescription: z.string().optional(),\n\t/** Whether to generate test files (default: true) */\n\tgenerateTests: z.boolean().optional().default(true),\n\t/** Whether to auto-register in index.ts (default: true) */\n\tautoRegister: z.boolean().optional().default(true),\n\t/** Resource-specific options (required for resources) */\n\tresourceOptions: ResourceOptionsSchema.optional(),\n}).refine(\n\t(data) => {\n\t\t// If entity type is resource, resourceOptions must be provided\n\t\tif (data.entityType === \"resource\" && !data.resourceOptions) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\t{\n\t\tmessage: \"Resource options are required when entityType is 'resource'\",\n\t\tpath: [\"resourceOptions\"],\n\t}\n).refine(\n\t(data) => {\n\t\t// Cannot have both static and dynamic flags set\n\t\tif (data.resourceOptions?.static && data.resourceOptions?.dynamic) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\t{\n\t\tmessage: \"Cannot use both --static and --dynamic flags\",\n\t\tpath: [\"resourceOptions\"],\n\t}\n);\n\n// Input type (before validation/defaults applied)\nexport type ScaffoldConfig = z.input<typeof ScaffoldConfigSchema>;\n\n// Output type (after validation/defaults applied)\nexport type ValidatedScaffoldConfig = z.output<typeof ScaffoldConfigSchema>;\n\n/**\n * Schema for registration service configuration\n */\nexport const RegistrationConfigSchema = z.object({\n\t/** Entity type */\n\tentityType: z.enum([\"tool\", \"prompt\", \"resource\"]),\n\t/** Entity type plural form */\n\tentityTypePlural: z.enum([\"tools\", \"prompts\", \"resources\"]),\n\t/** Import directory path */\n\tdirectory: z.string(),\n\t/** Function name suffix */\n\tfunctionSuffix: z.string(),\n});\n\nexport type RegistrationConfig = z.infer<typeof RegistrationConfigSchema>;\n\n/**\n * Schema for validation service configuration\n */\nexport const ValidationConfigSchema = z.object({\n\t/** Entity type */\n\tentityType: z.enum([\"tool\", \"prompt\", \"resource\"]),\n\t/** Directory where entity file will be created */\n\tsourceDir: z.string(),\n});\n\nexport type ValidationConfig = z.infer<typeof ValidationConfigSchema>;\n\n/**\n * Schema for template configuration\n */\nexport const TemplateConfigSchema = z.object({\n\t/** Entity type */\n\tentityType: z.enum([\"tool\", \"prompt\", \"resource\"]),\n\t/** Entity name in kebab-case */\n\tname: z.string(),\n\t/** Capitalized name (PascalCase) */\n\tcapitalizedName: z.string(),\n\t/** Entity description */\n\tdescription: z.string().optional(),\n});\n\nexport type TemplateConfig = z.infer<typeof TemplateConfigSchema>;\n\n/**\n * Schema for resource template options (extends TemplateConfig)\n */\nexport const ResourceTemplateOptionsSchema = TemplateConfigSchema.extend({\n\t/** Entity type must be resource */\n\tentityType: z.literal(\"resource\"),\n\t/** URI pattern for the resource */\n\turiPattern: z.string(),\n});\n\nexport type ResourceTemplateOptions = z.infer<typeof ResourceTemplateOptionsSchema>;\n\n/**\n * Schema for entity lister configuration\n */\nexport const EntityListerConfigSchema = z.object({\n\t/** Entity type */\n\tentityType: z.enum([\"tool\", \"prompt\", \"resource\"]),\n\t/** Entity type plural form */\n\tentityTypePlural: z.enum([\"tools\", \"prompts\", \"resources\"]),\n\t/** Directory where entities are stored */\n\tdirectory: z.string(),\n\t/** Function name suffix */\n\tfunctionSuffix: z.string(),\n\t/** Regex pattern to extract description from file */\n\tdescriptionPattern: z.instanceof(RegExp),\n\t/** Command name for CLI */\n\tcommandName: z.string(),\n\t/** Command description for CLI */\n\tcommandDescription: z.string(),\n});\n\nexport type EntityListerConfig = z.infer<typeof EntityListerConfigSchema>;\n","/**\n * Entity Scaffold Strategy\n *\n * Strategy for scaffolding MCP entities (tools, prompts, resources).\n * Implements only entity-specific logic while orchestrator handles common flow.\n */\n\nimport { mkdir, writeFile } from \"node:fs/promises\";\nimport { join } from \"node:path\";\nimport { RegistrationService } from \"../registration-service.js\";\nimport { ValidationService } from \"../validation-service.js\";\nimport { TemplateService } from \"../template-service.js\";\nimport { BindingDetectionService } from \"../binding-detection-service.js\";\nimport { updateTemplateMetadata } from \"../metadata.js\";\nimport { toPascalCase } from \"../utils.js\";\nimport { ScaffoldConfigSchema, type ScaffoldConfig } from \"../schemas.js\";\nimport type { RegistrationConfig } from \"../registration-service.js\";\nimport type { ValidationConfig, ResourceOptions } from \"../validation-service.js\";\nimport type { ResourceTemplateOptions } from \"../template-service.js\";\nimport type {\n\tScaffoldStrategy,\n\tScaffoldContext,\n} from \"../orchestration/types.js\";\n\n/**\n * Result of entity scaffolding operation\n */\nexport interface EntityScaffoldResult {\n\t/** Whether scaffolding was successful */\n\tsuccess: boolean;\n\t/** Files that were created */\n\tfilesCreated: string[];\n\t/** Whether entity was registered */\n\tregistered: boolean;\n\t/** Any warnings or messages */\n\tmessages: string[];\n}\n\n/**\n * Strategy for scaffolding entities\n *\n * Handles: tools, prompts, resources\n * Does NOT need backup/rollback (low risk - only creates new files)\n */\nexport class EntityScaffoldStrategy\n\timplements ScaffoldStrategy<ScaffoldConfig, EntityScaffoldResult>\n{\n\tprivate registrationService: RegistrationService;\n\tprivate validationService: ValidationService;\n\tprivate templateService: TemplateService;\n\tprivate bindingDetectionService: BindingDetectionService;\n\n\tconstructor() {\n\t\tthis.registrationService = new RegistrationService();\n\t\tthis.validationService = new ValidationService();\n\t\tthis.templateService = new TemplateService();\n\t\tthis.bindingDetectionService = new BindingDetectionService();\n\t}\n\n\t/**\n\t * Validate entity configuration\n\t */\n\tasync validate(cwd: string, config: ScaffoldConfig): Promise<void> {\n\t\t// Validate configuration with Zod\n\t\tconst parseResult = ScaffoldConfigSchema.safeParse(config);\n\t\tif (!parseResult.success) {\n\t\t\tconst firstError = parseResult.error.errors[0];\n\t\t\tthrow new Error(firstError.message);\n\t\t}\n\n\t\tconst { entityType, name } = parseResult.data;\n\n\t\t// Validate entity\n\t\tconst validationConfig: ValidationConfig = {\n\t\t\tentityType,\n\t\t\tsourceDir: `src/${entityType}s`,\n\t\t};\n\n\t\tthis.validationService.validateEntity(cwd, name, validationConfig);\n\n\t\t// Handle resource-specific validation\n\t\tif (entityType === \"resource\" && config.resourceOptions) {\n\t\t\tthis.validationService.validateResourceOptions(config.resourceOptions);\n\t\t}\n\t}\n\n\t/**\n\t * Execute entity scaffolding\n\t *\n\t * 1. Generate entity file\n\t * 2. Generate test files (if enabled)\n\t * 3. Register entity (if enabled)\n\t * 4. Update metadata\n\t */\n\tasync execute(\n\t\tcontext: ScaffoldContext<ScaffoldConfig, EntityScaffoldResult>,\n\t): Promise<void> {\n\t\tconst { cwd, config, result } = context;\n\n\t\tconst { entityType, name } = config;\n\t\tconst capitalizedName = toPascalCase(name);\n\t\tconst description = config.description || \"TODO: Add description\";\n\t\tconst generateTests = config.generateTests !== false; // Default true\n\t\tconst autoRegister = config.autoRegister !== false; // Default true\n\n\t\t// 1. Generate entity file\n\t\tconst entityFilePath = await this.generateEntityFile(\n\t\t\tcwd,\n\t\t\tname,\n\t\t\tcapitalizedName,\n\t\t\tdescription,\n\t\t\tconfig,\n\t\t);\n\t\tresult.filesCreated.push(entityFilePath);\n\n\t\t// 2. Generate test files\n\t\tif (generateTests) {\n\t\t\tconst testFiles = await this.generateTestFiles(\n\t\t\t\tcwd,\n\t\t\t\tname,\n\t\t\t\tcapitalizedName,\n\t\t\t\tdescription,\n\t\t\t\tconfig,\n\t\t\t);\n\t\t\tresult.filesCreated.push(...testFiles);\n\t\t}\n\n\t\t// 3. Register entity\n\t\tif (autoRegister) {\n\t\t\tconst registrationConfig: RegistrationConfig = {\n\t\t\t\tentityType,\n\t\t\t\tentityTypePlural: `${entityType}s`,\n\t\t\t\tdirectory: `./${entityType}s/`,\n\t\t\t\tfunctionSuffix:\n\t\t\t\t\tentityType.charAt(0).toUpperCase() + entityType.slice(1),\n\t\t\t};\n\n\t\t\tawait this.registrationService.registerEntity(\n\t\t\t\tcwd,\n\t\t\t\tname,\n\t\t\t\tcapitalizedName,\n\t\t\t\tregistrationConfig,\n\t\t\t);\n\t\t\tresult.registered = true;\n\t\t}\n\n\t\t// 4. Update metadata\n\t\tawait updateTemplateMetadata(\n\t\t\tcwd,\n\t\t\t`${entityType}s`,\n\t\t\tname,\n\t\t\t`src/${entityType}s/${name}.ts`,\n\t\t\tgenerateTests,\n\t\t);\n\n\t\tresult.success = true;\n\t}\n\n\t/**\n\t * Entities don't need backup (low risk)\n\t */\n\tneedsBackup(): boolean {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Create initial result object\n\t */\n\tcreateResult(): EntityScaffoldResult {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tfilesCreated: [],\n\t\t\tregistered: false,\n\t\t\tmessages: [],\n\t\t};\n\t}\n\n\t/**\n\t * Generate the main entity file\n\t */\n\tprivate async generateEntityFile(\n\t\tcwd: string,\n\t\tname: string,\n\t\tcapitalizedName: string,\n\t\tdescription: string,\n\t\tconfig: ScaffoldConfig,\n\t): Promise<string> {\n\t\tconst { entityType, resourceOptions } = config;\n\t\tconst dirPath = join(cwd, \"src\", `${entityType}s`);\n\t\tconst filePath = join(dirPath, `${name}.ts`);\n\n\t\t// Create directory if it doesn't exist\n\t\tawait mkdir(dirPath, { recursive: true });\n\n\t\t// Detect bindings for tools (only tools need env parameter for bindings)\n\t\tlet bindingContext;\n\t\tif (entityType === \"tool\") {\n\t\t\tconst bindings = await this.bindingDetectionService.detectBindings(cwd);\n\t\t\tconst hasBindings =\n\t\t\t\tbindings.kv.length > 0 ||\n\t\t\t\tbindings.d1.length > 0 ||\n\t\t\t\tbindings.r2.length > 0 ||\n\t\t\t\t!!bindings.ai;\n\n\t\t\tif (hasBindings) {\n\t\t\t\tconst examples =\n\t\t\t\t\tthis.bindingDetectionService.generateBindingExamples(bindings);\n\t\t\t\tconst summary =\n\t\t\t\t\tthis.bindingDetectionService.generateBindingSummary(bindings);\n\n\t\t\t\tbindingContext = {\n\t\t\t\t\thasBindings: true,\n\t\t\t\t\tbindingSummary: summary,\n\t\t\t\t\tbindingExamples: examples,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tbindingContext = {\n\t\t\t\t\thasBindings: false,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tlet content: string;\n\n\t\tif (entityType === \"resource\" && resourceOptions) {\n\t\t\t// Determine URI pattern for resources\n\t\t\tconst uriPattern = this.validationService.determineUriPattern(\n\t\t\t\tname,\n\t\t\t\tresourceOptions,\n\t\t\t);\n\n\t\t\tconst resourceConfig: ResourceTemplateOptions = {\n\t\t\t\tentityType,\n\t\t\t\tname,\n\t\t\t\tcapitalizedName,\n\t\t\t\tdescription,\n\t\t\t\turiPattern,\n\t\t\t};\n\n\t\t\tcontent = this.templateService.generateEntityFile(resourceConfig);\n\t\t} else {\n\t\t\tcontent = this.templateService.generateEntityFile({\n\t\t\t\tentityType,\n\t\t\t\tname,\n\t\t\t\tcapitalizedName,\n\t\t\t\tdescription,\n\t\t\t\tbindingContext,\n\t\t\t});\n\t\t}\n\n\t\tawait writeFile(filePath, content, \"utf-8\");\n\t\treturn filePath;\n\t}\n\n\t/**\n\t * Generate unit and integration test files\n\t */\n\tprivate async generateTestFiles(\n\t\tcwd: string,\n\t\tname: string,\n\t\tcapitalizedName: string,\n\t\tdescription: string,\n\t\tconfig: ScaffoldConfig,\n\t): Promise<string[]> {\n\t\tconst { entityType, resourceOptions } = config;\n\t\tconst testFiles: string[] = [];\n\n\t\t// Unit test file\n\t\tconst unitTestPath = await this.generateUnitTest(\n\t\t\tcwd,\n\t\t\tname,\n\t\t\tcapitalizedName,\n\t\t\tdescription,\n\t\t\tentityType,\n\t\t);\n\t\ttestFiles.push(unitTestPath);\n\n\t\t// Integration test file (YAML)\n\t\tconst integrationTestPath = await this.generateIntegrationTest(\n\t\t\tcwd,\n\t\t\tname,\n\t\t\tcapitalizedName,\n\t\t\tdescription,\n\t\t\tentityType,\n\t\t\tresourceOptions,\n\t\t);\n\t\ttestFiles.push(integrationTestPath);\n\n\t\treturn testFiles;\n\t}\n\n\t/**\n\t * Generate unit test file\n\t */\n\tprivate async generateUnitTest(\n\t\tcwd: string,\n\t\tname: string,\n\t\tcapitalizedName: string,\n\t\tdescription: string,\n\t\tentityType: \"tool\" | \"prompt\" | \"resource\",\n\t): Promise<string> {\n\t\tconst dirPath = join(cwd, \"test\", \"unit\", `${entityType}s`);\n\t\tconst filePath = join(dirPath, `${name}.test.ts`);\n\n\t\tawait mkdir(dirPath, { recursive: true });\n\n\t\tconst content = this.templateService.generateUnitTestFile({\n\t\t\tentityType,\n\t\t\tname,\n\t\t\tcapitalizedName,\n\t\t\tdescription,\n\t\t});\n\n\t\tawait writeFile(filePath, content, \"utf-8\");\n\t\treturn filePath;\n\t}\n\n\t/**\n\t * Generate integration test file (YAML)\n\t */\n\tprivate async generateIntegrationTest(\n\t\tcwd: string,\n\t\tname: string,\n\t\tcapitalizedName: string,\n\t\tdescription: string,\n\t\tentityType: \"tool\" | \"prompt\" | \"resource\",\n\t\tresourceOptions?: ResourceOptions,\n\t): Promise<string> {\n\t\t// Tools go directly in specs/, others in subdirectories\n\t\tconst dirPath = join(\n\t\t\tcwd,\n\t\t\t\"test\",\n\t\t\t\"integration\",\n\t\t\t\"specs\",\n\t\t\tentityType === \"tool\" ? \"\" : `${entityType}s`,\n\t\t);\n\t\tconst filePath = join(dirPath, `${name}.yaml`);\n\n\t\tawait mkdir(dirPath, { recursive: true });\n\n\t\tlet content: string;\n\n\t\tif (entityType === \"resource\" && resourceOptions) {\n\t\t\tconst uriPattern = this.validationService.determineUriPattern(\n\t\t\t\tname,\n\t\t\t\tresourceOptions,\n\t\t\t);\n\n\t\t\tcontent = this.templateService.generateIntegrationTestYaml({\n\t\t\t\tentityType,\n\t\t\t\tname,\n\t\t\t\tcapitalizedName,\n\t\t\t\tdescription,\n\t\t\t\turiPattern,\n\t\t\t});\n\t\t} else {\n\t\t\tcontent = this.templateService.generateIntegrationTestYaml({\n\t\t\t\tentityType,\n\t\t\t\tname,\n\t\t\t\tcapitalizedName,\n\t\t\t\tdescription,\n\t\t\t});\n\t\t}\n\n\t\tawait writeFile(filePath, content, \"utf-8\");\n\t\treturn filePath;\n\t}\n}\n","/**\n * Entity Scaffolder\n *\n * Facade for entity scaffolding using the orchestration pattern.\n * Delegates to ScaffoldOrchestrator + EntityScaffoldStrategy to eliminate duplication.\n */\n\nimport { ScaffoldOrchestrator } from \"./orchestration/index.js\";\nimport { EntityScaffoldStrategy } from \"./strategies/entity-scaffold-strategy.js\";\nimport type { ScaffoldConfig } from \"./schemas.js\";\n\n// Re-export ScaffoldConfig type for external use\nexport type { ScaffoldConfig };\n\n/**\n * Result of scaffolding operation\n */\nexport interface ScaffoldResult {\n\t/** Whether scaffolding was successful */\n\tsuccess: boolean;\n\t/** Files that were created */\n\tfilesCreated: string[];\n\t/** Whether entity was registered */\n\tregistered: boolean;\n\t/** Any warnings or messages */\n\tmessages: string[];\n}\n\n/**\n * Service for scaffolding MCP entities\n *\n * Facade that delegates to ScaffoldOrchestrator + EntityScaffoldStrategy.\n * This maintains the same public API while using the refactored architecture.\n */\nexport class EntityScaffolder {\n\tprivate orchestrator: ScaffoldOrchestrator<ScaffoldConfig, ScaffoldResult>;\n\tprivate strategy: EntityScaffoldStrategy;\n\n\tconstructor() {\n\t\tthis.orchestrator = new ScaffoldOrchestrator();\n\t\tthis.strategy = new EntityScaffoldStrategy();\n\t}\n\n\t/**\n\t * Scaffold a new entity\n\t *\n\t * @param cwd Current working directory (project root)\n\t * @param config Scaffolding configuration\n\t * @returns Result with created files and registration status\n\t */\n\tasync scaffold(cwd: string, config: ScaffoldConfig): Promise<ScaffoldResult> {\n\t\t// Delegate to orchestrator + strategy\n\t\treturn this.orchestrator.scaffold(cwd, config, this.strategy);\n\t}\n\n\t/**\n\t * Get emoji for entity type (for console output)\n\t */\n\tstatic getEntityEmoji(entityType: \"tool\" | \"prompt\" | \"resource\"): string {\n\t\tswitch (entityType) {\n\t\t\tcase \"tool\":\n\t\t\t\treturn \"\";\n\t\t\tcase \"prompt\":\n\t\t\t\treturn \"\";\n\t\t\tcase \"resource\":\n\t\t\t\treturn \"\";\n\t\t}\n\t}\n\n\t/**\n\t * Get entity type display name\n\t */\n\tstatic getEntityDisplayName(\n\t\tentityType: \"tool\" | \"prompt\" | \"resource\",\n\t): string {\n\t\treturn entityType.charAt(0).toUpperCase() + entityType.slice(1);\n\t}\n}\n","/**\n * Add Prompt Command\n *\n * Scaffolds a new MCP prompt with:\n * - Prompt file with TODO markers\n * - Unit test file structure\n * - Integration test YAML\n * - Auto-registration in src/index.ts\n */\n\nimport { Command } from \"commander\";\nimport { EntityScaffolder, type ScaffoldConfig } from \"./shared/entity-scaffolder.js\";\nimport { outputResult } from \"./shared/json-output.js\";\nimport type { AddEntityResult } from \"../../types/command-results.js\";\n\nexport interface AddPromptOptions {\n\tdescription?: string;\n\ttests: boolean;\n\tregister: boolean;\n\tjson?: boolean;\n}\n\n/**\n * Create the 'add prompt' command\n */\nexport function createAddPromptCommand(): Command {\n\tconst command = new Command(\"prompt\")\n\t\t.description(\"Add a new MCP prompt to the project\")\n\t\t.argument(\"<name>\", \"Prompt name (lowercase with hyphens)\")\n\t\t.option(\n\t\t\t\"--description <desc>\",\n\t\t\t\"Prompt description\",\n\t\t\t\"TODO: Add description\",\n\t\t)\n\t\t.option(\"--no-tests\", \"Skip test file generation\")\n\t\t.option(\"--no-register\", \"Don't auto-register in index.ts\")\n\t\t.option(\"--json\", \"Output result as JSON\")\n\t\t.action(async (name: string, options: AddPromptOptions) => {\n\t\t\ttry {\n\t\t\t\tconst cwd = process.cwd();\n\t\t\t\tconst scaffolder = new EntityScaffolder();\n\n\t\t\t\t// Configure scaffolding\n\t\t\t\tconst config: ScaffoldConfig = {\n\t\t\t\t\tentityType: \"prompt\",\n\t\t\t\t\tname,\n\t\t\t\t\tdescription: options.description,\n\t\t\t\t\tgenerateTests: options.tests,\n\t\t\t\t\tautoRegister: options.register,\n\t\t\t\t};\n\n\t\t\t\t// Scaffold the prompt\n\t\t\t\tconst scaffoldResult = await scaffolder.scaffold(cwd, config);\n\n\t\t\t\t// Build result object\n\t\t\t\tconst result: AddEntityResult = {\n\t\t\t\t\tsuccess: scaffoldResult.success,\n\t\t\t\t\tentityType: \"prompt\",\n\t\t\t\t\tentityName: name,\n\t\t\t\t\tfilesCreated: scaffoldResult.filesCreated,\n\t\t\t\t\tregistered: scaffoldResult.registered,\n\t\t\t\t\tmessage: `Prompt '${name}' created successfully`,\n\t\t\t\t};\n\n\t\t\t\t// Output result\n\t\t\t\toutputResult(result, !!options.json, (r) => {\n\t\t\t\t\tconsole.log(`\\n Adding prompt: ${name}\\n`);\n\n\t\t\t\t\tfor (const file of r.filesCreated) {\n\t\t\t\t\t\tconsole.log(` Created ${file}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (r.registered) {\n\t\t\t\t\t\tconsole.log(` Registered in src/index.ts`);\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(`\\n Prompt '${name}' created successfully!\\n`);\n\t\t\t\t\tconsole.log(\"Next steps:\");\n\t\t\t\t\tconsole.log(`  1. Edit src/prompts/${name}.ts and implement your logic`);\n\t\t\t\t\tconsole.log(`  2. Run 'npm test' to verify tests pass`);\n\t\t\t\t\tconsole.log(`  3. Run 'npm run validate' to check project health\\n`);\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconst errorMessage = error instanceof Error ? error.message : String(error);\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconst result: AddEntityResult = {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tentityType: \"prompt\",\n\t\t\t\t\t\tentityName: name,\n\t\t\t\t\t\tfilesCreated: [],\n\t\t\t\t\t\tregistered: false,\n\t\t\t\t\t\terror: errorMessage,\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`\\n Error: ${errorMessage}\\n`);\n\t\t\t\t}\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n\n\treturn command;\n}\n","/**\n * Add Resource Command\n *\n * Scaffolds a new MCP resource with:\n * - Resource file with TODO markers\n * - Unit test file structure\n * - Integration test YAML\n * - Auto-registration in src/index.ts\n */\n\nimport { Command } from \"commander\";\nimport { EntityScaffolder, type ScaffoldConfig } from \"./shared/entity-scaffolder.js\";\nimport { outputResult } from \"./shared/json-output.js\";\nimport type { AddEntityResult } from \"../../types/command-results.js\";\n\nexport interface AddResourceOptions {\n\tdescription?: string;\n\turiPattern?: string;\n\tstatic?: boolean;\n\tdynamic?: boolean;\n\ttests: boolean;\n\tregister: boolean;\n\tjson?: boolean;\n}\n\n/**\n * Create the 'add resource' command\n */\nexport function createAddResourceCommand(): Command {\n\tconst command = new Command(\"resource\")\n\t\t.description(\"Add a new MCP resource to the project\")\n\t\t.argument(\"<name>\", \"Resource name (lowercase with hyphens)\")\n\t\t.option(\n\t\t\t\"--description <desc>\",\n\t\t\t\"Resource description\",\n\t\t\t\"TODO: Add description\",\n\t\t)\n\t\t.option(\n\t\t\t\"--uri-pattern <pattern>\",\n\t\t\t\"URI pattern (e.g., 'user://{id}' for dynamic, 'config://app' for static)\",\n\t\t)\n\t\t.option(\n\t\t\t\"--static\",\n\t\t\t\"Explicitly create a static resource (fixed URI, no variables)\",\n\t\t)\n\t\t.option(\n\t\t\t\"--dynamic\",\n\t\t\t\"Create a dynamic resource (URI with template variables like {id})\",\n\t\t)\n\t\t.option(\"--no-tests\", \"Skip test file generation\")\n\t\t.option(\"--no-register\", \"Don't auto-register in index.ts\")\n\t\t.option(\"--json\", \"Output result as JSON\")\n\t\t.action(async (name: string, options: AddResourceOptions) => {\n\t\t\t// Validate conflicting flags\n\t\t\tif (options.static && options.dynamic) {\n\t\t\t\tthrow new Error(\"Cannot use both --static and --dynamic flags\");\n\t\t\t}\n\n\t\t\t// Determine URI pattern based on flags and user input\n\t\t\tif (!options.uriPattern) {\n\t\t\t\tif (options.dynamic) {\n\t\t\t\t\t// Explicit dynamic\n\t\t\t\t\toptions.uriPattern = \"resource://{id}\";\n\t\t\t\t} else {\n\t\t\t\t\t// Default to static (simpler, more common)\n\t\t\t\t\toptions.uriPattern = `config://${name}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst cwd = process.cwd();\n\t\t\t\tconst scaffolder = new EntityScaffolder();\n\n\t\t\t\t// Configure scaffolding\n\t\t\t\tconst config: ScaffoldConfig = {\n\t\t\t\t\tentityType: \"resource\",\n\t\t\t\t\tname,\n\t\t\t\t\tdescription: options.description,\n\t\t\t\t\tgenerateTests: options.tests,\n\t\t\t\t\tautoRegister: options.register,\n\t\t\t\t\tresourceOptions: {\n\t\t\t\t\t\turiPattern: options.uriPattern,\n\t\t\t\t\t\tstatic: options.static,\n\t\t\t\t\t\tdynamic: options.dynamic,\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\t// Scaffold the resource\n\t\t\t\tconst scaffoldResult = await scaffolder.scaffold(cwd, config);\n\n\t\t\t\t// Build result object\n\t\t\t\tconst result: AddEntityResult = {\n\t\t\t\t\tsuccess: scaffoldResult.success,\n\t\t\t\t\tentityType: \"resource\",\n\t\t\t\t\tentityName: name,\n\t\t\t\t\tfilesCreated: scaffoldResult.filesCreated,\n\t\t\t\t\tregistered: scaffoldResult.registered,\n\t\t\t\t\tmessage: `Resource '${name}' created successfully`,\n\t\t\t\t};\n\n\t\t\t\t// Output result\n\t\t\t\toutputResult(result, !!options.json, (r) => {\n\t\t\t\t\tconsole.log(`\\n Adding resource: ${name}\\n`);\n\n\t\t\t\t\tfor (const file of r.filesCreated) {\n\t\t\t\t\t\tconsole.log(` Created ${file}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (r.registered) {\n\t\t\t\t\t\tconsole.log(` Registered in src/index.ts`);\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(`\\n Resource '${name}' created successfully!\\n`);\n\t\t\t\t\tconsole.log(\"Next steps:\");\n\t\t\t\t\tconsole.log(`  1. Edit src/resources/${name}.ts and implement your logic`);\n\t\t\t\t\tconsole.log(`  2. Run 'npm test' to verify tests pass`);\n\t\t\t\t\tconsole.log(`  3. Run 'npm run validate' to check project health\\n`);\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconst errorMessage = error instanceof Error ? error.message : String(error);\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconst result: AddEntityResult = {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tentityType: \"resource\",\n\t\t\t\t\t\tentityName: name,\n\t\t\t\t\t\tfilesCreated: [],\n\t\t\t\t\t\tregistered: false,\n\t\t\t\t\t\terror: errorMessage,\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`\\n Error: ${errorMessage}\\n`);\n\t\t\t\t}\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n\n\treturn command;\n}\n","/**\n * Platform Detection Utilities\n *\n * Detects the deployment platform (Cloudflare Workers, Vercel, etc.)\n * based on project structure and configuration files.\n */\n\nimport { readFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\n\nexport type Platform = \"cloudflare\" | \"vercel\" | \"unknown\";\n\n/**\n * Detect the platform for a given project directory\n *\n * @param cwd - Project root directory\n * @returns Detected platform\n */\nexport async function detectPlatform(cwd: string): Promise<Platform> {\n\t// Check for Cloudflare Workers indicators\n\tif (await isCloudflareProject(cwd)) {\n\t\treturn \"cloudflare\";\n\t}\n\n\t// Check for Vercel/Next.js indicators\n\tif (await isVercelProject(cwd)) {\n\t\treturn \"vercel\";\n\t}\n\n\treturn \"unknown\";\n}\n\n/**\n * Check if project is a Cloudflare Workers project\n */\nasync function isCloudflareProject(cwd: string): Promise<boolean> {\n\t// Primary indicator: wrangler config file (toml, jsonc, or json)\n\tconst wranglerFiles = [\"wrangler.jsonc\", \"wrangler.json\", \"wrangler.toml\"];\n\tfor (const file of wranglerFiles) {\n\t\tif (existsSync(join(cwd, file))) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t// Secondary indicator: package.json with 'agents' dependency\n\tconst pkgPath = join(cwd, \"package.json\");\n\tif (existsSync(pkgPath)) {\n\t\ttry {\n\t\t\tconst pkg = JSON.parse(await readFile(pkgPath, \"utf-8\"));\n\t\t\tif (pkg.dependencies?.[\"agents\"] || pkg.devDependencies?.[\"wrangler\"]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch {\n\t\t\t// Invalid package.json, continue checking\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/**\n * Check if project is a Vercel/Next.js project\n */\nasync function isVercelProject(cwd: string): Promise<boolean> {\n\t// Primary indicators: Vercel or Next.js config files\n\tconst vercelFiles = [\n\t\t\"vercel.json\",\n\t\t\"next.config.js\",\n\t\t\"next.config.mjs\",\n\t\t\"next.config.ts\",\n\t];\n\n\tfor (const file of vercelFiles) {\n\t\tif (existsSync(join(cwd, file))) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t// Secondary indicator: package.json with Next.js or @vercel/mcp-adapter\n\tconst pkgPath = join(cwd, \"package.json\");\n\tif (existsSync(pkgPath)) {\n\t\ttry {\n\t\t\tconst pkg = JSON.parse(await readFile(pkgPath, \"utf-8\"));\n\t\t\tif (\n\t\t\t\tpkg.dependencies?.[\"next\"] ||\n\t\t\t\tpkg.dependencies?.[\"@vercel/mcp-adapter\"] ||\n\t\t\t\tpkg.devDependencies?.[\"next\"]\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch {\n\t\t\t// Invalid package.json, continue\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/**\n * Get the expected entry point path for a platform\n */\nexport function getEntryPointPath(cwd: string, platform: Platform): string {\n\tswitch (platform) {\n\t\tcase \"cloudflare\":\n\t\t\treturn join(cwd, \"src/index.ts\");\n\t\tcase \"vercel\":\n\t\t\treturn join(cwd, \"app/api/mcp/route.ts\");\n\t\tdefault:\n\t\t\tthrow new Error(`Unknown platform: ${platform}`);\n\t}\n}\n\n/**\n * Validate that the project has the expected entry point\n */\nexport function validateEntryPoint(cwd: string, platform: Platform): void {\n\tconst entryPoint = getEntryPointPath(cwd, platform);\n\n\tif (!existsSync(entryPoint)) {\n\t\tthrow new Error(\n\t\t\t`Entry point not found: ${entryPoint}. ` +\n\t\t\t\t`This doesn't appear to be a valid ${platform} MCP server project.`,\n\t\t);\n\t}\n}\n","/**\n * Auth Template Generators\n *\n * Generates TypeScript code for authentication files:\n * - Auth types and interfaces\n * - Provider configurations\n * - Provider implementations (Stytch, Auth0, WorkOS)\n */\n\nexport type AuthProvider = \"stytch\" | \"auth0\" | \"workos\";\n\n/**\n * Generate auth types template (types.ts)\n */\nexport function generateAuthTypesTemplate(): string {\n\treturn `/**\n * Authentication Types\n *\n * Common interfaces for all auth providers.\n */\n\nexport interface AuthProvider {\n\tname: string;\n\tvalidateToken(token: string, env: Env): Promise<UserContext>;\n\tgetMetadata(env: Env): AuthServerMetadata;\n\tgetRequiredEnvVars(): string[];\n}\n\nexport interface UserContext {\n\tuserId: string;\n\temail?: string;\n\tname?: string;\n\tscopes?: string[];\n\tmetadata?: Record<string, unknown>;\n}\n\nexport interface AuthServerMetadata {\n\tissuer: string;\n\tauthorization_endpoint: string;\n\ttoken_endpoint: string;\n\tregistration_endpoint?: string;\n\tscopes_supported?: string[];\n}\n\nexport class AuthenticationError extends Error {\n\tconstructor(message: string, public code: string) {\n\t\tsuper(message);\n\t\tthis.name = \"AuthenticationError\";\n\t}\n}\n`;\n}\n\n/**\n * Generate auth config template (config.ts)\n */\nexport function generateAuthConfigTemplate(provider: AuthProvider): string {\n\tconst capitalizedProvider = capitalizeFirst(provider);\n\n\treturn `/**\n * Authentication Configuration\n *\n * Provides the appropriate auth provider based on environment.\n */\n\nimport type { AuthProvider } from \"./types.js\";\nimport { ${capitalizedProvider}Provider } from \"./providers/${provider}.js\";\n\nexport function getAuthProvider(env: Env): AuthProvider {\n\treturn new ${capitalizedProvider}Provider();\n}\n\nexport function validateAuthEnv(env: Env): void {\n\tconst provider = getAuthProvider(env);\n\tconst required = provider.getRequiredEnvVars();\n\n\tfor (const key of required) {\n\t\tif (!env[key]) {\n\t\t\tthrow new Error(\n\t\t\t\t\\`Missing required environment variable: \\${key}\\\\n\\` +\n\t\t\t\t\t\\`Please set this in your .env file or wrangler.toml\\`,\n\t\t\t);\n\t\t}\n\t}\n}\n`;\n}\n\n/**\n * Generate Stytch provider template\n */\nexport function generateStytchProviderTemplate(): string {\n\treturn `/**\n * Stytch Authentication Provider\n *\n * Uses Stytch Connected Apps for MCP server authentication.\n * Docs: https://stytch.com/docs/guides/connected-apps/mcp-servers\n */\n\nimport type {\n\tAuthProvider,\n\tUserContext,\n\tAuthServerMetadata,\n} from \"../types.js\";\nimport { AuthenticationError } from \"../types.js\";\n\nexport class StytchProvider implements AuthProvider {\n\tname = \"stytch\";\n\n\tasync validateToken(token: string, env: Env): Promise<UserContext> {\n\t\ttry {\n\t\t\t// Stytch session authentication\n\t\t\tconst response = await fetch(\n\t\t\t\t\"https://api.stytch.com/v1/sessions/authenticate\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\tAuthorization: \\`Basic \\${btoa(\\`\\${env.STYTCH_PROJECT_ID}:\\${env.STYTCH_SECRET}\\`)}\\`,\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tsession_token: token,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new AuthenticationError(\n\t\t\t\t\t\"Invalid or expired token\",\n\t\t\t\t\t\"invalid_token\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\treturn {\n\t\t\t\tuserId: data.session.user_id,\n\t\t\t\temail: data.session.attributes?.email,\n\t\t\t\tname: data.session.attributes?.name,\n\t\t\t\tmetadata: {\n\t\t\t\t\tsessionId: data.session.session_id,\n\t\t\t\t\tauthenticatedAt: data.session.authenticated_at,\n\t\t\t\t},\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tif (error instanceof AuthenticationError) {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t\tthrow new AuthenticationError(\n\t\t\t\t\"Failed to validate token\",\n\t\t\t\t\"validation_failed\",\n\t\t\t);\n\t\t}\n\t}\n\n\tgetMetadata(env: Env): AuthServerMetadata {\n\t\tconst baseUrl =\n\t\t\tenv.STYTCH_ENV === \"live\"\n\t\t\t\t? \"https://api.stytch.com\"\n\t\t\t\t: \"https://test.stytch.com\";\n\n\t\treturn {\n\t\t\tissuer: \\`\\${baseUrl}/v1/projects/\\${env.STYTCH_PROJECT_ID}\\`,\n\t\t\tauthorization_endpoint: \\`\\${baseUrl}/v1/oauth/authorize\\`,\n\t\t\ttoken_endpoint: \\`\\${baseUrl}/v1/oauth/token\\`,\n\t\t\tregistration_endpoint: \\`\\${baseUrl}/v1/oauth/register\\`,\n\t\t\tscopes_supported: [\"openid\", \"profile\", \"email\"],\n\t\t};\n\t}\n\n\tgetRequiredEnvVars(): string[] {\n\t\treturn [\"STYTCH_PROJECT_ID\", \"STYTCH_SECRET\"];\n\t}\n}\n`;\n}\n\n/**\n * Generate Auth0 provider template\n */\nexport function generateAuth0ProviderTemplate(): string {\n\treturn `/**\n * Auth0 Authentication Provider\n *\n * Uses Auth0 for enterprise-grade authentication.\n * Docs: https://auth0.com/docs\n */\n\nimport type {\n\tAuthProvider,\n\tUserContext,\n\tAuthServerMetadata,\n} from \"../types.js\";\nimport { AuthenticationError } from \"../types.js\";\n\nexport class Auth0Provider implements AuthProvider {\n\tname = \"auth0\";\n\n\tasync validateToken(token: string, env: Env): Promise<UserContext> {\n\t\ttry {\n\t\t\t// Verify JWT with Auth0\n\t\t\tconst response = await fetch(\\`https://\\${env.AUTH0_DOMAIN}/userinfo\\`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: \\`Bearer \\${token}\\`,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new AuthenticationError(\n\t\t\t\t\t\"Invalid or expired token\",\n\t\t\t\t\t\"invalid_token\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\treturn {\n\t\t\t\tuserId: data.sub,\n\t\t\t\temail: data.email,\n\t\t\t\tname: data.name,\n\t\t\t\tmetadata: {\n\t\t\t\t\temailVerified: data.email_verified,\n\t\t\t\t\tpicture: data.picture,\n\t\t\t\t},\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tif (error instanceof AuthenticationError) {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t\tthrow new AuthenticationError(\n\t\t\t\t\"Failed to validate token\",\n\t\t\t\t\"validation_failed\",\n\t\t\t);\n\t\t}\n\t}\n\n\tgetMetadata(env: Env): AuthServerMetadata {\n\t\tconst domain = env.AUTH0_DOMAIN;\n\n\t\treturn {\n\t\t\tissuer: \\`https://\\${domain}/\\`,\n\t\t\tauthorization_endpoint: \\`https://\\${domain}/authorize\\`,\n\t\t\ttoken_endpoint: \\`https://\\${domain}/oauth/token\\`,\n\t\t\tregistration_endpoint: \\`https://\\${domain}/oidc/register\\`,\n\t\t\tscopes_supported: [\"openid\", \"profile\", \"email\", \"offline_access\"],\n\t\t};\n\t}\n\n\tgetRequiredEnvVars(): string[] {\n\t\treturn [\"AUTH0_DOMAIN\", \"AUTH0_CLIENT_ID\", \"AUTH0_CLIENT_SECRET\", \"AUTH0_AUDIENCE\"];\n\t}\n}\n`;\n}\n\n/**\n * Generate WorkOS provider template\n */\nexport function generateWorkOSProviderTemplate(): string {\n\treturn `/**\n * WorkOS Authentication Provider\n *\n * Uses WorkOS for B2B/enterprise authentication with SSO support.\n * Docs: https://workos.com/docs\n */\n\nimport type {\n\tAuthProvider,\n\tUserContext,\n\tAuthServerMetadata,\n} from \"../types.js\";\nimport { AuthenticationError } from \"../types.js\";\n\nexport class WorkosProvider implements AuthProvider {\n\tname = \"workos\";\n\n\tasync validateToken(token: string, env: Env): Promise<UserContext> {\n\t\ttry {\n\t\t\t// Get user profile from WorkOS\n\t\t\tconst response = await fetch(\n\t\t\t\t\"https://api.workos.com/user_management/users/me\",\n\t\t\t\t{\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: \\`Bearer \\${token}\\`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new AuthenticationError(\n\t\t\t\t\t\"Invalid or expired token\",\n\t\t\t\t\t\"invalid_token\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\treturn {\n\t\t\t\tuserId: data.id,\n\t\t\t\temail: data.email,\n\t\t\t\tname: \\`\\${data.first_name} \\${data.last_name}\\`.trim(),\n\t\t\t\tmetadata: {\n\t\t\t\t\torganizationId: data.organization_id,\n\t\t\t\t\temailVerified: data.email_verified,\n\t\t\t\t},\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tif (error instanceof AuthenticationError) {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t\tthrow new AuthenticationError(\n\t\t\t\t\"Failed to validate token\",\n\t\t\t\t\"validation_failed\",\n\t\t\t);\n\t\t}\n\t}\n\n\tgetMetadata(env: Env): AuthServerMetadata {\n\t\treturn {\n\t\t\tissuer: \"https://api.workos.com/\",\n\t\t\tauthorization_endpoint:\n\t\t\t\t\"https://api.workos.com/user_management/authorize\",\n\t\t\ttoken_endpoint: \"https://api.workos.com/user_management/token\",\n\t\t\tscopes_supported: [\"openid\", \"profile\", \"email\", \"organizations\"],\n\t\t};\n\t}\n\n\tgetRequiredEnvVars(): string[] {\n\t\treturn [\"WORKOS_API_KEY\", \"WORKOS_CLIENT_ID\"];\n\t}\n}\n`;\n}\n\n/**\n * Generate .env.example template for a provider\n */\nexport function generateEnvExampleTemplate(provider: AuthProvider): string {\n\tconst templates: Record<AuthProvider, string> = {\n\t\tstytch: `# Stytch Configuration\n# Get these from: https://stytch.com/dashboard/api-keys\nSTYTCH_PROJECT_ID=project-test-00000000-0000-0000-0000-000000000000\nSTYTCH_SECRET=secret-test-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nSTYTCH_ENV=test  # Use \"live\" for production\n\n# Stytch Setup Instructions:\n# 1. Create a Stytch account at https://stytch.com\n# 2. Create a new \"Consumer Authentication\" project\n# 3. Go to API Keys and copy your Project ID and Secret\n# 4. In Connected Apps settings:\n#    - Enable \"Allow dynamic client registration\"\n#    - Add your Worker URL (after deployment)\n# 5. Update this file with your credentials\n`,\n\t\tauth0: `# Auth0 Configuration\n# Get these from: https://manage.auth0.com/dashboard\nAUTH0_DOMAIN=your-tenant.auth0.com\nAUTH0_CLIENT_ID=xxxxxxxxxxxxxxxxxxxx\nAUTH0_CLIENT_SECRET=yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy\nAUTH0_AUDIENCE=https://your-api.example.com\n\n# Auth0 Setup Instructions:\n# 1. Create an Auth0 account at https://auth0.com\n# 2. Create a new application (Machine to Machine or Regular Web App)\n# 3. Copy your Domain, Client ID, and Client Secret\n# 4. Set your API Audience (API identifier)\n# 5. Update this file with your credentials\n`,\n\t\tworkos: `# WorkOS Configuration\n# Get these from: https://dashboard.workos.com/\nWORKOS_API_KEY=sk_test_xxxxxxxxxxxxxxxxxxxx\nWORKOS_CLIENT_ID=client_xxxxxxxxxxxxxxxxxxxx\n\n# WorkOS Setup Instructions:\n# 1. Create a WorkOS account at https://workos.com\n# 2. Go to API Keys in the dashboard\n# 3. Create a new API key\n# 4. Copy your Client ID from the application settings\n# 5. Update this file with your credentials\n`,\n\t};\n\n\treturn templates[provider];\n}\n\n/**\n * Capitalize first letter of a string\n */\nfunction capitalizeFirst(str: string): string {\n\treturn str.charAt(0).toUpperCase() + str.slice(1);\n}\n","/**\n * Dependency Manager\n *\n * Safely adds authentication dependencies to package.json based on\n * provider and platform selection.\n */\n\nimport { readFile, writeFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\n\nexport type AuthProvider = \"stytch\" | \"auth0\" | \"workos\";\nexport type Platform = \"cloudflare\" | \"vercel\" | \"unknown\";\n\nexport interface DependencyUpdate {\n\tdependencies: Record<string, string>;\n\tdevDependencies: Record<string, string>;\n}\n\n/**\n * Get required dependencies for auth provider and platform\n *\n * @param provider - Auth provider (stytch, auth0, workos)\n * @param platform - Deployment platform (cloudflare, vercel)\n * @returns Dependencies to add\n */\nexport function getAuthDependencies(\n\tprovider: AuthProvider,\n\tplatform: Platform,\n): DependencyUpdate {\n\tconst deps: DependencyUpdate = {\n\t\tdependencies: {},\n\t\tdevDependencies: {},\n\t};\n\n\t// Cloudflare Workers OAuth Provider (for all Cloudflare auth)\n\tif (platform === \"cloudflare\") {\n\t\tdeps.dependencies[\"@cloudflare/workers-oauth-provider\"] = \"^0.0.12\";\n\t}\n\n\t// Provider-specific dependencies\n\tswitch (provider) {\n\t\tcase \"stytch\":\n\t\t\t// Stytch SDK for token validation (optional, could use fetch directly)\n\t\t\t// deps.dependencies[\"stytch\"] = \"^10.0.0\";\n\t\t\tbreak;\n\n\t\tcase \"auth0\":\n\t\t\tdeps.dependencies[\"auth0\"] = \"^4.0.0\";\n\t\t\tbreak;\n\n\t\tcase \"workos\":\n\t\t\tdeps.dependencies[\"@workos-inc/node\"] = \"^7.0.0\";\n\t\t\tbreak;\n\t}\n\n\treturn deps;\n}\n\n/**\n * Add dependencies to package.json\n *\n * @param cwd - Project root directory\n * @param update - Dependencies to add\n * @returns True if package.json was modified\n */\nexport async function addDependenciesToPackageJson(\n\tcwd: string,\n\tupdate: DependencyUpdate,\n): Promise<boolean> {\n\tconst packageJsonPath = join(cwd, \"package.json\");\n\n\tif (!existsSync(packageJsonPath)) {\n\t\tthrow new Error(`package.json not found at ${packageJsonPath}`);\n\t}\n\n\t// Read and parse\n\tconst content = await readFile(packageJsonPath, \"utf-8\");\n\tconst pkg = JSON.parse(content);\n\n\t// Track if we made changes\n\tlet modified = false;\n\n\t// Add dependencies\n\tif (Object.keys(update.dependencies).length > 0) {\n\t\tpkg.dependencies = pkg.dependencies || {};\n\n\t\tfor (const [name, version] of Object.entries(update.dependencies)) {\n\t\t\tif (!pkg.dependencies[name]) {\n\t\t\t\tpkg.dependencies[name] = version;\n\t\t\t\tmodified = true;\n\t\t\t}\n\t\t}\n\n\t\t// Sort dependencies alphabetically\n\t\tpkg.dependencies = sortObject(pkg.dependencies);\n\t}\n\n\t// Add devDependencies\n\tif (Object.keys(update.devDependencies).length > 0) {\n\t\tpkg.devDependencies = pkg.devDependencies || {};\n\n\t\tfor (const [name, version] of Object.entries(update.devDependencies)) {\n\t\t\tif (!pkg.devDependencies[name]) {\n\t\t\t\tpkg.devDependencies[name] = version;\n\t\t\t\tmodified = true;\n\t\t\t}\n\t\t}\n\n\t\t// Sort devDependencies alphabetically\n\t\tpkg.devDependencies = sortObject(pkg.devDependencies);\n\t}\n\n\t// Write back if modified\n\tif (modified) {\n\t\tawait writeFile(\n\t\t\tpackageJsonPath,\n\t\t\tJSON.stringify(pkg, null, 2) + \"\\n\",\n\t\t\t\"utf-8\",\n\t\t);\n\t}\n\n\treturn modified;\n}\n\n/**\n * List dependencies that would be added\n *\n * @param cwd - Project root directory\n * @param update - Dependencies to check\n * @returns List of new dependencies\n */\nexport async function listNewDependencies(\n\tcwd: string,\n\tupdate: DependencyUpdate,\n): Promise<string[]> {\n\tconst packageJsonPath = join(cwd, \"package.json\");\n\n\tif (!existsSync(packageJsonPath)) {\n\t\t// All dependencies are new if package.json doesn't exist\n\t\treturn [\n\t\t\t...Object.keys(update.dependencies),\n\t\t\t...Object.keys(update.devDependencies),\n\t\t];\n\t}\n\n\tconst content = await readFile(packageJsonPath, \"utf-8\");\n\tconst pkg = JSON.parse(content);\n\n\tconst newDeps: string[] = [];\n\n\t// Check dependencies\n\tfor (const name of Object.keys(update.dependencies)) {\n\t\tif (!pkg.dependencies?.[name]) {\n\t\t\tnewDeps.push(name);\n\t\t}\n\t}\n\n\t// Check devDependencies\n\tfor (const name of Object.keys(update.devDependencies)) {\n\t\tif (!pkg.devDependencies?.[name]) {\n\t\t\tnewDeps.push(name);\n\t\t}\n\t}\n\n\treturn newDeps;\n}\n\n/**\n * Remove auth dependencies from package.json\n *\n * @param cwd - Project root directory\n * @param provider - Auth provider to remove\n * @param platform - Platform to remove dependencies for\n * @returns True if package.json was modified\n */\nexport async function removeAuthDependencies(\n\tcwd: string,\n\tprovider: AuthProvider,\n\tplatform: Platform,\n): Promise<boolean> {\n\tconst packageJsonPath = join(cwd, \"package.json\");\n\n\tif (!existsSync(packageJsonPath)) {\n\t\treturn false;\n\t}\n\n\tconst content = await readFile(packageJsonPath, \"utf-8\");\n\tconst pkg = JSON.parse(content);\n\n\tconst depsToRemove = getAuthDependencies(provider, platform);\n\tlet modified = false;\n\n\t// Remove dependencies\n\tfor (const name of Object.keys(depsToRemove.dependencies)) {\n\t\tif (pkg.dependencies?.[name]) {\n\t\t\tdelete pkg.dependencies[name];\n\t\t\tmodified = true;\n\t\t}\n\t}\n\n\t// Remove devDependencies\n\tfor (const name of Object.keys(depsToRemove.devDependencies)) {\n\t\tif (pkg.devDependencies?.[name]) {\n\t\t\tdelete pkg.devDependencies[name];\n\t\t\tmodified = true;\n\t\t}\n\t}\n\n\tif (modified) {\n\t\tawait writeFile(\n\t\t\tpackageJsonPath,\n\t\t\tJSON.stringify(pkg, null, 2) + \"\\n\",\n\t\t\t\"utf-8\",\n\t\t);\n\t}\n\n\treturn modified;\n}\n\n/**\n * Sort object keys alphabetically\n */\nfunction sortObject(obj: Record<string, string>): Record<string, string> {\n\treturn Object.keys(obj)\n\t\t.sort()\n\t\t.reduce(\n\t\t\t(sorted, key) => {\n\t\t\t\tsorted[key] = obj[key];\n\t\t\t\treturn sorted;\n\t\t\t},\n\t\t\t{} as Record<string, string>,\n\t\t);\n}\n","/**\n * Anchor Service\n *\n * Provides anchor-based code transformation for reliable, agent-friendly\n * code modifications. Anchors are special comment blocks that mark insertion\n * points for generated code, making transformations more robust than regex.\n *\n * Pattern: <!-- or // <mcp-anchor:name> --> ... <!-- or // </mcp-anchor:name> -->\n */\n\nimport { readFile, writeFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\n\n/**\n * Anchor block definition\n */\nexport interface AnchorBlock {\n\t/** Anchor type/name (e.g., \"auth:imports\", \"auth:middleware\") */\n\ttype: string;\n\t/** Start marker comment */\n\tstartMarker: string;\n\t/** End marker comment */\n\tendMarker: string;\n\t/** Human-readable description */\n\tdescription: string;\n}\n\n/**\n * Predefined anchor blocks for auth transformation\n */\nexport const AUTH_ANCHORS = {\n\tIMPORTS: {\n\t\ttype: \"auth:imports\",\n\t\tstartMarker: \"// <mcp-auth:imports>\",\n\t\tendMarker: \"// </mcp-auth:imports>\",\n\t\tdescription: \"Auth imports will be added here by add-auth command\",\n\t},\n\tMIDDLEWARE: {\n\t\ttype: \"auth:middleware\",\n\t\tstartMarker: \"// <mcp-auth:middleware>\",\n\t\tendMarker: \"// </mcp-auth:middleware>\",\n\t\tdescription: \"Auth middleware will be added here by add-auth command\",\n\t},\n\tCONFIG_VARS: {\n\t\ttype: \"auth:vars\",\n\t\tstartMarker: \"// <mcp-auth:vars>\",\n\t\tendMarker: \"// </mcp-auth:vars>\",\n\t\tdescription: \"Auth environment variables managed by mcp-server-kit\",\n\t},\n} as const;\n\n/**\n * Predefined anchor blocks for Cloudflare binding transformation\n */\nexport const BINDING_ANCHORS = {\n\t// Phase 1: KV and D1\n\tKV: {\n\t\ttype: \"bindings:kv\",\n\t\tstartMarker: \"// <mcp-bindings:kv>\",\n\t\tendMarker: \"// </mcp-bindings:kv>\",\n\t\tdescription: \"KV namespace bindings managed by mcp-server-kit\",\n\t},\n\tD1: {\n\t\ttype: \"bindings:d1\",\n\t\tstartMarker: \"// <mcp-bindings:d1>\",\n\t\tendMarker: \"// </mcp-bindings:d1>\",\n\t\tdescription: \"D1 database bindings managed by mcp-server-kit\",\n\t},\n\tIMPORTS: {\n\t\ttype: \"bindings:imports\",\n\t\tstartMarker: \"// <mcp-bindings:imports>\",\n\t\tendMarker: \"// </mcp-bindings:imports>\",\n\t\tdescription: \"Binding helper imports will be added here by add binding command\",\n\t},\n\t// Phase 2: R2 and Queues (coming soon)\n\tR2: {\n\t\ttype: \"bindings:r2\",\n\t\tstartMarker: \"// <mcp-bindings:r2>\",\n\t\tendMarker: \"// </mcp-bindings:r2>\",\n\t\tdescription: \"R2 bucket bindings managed by mcp-server-kit\",\n\t},\n\tQUEUES_PRODUCERS: {\n\t\ttype: \"bindings:queues:producers\",\n\t\tstartMarker: \"// <mcp-bindings:queues:producers>\",\n\t\tendMarker: \"// </mcp-bindings:queues:producers>\",\n\t\tdescription: \"Queue producer bindings managed by mcp-server-kit\",\n\t},\n\tQUEUES_CONSUMERS: {\n\t\ttype: \"bindings:queues:consumers\",\n\t\tstartMarker: \"// <mcp-bindings:queues:consumers>\",\n\t\tendMarker: \"// </mcp-bindings:queues:consumers>\",\n\t\tdescription: \"Queue consumer bindings managed by mcp-server-kit\",\n\t},\n\t// Phase 3: Workers AI and Vectorize (coming soon)\n\tAI: {\n\t\ttype: \"bindings:ai\",\n\t\tstartMarker: \"// <mcp-bindings:ai>\",\n\t\tendMarker: \"// </mcp-bindings:ai>\",\n\t\tdescription: \"Workers AI binding managed by mcp-server-kit\",\n\t},\n\tVECTORIZE: {\n\t\ttype: \"bindings:vectorize\",\n\t\tstartMarker: \"// <mcp-bindings:vectorize>\",\n\t\tendMarker: \"// </mcp-bindings:vectorize>\",\n\t\tdescription: \"Vectorize index bindings managed by mcp-server-kit\",\n\t},\n\t// Phase 4: Hyperdrive (coming soon)\n\tHYPERDRIVE: {\n\t\ttype: \"bindings:hyperdrive\",\n\t\tstartMarker: \"// <mcp-bindings:hyperdrive>\",\n\t\tendMarker: \"// </mcp-bindings:hyperdrive>\",\n\t\tdescription: \"Hyperdrive config bindings managed by mcp-server-kit\",\n\t},\n} as const;\n\n/**\n * Result of anchor operation\n */\nexport interface AnchorOperationResult {\n\t/** Whether the operation succeeded */\n\tsuccess: boolean;\n\t/** Whether content was actually modified */\n\tmodified: boolean;\n\t/** Error message if operation failed */\n\terror?: string;\n\t/** Warning message (e.g., anchor already populated) */\n\twarning?: string;\n}\n\n/**\n * Service for anchor-based code transformation\n */\nexport class AnchorService {\n\t/**\n\t * Check if a file contains the specified anchor block\n\t */\n\tasync hasAnchor(\n\t\tfilePath: string,\n\t\tanchor: AnchorBlock,\n\t): Promise<boolean> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst content = await readFile(filePath, \"utf-8\");\n\t\treturn (\n\t\t\tcontent.includes(anchor.startMarker) && content.includes(anchor.endMarker)\n\t\t);\n\t}\n\n\t/**\n\t * Check if an anchor block is empty (ready for content insertion)\n\t */\n\tasync isAnchorEmpty(\n\t\tfilePath: string,\n\t\tanchor: AnchorBlock,\n\t): Promise<boolean> {\n\t\tconst content = await readFile(filePath, \"utf-8\");\n\n\t\tconst startIdx = content.indexOf(anchor.startMarker);\n\t\tconst endIdx = content.indexOf(anchor.endMarker);\n\n\t\tif (startIdx === -1 || endIdx === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Extract content between anchors\n\t\tconst blockContent = content.slice(\n\t\t\tstartIdx + anchor.startMarker.length,\n\t\t\tendIdx,\n\t\t);\n\n\t\t// Consider empty if only whitespace or comments\n\t\tconst trimmed = blockContent.trim();\n\t\treturn (\n\t\t\ttrimmed === \"\" ||\n\t\t\ttrimmed.startsWith(\"//\") ||\n\t\t\ttrimmed.startsWith(\"#\")\n\t\t);\n\t}\n\n\t/**\n\t * Insert content at the specified anchor block\n\t *\n\t * @param filePath - Path to file to modify\n\t * @param anchor - Anchor block to insert at\n\t * @param content - Content to insert\n\t * @param options - Insertion options\n\t * @returns Result of the operation\n\t */\n\tasync insertAtAnchor(\n\t\tfilePath: string,\n\t\tanchor: AnchorBlock,\n\t\tcontent: string,\n\t\toptions: {\n\t\t\t/** Allow overwriting non-empty anchors */\n\t\t\tforce?: boolean;\n\t\t\t/** Add indentation to inserted content */\n\t\t\tindent?: string;\n\t\t} = {},\n\t): Promise<AnchorOperationResult> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `File not found: ${filePath}`,\n\t\t\t};\n\t\t}\n\n\t\tconst fileContent = await readFile(filePath, \"utf-8\");\n\n\t\t// Check if anchors exist\n\t\tconst startIdx = fileContent.indexOf(anchor.startMarker);\n\t\tconst endIdx = fileContent.indexOf(anchor.endMarker);\n\n\t\tif (startIdx === -1 || endIdx === -1) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `Missing anchor block: ${anchor.type}. Expected to find ${anchor.startMarker} and ${anchor.endMarker}`,\n\t\t\t};\n\t\t}\n\n\t\t// Check if anchor already has content\n\t\tconst blockContent = fileContent.slice(\n\t\t\tstartIdx + anchor.startMarker.length,\n\t\t\tendIdx,\n\t\t);\n\t\tconst isEmpty =\n\t\t\tblockContent.trim() === \"\" ||\n\t\t\tblockContent.trim().startsWith(\"//\") ||\n\t\t\tblockContent.trim().startsWith(\"#\");\n\n\t\tif (!isEmpty && !options.force) {\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tmodified: false,\n\t\t\t\twarning: `Anchor block ${anchor.type} already has content. Use force=true to overwrite.`,\n\t\t\t};\n\t\t}\n\n\t\t// Apply indentation if specified\n\t\tlet insertContent = content;\n\t\tif (options.indent) {\n\t\t\tinsertContent = content\n\t\t\t\t.split(\"\\n\")\n\t\t\t\t.map((line) => (line.trim() ? options.indent + line : line))\n\t\t\t\t.join(\"\\n\");\n\t\t}\n\n\t\t// Insert content between anchors\n\t\tconst before = fileContent.slice(0, startIdx + anchor.startMarker.length);\n\t\tconst after = fileContent.slice(endIdx);\n\t\tconst newContent = before + \"\\n\" + insertContent + \"\\n\" + after;\n\n\t\tawait writeFile(filePath, newContent, \"utf-8\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmodified: true,\n\t\t};\n\t}\n\n\t/**\n\t * Remove content from an anchor block (leave anchors intact)\n\t */\n\tasync clearAnchor(\n\t\tfilePath: string,\n\t\tanchor: AnchorBlock,\n\t): Promise<AnchorOperationResult> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `File not found: ${filePath}`,\n\t\t\t};\n\t\t}\n\n\t\tconst fileContent = await readFile(filePath, \"utf-8\");\n\n\t\tconst startIdx = fileContent.indexOf(anchor.startMarker);\n\t\tconst endIdx = fileContent.indexOf(anchor.endMarker);\n\n\t\tif (startIdx === -1 || endIdx === -1) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `Missing anchor block: ${anchor.type}`,\n\t\t\t};\n\t\t}\n\n\t\t// Remove content between anchors, keep anchors\n\t\tconst before = fileContent.slice(0, startIdx + anchor.startMarker.length);\n\t\tconst after = fileContent.slice(endIdx);\n\t\tconst newContent = before + \"\\n// \" + anchor.description + \"\\n\" + after;\n\n\t\tawait writeFile(filePath, newContent, \"utf-8\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmodified: true,\n\t\t};\n\t}\n\n\t/**\n\t * Insert an anchor block at a specific position in a file\n\t * (Used when scaffolding new templates)\n\t */\n\tasync insertAnchorBlock(\n\t\tfilePath: string,\n\t\tanchor: AnchorBlock,\n\t\tposition: number,\n\t): Promise<AnchorOperationResult> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `File not found: ${filePath}`,\n\t\t\t};\n\t\t}\n\n\t\tconst content = await readFile(filePath, \"utf-8\");\n\n\t\t// Check if anchor already exists\n\t\tif (content.includes(anchor.startMarker)) {\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tmodified: false,\n\t\t\t\twarning: `Anchor block ${anchor.type} already exists`,\n\t\t\t};\n\t\t}\n\n\t\tconst anchorBlock = `\\n${anchor.startMarker}\\n// ${anchor.description}\\n${anchor.endMarker}\\n`;\n\t\tconst newContent =\n\t\t\tcontent.slice(0, position) + anchorBlock + content.slice(position);\n\n\t\tawait writeFile(filePath, newContent, \"utf-8\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmodified: true,\n\t\t};\n\t}\n\n\t/**\n\t * Validate that all required anchors are present in a file\n\t */\n\tasync validateAnchors(\n\t\tfilePath: string,\n\t\trequiredAnchors: AnchorBlock[],\n\t): Promise<{ valid: boolean; missing: string[] }> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn {\n\t\t\t\tvalid: false,\n\t\t\t\tmissing: requiredAnchors.map((a) => a.type),\n\t\t\t};\n\t\t}\n\n\t\tconst content = await readFile(filePath, \"utf-8\");\n\t\tconst missing: string[] = [];\n\n\t\tfor (const anchor of requiredAnchors) {\n\t\t\tif (\n\t\t\t\t!content.includes(anchor.startMarker) ||\n\t\t\t\t!content.includes(anchor.endMarker)\n\t\t\t) {\n\t\t\t\tmissing.push(anchor.type);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tvalid: missing.length === 0,\n\t\t\tmissing,\n\t\t};\n\t}\n}\n","/**\n * Entry Point Transformer\n *\n * Transforms entry point files (src/index.ts) to add authentication middleware.\n * Handles Cloudflare Workers and Vercel Next.js patterns.\n *\n * Uses anchor-based transformation for reliability, with regex fallback for\n * backward compatibility with templates that don't have anchor blocks.\n */\n\nimport { readFile, writeFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { AnchorService, AUTH_ANCHORS } from \"./anchor-service.js\";\n\nexport type Platform = \"cloudflare\" | \"vercel\";\n\n/**\n * Transform entry point to add authentication\n *\n * @param filePath - Path to entry point file\n * @param platform - Deployment platform\n * @returns True if file was modified\n */\nexport async function addAuthToEntryPoint(\n\tfilePath: string,\n\tplatform: Platform,\n): Promise<boolean> {\n\tif (!existsSync(filePath)) {\n\t\tthrow new Error(`Entry point not found: ${filePath}`);\n\t}\n\n\tconst content = await readFile(filePath, \"utf-8\");\n\n\tlet transformed: string;\n\tif (platform === \"cloudflare\") {\n\t\ttransformed = await addCloudflareAuth(filePath, content);\n\t} else if (platform === \"vercel\") {\n\t\ttransformed = addVercelAuth(content);\n\t} else {\n\t\tthrow new Error(`Unsupported platform: ${platform}`);\n\t}\n\n\t// Only write if content changed\n\tif (transformed !== content) {\n\t\tawait writeFile(filePath, transformed, \"utf-8\");\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n/**\n * Add authentication to Cloudflare Workers entry point\n */\nasync function addCloudflareAuth(\n\tfilePath: string,\n\tcontent: string,\n): Promise<string> {\n\t// Check if already has auth\n\tif (content.includes(\"getAuthProvider\") || content.includes(\"Authorization\")) {\n\t\treturn content; // Already transformed\n\t}\n\n\tconst anchorService = new AnchorService();\n\n\t// Check if file has anchor blocks\n\tconst hasImportsAnchor = await anchorService.hasAnchor(\n\t\tfilePath,\n\t\tAUTH_ANCHORS.IMPORTS,\n\t);\n\tconst hasMiddlewareAnchor = await anchorService.hasAnchor(\n\t\tfilePath,\n\t\tAUTH_ANCHORS.MIDDLEWARE,\n\t);\n\n\t// Auth imports content\n\tconst authImports = `import { getAuthProvider } from \"./auth/config.js\";\nimport { AuthenticationError } from \"./auth/types.js\";`;\n\n\t// Auth middleware content\n\tconst authMiddleware = `\\t// Validate authentication\n\\tconst authHeader = request.headers.get(\"Authorization\");\n\\tif (!authHeader) {\n\\t\\treturn new Response(\"Unauthorized: Missing Authorization header\", {\n\\t\\t\\tstatus: 401,\n\\t\\t\\theaders: { \"Content-Type\": \"text/plain\" },\n\\t\\t});\n\\t}\n\n\\tconst token = authHeader.replace(/^Bearer\\\\s+/i, \"\");\n\\ttry {\n\\t\\tconst provider = getAuthProvider(env);\n\\t\\tconst user = await provider.validateToken(token, env);\n\n\\t\\t// Attach user context to env for tools to use\n\\t\\t(env as any).user = user;\n\\t} catch (error) {\n\\t\\tif (error instanceof AuthenticationError) {\n\\t\\t\\treturn new Response(\\`Unauthorized: \\${error.message}\\`, {\n\\t\\t\\t\\tstatus: 401,\n\\t\\t\\t\\theaders: { \"Content-Type\": \"text/plain\" },\n\\t\\t\\t});\n\\t\\t}\n\\t\\tconsole.error(\"Authentication error:\", error);\n\\t\\treturn new Response(\"Internal Server Error\", {\n\\t\\t\\tstatus: 500,\n\\t\\t\\theaders: { \"Content-Type\": \"text/plain\" },\n\\t\\t});\n\\t}`;\n\n\t// If anchors are present, use anchor-based transformation\n\tif (hasImportsAnchor && hasMiddlewareAnchor) {\n\t\t// Insert imports at anchor\n\t\tconst importsResult = await anchorService.insertAtAnchor(\n\t\t\tfilePath,\n\t\t\tAUTH_ANCHORS.IMPORTS,\n\t\t\tauthImports,\n\t\t);\n\n\t\t// Insert middleware at anchor\n\t\tconst middlewareResult = await anchorService.insertAtAnchor(\n\t\t\tfilePath,\n\t\t\tAUTH_ANCHORS.MIDDLEWARE,\n\t\t\tauthMiddleware,\n\t\t);\n\n\t\tif (importsResult.success && middlewareResult.success) {\n\t\t\t// Re-read file after anchor insertions\n\t\t\treturn await readFile(filePath, \"utf-8\");\n\t\t}\n\n\t\t// If anchor insertion failed, fall through to regex\n\t\tconsole.warn(\n\t\t\t\"Anchor insertion failed, falling back to regex transformation\",\n\t\t);\n\t}\n\n\t// Fallback: Use regex-based transformation for backward compatibility\n\treturn addCloudflareAuthRegex(content);\n}\n\n/**\n * Legacy regex-based auth transformation (backward compatibility)\n */\nfunction addCloudflareAuthRegex(content: string): string {\n\t// Add auth imports after existing imports\n\tconst authImports = `import { getAuthProvider } from \"./auth/config.js\";\nimport { AuthenticationError } from \"./auth/types.js\";\n`;\n\n\t// Find the last import statement\n\tconst importRegex = /^import\\s+.*?;$/gm;\n\tlet lastImportIndex = 0;\n\tlet match;\n\n\twhile ((match = importRegex.exec(content)) !== null) {\n\t\tlastImportIndex = match.index + match[0].length;\n\t}\n\n\t// Insert auth imports after last import\n\tlet result = content;\n\tif (lastImportIndex > 0) {\n\t\tresult =\n\t\t\tcontent.slice(0, lastImportIndex) +\n\t\t\t\"\\n\" +\n\t\t\tauthImports +\n\t\t\tcontent.slice(lastImportIndex);\n\t} else {\n\t\t// No imports found, add at the beginning\n\t\tresult = authImports + \"\\n\" + content;\n\t}\n\n\t// Find the fetch handler and add auth middleware\n\tconst fetchHandlerRegex =\n\t\t/async\\s+fetch\\s*\\(\\s*request:\\s*Request,\\s*env:\\s*Env(?:,\\s*ctx:\\s*ExecutionContext)?\\s*\\):\\s*Promise<Response>\\s*\\{/;\n\tconst fetchMatch = fetchHandlerRegex.exec(result);\n\n\tif (fetchMatch) {\n\t\tconst insertPosition = fetchMatch.index + fetchMatch[0].length;\n\n\t\tconst authMiddleware = `\n\t\t// Validate authentication\n\t\tconst authHeader = request.headers.get(\"Authorization\");\n\t\tif (!authHeader) {\n\t\t\treturn new Response(\"Unauthorized: Missing Authorization header\", {\n\t\t\t\tstatus: 401,\n\t\t\t\theaders: { \"Content-Type\": \"text/plain\" },\n\t\t\t});\n\t\t}\n\n\t\tconst token = authHeader.replace(/^Bearer\\\\s+/i, \"\");\n\t\ttry {\n\t\t\tconst provider = getAuthProvider(env);\n\t\t\tconst user = await provider.validateToken(token, env);\n\n\t\t\t// Attach user context to env for tools to use\n\t\t\t(env as any).user = user;\n\t\t} catch (error) {\n\t\t\tif (error instanceof AuthenticationError) {\n\t\t\t\treturn new Response(\\`Unauthorized: \\${error.message}\\`, {\n\t\t\t\t\tstatus: 401,\n\t\t\t\t\theaders: { \"Content-Type\": \"text/plain\" },\n\t\t\t\t});\n\t\t\t}\n\t\t\tconsole.error(\"Authentication error:\", error);\n\t\t\treturn new Response(\"Internal Server Error\", {\n\t\t\t\tstatus: 500,\n\t\t\t\theaders: { \"Content-Type\": \"text/plain\" },\n\t\t\t});\n\t\t}\n`;\n\n\t\tresult =\n\t\t\tresult.slice(0, insertPosition) + authMiddleware + result.slice(insertPosition);\n\t}\n\n\treturn result;\n}\n\n/**\n * Add authentication to Vercel/Next.js entry point\n */\nfunction addVercelAuth(content: string): string {\n\t// Check if already has auth\n\tif (content.includes(\"getAuthProvider\") || content.includes(\"Authorization\")) {\n\t\treturn content; // Already transformed\n\t}\n\n\t// Add auth imports after existing imports\n\tconst authImports = `import { getAuthProvider } from \"@/auth/config\";\nimport { AuthenticationError } from \"@/auth/types\";\n`;\n\n\t// Find the last import statement\n\tconst importRegex = /^import\\s+.*?;$/gm;\n\tlet lastImportIndex = 0;\n\tlet match;\n\n\twhile ((match = importRegex.exec(content)) !== null) {\n\t\tlastImportIndex = match.index + match[0].length;\n\t}\n\n\t// Insert auth imports after last import\n\tlet result = content;\n\tif (lastImportIndex > 0) {\n\t\tresult =\n\t\t\tcontent.slice(0, lastImportIndex) +\n\t\t\t\"\\n\" +\n\t\t\tauthImports +\n\t\t\tcontent.slice(lastImportIndex);\n\t} else {\n\t\tresult = authImports + \"\\n\" + content;\n\t}\n\n\t// Find the POST handler and add auth middleware\n\tconst postHandlerRegex =\n\t\t/export\\s+async\\s+function\\s+POST\\s*\\(\\s*request:\\s*Request\\s*\\)/;\n\tconst postMatch = postHandlerRegex.exec(result);\n\n\tif (postMatch) {\n\t\tconst insertPosition = postMatch.index + postMatch[0].length;\n\n\t\t// Find opening brace\n\t\tconst braceMatch = result.slice(insertPosition).match(/\\{/);\n\t\tif (braceMatch) {\n\t\t\tconst bracePosition = insertPosition + braceMatch.index! + 1;\n\n\t\t\tconst authMiddleware = `\n\t// Validate authentication\n\tconst authHeader = request.headers.get(\"Authorization\");\n\tif (!authHeader) {\n\t\treturn new Response(\"Unauthorized: Missing Authorization header\", {\n\t\t\tstatus: 401,\n\t\t\theaders: { \"Content-Type\": \"text/plain\" },\n\t\t});\n\t}\n\n\tconst token = authHeader.replace(/^Bearer\\\\s+/i, \"\");\n\ttry {\n\t\tconst provider = getAuthProvider(process.env as any);\n\t\tconst user = await provider.validateToken(token, process.env as any);\n\n\t\t// User context available for tools (would need to pass through adapter)\n\t\t// For now, validation is the primary goal\n\t} catch (error) {\n\t\tif (error instanceof AuthenticationError) {\n\t\t\treturn new Response(\\`Unauthorized: \\${error.message}\\`, {\n\t\t\t\tstatus: 401,\n\t\t\t\theaders: { \"Content-Type\": \"text/plain\" },\n\t\t\t});\n\t\t}\n\t\tconsole.error(\"Authentication error:\", error);\n\t\treturn new Response(\"Internal Server Error\", {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"Content-Type\": \"text/plain\" },\n\t\t});\n\t}\n`;\n\n\t\t\tresult =\n\t\t\t\tresult.slice(0, bracePosition) +\n\t\t\t\tauthMiddleware +\n\t\t\t\tresult.slice(bracePosition);\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * Remove authentication from entry point (for rollback)\n *\n * @param filePath - Path to entry point file\n * @param platform - Deployment platform\n * @returns True if file was modified\n */\nexport async function removeAuthFromEntryPoint(\n\tfilePath: string,\n\tplatform: Platform,\n): Promise<boolean> {\n\tif (!existsSync(filePath)) {\n\t\treturn false;\n\t}\n\n\tconst anchorService = new AnchorService();\n\n\t// Check if file has anchor blocks\n\tconst hasAnchors =\n\t\t(await anchorService.hasAnchor(filePath, AUTH_ANCHORS.IMPORTS)) &&\n\t\t(await anchorService.hasAnchor(filePath, AUTH_ANCHORS.MIDDLEWARE));\n\n\tif (hasAnchors) {\n\t\t// Use anchor-based removal\n\t\tconst importsResult = await anchorService.clearAnchor(\n\t\t\tfilePath,\n\t\t\tAUTH_ANCHORS.IMPORTS,\n\t\t);\n\t\tconst middlewareResult = await anchorService.clearAnchor(\n\t\t\tfilePath,\n\t\t\tAUTH_ANCHORS.MIDDLEWARE,\n\t\t);\n\n\t\treturn importsResult.modified || middlewareResult.modified;\n\t}\n\n\t// Fallback: regex-based removal for backward compatibility\n\tconst content = await readFile(filePath, \"utf-8\");\n\n\t// Remove auth imports\n\tlet result = content.replace(\n\t\t/import\\s+\\{[^}]*getAuthProvider[^}]*\\}\\s+from\\s+['\"]\\.\\/auth\\/config(?:\\.js)?['\"];?\\s*/g,\n\t\t\"\",\n\t);\n\tresult = result.replace(\n\t\t/import\\s+\\{[^}]*AuthenticationError[^}]*\\}\\s+from\\s+['\"]\\.\\/auth\\/types(?:\\.js)?['\"];?\\s*/g,\n\t\t\"\",\n\t);\n\tresult = result.replace(\n\t\t/import\\s+\\{[^}]*getAuthProvider[^}]*\\}\\s+from\\s+['\"]@\\/auth\\/config['\"];?\\s*/g,\n\t\t\"\",\n\t);\n\tresult = result.replace(\n\t\t/import\\s+\\{[^}]*AuthenticationError[^}]*\\}\\s+from\\s+['\"]@\\/auth\\/types['\"];?\\s*/g,\n\t\t\"\",\n\t);\n\n\t// Remove auth middleware blocks\n\tresult = result.replace(\n\t\t/\\/\\/ Validate authentication[\\s\\S]*?\\/\\/ Attach user context[\\s\\S]*?\\}\\s*\\n/g,\n\t\t\"\",\n\t);\n\tresult = result.replace(\n\t\t/\\/\\/ Validate authentication[\\s\\S]*?\\/\\/ User context available[\\s\\S]*?\\}\\s*\\n/g,\n\t\t\"\",\n\t);\n\n\t// Only write if content changed\n\tif (result !== content) {\n\t\tawait writeFile(filePath, result, \"utf-8\");\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n/**\n * Check if entry point already has authentication\n *\n * @param filePath - Path to entry point file\n * @returns True if authentication is present\n */\nexport async function hasAuthentication(filePath: string): Promise<boolean> {\n\tif (!existsSync(filePath)) {\n\t\treturn false;\n\t}\n\n\tconst anchorService = new AnchorService();\n\n\t// Check if file has anchors\n\tconst hasAnchors =\n\t\t(await anchorService.hasAnchor(filePath, AUTH_ANCHORS.IMPORTS)) &&\n\t\t(await anchorService.hasAnchor(filePath, AUTH_ANCHORS.MIDDLEWARE));\n\n\tif (hasAnchors) {\n\t\t// Check if anchors have content (not empty)\n\t\tconst importsEmpty = await anchorService.isAnchorEmpty(\n\t\t\tfilePath,\n\t\t\tAUTH_ANCHORS.IMPORTS,\n\t\t);\n\t\tconst middlewareEmpty = await anchorService.isAnchorEmpty(\n\t\t\tfilePath,\n\t\t\tAUTH_ANCHORS.MIDDLEWARE,\n\t\t);\n\n\t\treturn !importsEmpty && !middlewareEmpty;\n\t}\n\n\t// Fallback: check content directly\n\tconst content = await readFile(filePath, \"utf-8\");\n\treturn (\n\t\tcontent.includes(\"getAuthProvider\") &&\n\t\t(content.includes(\"Validate authentication\") ||\n\t\t\tcontent.includes(\"Authorization\"))\n\t);\n}\n","/**\n * TOML Merger Service\n *\n * Provides structured TOML configuration merging using a proper parser\n * instead of brittle regex replacement. Preserves comments and formatting\n * where possible.\n */\n\nimport { readFile, writeFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport TOML from \"@iarna/toml\";\n\n/**\n * Result of TOML merge operation\n */\nexport interface TomlMergeResult {\n\t/** Whether the operation succeeded */\n\tsuccess: boolean;\n\t/** Whether the file was actually modified */\n\tmodified: boolean;\n\t/** Error message if operation failed */\n\terror?: string;\n}\n\n/**\n * Service for structured TOML merging\n */\nexport class TomlMerger {\n\t/**\n\t * Merge values into a TOML section\n\t *\n\t * @param filePath - Path to TOML file\n\t * @param section - Section name (e.g., \"vars\", \"env\")\n\t * @param updates - Key-value pairs to merge\n\t * @param options - Merge options\n\t * @returns Result of the merge operation\n\t */\n\tasync mergeSection(\n\t\tfilePath: string,\n\t\tsection: string,\n\t\tupdates: Record<string, string | number | boolean>,\n\t\toptions: {\n\t\t\t/** Overwrite existing values */\n\t\t\toverwrite?: boolean;\n\t\t} = {},\n\t): Promise<TomlMergeResult> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `File not found: ${filePath}`,\n\t\t\t};\n\t\t}\n\n\t\ttry {\n\t\t\tconst content = await readFile(filePath, \"utf-8\");\n\t\t\tconst config = TOML.parse(content) as Record<string, any>;\n\n\t\t\t// Ensure section exists\n\t\t\tif (!config[section]) {\n\t\t\t\tconfig[section] = {};\n\t\t\t}\n\n\t\t\t// Merge updates (skip existing keys unless overwrite=true)\n\t\t\tlet modified = false;\n\t\t\tfor (const [key, value] of Object.entries(updates)) {\n\t\t\t\tif (!(key in config[section]) || options.overwrite) {\n\t\t\t\t\tconfig[section][key] = value;\n\t\t\t\t\tmodified = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (modified) {\n\t\t\t\tconst newContent = TOML.stringify(config);\n\t\t\t\tawait writeFile(filePath, newContent, \"utf-8\");\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tmodified,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `TOML parse error: ${error}`,\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Remove specific keys from a TOML section\n\t *\n\t * @param filePath - Path to TOML file\n\t * @param section - Section name\n\t * @param keys - Keys to remove\n\t * @returns Result of the operation\n\t */\n\tasync removeKeys(\n\t\tfilePath: string,\n\t\tsection: string,\n\t\tkeys: string[],\n\t): Promise<TomlMergeResult> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `File not found: ${filePath}`,\n\t\t\t};\n\t\t}\n\n\t\ttry {\n\t\t\tconst content = await readFile(filePath, \"utf-8\");\n\t\t\tconst config = TOML.parse(content) as Record<string, any>;\n\n\t\t\tif (!config[section]) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\tmodified: false,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet modified = false;\n\t\t\tfor (const key of keys) {\n\t\t\t\tif (key in config[section]) {\n\t\t\t\t\tdelete config[section][key];\n\t\t\t\t\tmodified = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (modified) {\n\t\t\t\t// Remove section if empty\n\t\t\t\tif (Object.keys(config[section]).length === 0) {\n\t\t\t\t\tdelete config[section];\n\t\t\t\t}\n\n\t\t\t\tconst newContent = TOML.stringify(config);\n\t\t\t\tawait writeFile(filePath, newContent, \"utf-8\");\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tmodified,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmodified: false,\n\t\t\t\terror: `TOML parse error: ${error}`,\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Check if specific keys exist in a TOML section\n\t *\n\t * @param filePath - Path to TOML file\n\t * @param section - Section name\n\t * @param keys - Keys to check\n\t * @returns Map of key existence\n\t */\n\tasync hasKeys(\n\t\tfilePath: string,\n\t\tsection: string,\n\t\tkeys: string[],\n\t): Promise<Record<string, boolean>> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn Object.fromEntries(keys.map((k) => [k, false]));\n\t\t}\n\n\t\ttry {\n\t\t\tconst content = await readFile(filePath, \"utf-8\");\n\t\t\tconst config = TOML.parse(content) as Record<string, any>;\n\n\t\t\tif (!config[section]) {\n\t\t\t\treturn Object.fromEntries(keys.map((k) => [k, false]));\n\t\t\t}\n\n\t\t\treturn Object.fromEntries(keys.map((k) => [k, k in config[section]]));\n\t\t} catch (error) {\n\t\t\treturn Object.fromEntries(keys.map((k) => [k, false]));\n\t\t}\n\t}\n\n\t/**\n\t * Get value from TOML section\n\t *\n\t * @param filePath - Path to TOML file\n\t * @param section - Section name\n\t * @param key - Key to retrieve\n\t * @returns Value or undefined if not found\n\t */\n\tasync getValue(\n\t\tfilePath: string,\n\t\tsection: string,\n\t\tkey: string,\n\t): Promise<any | undefined> {\n\t\tif (!existsSync(filePath)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\ttry {\n\t\t\tconst content = await readFile(filePath, \"utf-8\");\n\t\t\tconst config = TOML.parse(content) as Record<string, any>;\n\n\t\t\treturn config[section]?.[key];\n\t\t} catch (error) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n","/**\n * Auth Configuration Updater\n *\n * Updates platform-specific config files to add authentication environment\n * variables. Handles wrangler.toml/wrangler.jsonc (Cloudflare) and vercel.json (Vercel).\n *\n * Uses TomlMerger for structured TOML operations (no regex).\n */\n\nimport { readFile, writeFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport { TomlMerger } from \"../toml-merger.js\";\nimport { AnchorService, AUTH_ANCHORS } from \"../anchor-service.js\";\nimport {\n\tgetWranglerConfigPath,\n\tparseJSONC,\n\tformatJSON,\n} from \"./wrangler-utils.js\";\n\nexport type AuthProvider = \"stytch\" | \"auth0\" | \"workos\";\nexport type Platform = \"cloudflare\" | \"vercel\";\n\n/**\n * Get required environment variables for a provider\n */\nexport function getRequiredEnvVars(provider: AuthProvider): string[] {\n\tswitch (provider) {\n\t\tcase \"stytch\":\n\t\t\treturn [\"STYTCH_PROJECT_ID\", \"STYTCH_SECRET\", \"STYTCH_ENV\"];\n\t\tcase \"auth0\":\n\t\t\treturn [\n\t\t\t\t\"AUTH0_DOMAIN\",\n\t\t\t\t\"AUTH0_CLIENT_ID\",\n\t\t\t\t\"AUTH0_CLIENT_SECRET\",\n\t\t\t\t\"AUTH0_AUDIENCE\",\n\t\t\t];\n\t\tcase \"workos\":\n\t\t\treturn [\"WORKOS_API_KEY\", \"WORKOS_CLIENT_ID\"];\n\t}\n}\n\n/**\n * Update wrangler.toml to add auth environment variables (TOML format)\n * Uses TomlMerger for structured parsing (no regex)\n *\n * @param wranglerPath - Path to wrangler.toml file\n * @param provider - Auth provider\n * @returns True if file was modified\n */\nasync function updateWranglerToml(\n\twranglerPath: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tif (!existsSync(wranglerPath)) {\n\t\treturn false;\n\t}\n\n\tconst tomlMerger = new TomlMerger();\n\tconst requiredVars = getRequiredEnvVars(provider);\n\n\t// Check if auth vars already present\n\tconst existingKeys = await tomlMerger.hasKeys(\n\t\twranglerPath,\n\t\t\"vars\",\n\t\trequiredVars,\n\t);\n\n\tif (Object.values(existingKeys).some((exists) => exists)) {\n\t\treturn false; // Already has auth config\n\t}\n\n\t// Merge auth environment variables into [vars] section\n\tconst updates: Record<string, string> = {};\n\tfor (const varName of requiredVars) {\n\t\tupdates[varName] = \"\";\n\t}\n\n\tconst result = await tomlMerger.mergeSection(wranglerPath, \"vars\", updates);\n\n\treturn result.modified;\n}\n\n/**\n * Update wrangler.jsonc/json to add auth environment variables (JSON format)\n * Uses anchor-based insertion to preserve comments and structure\n *\n * @param wranglerPath - Path to wrangler.jsonc or wrangler.json file\n * @param provider - Auth provider\n * @returns True if file was modified\n */\nasync function updateWranglerJsonc(\n\twranglerPath: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tif (!existsSync(wranglerPath)) {\n\t\treturn false;\n\t}\n\n\tconst content = await readFile(wranglerPath, \"utf-8\");\n\n\t// Parse JSONC to check if vars already exist\n\tconst config = parseJSONC(content);\n\n\t// Check if auth vars already present\n\tconst requiredVars = getRequiredEnvVars(provider);\n\tif (config.vars && requiredVars.some((v) => config.vars[v] !== undefined)) {\n\t\treturn false; // Already has auth config\n\t}\n\n\t// Use anchor service to insert vars at the auth:vars anchor\n\tconst anchorService = new AnchorService();\n\n\t// Check if anchor exists\n\tconst hasAnchor = await anchorService.hasAnchor(\n\t\twranglerPath,\n\t\tAUTH_ANCHORS.CONFIG_VARS,\n\t);\n\n\tif (!hasAnchor) {\n\t\t// Fallback to old method if no anchor (for backwards compatibility)\n\t\t// Add auth environment variables to vars section\n\t\tif (!config.vars) {\n\t\t\tconfig.vars = {};\n\t\t}\n\n\t\tfor (const varName of requiredVars) {\n\t\t\tconfig.vars[varName] = \"\";\n\t\t}\n\n\t\t// Write back with proper formatting\n\t\tawait writeFile(wranglerPath, formatJSON(config) + \"\\n\", \"utf-8\");\n\t\treturn true;\n\t}\n\n\t// Build vars JSON snippet\n\tconst varsEntries = requiredVars\n\t\t.map((varName) => `\\t\\t\"${varName}\": \"\"`)\n\t\t.join(\",\\n\");\n\n\tconst varsJson = `\"vars\": {\\n${varsEntries}\\n\\t},`;\n\n\t// Insert at auth vars anchor\n\tconst result = await anchorService.insertAtAnchor(\n\t\twranglerPath,\n\t\tAUTH_ANCHORS.CONFIG_VARS,\n\t\tvarsJson,\n\t\t{ indent: \"\\t\" },\n\t);\n\n\treturn result.modified;\n}\n\n/**\n * Update wrangler config to add auth environment variables\n * Detects format (TOML vs JSON/JSONC) and routes to appropriate handler\n *\n * @param cwd - Project root directory\n * @param provider - Auth provider\n * @returns True if file was modified\n */\nexport async function updateWranglerConfig(\n\tcwd: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tconst wranglerPath = getWranglerConfigPath(cwd);\n\n\tif (!wranglerPath) {\n\t\treturn false; // No wrangler config found\n\t}\n\n\t// Route to appropriate handler based on file extension\n\tif (wranglerPath.endsWith(\".toml\")) {\n\t\treturn updateWranglerToml(wranglerPath, provider);\n\t} else {\n\t\t// .jsonc or .json\n\t\treturn updateWranglerJsonc(wranglerPath, provider);\n\t}\n}\n\n/**\n * Update vercel.json to add auth environment variables\n *\n * @param cwd - Project root directory\n * @param provider - Auth provider\n * @returns True if file was created or modified\n */\nexport async function updateVercelConfig(\n\tcwd: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tconst vercelPath = join(cwd, \"vercel.json\");\n\n\tconst requiredVars = getRequiredEnvVars(provider);\n\n\tlet config: any = {};\n\n\tif (existsSync(vercelPath)) {\n\t\tconst content = await readFile(vercelPath, \"utf-8\");\n\t\tconfig = JSON.parse(content);\n\n\t\t// Check if auth vars already present\n\t\tif (\n\t\t\tconfig.env &&\n\t\t\trequiredVars.some((v: string) => config.env[v] !== undefined)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t// Add environment variables\n\tconfig.env = config.env || {};\n\n\tfor (const varName of requiredVars) {\n\t\tconfig.env[varName] = `@${varName.toLowerCase()}`;\n\t}\n\n\tawait writeFile(vercelPath, JSON.stringify(config, null, 2) + \"\\n\", \"utf-8\");\n\treturn true;\n}\n\n/**\n * Create or update .env.example file\n *\n * @param cwd - Project root directory\n * @param provider - Auth provider\n * @param content - Environment variable template content\n * @returns True if file was created or modified\n */\nexport async function updateEnvExample(\n\tcwd: string,\n\tprovider: AuthProvider,\n\tcontent: string,\n): Promise<boolean> {\n\tconst envPath = join(cwd, \".env.example\");\n\n\tif (existsSync(envPath)) {\n\t\tconst existing = await readFile(envPath, \"utf-8\");\n\n\t\t// Check if auth vars already present\n\t\tconst requiredVars = getRequiredEnvVars(provider);\n\t\tif (requiredVars.some((v) => existing.includes(v))) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Append to existing file\n\t\tawait writeFile(envPath, existing + \"\\n\" + content, \"utf-8\");\n\t} else {\n\t\t// Create new file\n\t\tawait writeFile(envPath, content, \"utf-8\");\n\t}\n\n\treturn true;\n}\n\n/**\n * Remove auth configuration from wrangler.toml (TOML format)\n * Uses TomlMerger for structured removal (no regex)\n *\n * @param wranglerPath - Path to wrangler.toml file\n * @param provider - Auth provider\n * @returns True if file was modified\n */\nasync function removeWranglerTomlAuthConfig(\n\twranglerPath: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tif (!existsSync(wranglerPath)) {\n\t\treturn false;\n\t}\n\n\tconst tomlMerger = new TomlMerger();\n\tconst requiredVars = getRequiredEnvVars(provider);\n\n\t// Remove auth environment variables from [vars] section\n\tconst result = await tomlMerger.removeKeys(\n\t\twranglerPath,\n\t\t\"vars\",\n\t\trequiredVars,\n\t);\n\n\treturn result.modified;\n}\n\n/**\n * Remove auth configuration from wrangler.jsonc/json (JSON format)\n *\n * @param wranglerPath - Path to wrangler.jsonc or wrangler.json file\n * @param provider - Auth provider\n * @returns True if file was modified\n */\nasync function removeWranglerJsoncAuthConfig(\n\twranglerPath: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tif (!existsSync(wranglerPath)) {\n\t\treturn false;\n\t}\n\n\tconst content = await readFile(wranglerPath, \"utf-8\");\n\tconst config = parseJSONC(content);\n\n\tif (!config.vars) {\n\t\treturn false; // No vars section\n\t}\n\n\tconst requiredVars = getRequiredEnvVars(provider);\n\tlet modified = false;\n\n\tfor (const varName of requiredVars) {\n\t\tif (config.vars[varName] !== undefined) {\n\t\t\tdelete config.vars[varName];\n\t\t\tmodified = true;\n\t\t}\n\t}\n\n\tif (modified) {\n\t\t// Remove vars section if empty\n\t\tif (Object.keys(config.vars).length === 0) {\n\t\t\tdelete config.vars;\n\t\t}\n\n\t\tawait writeFile(wranglerPath, formatJSON(config) + \"\\n\", \"utf-8\");\n\t}\n\n\treturn modified;\n}\n\n/**\n * Remove auth configuration from wrangler config\n * Detects format (TOML vs JSON/JSONC) and routes to appropriate handler\n *\n * @param cwd - Project root directory\n * @param provider - Auth provider\n * @returns True if file was modified\n */\nexport async function removeWranglerAuthConfig(\n\tcwd: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tconst wranglerPath = getWranglerConfigPath(cwd);\n\n\tif (!wranglerPath) {\n\t\treturn false; // No wrangler config found\n\t}\n\n\t// Route to appropriate handler based on file extension\n\tif (wranglerPath.endsWith(\".toml\")) {\n\t\treturn removeWranglerTomlAuthConfig(wranglerPath, provider);\n\t} else {\n\t\t// .jsonc or .json\n\t\treturn removeWranglerJsoncAuthConfig(wranglerPath, provider);\n\t}\n}\n\n/**\n * Remove auth configuration from vercel.json\n *\n * @param cwd - Project root directory\n * @param provider - Auth provider\n * @returns True if file was modified\n */\nexport async function removeVercelAuthConfig(\n\tcwd: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tconst vercelPath = join(cwd, \"vercel.json\");\n\n\tif (!existsSync(vercelPath)) {\n\t\treturn false;\n\t}\n\n\tconst content = await readFile(vercelPath, \"utf-8\");\n\tconst config = JSON.parse(content);\n\n\tif (!config.env) {\n\t\treturn false;\n\t}\n\n\tconst requiredVars = getRequiredEnvVars(provider);\n\tlet modified = false;\n\n\tfor (const varName of requiredVars) {\n\t\tif (config.env[varName] !== undefined) {\n\t\t\tdelete config.env[varName];\n\t\t\tmodified = true;\n\t\t}\n\t}\n\n\tif (modified) {\n\t\t// Remove env section if empty\n\t\tif (Object.keys(config.env).length === 0) {\n\t\t\tdelete config.env;\n\t\t}\n\n\t\tawait writeFile(vercelPath, JSON.stringify(config, null, 2) + \"\\n\", \"utf-8\");\n\t}\n\n\treturn modified;\n}\n\n/**\n * Remove auth variables from .env.example\n *\n * @param cwd - Project root directory\n * @param provider - Auth provider\n * @returns True if file was modified\n */\nexport async function removeEnvExampleAuthVars(\n\tcwd: string,\n\tprovider: AuthProvider,\n): Promise<boolean> {\n\tconst envPath = join(cwd, \".env.example\");\n\n\tif (!existsSync(envPath)) {\n\t\treturn false;\n\t}\n\n\tconst content = await readFile(envPath, \"utf-8\");\n\tlet result = content;\n\n\t// Remove auth variable lines\n\tconst requiredVars = getRequiredEnvVars(provider);\n\tfor (const varName of requiredVars) {\n\t\tresult = result.replace(new RegExp(`${varName}=.*\\n?`, \"g\"), \"\");\n\t}\n\n\t// Remove provider-specific comment sections\n\tresult = result.replace(\n\t\tnew RegExp(`# ${provider}[\\\\s\\\\S]*?(?=\\\\n#|\\\\n\\\\n|$)`, \"gi\"),\n\t\t\"\",\n\t);\n\n\t// Remove setup instructions (including the numbered list items)\n\tresult = result.replace(\n\t\t/# [A-Z][a-z]+ Setup Instructions:[\\s\\S]*?(?=\\n(?:[A-Z]|$))/g,\n\t\t\"\",\n\t);\n\n\t// Remove standalone numbered instruction lines\n\tresult = result.replace(/# \\d+\\. .*\\n/g, \"\");\n\n\t// Clean up extra blank lines\n\tresult = result.replace(/\\n{3,}/g, \"\\n\\n\");\n\n\tif (result !== content) {\n\t\tawait writeFile(envPath, result.trim() + \"\\n\", \"utf-8\");\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n","/**\n * Validation Gate\n *\n * Comprehensive post-transformation validation to ensure code transformations\n * were successful and didn't break the project. Supports rollback on failure.\n */\n\nimport { exec } from \"node:child_process\";\nimport { promisify } from \"node:util\";\nimport { readFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport { getWranglerConfigPath } from \"./config/wrangler-utils.js\";\nimport { AnchorService, AUTH_ANCHORS } from \"./anchor-service.js\";\nimport { restoreFromBackup } from \"./backup-restore.js\";\nimport type { AuthProvider } from \"./config/auth-config-updater.js\";\n\nconst execAsync = promisify(exec);\n\n/**\n * Individual validation check\n */\nexport interface ValidationCheck {\n\t/** Check name/identifier */\n\tname: string;\n\t/** Human-readable description */\n\tdescription: string;\n\t/** Function that performs the check */\n\tvalidate: () => Promise<boolean>;\n\t/** Error message if check fails */\n\terrorMessage: string;\n\t/** Whether this check is critical (causes rollback) */\n\tcritical: boolean;\n}\n\n/**\n * Result of validation gate\n */\nexport interface ValidationGateResult {\n\t/** Whether all checks passed */\n\tpassed: boolean;\n\t/** Checks that passed */\n\tpassedChecks: string[];\n\t/** Checks that failed */\n\tfailedChecks: string[];\n\t/** Whether rollback was performed */\n\trolledBack: boolean;\n\t/** Error messages from failed checks */\n\terrors: string[];\n}\n\n/**\n * Options for validation gate\n */\nexport interface ValidationGateOptions {\n\t/** Project root directory */\n\tcwd: string;\n\t/** Backup directory for rollback */\n\tbackupDir?: string;\n\t/** Auth provider (for config checks) */\n\tprovider?: AuthProvider;\n\t/** Skip type checking (faster, less thorough) */\n\tskipTypeCheck?: boolean;\n\t/** Perform rollback on failure */\n\trollbackOnFailure?: boolean;\n}\n\n/**\n * Service for validating code transformations\n */\nexport class ValidationGate {\n\tprivate anchorService: AnchorService;\n\n\tconstructor() {\n\t\tthis.anchorService = new AnchorService();\n\t}\n\n\t/**\n\t * Run full validation gate after auth transformation\n\t */\n\tasync validate(\n\t\toptions: ValidationGateOptions,\n\t): Promise<ValidationGateResult> {\n\t\tconst checks = await this.buildChecks(options);\n\t\tconst result: ValidationGateResult = {\n\t\t\tpassed: true,\n\t\t\tpassedChecks: [],\n\t\t\tfailedChecks: [],\n\t\t\trolledBack: false,\n\t\t\terrors: [],\n\t\t};\n\n\t\t// Run all checks\n\t\tfor (const check of checks) {\n\t\t\ttry {\n\t\t\t\tconst passed = await check.validate();\n\n\t\t\t\tif (passed) {\n\t\t\t\t\tresult.passedChecks.push(check.name);\n\t\t\t\t} else {\n\t\t\t\t\tresult.failedChecks.push(check.name);\n\t\t\t\t\tresult.errors.push(`${check.name}: ${check.errorMessage}`);\n\n\t\t\t\t\tif (check.critical) {\n\t\t\t\t\t\tresult.passed = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tresult.failedChecks.push(check.name);\n\t\t\t\tresult.errors.push(`${check.name}: ${error}`);\n\n\t\t\t\tif (check.critical) {\n\t\t\t\t\tresult.passed = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Rollback if critical checks failed\n\t\tif (\n\t\t\t!result.passed &&\n\t\t\toptions.rollbackOnFailure &&\n\t\t\toptions.backupDir\n\t\t) {\n\t\t\ttry {\n\t\t\t\tawait restoreFromBackup(options.backupDir, options.cwd);\n\t\t\t\tresult.rolledBack = true;\n\t\t\t} catch (error) {\n\t\t\t\tresult.errors.push(`Rollback failed: ${error}`);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Build list of validation checks\n\t */\n\tprivate async buildChecks(\n\t\toptions: ValidationGateOptions,\n\t): Promise<ValidationCheck[]> {\n\t\tconst checks: ValidationCheck[] = [];\n\n\t\t// 1. Type check (if not skipped)\n\t\tif (!options.skipTypeCheck) {\n\t\t\tchecks.push({\n\t\t\t\tname: \"type-check\",\n\t\t\t\tdescription: \"TypeScript compilation\",\n\t\t\t\tvalidate: async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait execAsync(\"npx tsc --noEmit\", { cwd: options.cwd });\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terrorMessage:\n\t\t\t\t\t\"TypeScript compilation failed. Auth transformation may have introduced type errors.\",\n\t\t\t\tcritical: true,\n\t\t\t});\n\t\t}\n\n\t\t// 2. Export invariants (handler still exists)\n\t\tchecks.push({\n\t\t\tname: \"export-invariants\",\n\t\t\tdescription: \"Export handler integrity\",\n\t\t\tvalidate: async () => {\n\t\t\t\tconst indexPath = join(options.cwd, \"src/index.ts\");\n\t\t\t\tif (!existsSync(indexPath)) return false;\n\n\t\t\t\tconst content = await readFile(indexPath, \"utf-8\");\n\t\t\t\treturn (\n\t\t\t\t\tcontent.includes(\"export default\") && content.includes(\"async fetch\")\n\t\t\t\t);\n\t\t\t},\n\t\t\terrorMessage: \"Export handler missing or malformed after transformation\",\n\t\t\tcritical: true,\n\t\t});\n\n\t\t// 3. Anchor blocks present\n\t\tchecks.push({\n\t\t\tname: \"anchors-present\",\n\t\t\tdescription: \"Anchor blocks exist\",\n\t\t\tvalidate: async () => {\n\t\t\t\tconst indexPath = join(options.cwd, \"src/index.ts\");\n\t\t\t\tconst validation = await this.anchorService.validateAnchors(indexPath, [\n\t\t\t\t\tAUTH_ANCHORS.IMPORTS,\n\t\t\t\t\tAUTH_ANCHORS.MIDDLEWARE,\n\t\t\t\t]);\n\t\t\t\treturn validation.valid;\n\t\t\t},\n\t\t\terrorMessage:\n\t\t\t\t\"Required anchor blocks missing. Template may not be compatible with add-auth command.\",\n\t\t\tcritical: false, // Warning only\n\t\t});\n\n\t\t// 4. Auth imports present\n\t\tchecks.push({\n\t\t\tname: \"auth-imports\",\n\t\t\tdescription: \"Auth imports added\",\n\t\t\tvalidate: async () => {\n\t\t\t\tconst indexPath = join(options.cwd, \"src/index.ts\");\n\t\t\t\tif (!existsSync(indexPath)) return false;\n\n\t\t\t\tconst content = await readFile(indexPath, \"utf-8\");\n\t\t\t\treturn (\n\t\t\t\t\tcontent.includes(\"getAuthProvider\") &&\n\t\t\t\t\tcontent.includes(\"AuthenticationError\")\n\t\t\t\t);\n\t\t\t},\n\t\t\terrorMessage: \"Auth imports not properly added to index.ts\",\n\t\t\tcritical: true,\n\t\t});\n\n\t\t// 5. Auth middleware present\n\t\tchecks.push({\n\t\t\tname: \"auth-middleware\",\n\t\t\tdescription: \"Auth middleware added\",\n\t\t\tvalidate: async () => {\n\t\t\t\tconst indexPath = join(options.cwd, \"src/index.ts\");\n\t\t\t\tif (!existsSync(indexPath)) return false;\n\n\t\t\t\tconst content = await readFile(indexPath, \"utf-8\");\n\t\t\t\treturn (\n\t\t\t\t\tcontent.includes(\"Authorization\") && content.includes(\"validateToken\")\n\t\t\t\t);\n\t\t\t},\n\t\t\terrorMessage: \"Auth middleware not properly added to fetch handler\",\n\t\t\tcritical: true,\n\t\t});\n\n\t\t// 6. Config vars present (if provider specified)\n\t\tif (options.provider) {\n\t\t\tchecks.push({\n\t\t\t\tname: \"config-vars\",\n\t\t\t\tdescription: \"Auth config variables\",\n\t\t\t\tvalidate: async () => {\n\t\t\t\t\tconst wranglerPath = getWranglerConfigPath(options.cwd);\n\t\t\t\t\tif (!wranglerPath) return false;\n\n\t\t\t\t\tconst content = await readFile(wranglerPath, \"utf-8\");\n\t\t\t\t\t// Check for provider-specific vars\n\t\t\t\t\tif (options.provider === \"stytch\") {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tcontent.includes(\"STYTCH_PROJECT_ID\") &&\n\t\t\t\t\t\t\tcontent.includes(\"STYTCH_SECRET\")\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (options.provider === \"auth0\") {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tcontent.includes(\"AUTH0_DOMAIN\") &&\n\t\t\t\t\t\t\tcontent.includes(\"AUTH0_CLIENT_ID\")\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (options.provider === \"workos\") {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tcontent.includes(\"WORKOS_API_KEY\") &&\n\t\t\t\t\t\t\tcontent.includes(\"WORKOS_CLIENT_ID\")\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\terrorMessage: \"Auth environment variables not added to config\",\n\t\t\t\tcritical: true,\n\t\t\t});\n\t\t}\n\n\t\t// 7. Auth files exist\n\t\tchecks.push({\n\t\t\tname: \"auth-files-exist\",\n\t\t\tdescription: \"Auth files created\",\n\t\t\tvalidate: async () => {\n\t\t\t\tconst authDir = join(options.cwd, \"src/auth\");\n\t\t\t\tconst requiredFiles = [\"config.ts\", \"types.ts\"];\n\n\t\t\t\tif (options.provider) {\n\t\t\t\t\trequiredFiles.push(`providers/${options.provider}.ts`);\n\t\t\t\t}\n\n\t\t\t\treturn requiredFiles.every((f) => existsSync(join(authDir, f)));\n\t\t\t},\n\t\t\terrorMessage: \"Required auth files missing\",\n\t\t\tcritical: true,\n\t\t});\n\n\t\t// 8. No duplicate imports\n\t\tchecks.push({\n\t\t\tname: \"no-duplicate-imports\",\n\t\t\tdescription: \"No duplicate imports\",\n\t\t\tvalidate: async () => {\n\t\t\t\tconst indexPath = join(options.cwd, \"src/index.ts\");\n\t\t\t\tif (!existsSync(indexPath)) return false;\n\n\t\t\t\tconst content = await readFile(indexPath, \"utf-8\");\n\t\t\t\tconst importLines = content\n\t\t\t\t\t.split(\"\\n\")\n\t\t\t\t\t.filter((l) => l.trim().startsWith(\"import\"));\n\n\t\t\t\t// Check for duplicate auth imports\n\t\t\t\tconst authImports = importLines.filter(\n\t\t\t\t\t(l) => l.includes(\"getAuthProvider\") || l.includes(\"AuthenticationError\")\n\t\t\t\t);\n\n\t\t\t\treturn authImports.length <= 2; // One for each\n\t\t\t},\n\t\t\terrorMessage: \"Duplicate imports detected (transformation may have run twice)\",\n\t\t\tcritical: false,\n\t\t});\n\n\t\treturn checks;\n\t}\n\n\t/**\n\t * Run a quick validation (skips type check)\n\t */\n\tasync quickValidate(\n\t\toptions: ValidationGateOptions,\n\t): Promise<ValidationGateResult> {\n\t\treturn this.validate({\n\t\t\t...options,\n\t\t\tskipTypeCheck: true,\n\t\t\trollbackOnFailure: false,\n\t\t});\n\t}\n\n\t/**\n\t * Run only critical checks\n\t */\n\tasync validateCritical(\n\t\toptions: ValidationGateOptions,\n\t): Promise<ValidationGateResult> {\n\t\tconst allChecks = await this.buildChecks(options);\n\t\tconst criticalChecks = allChecks.filter((c) => c.critical);\n\n\t\tconst result: ValidationGateResult = {\n\t\t\tpassed: true,\n\t\t\tpassedChecks: [],\n\t\t\tfailedChecks: [],\n\t\t\trolledBack: false,\n\t\t\terrors: [],\n\t\t};\n\n\t\tfor (const check of criticalChecks) {\n\t\t\ttry {\n\t\t\t\tconst passed = await check.validate();\n\n\t\t\t\tif (passed) {\n\t\t\t\t\tresult.passedChecks.push(check.name);\n\t\t\t\t} else {\n\t\t\t\t\tresult.failedChecks.push(check.name);\n\t\t\t\t\tresult.errors.push(`${check.name}: ${check.errorMessage}`);\n\t\t\t\t\tresult.passed = false;\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tresult.failedChecks.push(check.name);\n\t\t\t\tresult.errors.push(`${check.name}: ${error}`);\n\t\t\t\tresult.passed = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","/**\n * Auth Scaffold Strategy\n *\n * Strategy for scaffolding authentication in MCP servers.\n * Implements only auth-specific logic while orchestrator handles common flow.\n */\n\nimport { mkdir, writeFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport type { AddAuthOptions, AddAuthResult } from \"../../../../types/command-results.js\";\nimport {\n\tdetectPlatform,\n\tgetEntryPointPath,\n\ttype Platform,\n} from \"../platform-detection.js\";\nimport {\n\tgenerateAuthTypesTemplate,\n\tgenerateAuthConfigTemplate,\n\tgenerateStytchProviderTemplate,\n\tgenerateAuth0ProviderTemplate,\n\tgenerateWorkOSProviderTemplate,\n\tgenerateEnvExampleTemplate,\n\ttype AuthProvider,\n} from \"../auth-templates.js\";\nimport {\n\tgetAuthDependencies,\n\taddDependenciesToPackageJson,\n} from \"../dependency-manager.js\";\nimport {\n\taddAuthToEntryPoint,\n\thasAuthentication,\n} from \"../entry-point-transformer.js\";\nimport {\n\tupdateWranglerConfig,\n\tupdateVercelConfig,\n\tupdateEnvExample,\n} from \"../config/auth-config-updater.js\";\nimport { getWranglerConfigPath } from \"../config/wrangler-utils.js\";\nimport { ValidationGate } from \"../validation-gate.js\";\nimport type {\n\tScaffoldStrategy,\n\tScaffoldContext,\n} from \"../orchestration/types.js\";\n\n/**\n * Configuration for auth scaffolding\n */\nexport interface AuthScaffoldConfig {\n\t/** Auth provider to use */\n\tprovider: AuthProvider;\n\t/** Platform override (auto-detected if not specified) */\n\tplatform?: \"cloudflare\" | \"vercel\";\n\t/** Current working directory */\n\tcwd: string;\n\t/** Proceed even with warnings */\n\tforce?: boolean;\n}\n\n/**\n * Strategy for scaffolding authentication\n *\n * Handles: Stytch, Auth0, WorkOS\n * NEEDS backup/rollback (modifies config files and entry point)\n */\nexport class AuthScaffoldStrategy\n\timplements ScaffoldStrategy<AuthScaffoldConfig, AddAuthResult>\n{\n\t/**\n\t * Validate project structure and auth configuration\n\t */\n\tasync validate(cwd: string, config: AuthScaffoldConfig): Promise<void> {\n\t\t// Step 1: Validate this is an MCP project\n\t\tif (!existsSync(join(cwd, \"package.json\"))) {\n\t\t\tthrow new Error(\"No package.json found. Is this an MCP project?\");\n\t\t}\n\n\t\tif (!existsSync(join(cwd, \"src\"))) {\n\t\t\tthrow new Error(\"No src directory found. Is this an MCP project?\");\n\t\t}\n\n\t\t// Step 2: Detect platform\n\t\tconst detectedPlatform = config.platform || (await detectPlatform(cwd));\n\n\t\tif (detectedPlatform === \"unknown\") {\n\t\t\tthrow new Error(\n\t\t\t\t\"Could not detect platform. Please specify --platform cloudflare or --platform vercel\",\n\t\t\t);\n\t\t}\n\n\t\t// Store detected platform in config for use in execute()\n\t\tconfig.platform = detectedPlatform as \"cloudflare\" | \"vercel\";\n\n\t\t// Step 3: Check for existing auth\n\t\tconst entryPoint = getEntryPointPath(cwd, config.platform);\n\t\tif (existsSync(entryPoint) && (await hasAuthentication(entryPoint))) {\n\t\t\tif (!config.force) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Authentication is already configured. Use --force to overwrite.\",\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Execute auth scaffolding\n\t *\n\t * 1. Create auth directory structure\n\t * 2. Generate auth files\n\t * 3. Add dependencies\n\t * 4. Transform entry point\n\t * 5. Update config files\n\t * 6. Validate transformations\n\t */\n\tasync execute(\n\t\tcontext: ScaffoldContext<AuthScaffoldConfig, AddAuthResult>,\n\t): Promise<void> {\n\t\tconst { cwd, config, result } = context;\n\t\tconst { provider, platform } = config;\n\n\t\t// Platform is guaranteed to be set after validation\n\t\tconst confirmedPlatform = platform as \"cloudflare\" | \"vercel\";\n\n\t\t// Store platform in result\n\t\tresult.platform = confirmedPlatform;\n\n\t\t// Add warning if force was used\n\t\tif (config.force) {\n\t\t\tresult.warnings?.push(\"Overwriting existing authentication configuration\");\n\t\t}\n\n\t\t// Step 1: Create auth directory structure\n\t\tconst authDir = join(cwd, \"src/auth\");\n\t\tawait mkdir(authDir, { recursive: true });\n\t\tawait mkdir(join(authDir, \"providers\"), { recursive: true });\n\n\t\t// Step 2: Generate auth files\n\t\tawait this.generateAuthFiles(cwd, provider, result);\n\n\t\t// Step 3: Add dependencies\n\t\tawait this.addDependencies(cwd, provider, confirmedPlatform, result);\n\n\t\t// Step 4: Transform entry point\n\t\tawait this.transformEntryPoint(cwd, confirmedPlatform, result);\n\n\t\t// Step 5: Update config files\n\t\tawait this.updateConfigFiles(cwd, provider, confirmedPlatform, result);\n\n\t\t// Step 6: Validate transformations\n\t\tawait this.validateTransformations(cwd, provider, context.backupDir, result);\n\n\t\tresult.success = true;\n\t}\n\n\t/**\n\t * Auth needs backup (modifies config files)\n\t */\n\tneedsBackup(): boolean {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Create initial result object\n\t */\n\tcreateResult(): AddAuthResult {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tprovider: \"\", // Will be set by config\n\t\t\tplatform: \"unknown\",\n\t\t\tfilesCreated: [],\n\t\t\tfilesModified: [],\n\t\t\twarnings: [],\n\t\t};\n\t}\n\n\t/**\n\t * Generate authentication files\n\t */\n\tprivate async generateAuthFiles(\n\t\tcwd: string,\n\t\tprovider: AuthProvider,\n\t\tresult: AddAuthResult,\n\t): Promise<void> {\n\t\tconst authDir = join(cwd, \"src/auth\");\n\n\t\t// Generate types.ts\n\t\tconst typesPath = join(authDir, \"types.ts\");\n\t\tawait writeFile(typesPath, generateAuthTypesTemplate());\n\t\tresult.filesCreated.push(typesPath);\n\n\t\t// Generate config.ts\n\t\tconst configPath = join(authDir, \"config.ts\");\n\t\tawait writeFile(configPath, generateAuthConfigTemplate(provider));\n\t\tresult.filesCreated.push(configPath);\n\n\t\t// Generate provider implementation\n\t\tconst providerPath = join(authDir, `providers/${provider}.ts`);\n\t\tlet providerTemplate: string;\n\n\t\tswitch (provider) {\n\t\t\tcase \"stytch\":\n\t\t\t\tproviderTemplate = generateStytchProviderTemplate();\n\t\t\t\tbreak;\n\t\t\tcase \"auth0\":\n\t\t\t\tproviderTemplate = generateAuth0ProviderTemplate();\n\t\t\t\tbreak;\n\t\t\tcase \"workos\":\n\t\t\t\tproviderTemplate = generateWorkOSProviderTemplate();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tawait writeFile(providerPath, providerTemplate);\n\t\tresult.filesCreated.push(providerPath);\n\n\t\t// Store provider in result\n\t\tresult.provider = provider;\n\t}\n\n\t/**\n\t * Add authentication dependencies\n\t */\n\tprivate async addDependencies(\n\t\tcwd: string,\n\t\tprovider: AuthProvider,\n\t\tplatform: \"cloudflare\" | \"vercel\",\n\t\tresult: AddAuthResult,\n\t): Promise<void> {\n\t\tconst deps = getAuthDependencies(provider, platform);\n\t\tconst modified = await addDependenciesToPackageJson(cwd, deps);\n\n\t\tif (modified) {\n\t\t\tresult.filesModified.push(join(cwd, \"package.json\"));\n\t\t}\n\t}\n\n\t/**\n\t * Transform entry point to add authentication\n\t */\n\tprivate async transformEntryPoint(\n\t\tcwd: string,\n\t\tplatform: \"cloudflare\" | \"vercel\",\n\t\tresult: AddAuthResult,\n\t): Promise<void> {\n\t\tconst entryPoint = getEntryPointPath(cwd, platform);\n\n\t\tif (!existsSync(entryPoint)) {\n\t\t\tthrow new Error(`Entry point not found: ${entryPoint}`);\n\t\t}\n\n\t\tconst modified = await addAuthToEntryPoint(entryPoint, platform);\n\n\t\tif (modified) {\n\t\t\tresult.filesModified.push(entryPoint);\n\t\t}\n\t}\n\n\t/**\n\t * Update platform-specific config files\n\t */\n\tprivate async updateConfigFiles(\n\t\tcwd: string,\n\t\tprovider: AuthProvider,\n\t\tplatform: \"cloudflare\" | \"vercel\",\n\t\tresult: AddAuthResult,\n\t): Promise<void> {\n\t\t// Update platform config\n\t\tif (platform === \"cloudflare\") {\n\t\t\tconst modified = await updateWranglerConfig(cwd, provider);\n\t\t\tif (modified) {\n\t\t\t\tconst wranglerPath = getWranglerConfigPath(cwd);\n\t\t\t\tif (wranglerPath) {\n\t\t\t\t\tresult.filesModified.push(wranglerPath);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (platform === \"vercel\") {\n\t\t\tconst modified = await updateVercelConfig(cwd, provider);\n\t\t\tif (modified) {\n\t\t\t\tconst vercelPath = join(cwd, \"vercel.json\");\n\t\t\t\tif (result.filesCreated.includes(vercelPath)) {\n\t\t\t\t\t// Already in filesCreated\n\t\t\t\t} else if (existsSync(vercelPath)) {\n\t\t\t\t\tresult.filesModified.push(vercelPath);\n\t\t\t\t} else {\n\t\t\t\t\tresult.filesCreated.push(vercelPath);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Update .env.example\n\t\tconst envContent = generateEnvExampleTemplate(provider);\n\t\tconst modified = await updateEnvExample(cwd, provider, envContent);\n\n\t\tif (modified) {\n\t\t\tconst envPath = join(cwd, \".env.example\");\n\t\t\tif (existsSync(envPath)) {\n\t\t\t\tresult.filesModified.push(envPath);\n\t\t\t} else {\n\t\t\t\tresult.filesCreated.push(envPath);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Validate all transformations were successful\n\t */\n\tprivate async validateTransformations(\n\t\tcwd: string,\n\t\tprovider: AuthProvider,\n\t\tbackupDir: string | undefined,\n\t\tresult: AddAuthResult,\n\t): Promise<void> {\n\t\tconst validationGate = new ValidationGate();\n\n\t\t// Run quick validation (skip type check for speed)\n\t\t// Type check can be run by user with npm run type-check\n\t\tconst validationResult = await validationGate.quickValidate({\n\t\t\tcwd,\n\t\t\tbackupDir,\n\t\t\tprovider,\n\t\t\trollbackOnFailure: false, // Orchestrator handles rollback\n\t\t});\n\n\t\t// If critical checks failed, throw error to trigger rollback\n\t\tif (!validationResult.passed) {\n\t\t\tconst errorMessage = [\n\t\t\t\t\"Auth transformation validation failed:\",\n\t\t\t\t...validationResult.errors,\n\t\t\t].join(\"\\n  - \");\n\n\t\t\tthrow new Error(errorMessage);\n\t\t}\n\n\t\t// Log passed checks as info\n\t\tif (validationResult.passedChecks.length > 0) {\n\t\t\tresult.warnings?.push(\n\t\t\t\t` Validation passed: ${validationResult.passedChecks.join(\", \")}`,\n\t\t\t);\n\t\t}\n\t}\n}\n","/**\n * Auth Scaffolder\n *\n * Facade for adding authentication to MCP servers.\n * Delegates to ScaffoldOrchestrator with AuthScaffoldStrategy.\n *\n * Refactored from 333 lines  60 lines using orchestration pattern.\n */\n\nimport type { AddAuthOptions, AddAuthResult } from \"../../../types/command-results.js\";\nimport { ScaffoldOrchestrator } from \"./orchestration/scaffold-orchestrator.js\";\nimport {\n\tAuthScaffoldStrategy,\n\ttype AuthScaffoldConfig,\n} from \"./strategies/auth-scaffold-strategy.js\";\n\nexport class AuthScaffolder {\n\tprivate orchestrator: ScaffoldOrchestrator<AuthScaffoldConfig, AddAuthResult>;\n\tprivate strategy: AuthScaffoldStrategy;\n\n\tconstructor() {\n\t\tthis.orchestrator = new ScaffoldOrchestrator();\n\t\tthis.strategy = new AuthScaffoldStrategy();\n\t}\n\n\t/**\n\t * Add authentication to an MCP server project\n\t */\n\tasync addAuth(options: AddAuthOptions): Promise<AddAuthResult> {\n\t\tconst cwd = options.cwd || process.cwd();\n\t\tconst dryRun = options.dryRun || false;\n\t\tconst skipBackup = options.backup === false; // Default: create backup\n\n\t\t// Convert options to strategy config\n\t\tconst config: AuthScaffoldConfig = {\n\t\t\tprovider: options.provider,\n\t\t\tplatform: options.platform,\n\t\t\tcwd,\n\t\t\tforce: options.force,\n\t\t};\n\n\t\t// Handle dry run\n\t\tif (dryRun) {\n\t\t\tconst result = this.strategy.createResult();\n\t\t\tresult.provider = options.provider;\n\t\t\tresult.warnings?.push(\"DRY RUN: No changes will be made\");\n\n\t\t\t// Validate only (don't execute)\n\t\t\ttry {\n\t\t\t\tawait this.strategy.validate(cwd, config);\n\t\t\t\t// After validation, platform will be set in config\n\t\t\t\tresult.platform = config.platform || \"unknown\";\n\t\t\t\tresult.success = true;\n\t\t\t} catch (error) {\n\t\t\t\tresult.error = error instanceof Error ? error.message : String(error);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\t// Delegate to orchestrator + strategy, catch errors and return result\n\t\ttry {\n\t\t\treturn await this.orchestrator.scaffold(cwd, config, this.strategy, {\n\t\t\t\tskipBackup,\n\t\t\t\tdryRun: false,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t// Convert error to result format (auth tests expect this)\n\t\t\tconst result = this.strategy.createResult();\n\t\t\tresult.provider = options.provider;\n\t\t\t// Preserve platform if it was detected during validation\n\t\t\tresult.platform = config.platform || \"unknown\";\n\t\t\tresult.error = error instanceof Error ? error.message : String(error);\n\t\t\treturn result;\n\t\t}\n\t}\n}\n","/**\n * Add Auth Command\n *\n * Adds authentication to an existing MCP server project.\n * Supports Stytch, Auth0, and WorkOS providers.\n * Works with Cloudflare Workers and Vercel/Next.js platforms.\n */\n\nimport { Command } from \"commander\";\nimport type { AddAuthOptions, AddAuthResult } from \"../../types/command-results.js\";\nimport { AuthScaffolder } from \"./shared/auth-scaffolder.js\";\n\ninterface AddAuthCommandOptions {\n\tprovider: \"stytch\" | \"auth0\" | \"workos\";\n\tplatform?: \"cloudflare\" | \"vercel\";\n\tforce?: boolean;\n\tdryRun?: boolean;\n\tbackup?: boolean;\n\tjson?: boolean;\n\tcwd?: string;\n}\n\n/**\n * Add authentication to MCP server\n */\nexport async function addAuth(\n\toptions: AddAuthCommandOptions,\n): Promise<AddAuthResult> {\n\tconst scaffolder = new AuthScaffolder();\n\n\tconst scaffoldOptions: AddAuthOptions = {\n\t\tprovider: options.provider,\n\t\tplatform: options.platform,\n\t\tforce: options.force,\n\t\tdryRun: options.dryRun,\n\t\tbackup: options.backup,\n\t\tcwd: options.cwd,\n\t};\n\n\tconst result = await scaffolder.addAuth(scaffoldOptions);\n\n\t// Output results\n\tif (options.json) {\n\t\tconsole.log(JSON.stringify(result, null, 2));\n\t} else {\n\t\tprintHumanReadableResult(result);\n\t}\n\n\treturn result;\n}\n\n/**\n * Print human-readable result\n */\nfunction printHumanReadableResult(result: AddAuthResult): void {\n\tif (result.success) {\n\t\tconsole.log(\"\\n Authentication added successfully!\\n\");\n\n\t\tconsole.log(`Provider: ${result.provider}`);\n\t\tconsole.log(`Platform: ${result.platform}\\n`);\n\n\t\tif (result.filesCreated.length > 0) {\n\t\t\tconsole.log(\"Files created:\");\n\t\t\tfor (const file of result.filesCreated) {\n\t\t\t\tconsole.log(`  + ${file}`);\n\t\t\t}\n\t\t\tconsole.log();\n\t\t}\n\n\t\tif (result.filesModified.length > 0) {\n\t\t\tconsole.log(\"Files modified:\");\n\t\t\tfor (const file of result.filesModified) {\n\t\t\t\tconsole.log(`  ~ ${file}`);\n\t\t\t}\n\t\t\tconsole.log();\n\t\t}\n\n\t\tif (result.warnings && result.warnings.length > 0) {\n\t\t\tconsole.log(\"  Warnings:\");\n\t\t\tfor (const warning of result.warnings) {\n\t\t\t\tconsole.log(`  ${warning}`);\n\t\t\t}\n\t\t\tconsole.log();\n\t\t}\n\n\t\tconsole.log(\"Next steps:\");\n\t\tconsole.log(\"  1. Run 'npm install' to install auth dependencies\");\n\t\tconsole.log(\"  2. Update .env with your auth provider credentials\");\n\n\t\tif (result.platform === \"cloudflare\") {\n\t\t\tconsole.log(\"  3. Run 'npm run cf-typegen' to update types\");\n\t\t\tconsole.log(\"  4. Test locally with 'npm run dev'\");\n\t\t} else {\n\t\t\tconsole.log(\"  3. Configure Vercel environment variables\");\n\t\t\tconsole.log(\"  4. Test locally with 'npm run dev'\");\n\t\t}\n\n\t\tconsole.log();\n\t} else {\n\t\tconsole.error(\"\\n Failed to add authentication\\n\");\n\t\tconsole.error(`Error: ${result.error}\\n`);\n\n\t\tif (result.warnings && result.warnings.length > 0) {\n\t\t\tconsole.error(\"Warnings:\");\n\t\t\tfor (const warning of result.warnings) {\n\t\t\t\tconsole.error(`  ${warning}`);\n\t\t\t}\n\t\t\tconsole.error();\n\t\t}\n\n\t\tif (result.backupDir) {\n\t\t\tconsole.error(`Backup preserved at: ${result.backupDir}`);\n\t\t\tconsole.error(\"You can manually restore from this backup if needed.\\n\");\n\t\t}\n\n\t\tprocess.exit(1);\n\t}\n}\n\n/**\n * Validate command options\n */\nexport function validateAddAuthOptions(\n\toptions: Partial<AddAuthCommandOptions>,\n): void {\n\tif (!options.provider) {\n\t\tthrow new Error(\n\t\t\t\"Provider is required. Use --provider stytch, --provider auth0, or --provider workos\",\n\t\t);\n\t}\n\n\tconst validProviders = [\"stytch\", \"auth0\", \"workos\"];\n\tif (!validProviders.includes(options.provider)) {\n\t\tthrow new Error(\n\t\t\t`Invalid provider: ${options.provider}. Must be one of: ${validProviders.join(\", \")}`,\n\t\t);\n\t}\n\n\tif (\n\t\toptions.platform &&\n\t\t![\"cloudflare\", \"vercel\"].includes(options.platform)\n\t) {\n\t\tthrow new Error(\n\t\t\t`Invalid platform: ${options.platform}. Must be cloudflare or vercel`,\n\t\t);\n\t}\n}\n\n/**\n * Create the 'add auth' command\n */\nexport function createAddAuthCommand(): Command {\n\tconst command = new Command(\"auth\")\n\t\t.description(\"Add authentication to your MCP server\")\n\t\t.requiredOption(\n\t\t\t\"--provider <provider>\",\n\t\t\t\"Auth provider: stytch, auth0, or workos\",\n\t\t)\n\t\t.option(\n\t\t\t\"--platform <platform>\",\n\t\t\t\"Platform: cloudflare or vercel (auto-detected if not specified)\",\n\t\t)\n\t\t.option(\"--force\", \"Overwrite existing authentication configuration\")\n\t\t.option(\"--dry-run\", \"Show what would be done without making changes\")\n\t\t.option(\"--no-backup\", \"Skip creating backup before modifications\")\n\t\t.option(\"--json\", \"Output result as JSON\")\n\t\t.action(async (options: AddAuthCommandOptions) => {\n\t\t\ttry {\n\t\t\t\t// Validate options\n\t\t\t\tvalidateAddAuthOptions(options);\n\n\t\t\t\t// Call the main add auth function\n\t\t\t\tawait addAuth(options);\n\t\t\t} catch (error) {\n\t\t\t\tconst errorMessage =\n\t\t\t\t\terror instanceof Error ? error.message : String(error);\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconst result: AddAuthResult = {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tprovider: options.provider || \"unknown\",\n\t\t\t\t\t\tplatform: \"unknown\",\n\t\t\t\t\t\tfilesCreated: [],\n\t\t\t\t\t\tfilesModified: [],\n\t\t\t\t\t\terror: errorMessage,\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`\\n Error: ${errorMessage}\\n`);\n\t\t\t\t}\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n\n\treturn command;\n}\n","/**\n * Binding Types - Type definitions for Cloudflare binding scaffolding\n *\n * This module defines types for scaffolding Cloudflare Workers bindings\n * (KV, D1, R2, Queues, etc.) in MCP servers.\n */\n\n/**\n * Supported Cloudflare binding types\n *\n * Phase 1: kv, d1, r2 (implemented)\n * Phase 2: ai (implemented)\n * Phase 3: queues\n * Phase 4: vectorize, hyperdrive\n */\nexport type BindingType = 'kv' | 'd1' | 'r2' | 'queues' | 'ai' | 'vectorize' | 'hyperdrive';\n\n/**\n * Phase 1 binding types (storage primitives)\n */\nexport type Phase1BindingType = Extract<BindingType, 'kv' | 'd1' | 'r2'>;\n\n/**\n * Phase 2 binding types (AI/ML primitives)\n */\nexport type Phase2BindingType = Extract<BindingType, 'ai'>;\n\n/**\n * Configuration for scaffolding a Cloudflare binding\n */\nexport interface BindingScaffoldConfig {\n  /**\n   * Type of binding to scaffold\n   */\n  bindingType: BindingType;\n\n  /**\n   * Name of the binding in UPPER_SNAKE_CASE format\n   * Example: MY_CACHE, MY_DATABASE, USER_DATA\n   *\n   * Must match pattern: /^[A-Z][A-Z0-9_]*$/\n   */\n  bindingName: string;\n\n  /**\n   * Database name for D1 bindings (optional)\n   * If not provided, will be generated from bindingName\n   * Example: \"my-database\" for MY_DATABASE binding\n   */\n  databaseName?: string;\n\n  /**\n   * Bucket name for R2 bindings (optional, Phase 2)\n   * If not provided, will be generated from bindingName\n   */\n  bucketName?: string;\n\n  /**\n   * Whether to skip helper generation (advanced use case)\n   * Default: false\n   */\n  skipHelper?: boolean;\n\n  /**\n   * Whether to skip running cf-typegen after config update\n   * Default: false (will run cf-typegen)\n   */\n  skipTypegen?: boolean;\n}\n\n/**\n * Result of binding scaffolding operation\n */\nexport interface BindingScaffoldResult {\n  /**\n   * Whether the scaffolding operation succeeded\n   */\n  success: boolean;\n\n  /**\n   * Type of binding that was scaffolded\n   */\n  bindingType: BindingType;\n\n  /**\n   * Name of the binding that was created\n   */\n  bindingName: string;\n\n  /**\n   * Path to the generated helper file (if generated)\n   */\n  helperPath?: string;\n\n  /**\n   * Paths to all files that were created\n   */\n  filesCreated: string[];\n\n  /**\n   * Paths to all files that were modified\n   */\n  filesModified: string[];\n\n  /**\n   * Next steps for the user to complete the setup\n   */\n  nextSteps: string[];\n\n  /**\n   * Error message if scaffolding failed\n   */\n  error?: string;\n\n  /**\n   * Warning messages (non-fatal issues)\n   */\n  warnings?: string[];\n\n  /**\n   * Additional metadata specific to the binding type\n   */\n  metadata?: Record<string, any>;\n}\n\n/**\n * Template variables for Handlebars templates\n */\nexport interface BindingTemplateVars {\n  /**\n   * Original binding name in UPPER_SNAKE_CASE\n   * Example: MY_CACHE\n   */\n  BINDING_NAME: string;\n\n  /**\n   * Helper class name in PascalCase\n   * Example: MyCacheKV, MyDatabaseD1\n   */\n  HELPER_CLASS_NAME: string;\n\n  /**\n   * Kebab-case name for file paths\n   * Example: my-cache, my-database\n   */\n  KEBAB_NAME: string;\n\n  /**\n   * Camel-case name for variable names\n   * Example: myCache, myDatabase\n   */\n  CAMEL_NAME: string;\n\n  /**\n   * Type suffix (KV, D1, R2, etc.)\n   */\n  TYPE_SUFFIX: string;\n\n  /**\n   * Database name for D1 bindings (optional)\n   */\n  DATABASE_NAME?: string;\n\n  /**\n   * Bucket name for R2 bindings (optional)\n   */\n  BUCKET_NAME?: string;\n\n  /**\n   * Additional binding-specific variables\n   */\n  [key: string]: string | undefined;\n}\n\n/**\n * Validation error for binding configuration\n */\nexport interface BindingValidationError {\n  /**\n   * Error message\n   */\n  message: string;\n\n  /**\n   * Field that caused the error\n   */\n  field?: string;\n\n  /**\n   * Suggested fix for the error\n   */\n  suggestion?: string;\n}\n\n/**\n * Options for binding validator\n */\nexport interface BindingValidatorOptions {\n  /**\n   * Whether to check for duplicate bindings\n   * Default: true\n   */\n  checkDuplicates?: boolean;\n\n  /**\n   * Whether to validate anchor presence\n   * Default: true\n   */\n  checkAnchors?: boolean;\n\n  /**\n   * Whether to validate project structure\n   * Default: true\n   */\n  checkProjectStructure?: boolean;\n}\n\n/**\n * Binding configuration in wrangler.jsonc\n */\nexport interface WranglerBindingConfig {\n  /**\n   * KV namespace bindings\n   */\n  kv_namespaces?: Array<{\n    binding: string;\n    id?: string;\n    preview_id?: string;\n  }>;\n\n  /**\n   * D1 database bindings\n   */\n  d1_databases?: Array<{\n    binding: string;\n    database_name: string;\n    database_id?: string;\n    preview_database_id?: string;\n  }>;\n\n  /**\n   * R2 bucket bindings (Phase 2)\n   */\n  r2_buckets?: Array<{\n    binding: string;\n    bucket_name: string;\n    preview_bucket_name?: string;\n  }>;\n\n  /**\n   * Queue bindings (Phase 2)\n   */\n  queues?: {\n    producers?: Array<{\n      binding: string;\n      queue: string;\n    }>;\n    consumers?: Array<{\n      queue: string;\n      max_batch_size?: number;\n      max_batch_timeout?: number;\n    }>;\n  };\n\n  /**\n   * Workers AI binding (Phase 3)\n   */\n  ai?: {\n    binding: string;\n  };\n\n  /**\n   * Vectorize bindings (Phase 3)\n   */\n  vectorize?: Array<{\n    binding: string;\n    index_name: string;\n  }>;\n\n  /**\n   * Hyperdrive bindings (Phase 4)\n   */\n  hyperdrive?: Array<{\n    binding: string;\n    id: string;\n  }>;\n}\n\n/**\n * Type guard to check if a binding type is implemented in Phase 1\n */\nexport function isPhase1Binding(type: BindingType): type is Phase1BindingType {\n  return type === 'kv' || type === 'd1' || type === 'r2';\n}\n\n/**\n * Type guard to check if a binding type is implemented in Phase 2\n */\nexport function isPhase2Binding(type: BindingType): type is Phase2BindingType {\n  return type === 'ai';\n}\n\n/**\n * Get human-readable name for binding type\n */\nexport function getBindingTypeName(type: BindingType): string {\n  const names: Record<BindingType, string> = {\n    kv: 'KV Namespace',\n    d1: 'D1 Database',\n    r2: 'R2 Bucket',\n    queues: 'Queue',\n    ai: 'Workers AI',\n    vectorize: 'Vectorize Index',\n    hyperdrive: 'Hyperdrive Config',\n  };\n  return names[type];\n}\n\n/**\n * Get wrangler.jsonc key for binding type\n */\nexport function getWranglerKey(type: BindingType): string {\n  const keys: Record<BindingType, string> = {\n    kv: 'kv_namespaces',\n    d1: 'd1_databases',\n    r2: 'r2_buckets',\n    queues: 'queues',\n    ai: 'ai',\n    vectorize: 'vectorize',\n    hyperdrive: 'hyperdrive',\n  };\n  return keys[type];\n}\n","/**\n * Binding Validator Service\n *\n * Validates binding configuration before scaffolding.\n * Ensures binding names, project structure, and anchors are valid.\n */\n\nimport { existsSync } from \"node:fs\";\nimport { readFile } from \"node:fs/promises\";\nimport { join } from \"node:path\";\nimport type {\n\tBindingScaffoldConfig,\n\tBindingValidationError,\n\tBindingValidatorOptions,\n\tWranglerBindingConfig,\n} from \"@/types/binding-types.js\";\nimport { getWranglerKey, isPhase1Binding } from \"@/types/binding-types.js\";\nimport { AnchorService, BINDING_ANCHORS } from \"./anchor-service.js\";\n\n/**\n * Service for validating binding configuration\n */\nexport class BindingValidator {\n\tprivate anchorService = new AnchorService();\n\n\t/**\n\t * Validate binding configuration before scaffolding\n\t *\n\t * @throws {Error} If validation fails\n\t */\n\tasync validateBindingConfig(\n\t\tcwd: string,\n\t\tconfig: BindingScaffoldConfig,\n\t\toptions: BindingValidatorOptions = {},\n\t): Promise<void> {\n\t\tconst {\n\t\t\tcheckDuplicates = true,\n\t\t\tcheckAnchors = true,\n\t\t\tcheckProjectStructure = true,\n\t\t} = options;\n\n\t\tconst errors: BindingValidationError[] = [];\n\n\t\t// 1. Validate project structure\n\t\tif (checkProjectStructure) {\n\t\t\tconst structureErrors = await this.validateProjectStructure(cwd);\n\t\t\terrors.push(...structureErrors);\n\t\t}\n\n\t\t// 2. Validate binding name format\n\t\tconst nameError = this.validateBindingName(config.bindingName);\n\t\tif (nameError) {\n\t\t\terrors.push(nameError);\n\t\t}\n\n\t\t// 3. Validate binding type is supported\n\t\tconst typeError = this.validateBindingType(config.bindingType);\n\t\tif (typeError) {\n\t\t\terrors.push(typeError);\n\t\t}\n\n\t\t// 4. Validate binding-specific requirements\n\t\tconst specificErrors = this.validateBindingSpecific(config);\n\t\terrors.push(...specificErrors);\n\n\t\t// 5. Check for duplicate bindings\n\t\tif (checkDuplicates) {\n\t\t\tconst duplicateError = await this.validateNoDuplicateBinding(cwd, config);\n\t\t\tif (duplicateError) {\n\t\t\t\terrors.push(duplicateError);\n\t\t\t}\n\t\t}\n\n\t\t// 6. Validate required anchors exist\n\t\tif (checkAnchors) {\n\t\t\tconst anchorErrors = await this.validateAnchorsExist(cwd, config);\n\t\t\terrors.push(...anchorErrors);\n\t\t}\n\n\t\t// Throw error if any validation failed\n\t\tif (errors.length > 0) {\n\t\t\tconst errorMessages = errors.map((e) => {\n\t\t\t\tlet msg = e.message;\n\t\t\t\tif (e.field) msg = `${e.field}: ${msg}`;\n\t\t\t\tif (e.suggestion) msg += ` (${e.suggestion})`;\n\t\t\t\treturn msg;\n\t\t\t});\n\t\t\tthrow new Error(\n\t\t\t\t`Binding validation failed:\\n${errorMessages.map((m) => `  - ${m}`).join(\"\\n\")}`,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Validate project has required structure\n\t */\n\tprivate async validateProjectStructure(\n\t\tcwd: string,\n\t): Promise<BindingValidationError[]> {\n\t\tconst errors: BindingValidationError[] = [];\n\n\t\t// Check wrangler.jsonc exists\n\t\tconst wranglerPath = join(cwd, \"wrangler.jsonc\");\n\t\tif (!existsSync(wranglerPath)) {\n\t\t\terrors.push({\n\t\t\t\tmessage: \"wrangler.jsonc not found\",\n\t\t\t\tfield: \"project\",\n\t\t\t\tsuggestion:\n\t\t\t\t\t\"This command must be run from a Cloudflare Workers MCP server project\",\n\t\t\t});\n\t\t}\n\n\t\t// Check package.json exists\n\t\tconst packagePath = join(cwd, \"package.json\");\n\t\tif (!existsSync(packagePath)) {\n\t\t\terrors.push({\n\t\t\t\tmessage: \"package.json not found\",\n\t\t\t\tfield: \"project\",\n\t\t\t\tsuggestion: \"This command must be run from an MCP server project\",\n\t\t\t});\n\t\t}\n\n\t\t// Check src directory exists\n\t\tconst srcPath = join(cwd, \"src\");\n\t\tif (!existsSync(srcPath)) {\n\t\t\terrors.push({\n\t\t\t\tmessage: \"src directory not found\",\n\t\t\t\tfield: \"project\",\n\t\t\t\tsuggestion: \"This command must be run from an MCP server project\",\n\t\t\t});\n\t\t}\n\n\t\treturn errors;\n\t}\n\n\t/**\n\t * Validate binding name format\n\t *\n\t * Binding names must be uppercase with underscores (UPPER_SNAKE_CASE)\n\t * Examples: MY_CACHE, USER_DATA, PRODUCT_DB\n\t */\n\tprivate validateBindingName(name: string): BindingValidationError | null {\n\t\t// Must start with uppercase letter\n\t\tif (!/^[A-Z]/.test(name)) {\n\t\t\treturn {\n\t\t\t\tmessage: \"Binding name must start with an uppercase letter\",\n\t\t\t\tfield: \"bindingName\",\n\t\t\t\tsuggestion: `Use UPPER_SNAKE_CASE format (e.g., ${name.toUpperCase()})`,\n\t\t\t};\n\t\t}\n\n\t\t// Must only contain uppercase letters, numbers, and underscores\n\t\tif (!/^[A-Z][A-Z0-9_]*$/.test(name)) {\n\t\t\treturn {\n\t\t\t\tmessage:\n\t\t\t\t\t\"Binding name must only contain uppercase letters, numbers, and underscores\",\n\t\t\t\tfield: \"bindingName\",\n\t\t\t\tsuggestion: \"Use UPPER_SNAKE_CASE format (e.g., MY_CACHE, USER_DATA)\",\n\t\t\t};\n\t\t}\n\n\t\t// Cannot end with underscore\n\t\tif (name.endsWith(\"_\")) {\n\t\t\treturn {\n\t\t\t\tmessage: \"Binding name cannot end with an underscore\",\n\t\t\t\tfield: \"bindingName\",\n\t\t\t\tsuggestion: `Remove trailing underscore: ${name.slice(0, -1)}`,\n\t\t\t};\n\t\t}\n\n\t\t// Cannot have consecutive underscores\n\t\tif (name.includes(\"__\")) {\n\t\t\treturn {\n\t\t\t\tmessage: \"Binding name cannot have consecutive underscores\",\n\t\t\t\tfield: \"bindingName\",\n\t\t\t\tsuggestion: \"Use single underscores to separate words\",\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Validate binding type is supported\n\t */\n\tprivate validateBindingType(type: string): BindingValidationError | null {\n\t\tconst supportedTypes = [\n\t\t\t\"kv\",\n\t\t\t\"d1\",\n\t\t\t\"r2\",\n\t\t\t\"queues\",\n\t\t\t\"ai\",\n\t\t\t\"vectorize\",\n\t\t\t\"hyperdrive\",\n\t\t];\n\n\t\tif (!supportedTypes.includes(type)) {\n\t\t\treturn {\n\t\t\t\tmessage: `Unsupported binding type: ${type}`,\n\t\t\t\tfield: \"bindingType\",\n\t\t\t\tsuggestion: `Supported types: ${supportedTypes.join(\", \")}`,\n\t\t\t};\n\t\t}\n\n\t\t// Check if binding type is implemented (Phase 1 only)\n\t\tif (!isPhase1Binding(type as any)) {\n\t\t\treturn {\n\t\t\t\tmessage: `Binding type '${type}' is not yet implemented`,\n\t\t\t\tfield: \"bindingType\",\n\t\t\t\tsuggestion: \"Phase 1 supports: kv, d1\",\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Validate binding-specific requirements\n\t */\n\tprivate validateBindingSpecific(\n\t\tconfig: BindingScaffoldConfig,\n\t): BindingValidationError[] {\n\t\tconst errors: BindingValidationError[] = [];\n\n\t\t// D1 requires database name or binding name to generate it\n\t\tif (config.bindingType === \"d1\") {\n\t\t\t// Database name is optional but must be valid if provided\n\t\t\tif (\n\t\t\t\tconfig.databaseName &&\n\t\t\t\t!/^[a-z0-9-]+$/.test(config.databaseName)\n\t\t\t) {\n\t\t\t\terrors.push({\n\t\t\t\t\tmessage: \"D1 database name must be lowercase with hyphens only\",\n\t\t\t\t\tfield: \"databaseName\",\n\t\t\t\t\tsuggestion:\n\t\t\t\t\t\t\"Use lowercase letters, numbers, and hyphens (e.g., my-database)\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// R2 requires bucket name or binding name to generate it (Phase 2)\n\t\tif (config.bindingType === \"r2\") {\n\t\t\tif (config.bucketName && !/^[a-z0-9-]+$/.test(config.bucketName)) {\n\t\t\t\terrors.push({\n\t\t\t\t\tmessage: \"R2 bucket name must be lowercase with hyphens only\",\n\t\t\t\t\tfield: \"bucketName\",\n\t\t\t\t\tsuggestion:\n\t\t\t\t\t\t\"Use lowercase letters, numbers, and hyphens (e.g., my-bucket)\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn errors;\n\t}\n\n\t/**\n\t * Check if binding already exists in wrangler.jsonc\n\t */\n\tprivate async validateNoDuplicateBinding(\n\t\tcwd: string,\n\t\tconfig: BindingScaffoldConfig,\n\t): Promise<BindingValidationError | null> {\n\t\tconst wranglerPath = join(cwd, \"wrangler.jsonc\");\n\n\t\ttry {\n\t\t\tconst content = await readFile(wranglerPath, \"utf-8\");\n\n\t\t\t// Parse JSONC (remove comments)\n\t\t\tconst jsonContent = content.replace(/\\/\\/.*$/gm, \"\");\n\t\t\tconst wranglerConfig = JSON.parse(jsonContent) as WranglerBindingConfig;\n\n\t\t\t// Get wrangler key for this binding type\n\t\t\tconst key = getWranglerKey(config.bindingType);\n\n\t\t\t// Check if binding already exists\n\t\t\tlet bindingExists = false;\n\n\t\t\tif (config.bindingType === \"kv\") {\n\t\t\t\tconst kvBindings = wranglerConfig.kv_namespaces || [];\n\t\t\t\tbindingExists = kvBindings.some(\n\t\t\t\t\t(b) => b.binding === config.bindingName,\n\t\t\t\t);\n\t\t\t} else if (config.bindingType === \"d1\") {\n\t\t\t\tconst d1Bindings = wranglerConfig.d1_databases || [];\n\t\t\t\tbindingExists = d1Bindings.some(\n\t\t\t\t\t(b) => b.binding === config.bindingName,\n\t\t\t\t);\n\t\t\t} else if (config.bindingType === \"r2\") {\n\t\t\t\tconst r2Bindings = wranglerConfig.r2_buckets || [];\n\t\t\t\tbindingExists = r2Bindings.some(\n\t\t\t\t\t(b) => b.binding === config.bindingName,\n\t\t\t\t);\n\t\t\t} else if (config.bindingType === \"ai\") {\n\t\t\t\tbindingExists = wranglerConfig.ai?.binding === config.bindingName;\n\t\t\t} else if (config.bindingType === \"vectorize\") {\n\t\t\t\tconst vectorizeBindings = wranglerConfig.vectorize || [];\n\t\t\t\tbindingExists = vectorizeBindings.some(\n\t\t\t\t\t(b) => b.binding === config.bindingName,\n\t\t\t\t);\n\t\t\t} else if (config.bindingType === \"hyperdrive\") {\n\t\t\t\tconst hyperdriveBindings = wranglerConfig.hyperdrive || [];\n\t\t\t\tbindingExists = hyperdriveBindings.some(\n\t\t\t\t\t(b) => b.binding === config.bindingName,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (bindingExists) {\n\t\t\t\treturn {\n\t\t\t\t\tmessage: `Binding '${config.bindingName}' already exists in wrangler.jsonc`,\n\t\t\t\t\tfield: \"bindingName\",\n\t\t\t\t\tsuggestion: \"Choose a different binding name or remove the existing one\",\n\t\t\t\t};\n\t\t\t}\n\t\t} catch (error: any) {\n\t\t\t// If we can't parse wrangler.jsonc, warn but don't fail\n\t\t\t// (anchor service will handle the actual insertion)\n\t\t\tif (error.message?.includes(\"JSON\")) {\n\t\t\t\treturn {\n\t\t\t\t\tmessage: \"Failed to parse wrangler.jsonc\",\n\t\t\t\t\tfield: \"wrangler\",\n\t\t\t\t\tsuggestion:\n\t\t\t\t\t\t\"Ensure wrangler.jsonc is valid JSONC format before adding bindings\",\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Validate required anchor blocks exist\n\t */\n\tprivate async validateAnchorsExist(\n\t\tcwd: string,\n\t\tconfig: BindingScaffoldConfig,\n\t): Promise<BindingValidationError[]> {\n\t\tconst errors: BindingValidationError[] = [];\n\n\t\t// Check wrangler.jsonc has binding anchor\n\t\tconst wranglerPath = join(cwd, \"wrangler.jsonc\");\n\t\tconst bindingAnchor = this.getBindingAnchor(config.bindingType);\n\n\t\tif (bindingAnchor) {\n\t\t\tconst hasWranglerAnchor =\n\t\t\t\tawait this.anchorService.hasAnchor(wranglerPath, bindingAnchor);\n\t\t\tif (!hasWranglerAnchor) {\n\t\t\t\terrors.push({\n\t\t\t\t\tmessage: `Missing anchor block in wrangler.jsonc: ${bindingAnchor.type}`,\n\t\t\t\t\tfield: \"anchors\",\n\t\t\t\t\tsuggestion:\n\t\t\t\t\t\t\"Your project may be outdated. Re-scaffold with latest template or add anchor manually\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Check index.ts has imports anchor\n\t\tconst indexPath = join(cwd, \"src\", \"index.ts\");\n\t\tconst hasImportsAnchor = await this.anchorService.hasAnchor(\n\t\t\tindexPath,\n\t\t\tBINDING_ANCHORS.IMPORTS,\n\t\t);\n\t\tif (!hasImportsAnchor) {\n\t\t\terrors.push({\n\t\t\t\tmessage: `Missing anchor block in src/index.ts: ${BINDING_ANCHORS.IMPORTS.type}`,\n\t\t\t\tfield: \"anchors\",\n\t\t\t\tsuggestion:\n\t\t\t\t\t\"Your project may be outdated. Re-scaffold with latest template or add anchor manually\",\n\t\t\t});\n\t\t}\n\n\t\treturn errors;\n\t}\n\n\t/**\n\t * Get the anchor block for a binding type\n\t */\n\tprivate getBindingAnchor(type: string): (typeof BINDING_ANCHORS)[keyof typeof BINDING_ANCHORS] | null {\n\t\tswitch (type) {\n\t\t\tcase \"kv\":\n\t\t\t\treturn BINDING_ANCHORS.KV;\n\t\t\tcase \"d1\":\n\t\t\t\treturn BINDING_ANCHORS.D1;\n\t\t\tcase \"r2\":\n\t\t\t\treturn BINDING_ANCHORS.R2;\n\t\t\tcase \"queues\":\n\t\t\t\treturn BINDING_ANCHORS.QUEUES_PRODUCERS;\n\t\t\tcase \"ai\":\n\t\t\t\treturn BINDING_ANCHORS.AI;\n\t\t\tcase \"vectorize\":\n\t\t\t\treturn BINDING_ANCHORS.VECTORIZE;\n\t\t\tcase \"hyperdrive\":\n\t\t\t\treturn BINDING_ANCHORS.HYPERDRIVE;\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n}\n","/**\n * Binding Template Service\n *\n * Handles generation of Cloudflare binding helper files from Handlebars templates.\n * Generates type-safe wrapper classes for KV, D1, and other Cloudflare primitives.\n */\n\nimport Handlebars from \"handlebars\";\nimport { readFileSync, statSync } from \"node:fs\";\nimport { join, dirname } from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\nimport { mkdir, writeFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport type {\n\tBindingTemplateVars,\n\tBindingType,\n} from \"@/types/binding-types.js\";\n\n/**\n * Service for generating binding helper files from templates\n */\nexport class BindingTemplateService {\n\tprivate templateCache = new Map<string, HandlebarsTemplateDelegate>();\n\tprivate templatesDir: string;\n\n\tconstructor() {\n\t\t// Get the project root directory (where templates/ folder is)\n\t\tconst __filename = fileURLToPath(import.meta.url);\n\t\tconst __dirname = dirname(__filename);\n\n\t\t// Find templates directory by searching upward from current file\n\t\tlet currentDir = __dirname;\n\t\tlet templatesPath = \"\";\n\n\t\t// Search up to 5 levels for templates/scaffolding/bindings\n\t\tfor (let i = 0; i < 5; i++) {\n\t\t\tconst candidatePath = join(currentDir, \"templates/scaffolding/bindings\");\n\t\t\ttry {\n\t\t\t\t// Check if directory exists (sync is ok in constructor)\n\t\t\t\tif (statSync(candidatePath).isDirectory()) {\n\t\t\t\t\ttemplatesPath = candidatePath;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Directory doesn't exist, try parent\n\t\t\t}\n\t\t\tcurrentDir = dirname(currentDir);\n\t\t}\n\n\t\tif (!templatesPath) {\n\t\t\tthrow new Error(\n\t\t\t\t`Could not locate templates/scaffolding/bindings directory. Searched from: ${__dirname}`,\n\t\t\t);\n\t\t}\n\n\t\tthis.templatesDir = templatesPath;\n\t}\n\n\t/**\n\t * Load and compile a Handlebars template\n\t *\n\t * @param templatePath - Path to template file relative to templates/scaffolding/bindings/\n\t * @returns Compiled Handlebars template\n\t */\n\tprivate loadTemplate(templatePath: string): HandlebarsTemplateDelegate {\n\t\t// Check cache first\n\t\tif (this.templateCache.has(templatePath)) {\n\t\t\treturn this.templateCache.get(templatePath)!;\n\t\t}\n\n\t\t// Load template from file\n\t\tconst fullPath = join(this.templatesDir, templatePath);\n\t\tconst templateContent = readFileSync(fullPath, \"utf-8\");\n\n\t\t// Compile template with noEscape to preserve code formatting\n\t\tconst compiled = Handlebars.compile(templateContent, { noEscape: true });\n\n\t\t// Cache it\n\t\tthis.templateCache.set(templatePath, compiled);\n\n\t\treturn compiled;\n\t}\n\n\t/**\n\t * Generate KV helper file content\n\t *\n\t * @param vars - Template variables\n\t * @returns Generated TypeScript code\n\t */\n\tgenerateKVHelper(vars: BindingTemplateVars): string {\n\t\tconst template = this.loadTemplate(\"kv-helper.hbs\");\n\t\treturn template(vars);\n\t}\n\n\t/**\n\t * Generate D1 helper file content\n\t *\n\t * @param vars - Template variables\n\t * @returns Generated TypeScript code\n\t */\n\tgenerateD1Helper(vars: BindingTemplateVars): string {\n\t\tconst template = this.loadTemplate(\"d1-helper.hbs\");\n\t\treturn template(vars);\n\t}\n\n\t/**\n\t * Generate R2 helper file content\n\t *\n\t * @param vars - Template variables\n\t * @returns Generated TypeScript code\n\t */\n\tgenerateR2Helper(vars: BindingTemplateVars): string {\n\t\tconst template = this.loadTemplate(\"r2-helper.hbs\");\n\t\treturn template(vars);\n\t}\n\n\t/**\n\t * Generate helper file content based on binding type\n\t *\n\t * @param bindingType - Type of binding (kv, d1)\n\t * @param vars - Template variables\n\t * @returns Generated TypeScript code\n\t */\n\tgenerateHelper(\n\t\tbindingType: BindingType,\n\t\tvars: BindingTemplateVars,\n\t): string {\n\t\tswitch (bindingType) {\n\t\t\tcase \"kv\":\n\t\t\t\treturn this.generateKVHelper(vars);\n\t\t\tcase \"d1\":\n\t\t\t\treturn this.generateD1Helper(vars);\n\t\t\tcase \"r2\":\n\t\t\t\treturn this.generateR2Helper(vars);\n\t\t\tcase \"queues\":\n\t\t\tcase \"ai\":\n\t\t\tcase \"vectorize\":\n\t\t\tcase \"hyperdrive\":\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`Binding type '${bindingType}' is not yet implemented (Phase 2+)`,\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unknown binding type: ${bindingType}`);\n\t\t}\n\t}\n\n\t/**\n\t * Generate and write helper file to disk\n\t *\n\t * @param cwd - Project root directory\n\t * @param bindingType - Type of binding (kv, d1)\n\t * @param vars - Template variables\n\t * @returns Path to the created file\n\t */\n\tasync createHelperFile(\n\t\tcwd: string,\n\t\tbindingType: BindingType,\n\t\tvars: BindingTemplateVars,\n\t): Promise<string> {\n\t\t// Generate content\n\t\tconst content = this.generateHelper(bindingType, vars);\n\n\t\t// Determine output path\n\t\tconst bindingsDir = join(cwd, \"src\", \"utils\", \"bindings\");\n\t\tconst fileName = `${bindingType}-${vars.KEBAB_NAME}.ts`;\n\t\tconst outputPath = join(bindingsDir, fileName);\n\n\t\t// Create directory if it doesn't exist\n\t\tif (!existsSync(bindingsDir)) {\n\t\t\tawait mkdir(bindingsDir, { recursive: true });\n\t\t}\n\n\t\t// Write file\n\t\tawait writeFile(outputPath, content, \"utf-8\");\n\n\t\treturn outputPath;\n\t}\n\n\t/**\n\t * Get the expected helper file path without creating it\n\t *\n\t * @param cwd - Project root directory\n\t * @param bindingType - Type of binding (kv, d1)\n\t * @param kebabName - Binding name in kebab-case\n\t * @returns Expected path to the helper file\n\t */\n\tgetHelperPath(\n\t\tcwd: string,\n\t\tbindingType: BindingType,\n\t\tkebabName: string,\n\t): string {\n\t\treturn join(cwd, \"src\", \"utils\", \"bindings\", `${bindingType}-${kebabName}.ts`);\n\t}\n\n\t/**\n\t * Generate import statement for a helper class\n\t *\n\t * @param helperClassName - Name of the helper class (e.g., MyCacheKV)\n\t * @param bindingType - Type of binding (kv, d1)\n\t * @param kebabName - Binding name in kebab-case\n\t * @returns Import statement\n\t */\n\tgenerateImportStatement(\n\t\thelperClassName: string,\n\t\tbindingType: BindingType,\n\t\tkebabName: string,\n\t): string {\n\t\treturn `import { ${helperClassName} } from \"./utils/bindings/${bindingType}-${kebabName}.js\";`;\n\t}\n\n\t/**\n\t * Clear template cache (useful for testing)\n\t */\n\tclearCache(): void {\n\t\tthis.templateCache.clear();\n\t}\n\n\t/**\n\t * Get templates directory path (useful for testing)\n\t */\n\tgetTemplatesDir(): string {\n\t\treturn this.templatesDir;\n\t}\n}\n","/**\n * Binding Configuration Updater\n *\n * Adds Cloudflare bindings (KV, D1, R2, etc.) to wrangler.jsonc and src/index.ts.\n * Uses anchor-based code injection for safe, structured updates.\n */\n\nimport { readFile } from \"node:fs/promises\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport { AnchorService, BINDING_ANCHORS } from \"../anchor-service.js\";\nimport { getWranglerConfigPath } from \"./wrangler-utils.js\";\n\n/**\n * Add KV namespace binding to wrangler.jsonc using anchor service\n *\n * @param cwd - Project root directory\n * @param bindingName - Binding name (e.g., MY_CACHE)\n * @param kvId - Optional KV namespace ID\n * @returns True if binding was added\n */\nexport async function addKVBinding(\n\tcwd: string,\n\tbindingName: string,\n\tkvId?: string,\n): Promise<boolean> {\n\tconst wranglerPath = getWranglerConfigPath(cwd);\n\n\tif (!wranglerPath || !wranglerPath.endsWith(\".jsonc\")) {\n\t\tthrow new Error(\n\t\t\t\"wrangler.jsonc not found. KV bindings require wrangler.jsonc format.\",\n\t\t);\n\t}\n\n\tconst anchorService = new AnchorService();\n\n\t// Check if anchor exists\n\tconst hasAnchor = await anchorService.hasAnchor(\n\t\twranglerPath,\n\t\tBINDING_ANCHORS.KV,\n\t);\n\tif (!hasAnchor) {\n\t\tthrow new Error(\n\t\t\t\"Missing KV anchor block in wrangler.jsonc. Your project may be outdated.\",\n\t\t);\n\t}\n\n\t// Build KV binding entry\n\tconst kvBinding = kvId\n\t\t? `\"kv_namespaces\": [\n\t\t{\n\t\t\t\"binding\": \"${bindingName}\",\n\t\t\t\"id\": \"${kvId}\"\n\t\t}\n\t],`\n\t\t: `\"kv_namespaces\": [\n\t\t{\n\t\t\t\"binding\": \"${bindingName}\",\n\t\t\t\"id\": \"TODO: Run 'wrangler kv namespace create ${bindingName}' and add the ID here\"\n\t\t}\n\t],`;\n\n\t// Insert at KV anchor\n\tconst result = await anchorService.insertAtAnchor(\n\t\twranglerPath,\n\t\tBINDING_ANCHORS.KV,\n\t\tkvBinding,\n\t\t{ indent: \"\\t\" },\n\t);\n\n\treturn result.modified;\n}\n\n/**\n * Add D1 database binding to wrangler.jsonc using anchor service\n *\n * @param cwd - Project root directory\n * @param bindingName - Binding name (e.g., MY_DB)\n * @param databaseName - Database name (e.g., my-database)\n * @param databaseId - Optional D1 database ID\n * @returns True if binding was added\n */\nexport async function addD1Binding(\n\tcwd: string,\n\tbindingName: string,\n\tdatabaseName: string,\n\tdatabaseId?: string,\n): Promise<boolean> {\n\tconst wranglerPath = getWranglerConfigPath(cwd);\n\n\tif (!wranglerPath || !wranglerPath.endsWith(\".jsonc\")) {\n\t\tthrow new Error(\n\t\t\t\"wrangler.jsonc not found. D1 bindings require wrangler.jsonc format.\",\n\t\t);\n\t}\n\n\tconst anchorService = new AnchorService();\n\n\t// Check if anchor exists\n\tconst hasAnchor = await anchorService.hasAnchor(\n\t\twranglerPath,\n\t\tBINDING_ANCHORS.D1,\n\t);\n\tif (!hasAnchor) {\n\t\tthrow new Error(\n\t\t\t\"Missing D1 anchor block in wrangler.jsonc. Your project may be outdated.\",\n\t\t);\n\t}\n\n\t// Build D1 binding entry\n\tconst d1Binding = databaseId\n\t\t? `\"d1_databases\": [\n\t\t{\n\t\t\t\"binding\": \"${bindingName}\",\n\t\t\t\"database_name\": \"${databaseName}\",\n\t\t\t\"database_id\": \"${databaseId}\"\n\t\t}\n\t],`\n\t\t: `\"d1_databases\": [\n\t\t{\n\t\t\t\"binding\": \"${bindingName}\",\n\t\t\t\"database_name\": \"${databaseName}\",\n\t\t\t\"database_id\": \"TODO: Run 'wrangler d1 create ${databaseName}' and add the ID here\"\n\t\t}\n\t],`;\n\n\t// Insert at D1 anchor\n\tconst result = await anchorService.insertAtAnchor(\n\t\twranglerPath,\n\t\tBINDING_ANCHORS.D1,\n\t\td1Binding,\n\t\t{ indent: \"\\t\" },\n\t);\n\n\treturn result.modified;\n}\n\n/**\n * Add R2 bucket binding to wrangler.jsonc using anchor service\n *\n * @param cwd - Project root directory\n * @param bindingName - Binding name (e.g., MY_BUCKET)\n * @param bucketName - Bucket name (e.g., my-bucket)\n * @param previewBucketName - Optional preview bucket name\n * @returns True if binding was added\n */\nexport async function addR2Binding(\n\tcwd: string,\n\tbindingName: string,\n\tbucketName: string,\n\tpreviewBucketName?: string,\n): Promise<boolean> {\n\tconst wranglerPath = getWranglerConfigPath(cwd);\n\n\tif (!wranglerPath || !wranglerPath.endsWith(\".jsonc\")) {\n\t\tthrow new Error(\n\t\t\t\"wrangler.jsonc not found. R2 bindings require wrangler.jsonc format.\",\n\t\t);\n\t}\n\n\tconst anchorService = new AnchorService();\n\n\t// Check if anchor exists\n\tconst hasAnchor = await anchorService.hasAnchor(\n\t\twranglerPath,\n\t\tBINDING_ANCHORS.R2,\n\t);\n\tif (!hasAnchor) {\n\t\tthrow new Error(\n\t\t\t\"Missing R2 anchor block in wrangler.jsonc. Your project may be outdated.\",\n\t\t);\n\t}\n\n\t// Build R2 binding entry\n\tlet r2Binding: string;\n\tif (previewBucketName) {\n\t\tr2Binding = `\"r2_buckets\": [\n\t\t{\n\t\t\t\"binding\": \"${bindingName}\",\n\t\t\t\"bucket_name\": \"${bucketName}\",\n\t\t\t\"preview_bucket_name\": \"${previewBucketName}\"\n\t\t}\n\t],`;\n\t} else {\n\t\tr2Binding = `\"r2_buckets\": [\n\t\t{\n\t\t\t\"binding\": \"${bindingName}\",\n\t\t\t\"bucket_name\": \"${bucketName}\"\n\t\t}\n\t],`;\n\t}\n\n\t// Insert at R2 anchor\n\tconst result = await anchorService.insertAtAnchor(\n\t\twranglerPath,\n\t\tBINDING_ANCHORS.R2,\n\t\tr2Binding,\n\t\t{ indent: \"\\t\" },\n\t);\n\n\treturn result.modified;\n}\n\n/**\n * Add helper import to src/index.ts using anchor service\n *\n * @param cwd - Project root directory\n * @param importStatement - Import statement to add\n * @returns True if import was added\n */\nexport async function addBindingImport(\n\tcwd: string,\n\timportStatement: string,\n): Promise<boolean> {\n\tconst indexPath = join(cwd, \"src\", \"index.ts\");\n\n\tif (!existsSync(indexPath)) {\n\t\tthrow new Error(\"src/index.ts not found\");\n\t}\n\n\tconst anchorService = new AnchorService();\n\n\t// Check if anchor exists\n\tconst hasAnchor = await anchorService.hasAnchor(\n\t\tindexPath,\n\t\tBINDING_ANCHORS.IMPORTS,\n\t);\n\tif (!hasAnchor) {\n\t\tthrow new Error(\n\t\t\t\"Missing bindings import anchor in src/index.ts. Your project may be outdated.\",\n\t\t);\n\t}\n\n\t// Read current file content to get existing imports\n\tconst fileContent = await readFile(indexPath, \"utf-8\");\n\n\t// Extract current content between anchors\n\tconst anchor = BINDING_ANCHORS.IMPORTS;\n\tconst startIdx = fileContent.indexOf(anchor.startMarker);\n\tconst endIdx = fileContent.indexOf(anchor.endMarker);\n\n\tif (startIdx === -1 || endIdx === -1) {\n\t\tthrow new Error(\"Anchor markers not found in src/index.ts\");\n\t}\n\n\tconst currentContent = fileContent\n\t\t.slice(startIdx + anchor.startMarker.length, endIdx)\n\t\t.trim();\n\n\t// Check if import already exists (avoid duplicates)\n\tif (currentContent.includes(importStatement.trim())) {\n\t\treturn false; // Already present, no modification needed\n\t}\n\n\t// Build new content with all imports\n\tlet newContent: string;\n\tif (currentContent === \"\" || currentContent.startsWith(\"//\")) {\n\t\t// Anchor is empty or only has comments\n\t\tnewContent = importStatement;\n\t} else {\n\t\t// Append new import to existing imports\n\t\tnewContent = currentContent + \"\\n\" + importStatement;\n\t}\n\n\t// Insert with force=true to overwrite existing content\n\tconst result = await anchorService.insertAtAnchor(\n\t\tindexPath,\n\t\tBINDING_ANCHORS.IMPORTS,\n\t\tnewContent,\n\t\t{ force: true },\n\t);\n\n\treturn result.modified;\n}\n","/**\n * Binding Scaffold Strategy\n *\n * Strategy for scaffolding Cloudflare bindings in MCP servers.\n * Implements only binding-specific logic while orchestrator handles common flow.\n */\n\nimport { exec } from \"node:child_process\";\nimport { promisify } from \"node:util\";\nimport { existsSync } from \"node:fs\";\nimport type {\n\tBindingScaffoldConfig,\n\tBindingScaffoldResult,\n\tBindingTemplateVars,\n} from \"@/types/binding-types.js\";\nimport { BindingValidator } from \"../binding-validator.js\";\nimport { BindingTemplateService } from \"../binding-template-service.js\";\nimport {\n\taddKVBinding,\n\taddD1Binding,\n\taddR2Binding,\n\taddBindingImport,\n} from \"../config/binding-config-updater.js\";\nimport type {\n\tScaffoldStrategy,\n\tScaffoldContext,\n} from \"../orchestration/types.js\";\n\nconst execAsync = promisify(exec);\n\n/**\n * Convert UPPER_SNAKE_CASE to kebab-case\n */\nfunction toKebabCase(str: string): string {\n\treturn str.toLowerCase().replace(/_/g, \"-\");\n}\n\n/**\n * Convert UPPER_SNAKE_CASE to camelCase\n */\nfunction toCamelCase(str: string): string {\n\tconst kebab = toKebabCase(str);\n\treturn kebab.replace(/-([a-z])/g, (_, letter) => letter.toUpperCase());\n}\n\n/**\n * Convert UPPER_SNAKE_CASE to PascalCase\n */\nfunction toPascalCase(str: string): string {\n\tconst camel = toCamelCase(str);\n\treturn camel.charAt(0).toUpperCase() + camel.slice(1);\n}\n\n/**\n * Strategy for scaffolding Cloudflare bindings\n *\n * Handles: KV, D1 (R2, Queues, etc. planned)\n * NEEDS backup/rollback (modifies config files and creates new files)\n */\nexport class BindingScaffoldStrategy\n\timplements ScaffoldStrategy<BindingScaffoldConfig, BindingScaffoldResult>\n{\n\tprivate validator = new BindingValidator();\n\tprivate templateService = new BindingTemplateService();\n\n\t/**\n\t * Validate binding configuration\n\t */\n\tasync validate(cwd: string, config: BindingScaffoldConfig): Promise<void> {\n\t\tawait this.validator.validateBindingConfig(cwd, config);\n\t}\n\n\t/**\n\t * Execute binding scaffolding\n\t *\n\t * 1. Generate template variables\n\t * 2. Create helper file (if not skipped)\n\t * 3. Update wrangler.jsonc\n\t * 4. Add import to index.ts (if not skipped)\n\t * 5. Run cf-typegen (if not skipped)\n\t * 6. Generate next steps\n\t */\n\tasync execute(\n\t\tcontext: ScaffoldContext<BindingScaffoldConfig, BindingScaffoldResult>,\n\t): Promise<void> {\n\t\tconst { cwd, config, result } = context;\n\n\t\t// Step 1: Generate template variables\n\t\tconst templateVars = this.generateTemplateVars(config);\n\n\t\t// Step 2: Generate and write helper file\n\t\tif (!config.skipHelper) {\n\t\t\tconst helperPath = await this.templateService.createHelperFile(\n\t\t\t\tcwd,\n\t\t\t\tconfig.bindingType,\n\t\t\t\ttemplateVars,\n\t\t\t);\n\t\t\tresult.helperPath = helperPath;\n\t\t\tresult.filesCreated.push(helperPath);\n\t\t}\n\n\t\t// Step 3: Update wrangler.jsonc with binding\n\t\tawait this.updateWranglerConfig(cwd, config, result);\n\n\t\t// Step 4: Add import statement to index.ts\n\t\tif (!config.skipHelper) {\n\t\t\tconst importStatement = this.templateService.generateImportStatement(\n\t\t\t\ttemplateVars.HELPER_CLASS_NAME,\n\t\t\t\tconfig.bindingType,\n\t\t\t\ttemplateVars.KEBAB_NAME,\n\t\t\t);\n\n\t\t\tconst importAdded = await addBindingImport(cwd, importStatement);\n\t\t\tif (importAdded) {\n\t\t\t\tresult.filesModified.push(`${cwd}/src/index.ts`);\n\t\t\t}\n\t\t}\n\n\t\t// Step 5: Run cf-typegen to generate types\n\t\tif (!config.skipTypegen) {\n\t\t\tawait this.runCfTypegen(cwd, result);\n\t\t}\n\n\t\t// Step 6: Generate next steps for user\n\t\tresult.nextSteps = this.generateNextSteps(config, result);\n\n\t\tresult.success = true;\n\t}\n\n\t/**\n\t * Bindings need backup (modifies wrangler.jsonc)\n\t */\n\tneedsBackup(): boolean {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Create initial result object\n\t */\n\tcreateResult(): BindingScaffoldResult {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tbindingType: \"kv\", // Will be overwritten by config\n\t\t\tbindingName: \"\", // Will be overwritten by config\n\t\t\tfilesCreated: [],\n\t\t\tfilesModified: [],\n\t\t\tnextSteps: [],\n\t\t\twarnings: [],\n\t\t};\n\t}\n\n\t/**\n\t * Generate template variables from binding configuration\n\t */\n\tprivate generateTemplateVars(\n\t\tconfig: BindingScaffoldConfig,\n\t): BindingTemplateVars {\n\t\tconst kebabName = toKebabCase(config.bindingName);\n\t\tconst pascalName = toPascalCase(config.bindingName);\n\t\tconst camelName = toCamelCase(config.bindingName);\n\n\t\t// Type suffix (KV, D1, R2, etc.)\n\t\tconst typeSuffix = config.bindingType.toUpperCase();\n\n\t\tconst vars: BindingTemplateVars = {\n\t\t\tBINDING_NAME: config.bindingName,\n\t\t\tHELPER_CLASS_NAME: `${pascalName}${typeSuffix}`,\n\t\t\tKEBAB_NAME: kebabName,\n\t\t\tCAMEL_NAME: camelName,\n\t\t\tTYPE_SUFFIX: typeSuffix,\n\t\t};\n\n\t\t// Add binding-specific variables\n\t\tif (config.bindingType === \"d1\") {\n\t\t\tvars.DATABASE_NAME = config.databaseName || kebabName;\n\t\t}\n\n\t\tif (config.bindingType === \"r2\") {\n\t\t\tvars.BUCKET_NAME = config.bucketName || kebabName;\n\t\t}\n\n\t\treturn vars;\n\t}\n\n\t/**\n\t * Update wrangler.jsonc with binding configuration\n\t */\n\tprivate async updateWranglerConfig(\n\t\tcwd: string,\n\t\tconfig: BindingScaffoldConfig,\n\t\tresult: BindingScaffoldResult,\n\t): Promise<void> {\n\t\tlet modified = false;\n\n\t\tif (config.bindingType === \"kv\") {\n\t\t\tmodified = await addKVBinding(cwd, config.bindingName);\n\t\t} else if (config.bindingType === \"d1\") {\n\t\t\tconst databaseName =\n\t\t\t\tconfig.databaseName || toKebabCase(config.bindingName);\n\t\t\tmodified = await addD1Binding(cwd, config.bindingName, databaseName);\n\t\t} else if (config.bindingType === \"r2\") {\n\t\t\tconst bucketName = config.bucketName || toKebabCase(config.bindingName);\n\t\t\tmodified = await addR2Binding(cwd, config.bindingName, bucketName);\n\t\t} else {\n\t\t\tthrow new Error(\n\t\t\t\t`Binding type '${config.bindingType}' is not yet implemented`,\n\t\t\t);\n\t\t}\n\n\t\tif (modified) {\n\t\t\tresult.filesModified.push(`${cwd}/wrangler.jsonc`);\n\t\t}\n\t}\n\n\t/**\n\t * Run cf-typegen to generate TypeScript types from wrangler.jsonc\n\t */\n\tprivate async runCfTypegen(\n\t\tcwd: string,\n\t\tresult: BindingScaffoldResult,\n\t): Promise<void> {\n\t\ttry {\n\t\t\t// Check if cf-typegen script exists in package.json\n\t\t\tconst packageJsonPath = `${cwd}/package.json`;\n\t\t\tif (!existsSync(packageJsonPath)) {\n\t\t\t\tresult.warnings?.push(\"package.json not found, skipping cf-typegen\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Run cf-typegen\n\t\t\tconst { stdout, stderr } = await execAsync(\"npm run cf-typegen\", {\n\t\t\t\tcwd,\n\t\t\t\ttimeout: 30000, // 30 second timeout\n\t\t\t});\n\n\t\t\tif (stderr && !stderr.includes(\"WARN\")) {\n\t\t\t\tresult.warnings?.push(`cf-typegen warnings: ${stderr}`);\n\t\t\t}\n\n\t\t\t// Add worker-configuration.d.ts to modified files\n\t\t\tconst workerConfigPath = `${cwd}/worker-configuration.d.ts`;\n\t\t\tif (existsSync(workerConfigPath)) {\n\t\t\t\tresult.filesModified.push(workerConfigPath);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tresult.warnings?.push(\n\t\t\t\t`Failed to run cf-typegen: ${error instanceof Error ? error.message : String(error)}. Run 'npm run cf-typegen' manually.`,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Generate next steps for the user\n\t */\n\tprivate generateNextSteps(\n\t\tconfig: BindingScaffoldConfig,\n\t\tresult: BindingScaffoldResult,\n\t): string[] {\n\t\tconst steps: string[] = [];\n\t\tconst templateVars = this.generateTemplateVars(config);\n\n\t\tif (config.bindingType === \"kv\") {\n\t\t\tsteps.push(\n\t\t\t\t`1. Create a KV namespace: wrangler kv namespace create ${config.bindingName}`,\n\t\t\t);\n\t\t\tsteps.push(\n\t\t\t\t\"2. Update the binding ID in wrangler.jsonc with the namespace ID from step 1\",\n\t\t\t);\n\t\t\tsteps.push(\n\t\t\t\t`3. Use the helper class in your tools: new ${templateVars.HELPER_CLASS_NAME}(env.${config.bindingName})`,\n\t\t\t);\n\t\t} else if (config.bindingType === \"d1\") {\n\t\t\tconst databaseName =\n\t\t\t\tconfig.databaseName || toKebabCase(config.bindingName);\n\t\t\tsteps.push(`1. Create a D1 database: wrangler d1 create ${databaseName}`);\n\t\t\tsteps.push(\n\t\t\t\t\"2. Update the database_id in wrangler.jsonc with the database ID from step 1\",\n\t\t\t);\n\t\t\tsteps.push(\n\t\t\t\t`3. Create your schema: wrangler d1 execute ${databaseName} --file=./schema.sql`,\n\t\t\t);\n\t\t\tsteps.push(\n\t\t\t\t`4. Use the helper class in your tools: new ${templateVars.HELPER_CLASS_NAME}(env.${config.bindingName})`,\n\t\t\t);\n\t\t} else if (config.bindingType === \"r2\") {\n\t\t\tconst bucketName = config.bucketName || toKebabCase(config.bindingName);\n\t\t\tsteps.push(`1. Create an R2 bucket: wrangler r2 bucket create ${bucketName}`);\n\t\t\tsteps.push(\n\t\t\t\t`2. Use the helper class in your tools: new ${templateVars.HELPER_CLASS_NAME}(env.${config.bindingName})`,\n\t\t\t);\n\t\t\tsteps.push(\n\t\t\t\t`3. Upload objects: await bucket.put('path/to/file.txt', fileData)`,\n\t\t\t);\n\t\t}\n\n\t\tsteps.push(\"5. Deploy your changes: npm run deploy\");\n\n\t\treturn steps;\n\t}\n}\n","/**\n * Binding Scaffolder\n *\n * Facade for adding Cloudflare bindings to MCP servers.\n * Delegates to ScaffoldOrchestrator with BindingScaffoldStrategy.\n *\n * Refactored from 305 lines  ~70 lines using orchestration pattern.\n */\n\nimport type {\n\tBindingScaffoldConfig,\n\tBindingScaffoldResult,\n} from \"@/types/binding-types.js\";\nimport { ScaffoldOrchestrator } from \"./orchestration/scaffold-orchestrator.js\";\nimport { BindingScaffoldStrategy } from \"./strategies/binding-scaffold-strategy.js\";\n\n/**\n * Service for scaffolding Cloudflare bindings\n */\nexport class BindingScaffolder {\n\tprivate orchestrator: ScaffoldOrchestrator<\n\t\tBindingScaffoldConfig,\n\t\tBindingScaffoldResult\n\t>;\n\tprivate strategy: BindingScaffoldStrategy;\n\n\tconstructor() {\n\t\tthis.orchestrator = new ScaffoldOrchestrator();\n\t\tthis.strategy = new BindingScaffoldStrategy();\n\t}\n\n\t/**\n\t * Add a Cloudflare binding to an MCP server project\n\t *\n\t * @param cwd - Project root directory\n\t * @param config - Binding configuration\n\t * @returns Result with paths to created/modified files\n\t */\n\tasync scaffold(\n\t\tcwd: string,\n\t\tconfig: BindingScaffoldConfig,\n\t): Promise<BindingScaffoldResult> {\n\t\t// Determine if we need backup (skip if skipHelper is true)\n\t\tconst skipBackup = config.skipHelper === true;\n\n\t\t// Delegate to orchestrator + strategy, catch errors and return result\n\t\ttry {\n\t\t\tconst result = await this.orchestrator.scaffold(\n\t\t\t\tcwd,\n\t\t\t\tconfig,\n\t\t\t\tthis.strategy,\n\t\t\t\t{\n\t\t\t\t\tskipBackup,\n\t\t\t\t\tdryRun: false,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\t// Update result with config values (orchestrator doesn't know about these)\n\t\t\tresult.bindingType = config.bindingType;\n\t\t\tresult.bindingName = config.bindingName;\n\n\t\t\treturn result;\n\t\t} catch (error) {\n\t\t\t// Convert error to result format (binding tests expect this)\n\t\t\tconst result = this.strategy.createResult();\n\t\t\tresult.bindingType = config.bindingType;\n\t\t\tresult.bindingName = config.bindingName;\n\t\t\tresult.error = error instanceof Error ? error.message : String(error);\n\n\t\t\t// Add rollback warning if backup was created\n\t\t\tif (!skipBackup) {\n\t\t\t\tresult.warnings?.push(\"Changes have been rolled back due to error\");\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t}\n}\n","/**\n * Add Binding Command\n *\n * Adds Cloudflare bindings to an existing MCP server project.\n * Supports KV namespaces, D1 databases, R2 buckets, and other Cloudflare primitives.\n * Phase 1: KV, D1, and R2 support\n * Phase 2+: Queues, AI, Vectorize, Hyperdrive\n */\n\nimport { Command } from \"commander\";\nimport type {\n\tBindingScaffoldConfig,\n\tBindingScaffoldResult,\n\tBindingType,\n\tPhase1BindingType,\n} from \"@/types/binding-types.js\";\nimport { isPhase1Binding } from \"@/types/binding-types.js\";\nimport { BindingScaffolder } from \"./shared/binding-scaffolder.js\";\n\ninterface AddBindingCommandOptions {\n\tname: string;\n\tdatabase?: string;\n\tbucket?: string;\n\tskipHelper?: boolean;\n\tskipTypegen?: boolean;\n\tjson?: boolean;\n\tcwd?: string;\n}\n\n/**\n * Validate add binding command options\n */\nfunction validateAddBindingOptions(\n\tbindingType: string,\n\toptions: AddBindingCommandOptions,\n): void {\n\t// Validate binding type\n\tconst validTypes: BindingType[] = [\n\t\t\"kv\",\n\t\t\"d1\",\n\t\t\"r2\",\n\t\t\"queues\",\n\t\t\"ai\",\n\t\t\"vectorize\",\n\t\t\"hyperdrive\",\n\t];\n\tif (!validTypes.includes(bindingType as BindingType)) {\n\t\tthrow new Error(\n\t\t\t`Invalid binding type '${bindingType}'. Valid types: ${validTypes.join(\", \")}`,\n\t\t);\n\t}\n\n\t// Check if Phase 1 binding type\n\tif (!isPhase1Binding(bindingType as BindingType)) {\n\t\tthrow new Error(\n\t\t\t`Binding type '${bindingType}' is not yet supported. Phase 1 supports: kv, d1, r2`,\n\t\t);\n\t}\n\n\t// Validate binding name format\n\tif (!options.name) {\n\t\tthrow new Error(\"Binding name is required (--name <NAME>)\");\n\t}\n\n\t// Must be UPPER_SNAKE_CASE\n\tif (!/^[A-Z][A-Z0-9_]*$/.test(options.name)) {\n\t\tthrow new Error(\n\t\t\t`Binding name must be UPPER_SNAKE_CASE (e.g., MY_CACHE, USER_DATA)`,\n\t\t);\n\t}\n\n\t// D1-specific validation\n\tif (bindingType === \"d1\") {\n\t\t// Database name is optional, will be generated from binding name if not provided\n\t}\n}\n\n/**\n * Add Cloudflare binding to MCP server\n */\nexport async function addBinding(\n\tbindingType: Phase1BindingType,\n\toptions: AddBindingCommandOptions,\n): Promise<BindingScaffoldResult> {\n\tconst scaffolder = new BindingScaffolder();\n\n\tconst config: BindingScaffoldConfig = {\n\t\tbindingType,\n\t\tbindingName: options.name,\n\t\tdatabaseName: options.database,\n\t\tbucketName: options.bucket,\n\t\tskipHelper: options.skipHelper,\n\t\tskipTypegen: options.skipTypegen,\n\t};\n\n\tconst result = await scaffolder.scaffold(\n\t\toptions.cwd || process.cwd(),\n\t\tconfig,\n\t);\n\n\t// Output results\n\tif (options.json) {\n\t\tconsole.log(JSON.stringify(result, null, 2));\n\t} else {\n\t\tprintHumanReadableResult(result);\n\t}\n\n\treturn result;\n}\n\n/**\n * Print human-readable result\n */\nfunction printHumanReadableResult(result: BindingScaffoldResult): void {\n\tif (result.success) {\n\t\tconsole.log(\n\t\t\t`\\n ${result.bindingType.toUpperCase()} binding added successfully!\\n`,\n\t\t);\n\n\t\tconsole.log(`Binding: ${result.bindingName}`);\n\t\tconsole.log(`Type: ${result.bindingType.toUpperCase()}\\n`);\n\n\t\tif (result.helperPath) {\n\t\t\tconsole.log(\"Helper class:\");\n\t\t\tconsole.log(`  + ${result.helperPath}\\n`);\n\t\t}\n\n\t\tif (result.filesCreated.length > 0) {\n\t\t\tconsole.log(\"Files created:\");\n\t\t\tfor (const file of result.filesCreated) {\n\t\t\t\tconsole.log(`  + ${file}`);\n\t\t\t}\n\t\t\tconsole.log();\n\t\t}\n\n\t\tif (result.filesModified.length > 0) {\n\t\t\tconsole.log(\"Files modified:\");\n\t\t\tfor (const file of result.filesModified) {\n\t\t\t\tconsole.log(`  ~ ${file}`);\n\t\t\t}\n\t\t\tconsole.log();\n\t\t}\n\n\t\tif (result.warnings && result.warnings.length > 0) {\n\t\t\tconsole.log(\"  Warnings:\");\n\t\t\tfor (const warning of result.warnings) {\n\t\t\t\tconsole.log(`  ${warning}`);\n\t\t\t}\n\t\t\tconsole.log();\n\t\t}\n\n\t\tif (result.nextSteps.length > 0) {\n\t\t\tconsole.log(\"Next steps:\");\n\t\t\tfor (const step of result.nextSteps) {\n\t\t\t\tconsole.log(`  ${step}`);\n\t\t\t}\n\t\t\tconsole.log();\n\t\t}\n\t} else {\n\t\tconsole.error(\"\\n Failed to add binding\\n\");\n\t\tconsole.error(`Error: ${result.error || \"Unknown error\"}\\n`);\n\n\t\tif (result.warnings && result.warnings.length > 0) {\n\t\t\tconsole.error(\"Warnings:\");\n\t\t\tfor (const warning of result.warnings) {\n\t\t\t\tconsole.error(`  ${warning}`);\n\t\t\t}\n\t\t\tconsole.error();\n\t\t}\n\n\t\tprocess.exit(1);\n\t}\n}\n\n/**\n * Create the 'add binding' command\n */\nexport function createAddBindingCommand(): Command {\n\tconst command = new Command(\"binding\")\n\t\t.description(\"Add a Cloudflare binding to your MCP server (Phase 1: kv, d1, r2)\")\n\t\t.argument(\"<type>\", \"Binding type: kv, d1, or r2\")\n\t\t.requiredOption(\"--name <NAME>\", \"Binding name in UPPER_SNAKE_CASE\")\n\t\t.option(\n\t\t\t\"--database <name>\",\n\t\t\t\"Database name (for D1 only, defaults to binding name in kebab-case)\",\n\t\t)\n\t\t.option(\n\t\t\t\"--bucket <name>\",\n\t\t\t\"Bucket name (for R2 only, defaults to binding name in kebab-case)\",\n\t\t)\n\t\t.option(\"--skip-helper\", \"Skip generating helper class\")\n\t\t.option(\"--skip-typegen\", \"Skip running cf-typegen\")\n\t\t.option(\"--json\", \"Output result as JSON\")\n\t\t.action(\n\t\t\tasync (bindingType: string, options: AddBindingCommandOptions) => {\n\t\t\t\ttry {\n\t\t\t\t\t// Validate options\n\t\t\t\t\tvalidateAddBindingOptions(bindingType, options);\n\n\t\t\t\t\t// Call the main add binding function\n\t\t\t\t\tawait addBinding(bindingType as Phase1BindingType, options);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconst errorMessage =\n\t\t\t\t\t\terror instanceof Error ? error.message : String(error);\n\n\t\t\t\t\tif (options.json) {\n\t\t\t\t\t\tconst result: BindingScaffoldResult = {\n\t\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\t\tbindingType: bindingType as BindingType,\n\t\t\t\t\t\t\tbindingName: options.name || \"unknown\",\n\t\t\t\t\t\t\tfilesCreated: [],\n\t\t\t\t\t\t\tfilesModified: [],\n\t\t\t\t\t\t\tnextSteps: [],\n\t\t\t\t\t\t\terror: errorMessage,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(`\\n Error: ${errorMessage}\\n`);\n\t\t\t\t\t}\n\t\t\t\t\tprocess.exit(1);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\treturn command;\n}\n","/**\n * Add Tool Command\n *\n * Scaffolds a new MCP tool with:\n * - Tool file with TODO markers\n * - Unit test file structure\n * - Integration test YAML\n * - Auto-registration in src/index.ts\n */\n\nimport { Command } from \"commander\";\nimport { EntityScaffolder, type ScaffoldConfig } from \"./shared/entity-scaffolder.js\";\nimport { createAddPromptCommand } from \"./add-prompt.js\";\nimport { createAddResourceCommand } from \"./add-resource.js\";\nimport { createAddAuthCommand } from \"./add-auth.js\";\nimport { createAddBindingCommand } from \"./add-binding.js\";\nimport { outputResult } from \"./shared/json-output.js\";\nimport type { AddEntityResult } from \"../../types/command-results.js\";\n\ninterface AddToolOptions {\n\tdescription?: string;\n\ttests: boolean;\n\tregister: boolean;\n\ttemplate: \"simple\" | \"validated\" | \"async\";\n\tjson?: boolean;\n}\n\n/**\n * Create the 'add tool' command\n */\nexport function createAddToolCommand(): Command {\n\tconst command = new Command(\"tool\")\n\t\t.description(\"Add a new MCP tool to the project\")\n\t\t.argument(\"<name>\", \"Tool name (lowercase with hyphens)\")\n\t\t.option(\n\t\t\t\"--description <desc>\",\n\t\t\t\"Tool description\",\n\t\t\t\"TODO: Add description\",\n\t\t)\n\t\t.option(\"--no-tests\", \"Skip test file generation\")\n\t\t.option(\"--no-register\", \"Don't auto-register in index.ts\")\n\t\t.option(\n\t\t\t\"--template <type>\",\n\t\t\t\"Template type: simple|validated|async\",\n\t\t\t\"simple\",\n\t\t)\n\t\t.option(\"--json\", \"Output result as JSON\")\n\t\t.action(async (name: string, options: AddToolOptions) => {\n\t\t\ttry {\n\t\t\t\tconst cwd = process.cwd();\n\t\t\t\tconst scaffolder = new EntityScaffolder();\n\n\t\t\t\t// Configure scaffolding\n\t\t\t\tconst config: ScaffoldConfig = {\n\t\t\t\t\tentityType: \"tool\",\n\t\t\t\t\tname,\n\t\t\t\t\tdescription: options.description,\n\t\t\t\t\tgenerateTests: options.tests,\n\t\t\t\t\tautoRegister: options.register,\n\t\t\t\t};\n\n\t\t\t\t// Scaffold the tool\n\t\t\t\tconst scaffoldResult = await scaffolder.scaffold(cwd, config);\n\n\t\t\t\t// Build result object\n\t\t\t\tconst result: AddEntityResult = {\n\t\t\t\t\tsuccess: scaffoldResult.success,\n\t\t\t\t\tentityType: \"tool\",\n\t\t\t\t\tentityName: name,\n\t\t\t\t\tfilesCreated: scaffoldResult.filesCreated,\n\t\t\t\t\tregistered: scaffoldResult.registered,\n\t\t\t\t\tmessage: `Tool '${name}' created successfully`,\n\t\t\t\t};\n\n\t\t\t\t// Output result\n\t\t\t\toutputResult(result, !!options.json, (r) => {\n\t\t\t\t\tconsole.log(`\\n Adding tool: ${name}\\n`);\n\n\t\t\t\t\tfor (const file of r.filesCreated) {\n\t\t\t\t\t\tconsole.log(` Created ${file}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (r.registered) {\n\t\t\t\t\t\tconsole.log(` Registered in src/index.ts`);\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(`\\n Tool '${name}' created successfully!\\n`);\n\t\t\t\t\tconsole.log(\"Next steps:\");\n\t\t\t\t\tconsole.log(`  1. Edit src/tools/${name}.ts and implement your logic`);\n\t\t\t\t\tconsole.log(`  2. Run 'npm test' to verify tests pass`);\n\t\t\t\t\tconsole.log(`  3. Run 'npm run validate' to check project health\\n`);\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconst errorMessage = error instanceof Error ? error.message : String(error);\n\n\t\t\t\tif (options.json) {\n\t\t\t\t\tconst result: AddEntityResult = {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tentityType: \"tool\",\n\t\t\t\t\t\tentityName: name,\n\t\t\t\t\t\tfilesCreated: [],\n\t\t\t\t\t\tregistered: false,\n\t\t\t\t\t\terror: errorMessage,\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`\\n Error: ${errorMessage}\\n`);\n\t\t\t\t}\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n\n\treturn command;\n}\n\n/**\n * Create the 'add' command group\n */\nexport function createAddCommand(): Command {\n\tconst addCmd = new Command(\"add\").description(\n\t\t\"Add components to your MCP server\",\n\t);\n\n\taddCmd.addCommand(createAddToolCommand());\n\taddCmd.addCommand(createAddPromptCommand());\n\taddCmd.addCommand(createAddResourceCommand());\n\taddCmd.addCommand(createAddAuthCommand());\n\taddCmd.addCommand(createAddBindingCommand());\n\n\treturn addCmd;\n}\n","/**\n * Validate Command\n *\n * Validates an MCP server project:\n * - Checks tool registration in index.ts\n * - Verifies test files exist\n * - Validates integration test YAMLs\n * - Checks .mcp-template.json metadata\n */\n\nimport { Command } from \"commander\";\nimport fs from \"node:fs/promises\";\nimport path from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\nimport yaml from \"yaml\";\nimport { toKebabCase, capitalize } from \"./shared/utils.js\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * Validation issue severity\n */\nexport type IssueSeverity = \"error\" | \"warning\" | \"info\";\n\n/**\n * Validation issue\n */\nexport interface ValidationIssue {\n\tseverity: IssueSeverity;\n\tcategory: string;\n\tmessage: string;\n\tfile?: string;\n\tsuggestion?: string;\n}\n\n/**\n * Validation result\n */\nexport interface ValidationResult {\n\tpassed: boolean;\n\tissues: ValidationIssue[];\n\tsummary: {\n\t\terrors: number;\n\t\twarnings: number;\n\t\tinfo: number;\n\t};\n}\n\n/**\n * Tool metadata\n */\ninterface ToolMetadata {\n\tname: string;\n\tfile: string;\n\tregistered: boolean;\n\thasUnitTest: boolean;\n\thasIntegrationTest: boolean;\n}\n\n/**\n * MCP Template metadata\n */\ninterface McpTemplateMetadata {\n\tid: string;\n\tversion: string;\n\tname: string;\n\tscaffolded_at: string;\n\ttools: ToolMetadata[];\n\t[key: string]: unknown;\n}\n\n/**\n * Create validate command\n */\nexport function createValidateCommand(): Command {\n\treturn new Command(\"validate\")\n\t\t.description(\"Validate MCP server project structure and configuration\")\n\t\t.option(\"--fix\", \"Automatically fix issues where possible\")\n\t\t.option(\"--strict\", \"Fail on warnings (not just errors)\")\n\t\t.option(\"--json\", \"Output result as JSON\")\n\t\t.action(async (options) => {\n\t\t\tconst cwd = process.cwd();\n\n\t\t\tconst result = await validateProject(cwd, options);\n\n\t\t\t// Output results\n\t\t\tif (options.json) {\n\t\t\t\tconsole.log(JSON.stringify(result, null, 2));\n\t\t\t} else {\n\t\t\t\tconsole.log(\" Validating MCP server project...\\n\");\n\t\t\t\tprintValidationResults(result);\n\t\t\t}\n\n\t\t\t// Exit with appropriate code\n\t\t\tif (!result.passed) {\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\t});\n}\n\n/**\n * Validate entire project\n */\nexport async function validateProject(\n\tcwd: string,\n\toptions: { fix?: boolean; strict?: boolean } = {},\n): Promise<ValidationResult> {\n\tconst issues: ValidationIssue[] = [];\n\n\t// 1. Check .mcp-template.json exists\n\tconst metadataPath = path.join(cwd, \".mcp-template.json\");\n\tlet metadata: McpTemplateMetadata | null = null;\n\n\ttry {\n\t\tconst metadataContent = await fs.readFile(metadataPath, \"utf-8\");\n\t\tmetadata = JSON.parse(metadataContent);\n\t} catch (error) {\n\t\tissues.push({\n\t\t\tseverity: \"error\",\n\t\t\tcategory: \"Metadata\",\n\t\t\tmessage: \".mcp-template.json not found or invalid\",\n\t\t\tfile: \".mcp-template.json\",\n\t\t\tsuggestion: \"Run this command from an MCP server project root\",\n\t\t});\n\t\treturn createResult(issues);\n\t}\n\n\t// 2. Discover actual tools in src/tools/\n\tconst toolsDir = path.join(cwd, \"src\", \"tools\");\n\tconst actualTools = await discoverTools(toolsDir);\n\n\t// 3. Check index.ts registrations\n\tconst indexPath = path.join(cwd, \"src\", \"index.ts\");\n\tconst registeredTools = await checkToolRegistrations(indexPath);\n\n\t// 4. Validate tool registrations\n\tfor (const toolFile of actualTools) {\n\t\tconst toolName = path.basename(toolFile, path.extname(toolFile));\n\n\t\t// Skip example files\n\t\tif (toolName.startsWith(\"_example\")) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Check if tool is registered\n\t\tconst isRegistered = registeredTools.includes(toolName);\n\t\tif (!isRegistered) {\n\t\t\t// Convert kebab-case to PascalCase for function names\n\t\t\tconst pascalName = toolName\n\t\t\t\t.split(\"-\")\n\t\t\t\t.map((word) => capitalize(word))\n\t\t\t\t.join(\"\");\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"Registration\",\n\t\t\t\tmessage: `Tool \"${toolName}\" is not registered in src/index.ts`,\n\t\t\t\tfile: toolFile,\n\t\t\t\tsuggestion: `Add: import { register${pascalName}Tool } from \"./tools/${toolName}.js\";\\nregister${pascalName}Tool(this.server);`,\n\t\t\t});\n\t\t}\n\n\t\t// Check for unit test\n\t\tconst unitTestPath = path.join(\n\t\t\tcwd,\n\t\t\t\"test\",\n\t\t\t\"unit\",\n\t\t\t\"tools\",\n\t\t\t`${toolName}.test.ts`,\n\t\t);\n\t\tconst hasUnitTest = await fileExists(unitTestPath);\n\t\tif (!hasUnitTest) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\tcategory: \"Testing\",\n\t\t\t\tmessage: `Tool \"${toolName}\" is missing unit test`,\n\t\t\t\tfile: toolFile,\n\t\t\t\tsuggestion: `Create test/unit/tools/${toolName}.test.ts`,\n\t\t\t});\n\t\t}\n\n\t\t// Check for integration test\n\t\tconst integrationTestPath = path.join(\n\t\t\tcwd,\n\t\t\t\"test\",\n\t\t\t\"integration\",\n\t\t\t\"specs\",\n\t\t\t`${toolName}.yaml`,\n\t\t);\n\t\tconst hasIntegrationTest = await fileExists(integrationTestPath);\n\t\tif (!hasIntegrationTest) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\tcategory: \"Testing\",\n\t\t\t\tmessage: `Tool \"${toolName}\" is missing integration test`,\n\t\t\t\tfile: toolFile,\n\t\t\t\tsuggestion: `Create test/integration/specs/${toolName}.yaml`,\n\t\t\t});\n\t\t}\n\n\t\t// Validate integration test YAML if it exists\n\t\tif (hasIntegrationTest) {\n\t\t\tconst yamlIssues = await validateYaml(integrationTestPath, toolName);\n\t\t\tissues.push(...yamlIssues);\n\t\t}\n\t}\n\n\t// 5. Check for orphaned registrations (registered but file doesn't exist)\n\tfor (const registeredTool of registeredTools) {\n\t\tconst toolFile = actualTools.find((f) => {\n\t\t\tconst fileName = path.basename(f, path.extname(f));\n\t\t\treturn fileName === registeredTool;\n\t\t});\n\t\tif (!toolFile) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"Registration\",\n\t\t\t\tmessage: `Tool \"${registeredTool}\" is registered but file doesn't exist`,\n\t\t\t\tfile: \"src/index.ts\",\n\t\t\t\tsuggestion: `Remove registration or create src/tools/${registeredTool}.ts`,\n\t\t\t});\n\t\t}\n\t}\n\n\t// 6. Validate wrangler.jsonc configuration\n\tconst configIssues = await validateConfiguration(cwd);\n\tissues.push(...configIssues);\n\n\t// 7. Validate .mcp-template.json metadata matches reality\n\tif (metadata) {\n\t\tconst metadataIssues = await validateMetadata(\n\t\t\tmetadata,\n\t\t\tactualTools,\n\t\t\tregisteredTools,\n\t\t\tcwd,\n\t\t);\n\t\tissues.push(...metadataIssues);\n\t}\n\n\treturn createResult(issues, options.strict);\n}\n\n/**\n * Discover tool files in src/tools/\n */\nasync function discoverTools(toolsDir: string): Promise<string[]> {\n\ttry {\n\t\tconst files = await fs.readdir(toolsDir);\n\t\treturn files\n\t\t\t.filter((f) => f.endsWith(\".ts\") && !f.endsWith(\".test.ts\"))\n\t\t\t.map((f) => path.join(toolsDir, f));\n\t} catch (error) {\n\t\treturn [];\n\t}\n}\n\n/**\n * Check which tools are registered in src/index.ts\n */\nasync function checkToolRegistrations(indexPath: string): Promise<string[]> {\n\ttry {\n\t\tconst content = await fs.readFile(indexPath, \"utf-8\");\n\t\tconst registered: string[] = [];\n\n\t\t// Match: registerXxxTool(this.server);\n\t\tconst registerRegex = /register(\\w+)Tool\\(this\\.server\\)/g;\n\t\tlet match: RegExpExecArray | null;\n\n\t\twhile ((match = registerRegex.exec(content)) !== null) {\n\t\t\tconst toolName = toKebabCase(match[1]);\n\t\t\tregistered.push(toolName);\n\t\t}\n\n\t\treturn registered;\n\t} catch (error) {\n\t\treturn [];\n\t}\n}\n\n/**\n * Validate integration test YAML\n */\nasync function validateYaml(\n\tyamlPath: string,\n\ttoolName: string,\n): Promise<ValidationIssue[]> {\n\tconst issues: ValidationIssue[] = [];\n\n\ttry {\n\t\tconst content = await fs.readFile(yamlPath, \"utf-8\");\n\t\tconst data = yaml.parse(content);\n\n\t\t// Check required fields\n\t\tif (!data.name) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"YAML\",\n\t\t\t\tmessage: `Integration test for \"${toolName}\" is missing \"name\" field`,\n\t\t\t\tfile: yamlPath,\n\t\t\t});\n\t\t}\n\n\t\tif (!data.tool) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"YAML\",\n\t\t\t\tmessage: `Integration test for \"${toolName}\" is missing \"tool\" field`,\n\t\t\t\tfile: yamlPath,\n\t\t\t});\n\t\t}\n\n\t\tif (!data.assertions || !Array.isArray(data.assertions)) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"YAML\",\n\t\t\t\tmessage: `Integration test for \"${toolName}\" is missing \"assertions\" array`,\n\t\t\t\tfile: yamlPath,\n\t\t\t});\n\t\t}\n\n\t\t// Check that tool name matches\n\t\tif (data.tool && data.tool !== toolName) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\tcategory: \"YAML\",\n\t\t\t\tmessage: `Integration test tool name \"${data.tool}\" doesn't match file name \"${toolName}\"`,\n\t\t\t\tfile: yamlPath,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tissues.push({\n\t\t\tseverity: \"error\",\n\t\t\tcategory: \"YAML\",\n\t\t\tmessage: `Integration test for \"${toolName}\" has invalid YAML: ${error instanceof Error ? error.message : String(error)}`,\n\t\t\tfile: yamlPath,\n\t\t});\n\t}\n\n\treturn issues;\n}\n\n/**\n * Validate wrangler.jsonc configuration\n */\nasync function validateConfiguration(cwd: string): Promise<ValidationIssue[]> {\n\tconst issues: ValidationIssue[] = [];\n\n\t// Check for wrangler.jsonc or wrangler.json\n\tconst wranglerJsoncPath = path.join(cwd, \"wrangler.jsonc\");\n\tconst wranglerJsonPath = path.join(cwd, \"wrangler.json\");\n\n\tlet wranglerPath: string | null = null;\n\tif (await fileExists(wranglerJsoncPath)) {\n\t\twranglerPath = wranglerJsoncPath;\n\t} else if (await fileExists(wranglerJsonPath)) {\n\t\twranglerPath = wranglerJsonPath;\n\t}\n\n\tif (!wranglerPath) {\n\t\tissues.push({\n\t\t\tseverity: \"error\",\n\t\t\tcategory: \"Configuration\",\n\t\t\tmessage: \"wrangler.jsonc or wrangler.json not found\",\n\t\t\tsuggestion:\n\t\t\t\t\"This project needs a Cloudflare Workers configuration file\",\n\t\t});\n\t\treturn issues;\n\t}\n\n\t// Parse configuration (handle JSONC comments)\n\tlet config: Record<string, unknown>;\n\ttry {\n\t\tconst content = await fs.readFile(wranglerPath, \"utf-8\");\n\t\t// Simple JSONC comment removal (good enough for validation)\n\t\tconst jsonContent = content\n\t\t\t.replace(/\\/\\*[\\s\\S]*?\\*\\//g, \"\") // Remove /* */ comments\n\t\t\t.replace(/\\/\\/.*/g, \"\"); // Remove // comments\n\t\tconfig = JSON.parse(jsonContent);\n\t} catch (error) {\n\t\tissues.push({\n\t\t\tseverity: \"error\",\n\t\t\tcategory: \"Configuration\",\n\t\t\tmessage: `Invalid JSON in ${path.basename(wranglerPath)}: ${error instanceof Error ? error.message : String(error)}`,\n\t\t\tfile: wranglerPath,\n\t\t\tsuggestion: \"Fix JSON syntax errors\",\n\t\t});\n\t\treturn issues;\n\t}\n\n\t// Check required fields\n\tconst requiredFields = [\"name\", \"main\", \"compatibility_date\"];\n\tfor (const field of requiredFields) {\n\t\tif (!config[field]) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"Configuration\",\n\t\t\t\tmessage: `Missing required field \"${field}\" in ${path.basename(wranglerPath)}`,\n\t\t\t\tfile: wranglerPath,\n\t\t\t});\n\t\t}\n\t}\n\n\t// Check for durable_objects configuration\n\tif (!config.durable_objects) {\n\t\tissues.push({\n\t\t\tseverity: \"error\",\n\t\t\tcategory: \"Configuration\",\n\t\t\tmessage: \"Missing 'durable_objects' configuration\",\n\t\t\tfile: wranglerPath,\n\t\t\tsuggestion:\n\t\t\t\t'Add: \"durable_objects\": { \"bindings\": [{ \"name\": \"MCP_OBJECT\", \"class_name\": \"MCPServerAgent\" }] }',\n\t\t});\n\t} else {\n\t\tconst durableObjects = config.durable_objects as Record<string, unknown>;\n\t\tconst bindings = durableObjects.bindings as Array<Record<string, unknown>>;\n\n\t\tif (!bindings || !Array.isArray(bindings)) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"Configuration\",\n\t\t\t\tmessage: \"durable_objects.bindings must be an array\",\n\t\t\t\tfile: wranglerPath,\n\t\t\t});\n\t\t} else {\n\t\t\t// Check for MCP_OBJECT binding\n\t\t\tconst mcpBinding = bindings.find(\n\t\t\t\t(b) => b.name === \"MCP_OBJECT\",\n\t\t\t);\n\t\t\tif (!mcpBinding) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"error\",\n\t\t\t\t\tcategory: \"Configuration\",\n\t\t\t\t\tmessage:\n\t\t\t\t\t\t'Missing \"MCP_OBJECT\" binding in durable_objects.bindings',\n\t\t\t\t\tfile: wranglerPath,\n\t\t\t\t\tsuggestion:\n\t\t\t\t\t\t'Add: { \"name\": \"MCP_OBJECT\", \"class_name\": \"MCPServerAgent\" }',\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Verify class_name is set\n\t\t\t\tif (!mcpBinding.class_name) {\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tseverity: \"error\",\n\t\t\t\t\t\tcategory: \"Configuration\",\n\t\t\t\t\t\tmessage: \"MCP_OBJECT binding is missing class_name\",\n\t\t\t\t\t\tfile: wranglerPath,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Verify class exists in src/index.ts\n\t\t\t\t\tconst indexPath = path.join(cwd, \"src\", \"index.ts\");\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst indexContent = await fs.readFile(indexPath, \"utf-8\");\n\t\t\t\t\t\tconst className = mcpBinding.class_name as string;\n\t\t\t\t\t\tconst classRegex = new RegExp(\n\t\t\t\t\t\t\t`export\\\\s+class\\\\s+${className}\\\\s+extends\\\\s+McpAgent`,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!classRegex.test(indexContent)) {\n\t\t\t\t\t\t\tissues.push({\n\t\t\t\t\t\t\t\tseverity: \"error\",\n\t\t\t\t\t\t\t\tcategory: \"Configuration\",\n\t\t\t\t\t\t\t\tmessage: `Class \"${className}\" not found in src/index.ts or doesn't extend McpAgent`,\n\t\t\t\t\t\t\t\tfile: wranglerPath,\n\t\t\t\t\t\t\t\tsuggestion: `Ensure src/index.ts exports: export class ${className} extends McpAgent<Env>`,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t// src/index.ts not found or unreadable - will be caught by other validation\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Check for migrations configuration\n\tif (!config.migrations) {\n\t\tissues.push({\n\t\t\tseverity: \"error\",\n\t\t\tcategory: \"Configuration\",\n\t\t\tmessage: \"Missing 'migrations' configuration (required for Agents)\",\n\t\t\tfile: wranglerPath,\n\t\t\tsuggestion:\n\t\t\t\t'Add: \"migrations\": [{ \"tag\": \"v1\", \"new_sqlite_classes\": [\"MCPServerAgent\"] }]',\n\t\t});\n\t} else {\n\t\tconst migrations = config.migrations as Array<Record<string, unknown>>;\n\t\tif (!Array.isArray(migrations)) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"Configuration\",\n\t\t\t\tmessage: \"migrations must be an array\",\n\t\t\t\tfile: wranglerPath,\n\t\t\t});\n\t\t} else if (migrations.length === 0) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"error\",\n\t\t\t\tcategory: \"Configuration\",\n\t\t\t\tmessage: \"migrations array is empty\",\n\t\t\t\tfile: wranglerPath,\n\t\t\t\tsuggestion:\n\t\t\t\t\t'Add at least one migration: { \"tag\": \"v1\", \"new_sqlite_classes\": [\"MCPServerAgent\"] }',\n\t\t\t});\n\t\t} else {\n\t\t\t// Check that at least one migration has new_sqlite_classes with MCPServerAgent\n\t\t\tconst hasSqliteClasses = migrations.some((m) => {\n\t\t\t\tconst sqliteClasses = m.new_sqlite_classes as string[];\n\t\t\t\treturn (\n\t\t\t\t\tArray.isArray(sqliteClasses) &&\n\t\t\t\t\tsqliteClasses.some((c) =>\n\t\t\t\t\t\tc.includes(\"MCPServerAgent\") || c.includes(\"McpAgent\"),\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (!hasSqliteClasses) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"warning\",\n\t\t\t\t\tcategory: \"Configuration\",\n\t\t\t\t\tmessage:\n\t\t\t\t\t\t\"No migration includes MCPServerAgent in new_sqlite_classes\",\n\t\t\t\t\tfile: wranglerPath,\n\t\t\t\t\tsuggestion:\n\t\t\t\t\t\t\"Add your Agent class to new_sqlite_classes in migrations\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t// Check for deprecated 'mcp' field (from old template)\n\tif (config.mcp) {\n\t\tissues.push({\n\t\t\tseverity: \"error\",\n\t\t\tcategory: \"Configuration\",\n\t\t\tmessage:\n\t\t\t\t'Deprecated \"mcp\" field found (this field is not recognized by wrangler)',\n\t\t\tfile: wranglerPath,\n\t\t\tsuggestion:\n\t\t\t\t'Remove \"mcp\" field and use \"durable_objects\" instead (see above)',\n\t\t});\n\t}\n\n\treturn issues;\n}\n\n/**\n * Validate .mcp-template.json metadata\n */\nasync function validateMetadata(\n\tmetadata: McpTemplateMetadata,\n\tactualTools: string[],\n\tregisteredTools: string[],\n\tcwd: string,\n): Promise<ValidationIssue[]> {\n\tconst issues: ValidationIssue[] = [];\n\n\t// Check if tools array exists\n\tif (!metadata.tools || !Array.isArray(metadata.tools)) {\n\t\tissues.push({\n\t\t\tseverity: \"warning\",\n\t\t\tcategory: \"Metadata\",\n\t\t\tmessage: \".mcp-template.json is missing tools array\",\n\t\t\tfile: \".mcp-template.json\",\n\t\t\tsuggestion: \"Tools array should track all tools in the project\",\n\t\t});\n\t\treturn issues;\n\t}\n\n\t// Get actual tool names (without examples)\n\tconst actualToolNames = actualTools\n\t\t.map((f) => path.basename(f, path.extname(f)))\n\t\t.filter((name) => !name.startsWith(\"_example\"));\n\n\t// Check for tools in metadata that don't exist\n\tfor (const tool of metadata.tools) {\n\t\tif (!actualToolNames.includes(tool.name)) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\tcategory: \"Metadata\",\n\t\t\t\tmessage: `Tool \"${tool.name}\" in .mcp-template.json doesn't exist`,\n\t\t\t\tfile: \".mcp-template.json\",\n\t\t\t\tsuggestion: \"Remove from tools array or create the tool file\",\n\t\t\t});\n\t\t}\n\t}\n\n\t// Check for tools that exist but aren't in metadata\n\tfor (const toolName of actualToolNames) {\n\t\tconst inMetadata = metadata.tools.find((t) => t.name === toolName);\n\t\tif (!inMetadata) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"info\",\n\t\t\t\tcategory: \"Metadata\",\n\t\t\t\tmessage: `Tool \"${toolName}\" exists but not tracked in .mcp-template.json`,\n\t\t\t\tfile: \".mcp-template.json\",\n\t\t\t\tsuggestion: \"Add to tools array for better tracking\",\n\t\t\t});\n\t\t} else {\n\t\t\t// Verify metadata is accurate\n\t\t\tconst isRegistered = registeredTools.includes(toolName);\n\t\t\tif (inMetadata.registered !== isRegistered) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"info\",\n\t\t\t\t\tcategory: \"Metadata\",\n\t\t\t\t\tmessage: `Tool \"${toolName}\" registration status in .mcp-template.json is incorrect`,\n\t\t\t\t\tfile: \".mcp-template.json\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst unitTestPath = path.join(\n\t\t\t\tcwd,\n\t\t\t\t\"test\",\n\t\t\t\t\"unit\",\n\t\t\t\t\"tools\",\n\t\t\t\t`${toolName}.test.ts`,\n\t\t\t);\n\t\t\tconst hasUnitTest = await fileExists(unitTestPath);\n\t\t\tif (inMetadata.hasUnitTest !== hasUnitTest) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"info\",\n\t\t\t\t\tcategory: \"Metadata\",\n\t\t\t\t\tmessage: `Tool \"${toolName}\" unit test status in .mcp-template.json is incorrect`,\n\t\t\t\t\tfile: \".mcp-template.json\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\treturn issues;\n}\n\n/**\n * Check if file exists\n */\nasync function fileExists(filePath: string): Promise<boolean> {\n\ttry {\n\t\tawait fs.access(filePath);\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Create validation result\n */\nfunction createResult(\n\tissues: ValidationIssue[],\n\tstrict = false,\n): ValidationResult {\n\tconst summary = {\n\t\terrors: issues.filter((i) => i.severity === \"error\").length,\n\t\twarnings: issues.filter((i) => i.severity === \"warning\").length,\n\t\tinfo: issues.filter((i) => i.severity === \"info\").length,\n\t};\n\n\tconst passed = strict\n\t\t? summary.errors === 0 && summary.warnings === 0\n\t\t: summary.errors === 0;\n\n\treturn { passed, issues, summary };\n}\n\n/**\n * Print validation results\n */\nfunction printValidationResults(result: ValidationResult): void {\n\tif (result.issues.length === 0) {\n\t\tconsole.log(\" No issues found! Project is valid.\\n\");\n\t\treturn;\n\t}\n\n\t// Group issues by category\n\tconst byCategory = new Map<string, ValidationIssue[]>();\n\tfor (const issue of result.issues) {\n\t\tconst existing = byCategory.get(issue.category) || [];\n\t\texisting.push(issue);\n\t\tbyCategory.set(issue.category, existing);\n\t}\n\n\t// Print each category\n\tfor (const [category, issues] of byCategory) {\n\t\tconsole.log(`\\n${category}:`);\n\t\tfor (const issue of issues) {\n\t\t\tconst icon =\n\t\t\t\tissue.severity === \"error\"\n\t\t\t\t\t? \"\"\n\t\t\t\t\t: issue.severity === \"warning\"\n\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t: \"\";\n\t\t\tconsole.log(`  ${icon} ${issue.message}`);\n\t\t\tif (issue.file) {\n\t\t\t\tconsole.log(`     File: ${issue.file}`);\n\t\t\t}\n\t\t\tif (issue.suggestion) {\n\t\t\t\tconsole.log(`     Suggestion: ${issue.suggestion}`);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Print summary\n\tconsole.log(`\\n${\"=\".repeat(60)}`);\n\tconsole.log(`Summary: ${result.summary.errors} errors, ${result.summary.warnings} warnings, ${result.summary.info} info`);\n\n\tif (result.passed) {\n\t\tconsole.log(\" Validation passed (no critical errors)\\n\");\n\t} else {\n\t\tconsole.log(\" Validation failed (fix errors above)\\n\");\n\t}\n}\n\n// ============================================================================\n// Public API Exports\n// ============================================================================\n\n/**\n * These exports allow programmatic usage of the validation system.\n * Example:\n *\n * import { validateProject } from 'mcp-server-kit/validation';\n *\n * const result = await validateProject(process.cwd(), { strict: true });\n * if (!result.passed) {\n *   for (const issue of result.issues) {\n *     console.error(`${issue.severity}: ${issue.message}`);\n *   }\n * }\n */\n\n// Types are exported for programmatic usage\n// validateProject is already exported above (line 100)\n","/**\n * Entity Lister - Shared logic for listing MCP entities\n *\n * Provides a unified way to list tools, prompts, and resources\n * with their registration and test status.\n */\n\nimport { Command } from \"commander\";\nimport fs from \"node:fs/promises\";\nimport path from \"node:path\";\nimport { toKebabCase, fileExists } from \"./utils.js\";\n\n/**\n * Configuration for entity listing\n */\nexport interface EntityConfig {\n\t/** Entity type (singular) */\n\tentityType: \"tool\" | \"prompt\" | \"resource\";\n\t/** Entity type (plural) */\n\tentityTypePlural: \"tools\" | \"prompts\" | \"resources\";\n\t/** Source directory (e.g., 'src/tools') */\n\tsourceDir: string;\n\t/** Pattern to match registrations in index.ts */\n\tregistrationPattern: RegExp;\n\t/** Unit test directory (e.g., 'test/unit/tools') */\n\tunitTestDir: string;\n\t/** Integration test directory (e.g., 'test/integration/specs') */\n\tintegrationTestDir: string;\n\t/** Pattern to extract description from entity file */\n\tdescriptionPattern: RegExp;\n}\n\n/**\n * Entity information\n */\nexport interface EntityInfo {\n\tname: string;\n\tfile: string;\n\tregistered: boolean;\n\thasUnitTest: boolean;\n\thasIntegrationTest: boolean;\n\tdescription?: string;\n}\n\n/**\n * Generic entity lister\n */\nexport class EntityLister {\n\tconstructor(private config: EntityConfig) {}\n\n\t/**\n\t * Create Commander command for listing entities\n\t */\n\tcreateCommand(): Command {\n\t\treturn new Command(this.config.entityTypePlural)\n\t\t\t.description(\n\t\t\t\t`List all ${this.config.entityTypePlural} in the MCP server project`,\n\t\t\t)\n\t\t\t.option(\"-j, --json\", \"Output as JSON\")\n\t\t\t.option(\n\t\t\t\t\"-f, --filter <status>\",\n\t\t\t\t\"Filter by status (all, registered, unregistered, tested, untested)\",\n\t\t\t\t\"all\",\n\t\t\t)\n\t\t\t.option(\n\t\t\t\t\"--show-examples\",\n\t\t\t\t`Include example ${this.config.entityTypePlural} in output`,\n\t\t\t)\n\t\t\t.action(async (options) => {\n\t\t\t\tconst cwd = process.cwd();\n\n\t\t\t\ttry {\n\t\t\t\t\tconst entities = await this.discoverEntities(\n\t\t\t\t\t\tcwd,\n\t\t\t\t\t\toptions.showExamples,\n\t\t\t\t\t);\n\n\t\t\t\t\t// Filter entities\n\t\t\t\t\tconst filtered = this.filterEntities(entities, options.filter);\n\n\t\t\t\t\t// Output\n\t\t\t\t\tif (options.json) {\n\t\t\t\t\t\tconsole.log(JSON.stringify(filtered, null, 2));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.printTable(filtered);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t` Error: ${error instanceof Error ? error.message : String(error)}`,\n\t\t\t\t\t);\n\t\t\t\t\tprocess.exit(1);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Discover all entities in the project\n\t */\n\tasync discoverEntities(\n\t\tcwd: string,\n\t\tincludeExamples = false,\n\t): Promise<EntityInfo[]> {\n\t\tconst entities: EntityInfo[] = [];\n\n\t\t// 1. Scan source directory\n\t\tconst sourceDir = path.join(cwd, this.config.sourceDir);\n\t\tlet entityFiles: string[] = [];\n\n\t\ttry {\n\t\t\tconst files = await fs.readdir(sourceDir);\n\t\t\tentityFiles = files\n\t\t\t\t.filter((f) => f.endsWith(\".ts\") && !f.endsWith(\".test.ts\"))\n\t\t\t\t.filter((f) => includeExamples || !f.startsWith(\"_example\"));\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`${this.config.sourceDir}/ directory not found. Are you in an MCP server project?`,\n\t\t\t);\n\t\t}\n\n\t\t// 2. Check index.ts for registrations\n\t\tconst indexPath = path.join(cwd, \"src\", \"index.ts\");\n\t\tconst registeredEntities = await this.checkRegistrations(indexPath);\n\n\t\t// 3. Build entity info\n\t\tfor (const file of entityFiles) {\n\t\t\tconst entityName = path.basename(file, \".ts\");\n\t\t\tconst entityPath = path.join(sourceDir, file);\n\n\t\t\t// Check registration\n\t\t\tconst registered = registeredEntities.includes(entityName);\n\n\t\t\t// Check unit test\n\t\t\tconst unitTestPath = path.join(\n\t\t\t\tcwd,\n\t\t\t\tthis.config.unitTestDir,\n\t\t\t\t`${entityName}.test.ts`,\n\t\t\t);\n\t\t\tconst hasUnitTest = await fileExists(unitTestPath);\n\n\t\t\t// Check integration test\n\t\t\tconst integrationTestPath = path.join(\n\t\t\t\tcwd,\n\t\t\t\tthis.config.integrationTestDir,\n\t\t\t\t`${entityName}.yaml`,\n\t\t\t);\n\t\t\tconst hasIntegrationTest = await fileExists(integrationTestPath);\n\n\t\t\t// Try to extract description from file\n\t\t\tconst description = await this.extractDescription(entityPath);\n\n\t\t\tentities.push({\n\t\t\t\tname: entityName,\n\t\t\t\tfile: path.relative(cwd, entityPath),\n\t\t\t\tregistered,\n\t\t\t\thasUnitTest,\n\t\t\t\thasIntegrationTest,\n\t\t\t\tdescription,\n\t\t\t});\n\t\t}\n\n\t\treturn entities;\n\t}\n\n\t/**\n\t * Check which entities are registered in src/index.ts\n\t */\n\tasync checkRegistrations(indexPath: string): Promise<string[]> {\n\t\ttry {\n\t\t\tconst content = await fs.readFile(indexPath, \"utf-8\");\n\t\t\tconst registered: string[] = [];\n\n\t\t\tlet match: RegExpExecArray | null;\n\n\t\t\twhile ((match = this.config.registrationPattern.exec(content)) !== null) {\n\t\t\t\tconst entityName = toKebabCase(match[1]);\n\t\t\t\tregistered.push(entityName);\n\t\t\t}\n\n\t\t\treturn registered;\n\t\t} catch (error) {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Filter entities by status\n\t */\n\tfilterEntities(entities: EntityInfo[], filter: string): EntityInfo[] {\n\t\tswitch (filter.toLowerCase()) {\n\t\t\tcase \"registered\":\n\t\t\t\treturn entities.filter((e) => e.registered);\n\t\t\tcase \"unregistered\":\n\t\t\t\treturn entities.filter((e) => !e.registered);\n\t\t\tcase \"tested\":\n\t\t\t\treturn entities.filter((e) => e.hasUnitTest || e.hasIntegrationTest);\n\t\t\tcase \"untested\":\n\t\t\t\treturn entities.filter((e) => !e.hasUnitTest && !e.hasIntegrationTest);\n\t\t\tcase \"all\":\n\t\t\tdefault:\n\t\t\t\treturn entities;\n\t\t}\n\t}\n\n\t/**\n\t * Print entities in a formatted table\n\t */\n\tprintTable(entities: EntityInfo[]): void {\n\t\tif (entities.length === 0) {\n\t\t\tconsole.log(`No ${this.config.entityTypePlural} found.\\n`);\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log(\n\t\t\t`\\nFound ${entities.length} ${entities.length === 1 ? this.config.entityType : this.config.entityTypePlural}:\\n`,\n\t\t);\n\n\t\t// Calculate column widths\n\t\tconst nameWidth = Math.max(10, ...entities.map((e) => e.name.length));\n\t\tconst fileWidth = Math.max(20, ...entities.map((e) => e.file.length));\n\n\t\t// Header\n\t\tconst header = `${\"NAME\".padEnd(nameWidth)} | REG | UNIT | INT | ${\"FILE\".padEnd(fileWidth)}`;\n\t\tconsole.log(header);\n\t\tconsole.log(\"=\".repeat(header.length));\n\n\t\t// Rows\n\t\tfor (const entity of entities) {\n\t\t\tconst name = entity.name.padEnd(nameWidth);\n\t\t\tconst reg = entity.registered ? \"  \" : \"  \";\n\t\t\tconst unit = entity.hasUnitTest ? \"  \" : \"  \";\n\t\t\tconst int = entity.hasIntegrationTest ? \"  \" : \"  \";\n\t\t\tconst file = entity.file.padEnd(fileWidth);\n\n\t\t\tconsole.log(`${name} | ${reg} | ${unit} | ${int} | ${file}`);\n\n\t\t\t// Show description if available\n\t\t\tif (entity.description && entity.description !== \"No description\") {\n\t\t\t\tconsole.log(`${\"\".padEnd(nameWidth)}   ${entity.description}`);\n\t\t\t}\n\t\t}\n\n\t\t// Summary\n\t\tconst registered = entities.filter((e) => e.registered).length;\n\t\tconst withUnitTests = entities.filter((e) => e.hasUnitTest).length;\n\t\tconst withIntegrationTests = entities.filter(\n\t\t\t(e) => e.hasIntegrationTest,\n\t\t).length;\n\n\t\tconsole.log(\"\\nSummary:\");\n\t\tconsole.log(`  Registered:       ${registered}/${entities.length}`);\n\t\tconsole.log(`  Unit tests:       ${withUnitTests}/${entities.length}`);\n\t\tconsole.log(\n\t\t\t`  Integration tests: ${withIntegrationTests}/${entities.length}`,\n\t\t);\n\t\tconsole.log(\"\");\n\t}\n\n\t/**\n\t * Extract description from entity file\n\t */\n\tprivate async extractDescription(filePath: string): Promise<string> {\n\t\ttry {\n\t\t\tconst content = await fs.readFile(filePath, \"utf-8\");\n\n\t\t\t// Look for server.{tool|prompt|resource}() call and extract description parameter\n\t\t\tconst match = content.match(this.config.descriptionPattern);\n\n\t\t\tif (match && match[2]) {\n\t\t\t\treturn match[2];\n\t\t\t}\n\n\t\t\t// Fallback: look for file header comment\n\t\t\tconst headerRegex = /\\/\\*\\*[\\s\\S]*?\\*\\s*([^\\n]+)/;\n\t\t\tconst headerMatch = content.match(headerRegex);\n\n\t\t\tif (headerMatch && headerMatch[1]) {\n\t\t\t\treturn headerMatch[1].trim();\n\t\t\t}\n\n\t\t\treturn \"No description\";\n\t\t} catch (error) {\n\t\t\treturn \"No description\";\n\t\t}\n\t}\n}\n","/**\n * List Tools Command\n *\n * Lists all tools in the MCP server project with their status:\n * - Registration status\n * - Test coverage\n * - File locations\n */\n\nimport { Command } from \"commander\";\nimport {\n\tEntityLister,\n\tEntityConfig,\n\tEntityInfo,\n} from \"./shared/entity-lister.js\";\n\n/**\n * Tool information\n */\nexport interface ToolInfo extends EntityInfo {}\n\n/**\n * Configuration for listing tools\n */\nconst toolsConfig: EntityConfig = {\n\tentityType: \"tool\",\n\tentityTypePlural: \"tools\",\n\tsourceDir: \"src/tools\",\n\tregistrationPattern: /register(\\w+)Tool\\(this\\.server\\)/g,\n\tunitTestDir: \"test/unit/tools\",\n\tintegrationTestDir: \"test/integration/specs\",\n\tdescriptionPattern:\n\t\t/server\\.tool\\(\\s*[\"']([^\"']+)[\"'],\\s*[\"']([^\"']+)[\"']/,\n};\n\n/**\n * Create list tools command\n */\nexport function createListToolsCommand(): Command {\n\treturn new EntityLister(toolsConfig).createCommand();\n}\n\n/**\n * Discover all tools in the project\n * @deprecated Use EntityLister.discoverEntities() instead\n */\nexport async function discoverTools(\n\tcwd: string,\n\tincludeExamples = false,\n): Promise<ToolInfo[]> {\n\treturn new EntityLister(toolsConfig).discoverEntities(cwd, includeExamples);\n}\n\n/**\n * Check which tools are registered in src/index.ts\n * @deprecated Use EntityLister.checkRegistrations() instead\n */\nexport async function checkToolRegistrations(indexPath: string): Promise<string[]> {\n\treturn new EntityLister(toolsConfig).checkRegistrations(indexPath);\n}\n\n/**\n * Filter tools by status\n * @deprecated Use EntityLister.filterEntities() instead\n */\nexport function filterTools(tools: ToolInfo[], filter: string): ToolInfo[] {\n\treturn new EntityLister(toolsConfig).filterEntities(tools, filter);\n}\n\n/**\n * Convert PascalCase to kebab-case\n * @deprecated Import from shared/utils.js instead\n */\nexport function toKebabCase(str: string): string {\n\treturn str\n\t\t.replace(/([A-Z])/g, \"-$1\")\n\t\t.toLowerCase()\n\t\t.replace(/^-/, \"\");\n}\n","/**\n * List Prompts Command\n *\n * Lists all prompts in the MCP server project with their status:\n * - Registration status\n * - Test coverage\n * - File locations\n */\n\nimport { Command } from \"commander\";\nimport {\n\tEntityLister,\n\tEntityConfig,\n\tEntityInfo,\n} from \"./shared/entity-lister.js\";\n\n/**\n * Prompt information\n */\nexport interface PromptInfo extends EntityInfo {}\n\n/**\n * Configuration for listing prompts\n */\nconst promptsConfig: EntityConfig = {\n\tentityType: \"prompt\",\n\tentityTypePlural: \"prompts\",\n\tsourceDir: \"src/prompts\",\n\tregistrationPattern: /register(\\w+)Prompt\\(this\\.server\\)/g,\n\tunitTestDir: \"test/unit/prompts\",\n\tintegrationTestDir: \"test/integration/specs/prompts\",\n\tdescriptionPattern:\n\t\t/server\\.prompt\\(\\s*[\"']([^\"']+)[\"'],\\s*[\"']([^\"']+)[\"']/,\n};\n\n/**\n * Create list prompts command\n */\nexport function createListPromptsCommand(): Command {\n\treturn new EntityLister(promptsConfig).createCommand();\n}\n\n/**\n * Discover all prompts in the project\n * @deprecated Use EntityLister.discoverEntities() instead\n */\nexport async function discoverPrompts(\n\tcwd: string,\n\tincludeExamples = false,\n): Promise<PromptInfo[]> {\n\treturn new EntityLister(promptsConfig).discoverEntities(cwd, includeExamples);\n}\n\n/**\n * Check which prompts are registered in src/index.ts\n * @deprecated Use EntityLister.checkRegistrations() instead\n */\nexport async function checkPromptRegistrations(\n\tindexPath: string,\n): Promise<string[]> {\n\treturn new EntityLister(promptsConfig).checkRegistrations(indexPath);\n}\n\n/**\n * Filter prompts by status\n * @deprecated Use EntityLister.filterEntities() instead\n */\nexport function filterPrompts(\n\tprompts: PromptInfo[],\n\tfilter: string,\n): PromptInfo[] {\n\treturn new EntityLister(promptsConfig).filterEntities(prompts, filter);\n}\n\n/**\n * Convert PascalCase to kebab-case\n * @deprecated Import from shared/utils.js instead\n */\nexport function toKebabCase(str: string): string {\n\treturn str\n\t\t.replace(/([A-Z])/g, \"-$1\")\n\t\t.toLowerCase()\n\t\t.replace(/^-/, \"\");\n}\n","/**\n * List Resources Command\n *\n * Lists all resources in the MCP server project with their status:\n * - Registration status\n * - Test coverage\n * - File locations\n */\n\nimport { Command } from \"commander\";\nimport {\n\tEntityLister,\n\tEntityConfig,\n\tEntityInfo,\n} from \"./shared/entity-lister.js\";\n\n/**\n * Resource information\n */\nexport interface ResourceInfo extends EntityInfo {}\n\n/**\n * Configuration for listing resources\n */\nconst resourcesConfig: EntityConfig = {\n\tentityType: \"resource\",\n\tentityTypePlural: \"resources\",\n\tsourceDir: \"src/resources\",\n\tregistrationPattern: /register(\\w+)Resource\\(this\\.server\\)/g,\n\tunitTestDir: \"test/unit/resources\",\n\tintegrationTestDir: \"test/integration/specs/resources\",\n\tdescriptionPattern:\n\t\t/server\\.resource\\(\\s*[\"']([^\"']+)[\"'],\\s*[\"']([^\"']+)[\"']/,\n};\n\n/**\n * Create list resources command\n */\nexport function createListResourcesCommand(): Command {\n\treturn new EntityLister(resourcesConfig).createCommand();\n}\n\n/**\n * Discover all resources in the project\n * @deprecated Use EntityLister.discoverEntities() instead\n */\nexport async function discoverResources(\n\tcwd: string,\n\tincludeExamples = false,\n): Promise<ResourceInfo[]> {\n\treturn new EntityLister(resourcesConfig).discoverEntities(cwd, includeExamples);\n}\n\n/**\n * Check which resources are registered in src/index.ts\n * @deprecated Use EntityLister.checkRegistrations() instead\n */\nexport async function checkResourceRegistrations(\n\tindexPath: string,\n): Promise<string[]> {\n\treturn new EntityLister(resourcesConfig).checkRegistrations(indexPath);\n}\n\n/**\n * Filter resources by status\n * @deprecated Use EntityLister.filterEntities() instead\n */\nexport function filterResources(\n\tresources: ResourceInfo[],\n\tfilter: string,\n): ResourceInfo[] {\n\treturn new EntityLister(resourcesConfig).filterEntities(resources, filter);\n}\n\n/**\n * Convert PascalCase to kebab-case\n * @deprecated Import from shared/utils.js instead\n */\nexport function toKebabCase(str: string): string {\n\treturn str\n\t\t.replace(/([A-Z])/g, \"-$1\")\n\t\t.toLowerCase()\n\t\t.replace(/^-/, \"\");\n}\n","/**\n * List Command\n *\n * Parent command for listing various project elements.\n */\n\nimport { Command } from \"commander\";\nimport { createListToolsCommand } from \"./list-tools.js\";\nimport { createListPromptsCommand } from \"./list-prompts.js\";\nimport { createListResourcesCommand } from \"./list-resources.js\";\n\n/**\n * Create list command\n */\nexport function createListCommand(): Command {\n\tconst listCommand = new Command(\"list\")\n\t\t.description(\"List project elements (tools, prompts, resources, etc.)\");\n\n\t// Add subcommands\n\tlistCommand.addCommand(createListToolsCommand());\n\tlistCommand.addCommand(createListPromptsCommand());\n\tlistCommand.addCommand(createListResourcesCommand());\n\n\treturn listCommand;\n}\n"]}